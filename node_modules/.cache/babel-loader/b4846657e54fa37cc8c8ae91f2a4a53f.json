{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { Path } from '../shape';\nvar sin = Math.sin,\n    cos = Math.cos,\n    atan2 = Math.atan2,\n    PI = Math.PI;\n\nfunction _addDefaultArrow(shape, attrs, x1, y1, x2, y2, isStart) {\n  var stroke = attrs.stroke,\n      lineWidth = attrs.lineWidth;\n  var x = x1 - x2;\n  var y = y1 - y2;\n  var rad = atan2(y, x);\n  var arrowShape = new Path({\n    type: 'path',\n    canvas: shape.get('canvas'),\n    isArrowShape: true,\n    attrs: {\n      // 默认箭头的边长为 10，夹角为 60 度\n      path: \"M\" + 10 * cos(PI / 6) + \",\" + 10 * sin(PI / 6) + \" L0,0 L\" + 10 * cos(PI / 6) + \",-\" + 10 * sin(PI / 6),\n      // 使用 shape stroke 值\n      stroke: stroke,\n      lineWidth: lineWidth\n    }\n  });\n  arrowShape.translate(x2, y2);\n  arrowShape.rotateAtPoint(x2, y2, rad);\n  shape.set(isStart ? 'startArrowShape' : 'endArrowShape', arrowShape);\n}\n/**\n * 箭头 path 的设置要求\n * 1. 箭头顶点坐标需要为 (0, 0)\n * 2. 箭头夹角的中心分割线需要与 X 轴正方向对齐\n */\n\n\nfunction _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, isStart) {\n  var startArrow = attrs.startArrow,\n      endArrow = attrs.endArrow,\n      stroke = attrs.stroke,\n      lineWidth = attrs.lineWidth;\n  var arrowAttrs = isStart ? startArrow : endArrow;\n\n  var d = arrowAttrs.d,\n      arrowFill = arrowAttrs.fill,\n      arrowStroke = arrowAttrs.stroke,\n      arrowLineWidth = arrowAttrs.lineWidth,\n      restAttrs = __rest(arrowAttrs, [\"d\", \"fill\", \"stroke\", \"lineWidth\"]);\n\n  var x = x1 - x2;\n  var y = y1 - y2;\n  var rad = atan2(y, x);\n\n  if (d) {\n    x2 = x2 - cos(rad) * d;\n    y2 = y2 - sin(rad) * d;\n  }\n\n  var arrowShape = new Path({\n    type: 'path',\n    canvas: shape.get('canvas'),\n    isArrowShape: true,\n    attrs: __assign(__assign({}, restAttrs), {\n      // 支持单独设置箭头的 stroke 和 lineWidth，若为空则使用 shape 的值\n      stroke: arrowStroke || stroke,\n      lineWidth: arrowLineWidth || lineWidth,\n      // 箭头是否填充需要手动设置，不会继承自 shape 的值\n      fill: arrowFill\n    })\n  });\n  arrowShape.translate(x2, y2);\n  arrowShape.rotateAtPoint(x2, y2, rad);\n  shape.set(isStart ? 'startArrowShape' : 'endArrowShape', arrowShape);\n}\n/**\n * 如果自定义箭头并且有 d 需要做偏移，如果直接画，线条会超出箭头尖端，因此需要根据箭头偏移 d, 返回线需要缩短的距离\n * |----------------\n * |<|--------------\n * |\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n * @param {number} d  箭头沿线条方向的偏移距离\n * @return {{dx: number, dy: number}} 返回线条偏移距离\n */\n\n\nexport function getShortenOffset(x1, y1, x2, y2, d) {\n  var rad = atan2(y2 - y1, x2 - x1);\n  return {\n    dx: cos(rad) * d,\n    dy: sin(rad) * d\n  };\n}\n/**\n * 绘制起始箭头\n * @param {IShape} shape 图形\n * @param {ShapeAttrs} attrs shape 的绘图属性\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n */\n\nexport function addStartArrow(shape, attrs, x1, y1, x2, y2) {\n  if (typeof attrs.startArrow === 'object') {\n    _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, true);\n  } else if (attrs.startArrow) {\n    _addDefaultArrow(shape, attrs, x1, y1, x2, y2, true);\n  } else {\n    shape.set('startArrowShape', null);\n  }\n}\n/**\n * 绘制结束箭头\n * @param {IShape} shape 图形\n * @param {ShapeAttrs} attrs shape 的绘图属性\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n */\n\nexport function addEndArrow(shape, attrs, x1, y1, x2, y2) {\n  if (typeof attrs.endArrow === 'object') {\n    _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, false);\n  } else if (attrs.endArrow) {\n    _addDefaultArrow(shape, attrs, x1, y1, x2, y2, false);\n  } else {\n    shape.set('startArrowShape', null);\n  }\n}","map":{"version":3,"mappings":"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","names":["Path","Math","cos","atan2","PI","_addDefaultArrow","shape","attrs","x1","y1","x2","y2","isStart","lineWidth","x","y","rad","arrowShape","type","canvas","get","isArrowShape","path","sin","stroke","translate","rotateAtPoint","set","_addCustomizedArrow","endArrow","arrowAttrs","startArrow","arrowFill","arrowStroke","arrowLineWidth","restAttrs","d","fill","getShortenOffset","dx","dy","addStartArrow","addEndArrow"],"sourceRoot":"","sources":["../../src/util/arrow.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}