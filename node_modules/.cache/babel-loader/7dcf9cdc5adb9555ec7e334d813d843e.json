{"ast":null,"code":"import { vec2 } from '@antv/matrix-util';\n\nfunction smoothBezier(points, smooth, isLoop, constraint) {\n  var cps = [];\n  var hasConstraint = !!constraint;\n  var prevPoint;\n  var nextPoint;\n  var min;\n  var max;\n  var nextCp0;\n  var cp1;\n  var cp0;\n\n  if (hasConstraint) {\n    min = constraint[0], max = constraint[1];\n\n    for (var i = 0, l = points.length; i < l; i += 1) {\n      var point = points[i];\n      min = vec2.min([0, 0], min, point);\n      max = vec2.max([0, 0], max, point);\n    }\n  }\n\n  for (var i = 0, len = points.length; i < len; i += 1) {\n    var point = points[i];\n\n    if (i === 0 && !isLoop) {\n      cp0 = point;\n    } else if (i === len - 1 && !isLoop) {\n      cp1 = point;\n      cps.push(cp0);\n      cps.push(cp1);\n    } else {\n      var prevIdx = [i ? i - 1 : len - 1, i - 1][isLoop ? 0 : 1];\n      prevPoint = points[prevIdx];\n      nextPoint = points[isLoop ? (i + 1) % len : i + 1];\n      var v = [0, 0];\n      v = vec2.sub(v, nextPoint, prevPoint);\n      v = vec2.scale(v, v, smooth);\n      var d0 = vec2.distance(point, prevPoint);\n      var d1 = vec2.distance(point, nextPoint);\n      var sum = d0 + d1;\n\n      if (sum !== 0) {\n        d0 /= sum;\n        d1 /= sum;\n      }\n\n      var v1 = vec2.scale([0, 0], v, -d0);\n      var v2 = vec2.scale([0, 0], v, d1);\n      cp1 = vec2.add([0, 0], point, v1);\n      nextCp0 = vec2.add([0, 0], point, v2); // 下一个控制点必须在这个点和下一个点之间\n\n      nextCp0 = vec2.min([0, 0], nextCp0, vec2.max([0, 0], nextPoint, point));\n      nextCp0 = vec2.max([0, 0], nextCp0, vec2.min([0, 0], nextPoint, point)); // 重新计算 cp1 的值\n\n      v1 = vec2.sub([0, 0], nextCp0, point);\n      v1 = vec2.scale([0, 0], v1, -d0 / d1);\n      cp1 = vec2.add([0, 0], point, v1); // 上一个控制点必须要在上一个点和这一个点之间\n\n      cp1 = vec2.min([0, 0], cp1, vec2.max([0, 0], prevPoint, point));\n      cp1 = vec2.max([0, 0], cp1, vec2.min([0, 0], prevPoint, point)); // 重新计算 nextCp0 的值\n\n      v2 = vec2.sub([0, 0], point, cp1);\n      v2 = vec2.scale([0, 0], v2, d1 / d0);\n      nextCp0 = vec2.add([0, 0], point, v2);\n\n      if (hasConstraint) {\n        cp1 = vec2.max([0, 0], cp1, min);\n        cp1 = vec2.min([0, 0], cp1, max);\n        nextCp0 = vec2.max([0, 0], nextCp0, min);\n        nextCp0 = vec2.min([0, 0], nextCp0, max);\n      }\n\n      cps.push(cp0);\n      cps.push(cp1);\n      cp0 = nextCp0;\n    }\n  }\n\n  if (isLoop) {\n    cps.push(cps.shift());\n  }\n\n  return cps;\n}\n/**\n * create bezier spline from catmull rom spline\n * @param {Array} crp Catmull Rom Points\n * @param {boolean} z Spline is loop\n * @param {Array} constraint Constraint\n */\n\n\nfunction catmullRom2Bezier(crp, z, constraint) {\n  if (z === void 0) {\n    z = false;\n  }\n\n  if (constraint === void 0) {\n    constraint = [[0, 0], [1, 1]];\n  }\n\n  var isLoop = !!z;\n  var pointList = [];\n\n  for (var i = 0, l = crp.length; i < l; i += 2) {\n    pointList.push([crp[i], crp[i + 1]]);\n  }\n\n  var controlPointList = smoothBezier(pointList, 0.4, isLoop, constraint);\n  var len = pointList.length;\n  var d1 = [];\n  var cp1;\n  var cp2;\n  var p;\n\n  for (var i = 0; i < len - 1; i += 1) {\n    cp1 = controlPointList[i * 2];\n    cp2 = controlPointList[i * 2 + 1];\n    p = pointList[i + 1];\n    d1.push(['C', cp1[0], cp1[1], cp2[0], cp2[1], p[0], p[1]]);\n  }\n\n  if (isLoop) {\n    cp1 = controlPointList[len];\n    cp2 = controlPointList[len + 1];\n    p = pointList[0];\n    d1.push(['C', cp1[0], cp1[1], cp2[0], cp2[1], p[0], p[1]]);\n  }\n\n  return d1;\n}\n\nexport default catmullRom2Bezier;","map":{"version":3,"mappings":"AAAA,SAASA,IAAT,QAAqB,mBAArB;;AAKA,SAASC,YAAT,CAAsBC,MAAtB,EAAqCC,MAArC,EAAqDC,MAArD,EAAsEC,UAAtE,EAAuF;EACrF,IAAMC,GAAG,GAAW,EAApB;EACA,IAAMC,aAAa,GAAG,CAAC,CAACF,UAAxB;EAEA,IAAIG,SAAJ;EACA,IAAIC,SAAJ;EACA,IAAIC,GAAJ;EACA,IAAIC,GAAJ;EACA,IAAIC,OAAJ;EACA,IAAIC,GAAJ;EACA,IAAIC,GAAJ;;EAEA,IAAIP,aAAJ,EAAmB;IACfG,GAAG,GAAUL,UAAU,GAAvB,EAAKM,GAAG,GAAKN,UAAU,GAAvB;;IACF,KAAK,IAAIU,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGd,MAAM,CAACe,MAA3B,EAAmCF,CAAC,GAAGC,CAAvC,EAA0CD,CAAC,IAAI,CAA/C,EAAkD;MAChD,IAAMG,KAAK,GAAGhB,MAAM,CAACa,CAAD,CAApB;MACAL,GAAG,GAAGV,IAAI,CAACU,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBA,GAAnB,EAAwBQ,KAAxB,CAAN;MACAP,GAAG,GAAGX,IAAI,CAACW,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBA,GAAnB,EAAwBO,KAAxB,CAAN;IACD;EACF;;EAED,KAAK,IAAIH,CAAC,GAAG,CAAR,EAAWI,GAAG,GAAGjB,MAAM,CAACe,MAA7B,EAAqCF,CAAC,GAAGI,GAAzC,EAA8CJ,CAAC,IAAI,CAAnD,EAAsD;IACpD,IAAMG,KAAK,GAAGhB,MAAM,CAACa,CAAD,CAApB;;IACA,IAAIA,CAAC,KAAK,CAAN,IAAW,CAACX,MAAhB,EAAwB;MACtBU,GAAG,GAAGI,KAAN;IACD,CAFD,MAEO,IAAIH,CAAC,KAAKI,GAAG,GAAG,CAAZ,IAAiB,CAACf,MAAtB,EAA8B;MACnCS,GAAG,GAAGK,KAAN;MACAZ,GAAG,CAACc,IAAJ,CAASN,GAAT;MACAR,GAAG,CAACc,IAAJ,CAASP,GAAT;IACD,CAJM,MAIA;MACL,IAAMQ,OAAO,GAAG,CAAEN,CAAC,GAAGA,CAAC,GAAG,CAAP,GAAWI,GAAG,GAAG,CAApB,EAAuBJ,CAAC,GAAG,CAA3B,EAA+BX,MAAM,GAAG,CAAH,GAAO,CAA5C,CAAhB;MACAI,SAAS,GAAGN,MAAM,CAACmB,OAAD,CAAlB;MACAZ,SAAS,GAAGP,MAAM,CAACE,MAAM,GAAG,CAACW,CAAC,GAAG,CAAL,IAAUI,GAAb,GAAmBJ,CAAC,GAAG,CAA9B,CAAlB;MAEA,IAAIO,CAAC,GAAS,CAAE,CAAF,EAAK,CAAL,CAAd;MACAA,CAAC,GAAGtB,IAAI,CAACuB,GAAL,CAASD,CAAT,EAAYb,SAAZ,EAAuBD,SAAvB,CAAJ;MACAc,CAAC,GAAGtB,IAAI,CAACwB,KAAL,CAAWF,CAAX,EAAcA,CAAd,EAAiBnB,MAAjB,CAAJ;MAEA,IAAIsB,EAAE,GAAGzB,IAAI,CAAC0B,QAAL,CAAcR,KAAd,EAAqBV,SAArB,CAAT;MACA,IAAImB,EAAE,GAAG3B,IAAI,CAAC0B,QAAL,CAAcR,KAAd,EAAqBT,SAArB,CAAT;MAEA,IAAMmB,GAAG,GAAGH,EAAE,GAAGE,EAAjB;;MACA,IAAIC,GAAG,KAAK,CAAZ,EAAe;QACbH,EAAE,IAAIG,GAAN;QACAD,EAAE,IAAIC,GAAN;MACD;;MAED,IAAIC,EAAE,GAAG7B,IAAI,CAACwB,KAAL,CAAW,CAAE,CAAF,EAAK,CAAL,CAAX,EAAqBF,CAArB,EAAwB,CAACG,EAAzB,CAAT;MACA,IAAIK,EAAE,GAAG9B,IAAI,CAACwB,KAAL,CAAW,CAAE,CAAF,EAAK,CAAL,CAAX,EAAqBF,CAArB,EAAwBK,EAAxB,CAAT;MAEAd,GAAG,GAAGb,IAAI,CAAC+B,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBb,KAAnB,EAA0BW,EAA1B,CAAN;MACAjB,OAAO,GAAGZ,IAAI,CAAC+B,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBb,KAAnB,EAA0BY,EAA1B,CAAV,CAtBK,CAwBL;;MACAlB,OAAO,GAAGZ,IAAI,CAACU,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBE,OAAnB,EAA4BZ,IAAI,CAACW,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBF,SAAnB,EAA8BS,KAA9B,CAA5B,CAAV;MACAN,OAAO,GAAGZ,IAAI,CAACW,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBC,OAAnB,EAA4BZ,IAAI,CAACU,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBD,SAAnB,EAA8BS,KAA9B,CAA5B,CAAV,CA1BK,CA4BL;;MACAW,EAAE,GAAG7B,IAAI,CAACuB,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBX,OAAnB,EAA4BM,KAA5B,CAAL;MACAW,EAAE,GAAG7B,IAAI,CAACwB,KAAL,CAAW,CAAE,CAAF,EAAK,CAAL,CAAX,EAAqBK,EAArB,EAAyB,CAACJ,EAAD,GAAME,EAA/B,CAAL;MACAd,GAAG,GAAGb,IAAI,CAAC+B,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBb,KAAnB,EAA0BW,EAA1B,CAAN,CA/BK,CAiCL;;MACAhB,GAAG,GAAGb,IAAI,CAACU,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBG,GAAnB,EAAwBb,IAAI,CAACW,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBH,SAAnB,EAA8BU,KAA9B,CAAxB,CAAN;MACAL,GAAG,GAAGb,IAAI,CAACW,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBE,GAAnB,EAAwBb,IAAI,CAACU,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBF,SAAnB,EAA8BU,KAA9B,CAAxB,CAAN,CAnCK,CAqCL;;MACAY,EAAE,GAAG9B,IAAI,CAACuB,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBL,KAAnB,EAA0BL,GAA1B,CAAL;MACAiB,EAAE,GAAG9B,IAAI,CAACwB,KAAL,CAAW,CAAE,CAAF,EAAK,CAAL,CAAX,EAAqBM,EAArB,EAAyBH,EAAE,GAAGF,EAA9B,CAAL;MACAb,OAAO,GAAGZ,IAAI,CAAC+B,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBb,KAAnB,EAA0BY,EAA1B,CAAV;;MAEA,IAAIvB,aAAJ,EAAmB;QACjBM,GAAG,GAAGb,IAAI,CAACW,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBE,GAAnB,EAAwBH,GAAxB,CAAN;QACAG,GAAG,GAAGb,IAAI,CAACU,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBG,GAAnB,EAAwBF,GAAxB,CAAN;QACAC,OAAO,GAAGZ,IAAI,CAACW,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBC,OAAnB,EAA4BF,GAA5B,CAAV;QACAE,OAAO,GAAGZ,IAAI,CAACU,GAAL,CAAS,CAAE,CAAF,EAAK,CAAL,CAAT,EAAmBE,OAAnB,EAA4BD,GAA5B,CAAV;MACD;;MAEDL,GAAG,CAACc,IAAJ,CAASN,GAAT;MACAR,GAAG,CAACc,IAAJ,CAASP,GAAT;MACAC,GAAG,GAAGF,OAAN;IACD;EACF;;EAED,IAAIR,MAAJ,EAAY;IACVE,GAAG,CAACc,IAAJ,CAASd,GAAG,CAAC0B,KAAJ,EAAT;EACD;;EAED,OAAO1B,GAAP;AACD;AAED;;;;;;;;AAMA,SAAS2B,iBAAT,CACEC,GADF,EAEEC,CAFF,EAGE9B,UAHF,EAMG;EAJD;IAAA8B;EAAkB;;EAClB;IAAA9B,cACE,CAAE,CAAF,EAAK,CAAL,CADF,EAEE,CAAE,CAAF,EAAK,CAAL,CAFF;EAGC;;EAED,IAAMD,MAAM,GAAG,CAAC,CAAC+B,CAAjB;EACA,IAAMC,SAAS,GAAU,EAAzB;;EACA,KAAK,IAAIrB,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGkB,GAAG,CAACjB,MAAxB,EAAgCF,CAAC,GAAGC,CAApC,EAAuCD,CAAC,IAAI,CAA5C,EAA+C;IAC7CqB,SAAS,CAAChB,IAAV,CAAe,CAAEc,GAAG,CAACnB,CAAD,CAAL,EAAUmB,GAAG,CAACnB,CAAC,GAAG,CAAL,CAAb,CAAf;EACD;;EAED,IAAMsB,gBAAgB,GAAGpC,YAAY,CAACmC,SAAD,EAAY,GAAZ,EAAiBhC,MAAjB,EAAyBC,UAAzB,CAArC;EACA,IAAMc,GAAG,GAAGiB,SAAS,CAACnB,MAAtB;EACA,IAAMU,EAAE,GAAkB,EAA1B;EAEA,IAAId,GAAJ;EACA,IAAIyB,GAAJ;EACA,IAAIC,CAAJ;;EAEA,KAAK,IAAIxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGI,GAAG,GAAG,CAA1B,EAA6BJ,CAAC,IAAI,CAAlC,EAAqC;IACnCF,GAAG,GAAGwB,gBAAgB,CAACtB,CAAC,GAAG,CAAL,CAAtB;IACAuB,GAAG,GAAGD,gBAAgB,CAACtB,CAAC,GAAG,CAAJ,GAAQ,CAAT,CAAtB;IACAwB,CAAC,GAAGH,SAAS,CAACrB,CAAC,GAAG,CAAL,CAAb;IAEAY,EAAE,CAACP,IAAH,CAAQ,CAAE,GAAF,EAAOP,GAAG,CAAC,CAAD,CAAV,EAAeA,GAAG,CAAC,CAAD,CAAlB,EAAuByB,GAAG,CAAC,CAAD,CAA1B,EAA+BA,GAAG,CAAC,CAAD,CAAlC,EAAuCC,CAAC,CAAC,CAAD,CAAxC,EAA6CA,CAAC,CAAC,CAAD,CAA9C,CAAR;EACD;;EAED,IAAInC,MAAJ,EAAY;IACVS,GAAG,GAAGwB,gBAAgB,CAAClB,GAAD,CAAtB;IACAmB,GAAG,GAAGD,gBAAgB,CAAClB,GAAG,GAAG,CAAP,CAAtB;IACEoB,CAAC,GAAKH,SAAS,GAAf;IAEFT,EAAE,CAACP,IAAH,CAAQ,CAAE,GAAF,EAAOP,GAAG,CAAC,CAAD,CAAV,EAAeA,GAAG,CAAC,CAAD,CAAlB,EAAuByB,GAAG,CAAC,CAAD,CAA1B,EAA+BA,GAAG,CAAC,CAAD,CAAlC,EAAuCC,CAAC,CAAC,CAAD,CAAxC,EAA6CA,CAAC,CAAC,CAAD,CAA9C,CAAR;EACD;;EACD,OAAOZ,EAAP;AACD;;AAED,eAAeM,iBAAf","names":["vec2","smoothBezier","points","smooth","isLoop","constraint","cps","hasConstraint","prevPoint","nextPoint","min","max","nextCp0","cp1","cp0","i","l","length","point","len","push","prevIdx","v","sub","scale","d0","distance","d1","sum","v1","v2","add","shift","catmullRom2Bezier","crp","z","pointList","controlPointList","cp2","p"],"sourceRoot":"","sources":["../src/catmull-rom-2-bezier.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}