{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nexport var PassNode = /*#__PURE__*/function () {\n  function PassNode() {\n    _classCallCheck(this, PassNode);\n\n    this.name = void 0;\n    this.refCount = 0;\n    this.hasSideEffect = false;\n    this.devirtualize = [];\n    this.destroy = [];\n    this.reads = [];\n    this.writes = [];\n  }\n\n  _createClass(PassNode, [{\n    key: \"read\",\n    value: function read(handle) {\n      if (!this.reads.find(function (h) {\n        return h.index === handle.index;\n      })) {\n        this.reads.push(handle);\n      }\n\n      return handle;\n    }\n  }, {\n    key: \"sample\",\n    value: function sample(handle) {\n      this.read(handle); // TODO: 记录在 this.samples 中\n\n      return handle;\n    }\n  }, {\n    key: \"write\",\n    value: function write(fg, handle) {\n      var existed = this.writes.find(function (h) {\n        return h.index === handle.index;\n      });\n\n      if (existed) {\n        return handle;\n      }\n\n      var node = fg.getResourceNode(handle);\n      node.resource.version++;\n\n      if (node.resource.imported) {\n        this.hasSideEffect = true;\n      }\n\n      var r = fg.createResourceNode(node.resource);\n      var newNode = fg.getResourceNode(r);\n      newNode.writer = this;\n      this.writes.push(r);\n      return r;\n    }\n  }]);\n\n  return PassNode;\n}();","map":{"version":3,"mappings":";;AAIA,WAAaA,QAAb;EAAA;IAAAC;;IAAA,KACSC,IADT;IAAA,KAKSC,QALT,GAKoB,CALpB;IAAA,KAUSC,aAVT,GAUyB,KAVzB;IAAA,KAeSC,YAfT,GAe2C,EAf3C;IAAA,KAoBSC,OApBT,GAoBsC,EApBtC;IAAA,KAsBSC,KAtBT,GAsBqC,EAtBrC;IAAA,KAwBSC,MAxBT,GAwBsC,EAxBtC;EAAA;;EAAAC;IAAAC;IAAAC,qBA0BcC,MA1Bd,EA0B0D;MACtD,IAAI,CAAC,KAAKL,KAAL,CAAWM,IAAX,CAAgB,UAACC,CAAD;QAAA,OAAOA,CAAC,CAACC,KAAFD,KAAYF,MAAM,CAACG,KAA1B;MAAhB,EAAL,EAAuD;QACrD,KAAKR,KAAL,CAAWS,IAAX,CAAgBJ,MAAhB;MACD;;MACD,OAAOA,MAAP;IACD;EA/BH;IAAAF;IAAAC,uBAiCgBC,MAjChB,EAiC0C;MACtC,KAAKK,IAAL,CAAUL,MAAV,EADsC,CAEtC;;MACA,OAAOA,MAAP;IACD;EArCH;IAAAF;IAAAC,sBAwCIO,EAxCJ,EAyCIN,MAzCJ,EA0CsB;MAClB,IAAMO,OAAO,GAAG,KAAKX,MAAL,CAAYK,IAAZ,CAAiB,UAACC,CAAD;QAAA,OAAOA,CAAC,CAACC,KAAFD,KAAYF,MAAM,CAACG,KAA1B;MAAjB,EAAhB;;MACA,IAAII,OAAJ,EAAa;QACX,OAAOP,MAAP;MACD;;MAED,IAAMQ,IAAI,GAAGF,EAAE,CAACG,eAAHH,CAAmBN,MAAnBM,CAAb;MAEAE,IAAI,CAACE,QAALF,CAAcG,OAAdH;;MAEA,IAAIA,IAAI,CAACE,QAALF,CAAcI,QAAlB,EAA4B;QAC1B,KAAKpB,aAAL,GAAqB,IAArB;MACD;;MAED,IAAMqB,CAAC,GAAGP,EAAE,CAACQ,kBAAHR,CAAsBE,IAAI,CAACE,QAA3BJ,CAAV;MACA,IAAMS,OAAO,GAAGT,EAAE,CAACG,eAAHH,CAAmBO,CAAnBP,CAAhB;MAEAS,OAAO,CAACC,MAARD,GAAiB,IAAjBA;MAEA,KAAKnB,MAAL,CAAYQ,IAAZ,CAAiBS,CAAjB;MACA,OAAOA,CAAP;IACD;EA/DH;;EAAA;AAAA","names":["PassNode","_classCallCheck","name","refCount","hasSideEffect","devirtualize","destroy","reads","writes","_createClass","key","value","handle","find","h","index","push","read","fg","existed","node","getResourceNode","resource","version","imported","r","createResourceNode","newNode","writer"],"sources":["../../../src/components/framegraph/PassNode.ts"],"sourcesContent":["import { FrameGraphHandle } from './FrameGraphHandle';\nimport { FrameGraphSystem } from './System';\nimport { VirtualResource } from './VirtualResource';\n\nexport class PassNode {\n  public name: string;\n  /**\n   * count resources that have a reference to this pass node\n   */\n  public refCount = 0;\n\n  /**\n   * set by FG system\n   */\n  public hasSideEffect = false;\n\n  /**\n   * during FG's compile, create before executing\n   */\n  public devirtualize: VirtualResource[] = [];\n\n  /**\n   * during FG's compile, destroy after executing\n   */\n  public destroy: VirtualResource[] = [];\n\n  public reads: FrameGraphHandle[] = [];\n\n  public writes: FrameGraphHandle[] = [];\n\n  public read(handle: FrameGraphHandle): FrameGraphHandle {\n    if (!this.reads.find((h) => h.index === handle.index)) {\n      this.reads.push(handle);\n    }\n    return handle;\n  }\n\n  public sample(handle: FrameGraphHandle) {\n    this.read(handle);\n    // TODO: 记录在 this.samples 中\n    return handle;\n  }\n\n  public write(\n    fg: FrameGraphSystem,\n    handle: FrameGraphHandle,\n  ): FrameGraphHandle {\n    const existed = this.writes.find((h) => h.index === handle.index);\n    if (existed) {\n      return handle;\n    }\n\n    const node = fg.getResourceNode(handle);\n\n    node.resource.version++;\n\n    if (node.resource.imported) {\n      this.hasSideEffect = true;\n    }\n\n    const r = fg.createResourceNode(node.resource);\n    const newNode = fg.getResourceNode(r);\n\n    newNode.writer = this;\n\n    this.writes.push(r);\n    return r;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}