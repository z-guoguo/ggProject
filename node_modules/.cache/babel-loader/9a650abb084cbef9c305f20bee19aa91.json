{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { Rectangle, Polyline, Point, Angle, Path, Line } from '../geometry';\nimport { StringExt, ObjectExt, NumberExt, FunctionExt, Dom, Vector } from '../util';\nimport { Router, Connector, NodeAnchor, EdgeAnchor, ConnectionPoint } from '../registry';\nimport { Edge } from '../model/edge';\nimport { Markup } from './markup';\nimport { CellView } from './cell';\nexport class EdgeView extends CellView {\n  constructor() {\n    super(...arguments);\n    this.POINT_ROUNDING = 2;\n    this.markerCache = {}; // #endregion\n    // #endregion\n  }\n\n  get [Symbol.toStringTag]() {\n    return EdgeView.toStringTag;\n  }\n\n  getContainerClassName() {\n    return [super.getContainerClassName(), this.prefixClassName('edge')].join(' ');\n  }\n\n  get sourceBBox() {\n    const sourceView = this.sourceView;\n\n    if (!sourceView) {\n      const sourceDef = this.cell.getSource();\n      return new Rectangle(sourceDef.x, sourceDef.y);\n    }\n\n    const sourceMagnet = this.sourceMagnet;\n\n    if (sourceView.isEdgeElement(sourceMagnet)) {\n      return new Rectangle(this.sourceAnchor.x, this.sourceAnchor.y);\n    }\n\n    return sourceView.getBBoxOfElement(sourceMagnet || sourceView.container);\n  }\n\n  get targetBBox() {\n    const targetView = this.targetView;\n\n    if (!targetView) {\n      const targetDef = this.cell.getTarget();\n      return new Rectangle(targetDef.x, targetDef.y);\n    }\n\n    const targetMagnet = this.targetMagnet;\n\n    if (targetView.isEdgeElement(targetMagnet)) {\n      return new Rectangle(this.targetAnchor.x, this.targetAnchor.y);\n    }\n\n    return targetView.getBBoxOfElement(targetMagnet || targetView.container);\n  }\n\n  isEdgeView() {\n    return true;\n  }\n\n  confirmUpdate(flag, options = {}) {\n    let ref = flag;\n\n    if (this.hasAction(ref, 'source')) {\n      if (!this.updateTerminalProperties('source')) {\n        return ref;\n      }\n\n      ref = this.removeAction(ref, 'source');\n    }\n\n    if (this.hasAction(ref, 'target')) {\n      if (!this.updateTerminalProperties('target')) {\n        return ref;\n      }\n\n      ref = this.removeAction(ref, 'target');\n    }\n\n    const graph = this.graph;\n    const sourceView = this.sourceView;\n    const targetView = this.targetView;\n\n    if (graph && (sourceView && !graph.renderer.isViewMounted(sourceView) || targetView && !graph.renderer.isViewMounted(targetView))) {\n      // Wait for the sourceView and targetView to be rendered.\n      return ref;\n    }\n\n    if (this.hasAction(ref, 'render')) {\n      this.render();\n      ref = this.removeAction(ref, ['render', 'update', 'vertices', 'labels', 'tools', 'widget']);\n      return ref;\n    }\n\n    ref = this.handleAction(ref, 'vertices', () => this.renderVertexMarkers());\n    ref = this.handleAction(ref, 'update', () => this.update(null, options));\n    ref = this.handleAction(ref, 'labels', () => this.onLabelsChange(options));\n    ref = this.handleAction(ref, 'tools', () => {\n      this.renderTools();\n      this.updateToolsPosition();\n    });\n    ref = this.handleAction(ref, 'widget', () => this.renderExternalTools());\n    return ref;\n  }\n\n  onLabelsChange(options = {}) {\n    // Note: this optimization works in async=false mode only\n    if (this.shouldRerenderLabels(options)) {\n      this.renderLabels();\n    } else {\n      this.updateLabels();\n    }\n\n    this.updateLabelPositions();\n  }\n\n  shouldRerenderLabels(options = {}) {\n    const previousLabels = this.cell.previous('labels');\n\n    if (previousLabels == null) {\n      return true;\n    } // Here is an optimization for cases when we know, that change does\n    // not require re-rendering of all labels.\n\n\n    if ('propertyPathArray' in options && 'propertyValue' in options) {\n      // The label is setting by `prop()` method\n      const pathArray = options.propertyPathArray || [];\n      const pathLength = pathArray.length;\n\n      if (pathLength > 1) {\n        // We are changing a single label here e.g. 'labels/0/position'\n        const index = pathArray[1];\n\n        if (previousLabels[index]) {\n          if (pathLength === 2) {\n            // We are changing the entire label. Need to check if the\n            // markup is also being changed.\n            return typeof options.propertyValue === 'object' && ObjectExt.has(options.propertyValue, 'markup');\n          } // We are changing a label property but not the markup\n\n\n          if (pathArray[2] !== 'markup') {\n            return false;\n          }\n        }\n      }\n    }\n\n    return true;\n  }\n\n  render() {\n    this.empty();\n    this.containers = {};\n    this.renderMarkup();\n    this.renderLabels();\n    this.update();\n    this.renderExternalTools();\n    return this;\n  }\n\n  renderMarkup() {\n    const markup = this.cell.markup;\n\n    if (markup) {\n      if (typeof markup === 'string') {\n        return this.renderStringMarkup(markup);\n      }\n\n      return this.renderJSONMarkup(markup);\n    }\n\n    throw new TypeError('Invalid edge markup.');\n  }\n\n  renderJSONMarkup(markup) {\n    const ret = this.parseJSONMarkup(markup, this.container);\n    this.selectors = ret.selectors;\n    this.container.append(ret.fragment);\n  }\n\n  renderStringMarkup(markup) {\n    const cache = this.containers;\n    const children = Vector.createVectors(markup); // Cache children elements for quicker access.\n\n    children.forEach(child => {\n      const className = child.attr('class');\n\n      if (className) {\n        cache[StringExt.camelCase(className)] = child.node;\n      }\n    });\n    this.renderTools();\n    this.renderVertexMarkers();\n    this.renderArrowheadMarkers();\n    Dom.append(this.container, children.map(child => child.node));\n  }\n\n  renderLabels() {\n    const edge = this.cell;\n    const labels = edge.getLabels();\n    const count = labels.length;\n    let container = this.containers.labels;\n    this.labelCache = {};\n    this.labelSelectors = {};\n\n    if (count <= 0) {\n      if (container && container.parentNode) {\n        container.parentNode.removeChild(container);\n      }\n\n      return this;\n    }\n\n    if (container) {\n      this.empty(container);\n    } else {\n      container = Dom.createSvgElement('g');\n      this.addClass(this.prefixClassName('edge-labels'), container);\n      this.containers.labels = container;\n    }\n\n    for (let i = 0, ii = labels.length; i < ii; i += 1) {\n      const label = labels[i];\n      const normalized = this.normalizeLabelMarkup(this.parseLabelMarkup(label.markup));\n      let labelNode;\n      let selectors;\n\n      if (normalized) {\n        labelNode = normalized.node;\n        selectors = normalized.selectors;\n      } else {\n        const defaultLabel = edge.getDefaultLabel();\n        const normalized = this.normalizeLabelMarkup(this.parseLabelMarkup(defaultLabel.markup));\n        labelNode = normalized.node;\n        selectors = normalized.selectors;\n      }\n\n      labelNode.setAttribute('data-index', `${i}`);\n      container.appendChild(labelNode);\n      const rootSelector = this.rootSelector;\n\n      if (selectors[rootSelector]) {\n        throw new Error('Ambiguous label root selector.');\n      }\n\n      selectors[rootSelector] = labelNode;\n      this.labelCache[i] = labelNode;\n      this.labelSelectors[i] = selectors;\n    }\n\n    if (container.parentNode == null) {\n      this.container.appendChild(container);\n    }\n\n    this.updateLabels();\n    this.customizeLabels();\n    return this;\n  }\n\n  parseLabelMarkup(markup) {\n    if (markup) {\n      if (typeof markup === 'string') {\n        return this.parseLabelStringMarkup(markup);\n      }\n\n      return this.parseJSONMarkup(markup);\n    }\n\n    return null;\n  }\n\n  parseLabelStringMarkup(labelMarkup) {\n    const children = Vector.createVectors(labelMarkup);\n    const fragment = document.createDocumentFragment();\n\n    for (let i = 0, n = children.length; i < n; i += 1) {\n      const currentChild = children[i].node;\n      fragment.appendChild(currentChild);\n    }\n\n    return {\n      fragment,\n      selectors: {}\n    };\n  }\n\n  normalizeLabelMarkup(markup) {\n    if (markup == null) {\n      return;\n    }\n\n    const fragment = markup.fragment;\n\n    if (!(fragment instanceof DocumentFragment) || !fragment.hasChildNodes()) {\n      throw new Error('Invalid label markup.');\n    }\n\n    let vel;\n    const childNodes = fragment.childNodes;\n\n    if (childNodes.length > 1 || childNodes[0].nodeName.toUpperCase() !== 'G') {\n      // default markup fragment is not wrapped in `<g/>`\n      // add a `<g/>` container\n      vel = Vector.create('g').append(fragment);\n    } else {\n      vel = Vector.create(childNodes[0]);\n    }\n\n    vel.addClass(this.prefixClassName('edge-label'));\n    return {\n      node: vel.node,\n      selectors: markup.selectors\n    };\n  }\n\n  updateLabels() {\n    if (this.containers.labels) {\n      const edge = this.cell;\n      const labels = edge.labels;\n      const canLabelMove = this.can('edgeLabelMovable');\n      const defaultLabel = edge.getDefaultLabel();\n\n      for (let i = 0, n = labels.length; i < n; i += 1) {\n        const elem = this.labelCache[i];\n        const selectors = this.labelSelectors[i];\n        elem.setAttribute('cursor', canLabelMove ? 'move' : 'default');\n        const label = labels[i];\n        const attrs = ObjectExt.merge({}, defaultLabel.attrs, label.attrs);\n        this.updateAttrs(elem, attrs, {\n          selectors,\n          rootBBox: label.size ? Rectangle.fromSize(label.size) : undefined\n        });\n      }\n    }\n  }\n\n  mergeLabelAttrs(hasCustomMarkup, labelAttrs, defaultLabelAttrs) {\n    if (labelAttrs === null) {\n      return null;\n    }\n\n    if (labelAttrs === undefined) {\n      if (defaultLabelAttrs === null) {\n        return null;\n      }\n\n      if (defaultLabelAttrs === undefined) {\n        return undefined;\n      }\n\n      if (hasCustomMarkup) {\n        return defaultLabelAttrs;\n      }\n\n      return ObjectExt.merge({}, defaultLabelAttrs);\n    }\n\n    if (hasCustomMarkup) {\n      return ObjectExt.merge({}, defaultLabelAttrs, labelAttrs);\n    }\n  }\n\n  customizeLabels() {\n    if (this.containers.labels) {\n      const edge = this.cell;\n      const labels = edge.labels;\n\n      for (let i = 0, n = labels.length; i < n; i += 1) {\n        const label = labels[i];\n        const container = this.labelCache[i];\n        const selectors = this.labelSelectors[i];\n        this.graph.hook.onEdgeLabelRendered({\n          edge,\n          label,\n          container,\n          selectors\n        });\n      }\n    }\n  }\n\n  renderTools() {\n    const container = this.containers.tools;\n\n    if (container == null) {\n      return this;\n    }\n\n    const markup = this.cell.toolMarkup;\n    const $container = this.$(container).empty();\n\n    if (Markup.isStringMarkup(markup)) {\n      let template = StringExt.template(markup);\n      const tool = Vector.create(template());\n      $container.append(tool.node);\n      this.toolCache = tool.node; // If `doubleTools` is enabled, we render copy of the tools on the\n      // other side of the edge as well but only if the edge is longer\n      // than `longLength`.\n\n      if (this.options.doubleTools) {\n        let tool2;\n        const doubleToolMarkup = this.cell.doubleToolMarkup;\n\n        if (Markup.isStringMarkup(doubleToolMarkup)) {\n          template = StringExt.template(doubleToolMarkup);\n          tool2 = Vector.create(template());\n        } else {\n          tool2 = tool.clone();\n        }\n\n        $container.append(tool2.node);\n        this.tool2Cache = tool2.node;\n      }\n    }\n\n    return this;\n  }\n\n  renderExternalTools() {\n    const tools = this.cell.getTools();\n    this.addTools(tools);\n    return this;\n  }\n\n  renderVertexMarkers() {\n    const container = this.containers.vertices;\n\n    if (container == null) {\n      return this;\n    }\n\n    const markup = this.cell.vertexMarkup;\n    const $container = this.$(container).empty();\n\n    if (Markup.isStringMarkup(markup)) {\n      const template = StringExt.template(markup);\n      this.cell.getVertices().forEach((vertex, index) => {\n        $container.append(Vector.create(template(Object.assign({\n          index\n        }, vertex))).node);\n      });\n    }\n\n    return this;\n  }\n\n  renderArrowheadMarkers() {\n    const container = this.containers.arrowheads;\n\n    if (container == null) {\n      return this;\n    }\n\n    const markup = this.cell.arrowheadMarkup;\n    const $container = this.$(container).empty();\n\n    if (Markup.isStringMarkup(markup)) {\n      const template = StringExt.template(markup);\n      const sourceArrowhead = Vector.create(template({\n        end: 'source'\n      })).node;\n      const targetArrowhead = Vector.create(template({\n        end: 'target'\n      })).node;\n      this.containers.sourceArrowhead = sourceArrowhead;\n      this.containers.targetArrowhead = targetArrowhead;\n      $container.append(sourceArrowhead, targetArrowhead);\n    }\n\n    return this;\n  } // #endregion\n  // #region updating\n\n\n  update(partialAttrs, options = {}) {\n    this.cleanCache();\n    this.updateConnection(options);\n    const attrs = this.cell.getAttrs();\n\n    if (attrs != null) {\n      this.updateAttrs(this.container, attrs, {\n        attrs: partialAttrs === attrs ? null : partialAttrs,\n        selectors: this.selectors\n      });\n    }\n\n    this.updateConnectionPath();\n    this.updateLabelPositions();\n    this.updateToolsPosition();\n    this.updateArrowheadMarkers();\n    this.updateTools(options);\n    return this;\n  }\n\n  removeRedundantLinearVertices(options = {}) {\n    const edge = this.cell;\n    const vertices = edge.getVertices();\n    const routePoints = [this.sourceAnchor, ...vertices, this.targetAnchor];\n    const rawCount = routePoints.length; // Puts the route points into a polyline and try to simplify.\n\n    const polyline = new Polyline(routePoints);\n    polyline.simplify({\n      threshold: 0.01\n    });\n    const simplifiedPoints = polyline.points.map(point => point.toJSON());\n    const simplifiedCount = simplifiedPoints.length; // If simplification did not remove any redundant vertices.\n\n    if (rawCount === simplifiedCount) {\n      return 0;\n    } // Sets simplified polyline points as edge vertices.\n    // Removes first and last polyline points again (source/target anchors).\n\n\n    edge.setVertices(simplifiedPoints.slice(1, simplifiedCount - 1), options);\n    return rawCount - simplifiedCount;\n  }\n\n  updateConnectionPath() {\n    const containers = this.containers;\n\n    if (containers.connection) {\n      const pathData = this.getConnectionPathData();\n      containers.connection.setAttribute('d', pathData);\n    }\n\n    if (containers.connectionWrap) {\n      const pathData = this.getConnectionPathData();\n      containers.connectionWrap.setAttribute('d', pathData);\n    }\n\n    if (containers.sourceMarker && containers.targetMarker) {\n      this.translateAndAutoOrientArrows(containers.sourceMarker, containers.targetMarker);\n    }\n  }\n\n  getTerminalView(type) {\n    switch (type) {\n      case 'source':\n        return this.sourceView || null;\n\n      case 'target':\n        return this.targetView || null;\n\n      default:\n        throw new Error(`Unknown terminal type '${type}'`);\n    }\n  }\n\n  getTerminalAnchor(type) {\n    switch (type) {\n      case 'source':\n        return Point.create(this.sourceAnchor);\n\n      case 'target':\n        return Point.create(this.targetAnchor);\n\n      default:\n        throw new Error(`Unknown terminal type '${type}'`);\n    }\n  }\n\n  getTerminalConnectionPoint(type) {\n    switch (type) {\n      case 'source':\n        return Point.create(this.sourcePoint);\n\n      case 'target':\n        return Point.create(this.targetPoint);\n\n      default:\n        throw new Error(`Unknown terminal type '${type}'`);\n    }\n  }\n\n  getTerminalMagnet(type, options = {}) {\n    switch (type) {\n      case 'source':\n        {\n          if (options.raw) {\n            return this.sourceMagnet;\n          }\n\n          const sourceView = this.sourceView;\n\n          if (!sourceView) {\n            return null;\n          }\n\n          return this.sourceMagnet || sourceView.container;\n        }\n\n      case 'target':\n        {\n          if (options.raw) {\n            return this.targetMagnet;\n          }\n\n          const targetView = this.targetView;\n\n          if (!targetView) {\n            return null;\n          }\n\n          return this.targetMagnet || targetView.container;\n        }\n\n      default:\n        {\n          throw new Error(`Unknown terminal type '${type}'`);\n        }\n    }\n  }\n\n  updateConnection(options = {}) {\n    const edge = this.cell; // The edge is being translated by an ancestor that will shift\n    // source, target and vertices by an equal distance.\n\n    if (options.translateBy && edge.isFragmentDescendantOf(options.translateBy)) {\n      const tx = options.tx || 0;\n      const ty = options.ty || 0;\n      this.routePoints = new Polyline(this.routePoints).translate(tx, ty).points;\n      this.translateConnectionPoints(tx, ty);\n      this.path.translate(tx, ty);\n    } else {\n      const vertices = edge.getVertices(); // 1. Find anchor points\n\n      const anchors = this.findAnchors(vertices);\n      this.sourceAnchor = anchors.source;\n      this.targetAnchor = anchors.target; // 2. Find route points\n\n      this.routePoints = this.findRoutePoints(vertices); // 3. Find connection points\n\n      const connectionPoints = this.findConnectionPoints(this.routePoints, this.sourceAnchor, this.targetAnchor);\n      this.sourcePoint = connectionPoints.source;\n      this.targetPoint = connectionPoints.target; // 4. Find Marker Connection Point\n\n      const markerPoints = this.findMarkerPoints(this.routePoints, this.sourcePoint, this.targetPoint); // 5. Make path\n\n      this.path = this.findPath(this.routePoints, markerPoints.source || this.sourcePoint, markerPoints.target || this.targetPoint);\n    }\n\n    this.cleanCache();\n  }\n\n  findAnchors(vertices) {\n    const edge = this.cell;\n    const source = edge.source;\n    const target = edge.target;\n    const firstVertex = vertices[0];\n    const lastVertex = vertices[vertices.length - 1];\n\n    if (target.priority && !source.priority) {\n      // Reversed order\n      return this.findAnchorsOrdered('target', lastVertex, 'source', firstVertex);\n    } // Usual order\n\n\n    return this.findAnchorsOrdered('source', firstVertex, 'target', lastVertex);\n  }\n\n  findAnchorsOrdered(firstType, firstPoint, secondType, secondPoint) {\n    let firstAnchor;\n    let secondAnchor;\n    const edge = this.cell;\n    const firstTerminal = edge[firstType];\n    const secondTerminal = edge[secondType];\n    const firstView = this.getTerminalView(firstType);\n    const secondView = this.getTerminalView(secondType);\n    const firstMagnet = this.getTerminalMagnet(firstType);\n    const secondMagnet = this.getTerminalMagnet(secondType);\n\n    if (firstView) {\n      let firstRef;\n\n      if (firstPoint) {\n        firstRef = Point.create(firstPoint);\n      } else if (secondView) {\n        firstRef = secondMagnet;\n      } else {\n        firstRef = Point.create(secondTerminal);\n      }\n\n      firstAnchor = this.getAnchor(firstTerminal.anchor, firstView, firstMagnet, firstRef, firstType);\n    } else {\n      firstAnchor = Point.create(firstTerminal);\n    }\n\n    if (secondView) {\n      const secondRef = Point.create(secondPoint || firstAnchor);\n      secondAnchor = this.getAnchor(secondTerminal.anchor, secondView, secondMagnet, secondRef, secondType);\n    } else {\n      secondAnchor = Point.isPointLike(secondTerminal) ? Point.create(secondTerminal) : new Point();\n    }\n\n    return {\n      [firstType]: firstAnchor,\n      [secondType]: secondAnchor\n    };\n  }\n\n  getAnchor(def, cellView, magnet, ref, terminalType) {\n    const isEdge = cellView.isEdgeElement(magnet);\n    const connecting = this.graph.options.connecting;\n    let config = typeof def === 'string' ? {\n      name: def\n    } : def;\n\n    if (!config) {\n      const defaults = isEdge ? (terminalType === 'source' ? connecting.sourceEdgeAnchor : connecting.targetEdgeAnchor) || connecting.edgeAnchor : (terminalType === 'source' ? connecting.sourceAnchor : connecting.targetAnchor) || connecting.anchor;\n      config = typeof defaults === 'string' ? {\n        name: defaults\n      } : defaults;\n    }\n\n    if (!config) {\n      throw new Error(`Anchor should be specified.`);\n    }\n\n    let anchor;\n    const name = config.name;\n\n    if (isEdge) {\n      const fn = EdgeAnchor.registry.get(name);\n\n      if (typeof fn !== 'function') {\n        return EdgeAnchor.registry.onNotFound(name);\n      }\n\n      anchor = FunctionExt.call(fn, this, cellView, magnet, ref, config.args || {}, terminalType);\n    } else {\n      const fn = NodeAnchor.registry.get(name);\n\n      if (typeof fn !== 'function') {\n        return NodeAnchor.registry.onNotFound(name);\n      }\n\n      anchor = FunctionExt.call(fn, this, cellView, magnet, ref, config.args || {}, terminalType);\n    }\n\n    return anchor ? anchor.round(this.POINT_ROUNDING) : new Point();\n  }\n\n  findRoutePoints(vertices = []) {\n    const defaultRouter = this.graph.options.connecting.router || Router.presets.normal;\n    const router = this.cell.getRouter() || defaultRouter;\n    let routePoints;\n\n    if (typeof router === 'function') {\n      routePoints = FunctionExt.call(router, this, vertices, {}, this);\n    } else {\n      const name = typeof router === 'string' ? router : router.name;\n      const args = typeof router === 'string' ? {} : router.args || {};\n      const fn = name ? Router.registry.get(name) : Router.presets.normal;\n\n      if (typeof fn !== 'function') {\n        return Router.registry.onNotFound(name);\n      }\n\n      routePoints = FunctionExt.call(fn, this, vertices, args, this);\n    }\n\n    return routePoints == null ? vertices.map(p => Point.create(p)) : routePoints.map(p => Point.create(p));\n  }\n\n  findConnectionPoints(routePoints, sourceAnchor, targetAnchor) {\n    const edge = this.cell;\n    const connecting = this.graph.options.connecting;\n    const sourceTerminal = edge.getSource();\n    const targetTerminal = edge.getTarget();\n    const sourceView = this.sourceView;\n    const targetView = this.targetView;\n    const firstRoutePoint = routePoints[0];\n    const lastRoutePoint = routePoints[routePoints.length - 1]; // source\n\n    let sourcePoint;\n\n    if (sourceView && !sourceView.isEdgeElement(this.sourceMagnet)) {\n      const sourceMagnet = this.sourceMagnet || sourceView.container;\n      const sourcePointRef = firstRoutePoint || targetAnchor;\n      const sourceLine = new Line(sourcePointRef, sourceAnchor);\n      const connectionPointDef = sourceTerminal.connectionPoint || connecting.sourceConnectionPoint || connecting.connectionPoint;\n      sourcePoint = this.getConnectionPoint(connectionPointDef, sourceView, sourceMagnet, sourceLine, 'source');\n    } else {\n      sourcePoint = sourceAnchor;\n    } // target\n\n\n    let targetPoint;\n\n    if (targetView && !targetView.isEdgeElement(this.targetMagnet)) {\n      const targetMagnet = this.targetMagnet || targetView.container;\n      const targetConnectionPointDef = targetTerminal.connectionPoint || connecting.targetConnectionPoint || connecting.connectionPoint;\n      const targetPointRef = lastRoutePoint || sourceAnchor;\n      const targetLine = new Line(targetPointRef, targetAnchor);\n      targetPoint = this.getConnectionPoint(targetConnectionPointDef, targetView, targetMagnet, targetLine, 'target');\n    } else {\n      targetPoint = targetAnchor;\n    }\n\n    return {\n      source: sourcePoint,\n      target: targetPoint\n    };\n  }\n\n  getConnectionPoint(def, view, magnet, line, endType) {\n    const anchor = line.end;\n\n    if (def == null) {\n      return anchor;\n    }\n\n    const name = typeof def === 'string' ? def : def.name;\n    const args = typeof def === 'string' ? {} : def.args;\n    const fn = ConnectionPoint.registry.get(name);\n\n    if (typeof fn !== 'function') {\n      return ConnectionPoint.registry.onNotFound(name);\n    }\n\n    const connectionPoint = FunctionExt.call(fn, this, line, view, magnet, args || {}, endType);\n    return connectionPoint ? connectionPoint.round(this.POINT_ROUNDING) : anchor;\n  }\n\n  updateMarkerAttr(type) {\n    const attrs = this.cell.getAttrs();\n    const key = `.${type}-marker`;\n    const partial = attrs && attrs[key];\n\n    if (partial) {\n      this.updateAttrs(this.container, {}, {\n        attrs: {\n          [key]: partial\n        },\n        selectors: this.selectors\n      });\n    }\n  }\n\n  findMarkerPoints(routePoints, sourcePoint, targetPoint) {\n    const getLineWidth = type => {\n      const attrs = this.cell.getAttrs();\n      const keys = Object.keys(attrs);\n\n      for (let i = 0, l = keys.length; i < l; i += 1) {\n        const attr = attrs[keys[i]];\n\n        if (attr[`${type}Marker`] || attr[`${type}-marker`]) {\n          const strokeWidth = attr.strokeWidth || attr['stroke-width'];\n\n          if (strokeWidth) {\n            return parseFloat(strokeWidth);\n          }\n\n          break;\n        }\n      }\n\n      return null;\n    };\n\n    const firstRoutePoint = routePoints[0];\n    const lastRoutePoint = routePoints[routePoints.length - 1];\n    const sourceMarkerElem = this.containers.sourceMarker;\n    const targetMarkerElem = this.containers.targetMarker;\n    const cache = this.markerCache;\n    let sourceMarkerPoint;\n    let targetMarkerPoint; // Move the source point by the width of the marker taking into\n    // account its scale around x-axis. Note that scale is the only\n    // transform that makes sense to be set in `.marker-source`\n    // attributes object as all other transforms (translate/rotate)\n    // will be replaced by the `translateAndAutoOrient()` function.\n\n    if (sourceMarkerElem) {\n      this.updateMarkerAttr('source'); // support marker connection point registry???\n\n      cache.sourceBBox = cache.sourceBBox || Dom.getBBox(sourceMarkerElem);\n\n      if (cache.sourceBBox.width > 0) {\n        const scale = Dom.scale(sourceMarkerElem);\n        sourceMarkerPoint = sourcePoint.clone().move(firstRoutePoint || targetPoint, cache.sourceBBox.width * scale.sx * -1);\n      }\n    } else {\n      const strokeWidth = getLineWidth('source');\n\n      if (strokeWidth) {\n        sourceMarkerPoint = sourcePoint.clone().move(firstRoutePoint || targetPoint, -strokeWidth);\n      }\n    }\n\n    if (targetMarkerElem) {\n      this.updateMarkerAttr('target');\n      cache.targetBBox = cache.targetBBox || Dom.getBBox(targetMarkerElem);\n\n      if (cache.targetBBox.width > 0) {\n        const scale = Dom.scale(targetMarkerElem);\n        targetMarkerPoint = targetPoint.clone().move(lastRoutePoint || sourcePoint, cache.targetBBox.width * scale.sx * -1);\n      }\n    } else {\n      const strokeWidth = getLineWidth('target');\n\n      if (strokeWidth) {\n        targetMarkerPoint = targetPoint.clone().move(lastRoutePoint || sourcePoint, -strokeWidth);\n      }\n    } // If there was no markup for the marker, use the connection point.\n\n\n    cache.sourcePoint = sourceMarkerPoint || sourcePoint.clone();\n    cache.targetPoint = targetMarkerPoint || targetPoint.clone();\n    return {\n      source: sourceMarkerPoint,\n      target: targetMarkerPoint\n    };\n  }\n\n  findPath(routePoints, sourcePoint, targetPoint) {\n    const def = this.cell.getConnector() || this.graph.options.connecting.connector;\n    let name;\n    let args;\n    let fn;\n\n    if (typeof def === 'string') {\n      name = def;\n    } else {\n      name = def.name;\n      args = def.args;\n    }\n\n    if (name) {\n      const method = Connector.registry.get(name);\n\n      if (typeof method !== 'function') {\n        return Connector.registry.onNotFound(name);\n      }\n\n      fn = method;\n    } else {\n      fn = Connector.presets.normal;\n    }\n\n    const path = FunctionExt.call(fn, this, sourcePoint, targetPoint, routePoints, Object.assign(Object.assign({}, args), {\n      raw: true\n    }), this);\n    return typeof path === 'string' ? Path.parse(path) : path;\n  }\n\n  translateConnectionPoints(tx, ty) {\n    const cache = this.markerCache;\n\n    if (cache.sourcePoint) {\n      cache.sourcePoint.translate(tx, ty);\n    }\n\n    if (cache.targetPoint) {\n      cache.targetPoint.translate(tx, ty);\n    }\n\n    this.sourcePoint.translate(tx, ty);\n    this.targetPoint.translate(tx, ty);\n    this.sourceAnchor.translate(tx, ty);\n    this.targetAnchor.translate(tx, ty);\n  }\n\n  updateLabelPositions() {\n    if (this.containers.labels == null) {\n      return this;\n    }\n\n    const path = this.path;\n\n    if (!path) {\n      return this;\n    }\n\n    const edge = this.cell;\n    const labels = edge.getLabels();\n\n    if (labels.length === 0) {\n      return this;\n    }\n\n    const defaultLabel = edge.getDefaultLabel();\n    const defaultPosition = this.normalizeLabelPosition(defaultLabel.position);\n\n    for (let i = 0, ii = labels.length; i < ii; i += 1) {\n      const label = labels[i];\n      const labelPosition = this.normalizeLabelPosition(label.position);\n      const pos = ObjectExt.merge({}, defaultPosition, labelPosition);\n      const matrix = this.getLabelTransformationMatrix(pos);\n      this.labelCache[i].setAttribute('transform', Dom.matrixToTransformString(matrix));\n    }\n\n    return this;\n  }\n\n  updateToolsPosition() {\n    if (this.containers.tools == null) {\n      return this;\n    } // Move the tools a bit to the target position but don't cover the\n    // `sourceArrowhead` marker. Note that the offset is hardcoded here.\n    // The offset should be always more than the\n    // `this.$('.marker-arrowhead[end=\"source\"]')[0].bbox().width` but looking\n    // this up all the time would be slow.\n\n\n    let scale = '';\n    let offset = this.options.toolsOffset;\n    const connectionLength = this.getConnectionLength(); // Firefox returns `connectionLength=NaN` in odd cases (for bezier curves).\n    // In that case we won't update tools position at all.\n\n    if (connectionLength != null) {\n      // If the edge is too short, make the tools half the\n      // size and the offset twice as low.\n      if (connectionLength < this.options.shortLength) {\n        scale = 'scale(.5)';\n        offset /= 2;\n      }\n\n      let pos = this.getPointAtLength(offset);\n\n      if (pos != null) {\n        Dom.attr(this.toolCache, 'transform', `translate(${pos.x},${pos.y}) ${scale}`);\n      }\n\n      if (this.options.doubleTools && connectionLength >= this.options.longLength) {\n        const doubleToolsOffset = this.options.doubleToolsOffset || offset;\n        pos = this.getPointAtLength(connectionLength - doubleToolsOffset);\n\n        if (pos != null) {\n          Dom.attr(this.tool2Cache, 'transform', `translate(${pos.x},${pos.y}) ${scale}`);\n        }\n\n        Dom.attr(this.tool2Cache, 'visibility', 'visible');\n      } else if (this.options.doubleTools) {\n        Dom.attr(this.tool2Cache, 'visibility', 'hidden');\n      }\n    }\n\n    return this;\n  }\n\n  updateArrowheadMarkers() {\n    const container = this.containers.arrowheads;\n\n    if (container == null) {\n      return this;\n    }\n\n    if (container.style.display === 'none') {\n      return this;\n    }\n\n    const sourceArrowhead = this.containers.sourceArrowhead;\n    const targetArrowhead = this.containers.targetArrowhead;\n\n    if (sourceArrowhead && targetArrowhead) {\n      const len = this.getConnectionLength() || 0;\n      const sx = len < this.options.shortLength ? 0.5 : 1;\n      Dom.scale(sourceArrowhead, sx);\n      Dom.scale(targetArrowhead, sx);\n      this.translateAndAutoOrientArrows(sourceArrowhead, targetArrowhead);\n    }\n\n    return this;\n  }\n\n  updateTerminalProperties(type) {\n    const edge = this.cell;\n    const graph = this.graph;\n    const terminal = edge[type];\n    const nodeId = terminal && terminal.cell;\n    const viewKey = `${type}View`; // terminal is a point\n\n    if (!nodeId) {\n      this[viewKey] = null;\n      this.updateTerminalMagnet(type);\n      return true;\n    }\n\n    const terminalCell = graph.getCellById(nodeId);\n\n    if (!terminalCell) {\n      throw new Error(`Edge's ${type} node with id \"${nodeId}\" not exists`);\n    }\n\n    const endView = terminalCell.findView(graph);\n\n    if (!endView) {\n      return false;\n    }\n\n    this[viewKey] = endView;\n    this.updateTerminalMagnet(type);\n    return true;\n  }\n\n  updateTerminalMagnet(type) {\n    const propName = `${type}Magnet`;\n    const terminalView = this.getTerminalView(type);\n\n    if (terminalView) {\n      let magnet = terminalView.getMagnetFromEdgeTerminal(this.cell[type]);\n\n      if (magnet === terminalView.container) {\n        magnet = null;\n      }\n\n      this[propName] = magnet;\n    } else {\n      this[propName] = null;\n    }\n  }\n\n  translateAndAutoOrientArrows(sourceArrow, targetArrow) {\n    const route = this.routePoints;\n\n    if (sourceArrow) {\n      Dom.translateAndAutoOrient(sourceArrow, this.sourcePoint, route[0] || this.targetPoint, this.graph.view.stage);\n    }\n\n    if (targetArrow) {\n      Dom.translateAndAutoOrient(targetArrow, this.targetPoint, route[route.length - 1] || this.sourcePoint, this.graph.view.stage);\n    }\n  }\n\n  getLabelPositionAngle(idx) {\n    const label = this.cell.getLabelAt(idx);\n\n    if (label && label.position && typeof label.position === 'object') {\n      return label.position.angle || 0;\n    }\n\n    return 0;\n  }\n\n  getLabelPositionArgs(idx) {\n    const label = this.cell.getLabelAt(idx);\n\n    if (label && label.position && typeof label.position === 'object') {\n      return label.position.options;\n    }\n  }\n\n  getDefaultLabelPositionArgs() {\n    const defaultLabel = this.cell.getDefaultLabel();\n\n    if (defaultLabel && defaultLabel.position && typeof defaultLabel.position === 'object') {\n      return defaultLabel.position.options;\n    }\n  } // merge default label position args into label position args\n  // keep `undefined` or `null` because `{}` means something else\n\n\n  mergeLabelPositionArgs(labelPositionArgs, defaultLabelPositionArgs) {\n    if (labelPositionArgs === null) {\n      return null;\n    }\n\n    if (labelPositionArgs === undefined) {\n      if (defaultLabelPositionArgs === null) {\n        return null;\n      }\n\n      return defaultLabelPositionArgs;\n    }\n\n    return ObjectExt.merge({}, defaultLabelPositionArgs, labelPositionArgs);\n  }\n\n  addLabel(p1, p2, p3, options) {\n    let localX;\n    let localY;\n    let localAngle = 0;\n    let localOptions;\n\n    if (typeof p1 !== 'number') {\n      localX = p1.x;\n      localY = p1.y;\n\n      if (typeof p2 === 'number') {\n        localAngle = p2;\n        localOptions = p3;\n      } else {\n        localOptions = p2;\n      }\n    } else {\n      localX = p1;\n      localY = p2;\n\n      if (typeof p3 === 'number') {\n        localAngle = p3;\n        localOptions = options;\n      } else {\n        localOptions = p3;\n      }\n    } // merge label position arguments\n\n\n    const defaultLabelPositionArgs = this.getDefaultLabelPositionArgs();\n    const labelPositionArgs = localOptions;\n    const positionArgs = this.mergeLabelPositionArgs(labelPositionArgs, defaultLabelPositionArgs); // append label to labels array\n\n    const label = {\n      position: this.getLabelPosition(localX, localY, localAngle, positionArgs)\n    };\n    const index = -1;\n    this.cell.insertLabel(label, index, localOptions);\n    return index;\n  }\n\n  addVertex(x, y, options) {\n    const isPoint = typeof x !== 'number';\n    const localX = isPoint ? x.x : x;\n    const localY = isPoint ? x.y : y;\n    const localOptions = isPoint ? y : options;\n    const vertex = {\n      x: localX,\n      y: localY\n    };\n    const index = this.getVertexIndex(localX, localY);\n    this.cell.insertVertex(vertex, index, localOptions);\n    return index;\n  }\n\n  sendToken(token, options, callback) {\n    let duration;\n    let reversed;\n    let selector;\n    let rorate;\n    let timing = 'linear';\n\n    if (typeof options === 'object') {\n      duration = options.duration;\n      reversed = options.reversed === true;\n      selector = options.selector;\n\n      if (options.rotate === false) {\n        rorate = '';\n      } else if (options.rotate === true) {\n        rorate = 'auto';\n      } else if (options.rotate != null) {\n        rorate = `${options.rotate}`;\n      }\n\n      if (options.timing) {\n        timing = options.timing;\n      }\n    } else {\n      duration = options;\n      reversed = false;\n      selector = null;\n    }\n\n    duration = duration || 1000;\n    const attrs = {\n      dur: `${duration}ms`,\n      repeatCount: '1',\n      calcMode: timing,\n      fill: 'freeze'\n    };\n\n    if (rorate) {\n      attrs.rotate = rorate;\n    }\n\n    if (reversed) {\n      attrs.keyPoints = '1;0';\n      attrs.keyTimes = '0;1';\n    }\n\n    if (typeof options === 'object') {\n      const {\n        duration,\n        reversed,\n        selector,\n        rotate,\n        timing\n      } = options,\n            others = __rest(options, [\"duration\", \"reversed\", \"selector\", \"rotate\", \"timing\"]);\n\n      Object.keys(others).forEach(key => {\n        attrs[key] = others[key];\n      });\n    }\n\n    let path;\n\n    if (typeof selector === 'string') {\n      path = this.findOne(selector, this.container, this.selectors);\n    } else {\n      // Select connection path automatically.\n      path = this.containers.connection ? this.containers.connection : this.container.querySelector('path');\n    }\n\n    if (!(path instanceof SVGPathElement)) {\n      throw new Error('Token animation requires a valid connection path.');\n    }\n\n    const target = typeof token === 'string' ? this.findOne(token) : token;\n\n    if (target == null) {\n      throw new Error('Token animation requires a valid token element.');\n    }\n\n    const parent = target.parentNode;\n\n    const revert = () => {\n      if (!parent) {\n        Dom.remove(target);\n      }\n    };\n\n    const vToken = Vector.create(target);\n\n    if (!parent) {\n      vToken.appendTo(this.graph.view.stage);\n    }\n\n    const onComplete = attrs.complete;\n\n    attrs.complete = e => {\n      revert();\n\n      if (callback) {\n        callback();\n      }\n\n      if (onComplete) {\n        onComplete(e);\n      }\n    };\n\n    const stop = vToken.animateAlongPath(attrs, path);\n    return () => {\n      revert();\n      stop();\n    };\n  } // #endregion\n\n\n  getConnection() {\n    return this.path != null ? this.path.clone() : null;\n  }\n\n  getConnectionPathData() {\n    if (this.path == null) {\n      return '';\n    }\n\n    const cache = this.cache.pathCache;\n\n    if (!ObjectExt.has(cache, 'data')) {\n      cache.data = this.path.serialize();\n    }\n\n    return cache.data || '';\n  }\n\n  getConnectionSubdivisions() {\n    if (this.path == null) {\n      return null;\n    }\n\n    const cache = this.cache.pathCache;\n\n    if (!ObjectExt.has(cache, 'segmentSubdivisions')) {\n      cache.segmentSubdivisions = this.path.getSegmentSubdivisions();\n    }\n\n    return cache.segmentSubdivisions;\n  }\n\n  getConnectionLength() {\n    if (this.path == null) {\n      return 0;\n    }\n\n    const cache = this.cache.pathCache;\n\n    if (!ObjectExt.has(cache, 'length')) {\n      cache.length = this.path.length({\n        segmentSubdivisions: this.getConnectionSubdivisions()\n      });\n    }\n\n    return cache.length;\n  }\n\n  getPointAtLength(length) {\n    if (this.path == null) {\n      return null;\n    }\n\n    return this.path.pointAtLength(length, {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    });\n  }\n\n  getPointAtRatio(ratio) {\n    if (this.path == null) {\n      return null;\n    }\n\n    if (NumberExt.isPercentage(ratio)) {\n      // eslint-disable-next-line\n      ratio = parseFloat(ratio) / 100;\n    }\n\n    return this.path.pointAt(ratio, {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    });\n  }\n\n  getTangentAtLength(length) {\n    if (this.path == null) {\n      return null;\n    }\n\n    return this.path.tangentAtLength(length, {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    });\n  }\n\n  getTangentAtRatio(ratio) {\n    if (this.path == null) {\n      return null;\n    }\n\n    return this.path.tangentAt(ratio, {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    });\n  }\n\n  getClosestPoint(point) {\n    if (this.path == null) {\n      return null;\n    }\n\n    return this.path.closestPoint(point, {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    });\n  }\n\n  getClosestPointLength(point) {\n    if (this.path == null) {\n      return null;\n    }\n\n    return this.path.closestPointLength(point, {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    });\n  }\n\n  getClosestPointRatio(point) {\n    if (this.path == null) {\n      return null;\n    }\n\n    return this.path.closestPointNormalizedLength(point, {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    });\n  }\n\n  getLabelPosition(x, y, p3, p4) {\n    const pos = {\n      distance: 0\n    }; // normalize data from the two possible signatures\n\n    let angle = 0;\n    let options;\n\n    if (typeof p3 === 'number') {\n      angle = p3;\n      options = p4;\n    } else {\n      options = p3;\n    }\n\n    if (options != null) {\n      pos.options = options;\n    } // identify distance/offset settings\n\n\n    const isOffsetAbsolute = options && options.absoluteOffset;\n    const isDistanceRelative = !(options && options.absoluteDistance);\n    const isDistanceAbsoluteReverse = options && options.absoluteDistance && options.reverseDistance; // find closest point t\n\n    const path = this.path;\n    const pathOptions = {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    };\n    const labelPoint = new Point(x, y);\n    const t = path.closestPointT(labelPoint, pathOptions); // distance\n\n    const totalLength = this.getConnectionLength() || 0;\n    let labelDistance = path.lengthAtT(t, pathOptions);\n\n    if (isDistanceRelative) {\n      labelDistance = totalLength > 0 ? labelDistance / totalLength : 0;\n    }\n\n    if (isDistanceAbsoluteReverse) {\n      // fix for end point (-0 => 1)\n      labelDistance = -1 * (totalLength - labelDistance) || 1;\n    }\n\n    pos.distance = labelDistance; // offset\n    // use absolute offset if:\n    // - options.absoluteOffset is true,\n    // - options.absoluteOffset is not true but there is no tangent\n\n    let tangent;\n    if (!isOffsetAbsolute) tangent = path.tangentAtT(t);\n    let labelOffset;\n\n    if (tangent) {\n      labelOffset = tangent.pointOffset(labelPoint);\n    } else {\n      const closestPoint = path.pointAtT(t);\n      const labelOffsetDiff = labelPoint.diff(closestPoint);\n      labelOffset = {\n        x: labelOffsetDiff.x,\n        y: labelOffsetDiff.y\n      };\n    }\n\n    pos.offset = labelOffset;\n    pos.angle = angle;\n    return pos;\n  }\n\n  normalizeLabelPosition(pos) {\n    if (typeof pos === 'number') {\n      return {\n        distance: pos\n      };\n    }\n\n    return pos;\n  }\n\n  getLabelTransformationMatrix(labelPosition) {\n    const pos = this.normalizeLabelPosition(labelPosition);\n    const options = pos.options || {};\n    const labelAngle = pos.angle || 0;\n    const labelDistance = pos.distance;\n    const isDistanceRelative = labelDistance > 0 && labelDistance <= 1;\n    let labelOffset = 0;\n    const offsetCoord = {\n      x: 0,\n      y: 0\n    };\n    const offset = pos.offset;\n\n    if (offset) {\n      if (typeof offset === 'number') {\n        labelOffset = offset;\n      } else {\n        if (offset.x != null) {\n          offsetCoord.x = offset.x;\n        }\n\n        if (offset.y != null) {\n          offsetCoord.y = offset.y;\n        }\n      }\n    }\n\n    const isOffsetAbsolute = offsetCoord.x !== 0 || offsetCoord.y !== 0 || labelOffset === 0;\n    const isKeepGradient = options.keepGradient;\n    const isEnsureLegibility = options.ensureLegibility;\n    const path = this.path;\n    const pathOpt = {\n      segmentSubdivisions: this.getConnectionSubdivisions()\n    };\n    const distance = isDistanceRelative ? labelDistance * this.getConnectionLength() : labelDistance;\n    const tangent = path.tangentAtLength(distance, pathOpt);\n    let translation;\n    let angle = labelAngle;\n\n    if (tangent) {\n      if (isOffsetAbsolute) {\n        translation = tangent.start;\n        translation.translate(offsetCoord);\n      } else {\n        const normal = tangent.clone();\n        normal.rotate(-90, tangent.start);\n        normal.setLength(labelOffset);\n        translation = normal.end;\n      }\n\n      if (isKeepGradient) {\n        angle = tangent.angle() + labelAngle;\n\n        if (isEnsureLegibility) {\n          angle = Angle.normalize((angle + 90) % 180 - 90);\n        }\n      }\n    } else {\n      // fallback - the connection has zero length\n      translation = path.start;\n\n      if (isOffsetAbsolute) {\n        translation.translate(offsetCoord);\n      }\n    }\n\n    return Dom.createSVGMatrix().translate(translation.x, translation.y).rotate(angle);\n  }\n\n  getLabelCoordinates(pos) {\n    const matrix = this.getLabelTransformationMatrix(pos);\n    return new Point(matrix.e, matrix.f);\n  }\n\n  getVertexIndex(x, y) {\n    const edge = this.cell;\n    const vertices = edge.getVertices();\n    const vertexLength = this.getClosestPointLength(new Point(x, y));\n    let index = 0;\n\n    if (vertexLength != null) {\n      for (const ii = vertices.length; index < ii; index += 1) {\n        const currentVertex = vertices[index];\n        const currentLength = this.getClosestPointLength(currentVertex);\n\n        if (currentLength != null && vertexLength < currentLength) {\n          break;\n        }\n      }\n    }\n\n    return index;\n  }\n\n  getEventArgs(e, x, y) {\n    const view = this; // eslint-disable-line\n\n    const edge = view.cell;\n    const cell = edge;\n\n    if (x == null || y == null) {\n      return {\n        e,\n        view,\n        edge,\n        cell\n      };\n    }\n\n    return {\n      e,\n      x,\n      y,\n      view,\n      edge,\n      cell\n    };\n  }\n\n  notifyUnhandledMouseDown(e, x, y) {\n    this.notify('edge:unhandled:mousedown', {\n      e,\n      x,\n      y,\n      view: this,\n      cell: this.cell,\n      edge: this.cell\n    });\n  }\n\n  notifyMouseDown(e, x, y) {\n    super.onMouseDown(e, x, y);\n    this.notify('edge:mousedown', this.getEventArgs(e, x, y));\n  }\n\n  notifyMouseMove(e, x, y) {\n    super.onMouseMove(e, x, y);\n    this.notify('edge:mousemove', this.getEventArgs(e, x, y));\n  }\n\n  notifyMouseUp(e, x, y) {\n    super.onMouseUp(e, x, y);\n    this.notify('edge:mouseup', this.getEventArgs(e, x, y));\n  }\n\n  onClick(e, x, y) {\n    super.onClick(e, x, y);\n    this.notify('edge:click', this.getEventArgs(e, x, y));\n  }\n\n  onDblClick(e, x, y) {\n    super.onDblClick(e, x, y);\n    this.notify('edge:dblclick', this.getEventArgs(e, x, y));\n  }\n\n  onContextMenu(e, x, y) {\n    super.onContextMenu(e, x, y);\n    this.notify('edge:contextmenu', this.getEventArgs(e, x, y));\n  }\n\n  onMouseDown(e, x, y) {\n    this.notifyMouseDown(e, x, y);\n    const className = e.target.getAttribute('class');\n\n    switch (className) {\n      case 'vertex':\n        {\n          this.startVertexDragging(e, x, y);\n          return;\n        }\n\n      case 'vertex-remove':\n      case 'vertex-remove-area':\n        {\n          this.handleVertexRemoving(e, x, y);\n          return;\n        }\n\n      case 'connection':\n      case 'connection-wrap':\n        {\n          this.handleVertexAdding(e, x, y);\n          return;\n        }\n\n      case 'arrowhead':\n        {\n          this.startArrowheadDragging(e, x, y);\n          return;\n        }\n\n      case 'source-marker':\n      case 'target-marker':\n        {\n          this.notifyUnhandledMouseDown(e, x, y);\n          return;\n        }\n\n      default:\n        break;\n    }\n\n    this.startEdgeDragging(e, x, y);\n  }\n\n  onMouseMove(e, x, y) {\n    const data = this.getEventData(e);\n\n    switch (data.action) {\n      case 'drag-vertex':\n        {\n          this.dragVertex(e, x, y);\n          break;\n        }\n\n      case 'drag-label':\n        {\n          this.dragLabel(e, x, y);\n          break;\n        }\n\n      case 'drag-arrowhead':\n        {\n          this.dragArrowhead(e, x, y);\n          break;\n        }\n\n      case 'drag-edge':\n        {\n          this.dragEdge(e, x, y);\n          break;\n        }\n\n      default:\n        break;\n    }\n\n    this.notifyMouseMove(e, x, y);\n    return data;\n  }\n\n  onMouseUp(e, x, y) {\n    const data = this.getEventData(e);\n\n    switch (data.action) {\n      case 'drag-vertex':\n        {\n          this.stopVertexDragging(e, x, y);\n          break;\n        }\n\n      case 'drag-label':\n        {\n          this.stopLabelDragging(e, x, y);\n          break;\n        }\n\n      case 'drag-arrowhead':\n        {\n          this.stopArrowheadDragging(e, x, y);\n          break;\n        }\n\n      case 'drag-edge':\n        {\n          this.stopEdgeDragging(e, x, y);\n          break;\n        }\n\n      default:\n        break;\n    }\n\n    this.notifyMouseUp(e, x, y);\n    this.checkMouseleave(e);\n    return data;\n  }\n\n  onMouseOver(e) {\n    super.onMouseOver(e);\n    this.notify('edge:mouseover', this.getEventArgs(e));\n  }\n\n  onMouseOut(e) {\n    super.onMouseOut(e);\n    this.notify('edge:mouseout', this.getEventArgs(e));\n  }\n\n  onMouseEnter(e) {\n    super.onMouseEnter(e);\n    this.notify('edge:mouseenter', this.getEventArgs(e));\n  }\n\n  onMouseLeave(e) {\n    super.onMouseLeave(e);\n    this.notify('edge:mouseleave', this.getEventArgs(e));\n  }\n\n  onMouseWheel(e, x, y, delta) {\n    super.onMouseWheel(e, x, y, delta);\n    this.notify('edge:mousewheel', Object.assign({\n      delta\n    }, this.getEventArgs(e, x, y)));\n  }\n\n  onCustomEvent(e, name, x, y) {\n    // For default edge tool\n    const tool = Dom.findParentByClass(e.target, 'edge-tool', this.container);\n\n    if (tool) {\n      e.stopPropagation(); // no further action to be executed\n\n      if (this.can('useEdgeTools')) {\n        if (name === 'edge:remove') {\n          this.cell.remove({\n            ui: true\n          });\n          return;\n        }\n\n        this.notify('edge:customevent', Object.assign({\n          name\n        }, this.getEventArgs(e, x, y)));\n      }\n\n      this.notifyMouseDown(e, x, y);\n    } else {\n      this.notify('edge:customevent', Object.assign({\n        name\n      }, this.getEventArgs(e, x, y)));\n      super.onCustomEvent(e, name, x, y);\n    }\n  }\n\n  onLabelMouseDown(e, x, y) {\n    this.notifyMouseDown(e, x, y);\n    this.startLabelDragging(e, x, y);\n    const stopPropagation = this.getEventData(e).stopPropagation;\n\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n  } // #region drag edge\n\n\n  startEdgeDragging(e, x, y) {\n    if (!this.can('edgeMovable')) {\n      this.notifyUnhandledMouseDown(e, x, y);\n      return;\n    }\n\n    this.setEventData(e, {\n      x,\n      y,\n      moving: false,\n      action: 'drag-edge'\n    });\n  }\n\n  dragEdge(e, x, y) {\n    const data = this.getEventData(e);\n\n    if (!data.moving) {\n      data.moving = true;\n      this.addClass('edge-moving');\n      this.notify('edge:move', {\n        e,\n        x,\n        y,\n        view: this,\n        cell: this.cell,\n        edge: this.cell\n      });\n    }\n\n    this.cell.translate(x - data.x, y - data.y, {\n      ui: true\n    });\n    this.setEventData(e, {\n      x,\n      y\n    });\n    this.notify('edge:moving', {\n      e,\n      x,\n      y,\n      view: this,\n      cell: this.cell,\n      edge: this.cell\n    });\n  }\n\n  stopEdgeDragging(e, x, y) {\n    const data = this.getEventData(e);\n\n    if (data.moving) {\n      this.removeClass('edge-moving');\n      this.notify('edge:moved', {\n        e,\n        x,\n        y,\n        view: this,\n        cell: this.cell,\n        edge: this.cell\n      });\n    }\n\n    data.moving = false;\n  } // #endregion\n  // #region drag arrowhead\n\n\n  prepareArrowheadDragging(type, options) {\n    const magnet = this.getTerminalMagnet(type);\n    const data = {\n      action: 'drag-arrowhead',\n      x: options.x,\n      y: options.y,\n      isNewEdge: options.isNewEdge === true,\n      terminalType: type,\n      initialMagnet: magnet,\n      initialTerminal: ObjectExt.clone(this.cell[type]),\n      fallbackAction: options.fallbackAction || 'revert',\n      getValidateConnectionArgs: this.createValidateConnectionArgs(type),\n      options: options.options\n    };\n    this.beforeArrowheadDragging(data);\n    return data;\n  }\n\n  createValidateConnectionArgs(type) {\n    const args = [];\n    args[4] = type;\n    args[5] = this;\n    let opposite;\n    let i = 0;\n    let j = 0;\n\n    if (type === 'source') {\n      i = 2;\n      opposite = 'target';\n    } else {\n      j = 2;\n      opposite = 'source';\n    }\n\n    const terminal = this.cell[opposite];\n    const cellId = terminal.cell;\n\n    if (cellId) {\n      let magnet;\n      const view = args[i] = this.graph.renderer.findViewByCell(cellId);\n\n      if (view) {\n        magnet = view.getMagnetFromEdgeTerminal(terminal);\n\n        if (magnet === view.container) {\n          magnet = undefined;\n        }\n      }\n\n      args[i + 1] = magnet;\n    }\n\n    return (cellView, magnet) => {\n      args[j] = cellView;\n      args[j + 1] = cellView.container === magnet ? undefined : magnet;\n      return args;\n    };\n  }\n\n  beforeArrowheadDragging(data) {\n    data.zIndex = this.cell.zIndex;\n    this.cell.toFront();\n    const style = this.container.style;\n    data.pointerEvents = style.pointerEvents;\n    style.pointerEvents = 'none';\n\n    if (this.graph.options.connecting.highlight) {\n      this.highlightAvailableMagnets(data);\n    }\n  }\n\n  afterArrowheadDragging(data) {\n    if (data.zIndex != null) {\n      this.cell.setZIndex(data.zIndex, {\n        ui: true\n      });\n      data.zIndex = null;\n    }\n\n    const container = this.container;\n    container.style.pointerEvents = data.pointerEvents || '';\n\n    if (this.graph.options.connecting.highlight) {\n      this.unhighlightAvailableMagnets(data);\n    }\n  }\n\n  arrowheadDragging(target, x, y, data) {\n    data.x = x;\n    data.y = y; // Checking views right under the pointer\n\n    if (data.currentTarget !== target) {\n      // Unhighlight the previous view under pointer if there was one.\n      if (data.currentMagnet && data.currentView) {\n        data.currentView.unhighlight(data.currentMagnet, {\n          type: 'magnetAdsorbed'\n        });\n      }\n\n      data.currentView = this.graph.renderer.findViewByElem(target);\n\n      if (data.currentView) {\n        // If we found a view that is under the pointer, we need to find\n        // the closest magnet based on the real target element of the event.\n        data.currentMagnet = data.currentView.findMagnet(target);\n\n        if (data.currentMagnet && this.graph.hook.validateConnection(...data.getValidateConnectionArgs(data.currentView, data.currentMagnet), data.currentView.getEdgeTerminal(data.currentMagnet, x, y, this.cell, data.terminalType))) {\n          data.currentView.highlight(data.currentMagnet, {\n            type: 'magnetAdsorbed'\n          });\n        } else {\n          // This type of connection is not valid. Disregard this magnet.\n          data.currentMagnet = null;\n        }\n      } else {\n        // Make sure we'll unset previous magnet.\n        data.currentMagnet = null;\n      }\n    }\n\n    data.currentTarget = target;\n    this.cell.prop(data.terminalType, {\n      x,\n      y\n    }, Object.assign(Object.assign({}, data.options), {\n      ui: true\n    }));\n  }\n\n  arrowheadDragged(data, x, y) {\n    const view = data.currentView;\n    const magnet = data.currentMagnet;\n\n    if (!magnet || !view) {\n      return;\n    }\n\n    view.unhighlight(magnet, {\n      type: 'magnetAdsorbed'\n    });\n    const type = data.terminalType;\n    const terminal = view.getEdgeTerminal(magnet, x, y, this.cell, type);\n    this.cell.setTerminal(type, terminal, {\n      ui: true\n    });\n  }\n\n  snapArrowhead(x, y, data) {\n    const graph = this.graph;\n    const {\n      snap,\n      allowEdge\n    } = graph.options.connecting;\n    const radius = typeof snap === 'object' && snap.radius || 50;\n    const findViewsOption = {\n      x: x - radius,\n      y: y - radius,\n      width: 2 * radius,\n      height: 2 * radius\n    };\n    const views = graph.renderer.findViewsInArea(findViewsOption);\n\n    if (allowEdge) {\n      const edgeViews = graph.renderer.findEdgeViewsInArea(findViewsOption).filter(view => {\n        return view !== this;\n      });\n      views.push(...edgeViews);\n    }\n\n    const prevView = data.closestView || null;\n    const prevMagnet = data.closestMagnet || null;\n    data.closestView = null;\n    data.closestMagnet = null;\n    let distance;\n    let minDistance = Number.MAX_SAFE_INTEGER;\n    const pos = new Point(x, y);\n    views.forEach(view => {\n      if (view.container.getAttribute('magnet') !== 'false') {\n        // Find distance from the center of the cell to pointer coordinates\n        distance = view.cell.getBBox().getCenter().distance(pos); // the connection is looked up in a circle area by `distance < r`\n\n        if (distance < radius && distance < minDistance) {\n          if (prevMagnet === view.container || graph.hook.validateConnection(...data.getValidateConnectionArgs(view, null), view.getEdgeTerminal(view.container, x, y, this.cell, data.terminalType))) {\n            minDistance = distance;\n            data.closestView = view;\n            data.closestMagnet = view.container;\n          }\n        }\n      }\n\n      view.container.querySelectorAll('[magnet]').forEach(magnet => {\n        if (magnet.getAttribute('magnet') !== 'false') {\n          const bbox = view.getBBoxOfElement(magnet);\n          distance = pos.distance(bbox.getCenter());\n\n          if (distance < radius && distance < minDistance) {\n            if (prevMagnet === magnet || graph.hook.validateConnection(...data.getValidateConnectionArgs(view, magnet), view.getEdgeTerminal(magnet, x, y, this.cell, data.terminalType))) {\n              minDistance = distance;\n              data.closestView = view;\n              data.closestMagnet = magnet;\n            }\n          }\n        }\n      });\n    });\n    let terminal;\n    const type = data.terminalType;\n    const closestView = data.closestView;\n    const closestMagnet = data.closestMagnet;\n    const changed = prevMagnet !== closestMagnet;\n\n    if (prevView && changed) {\n      prevView.unhighlight(prevMagnet, {\n        type: 'magnetAdsorbed'\n      });\n    }\n\n    if (closestView) {\n      if (!changed) {\n        return;\n      }\n\n      closestView.highlight(closestMagnet, {\n        type: 'magnetAdsorbed'\n      });\n      terminal = closestView.getEdgeTerminal(closestMagnet, x, y, this.cell, type);\n    } else {\n      terminal = {\n        x,\n        y\n      };\n    }\n\n    this.cell.setTerminal(type, terminal, {}, Object.assign(Object.assign({}, data.options), {\n      ui: true\n    }));\n  }\n\n  snapArrowheadEnd(data) {\n    // Finish off link snapping.\n    // Everything except view unhighlighting was already done on pointermove.\n    const closestView = data.closestView;\n    const closestMagnet = data.closestMagnet;\n\n    if (closestView && closestMagnet) {\n      closestView.unhighlight(closestMagnet, {\n        type: 'magnetAdsorbed'\n      });\n      data.currentMagnet = closestView.findMagnet(closestMagnet);\n    }\n\n    data.closestView = null;\n    data.closestMagnet = null;\n  }\n\n  finishEmbedding(data) {\n    // Resets parent of the edge if embedding is enabled\n    if (this.graph.options.embedding.enabled && this.cell.updateParent()) {\n      // Make sure we don't reverse to the original 'z' index\n      data.zIndex = null;\n    }\n  }\n\n  fallbackConnection(data) {\n    switch (data.fallbackAction) {\n      case 'remove':\n        this.cell.remove({\n          ui: true\n        });\n        break;\n\n      case 'revert':\n      default:\n        this.cell.prop(data.terminalType, data.initialTerminal, {\n          ui: true\n        });\n        break;\n    }\n  }\n\n  notifyConnectionEvent(data, e) {\n    const terminalType = data.terminalType;\n    const initialTerminal = data.initialTerminal;\n    const currentTerminal = this.cell[terminalType];\n    const changed = currentTerminal && !Edge.equalTerminals(initialTerminal, currentTerminal);\n\n    if (changed) {\n      const graph = this.graph;\n      const previous = initialTerminal;\n      const previousCell = previous.cell ? graph.getCellById(previous.cell) : null;\n      const previousPort = previous.port;\n      const previousView = previousCell ? graph.findViewByCell(previousCell) : null;\n      const previousPoint = previousCell || data.isNewEdge ? null : Point.create(initialTerminal).toJSON();\n      const current = currentTerminal;\n      const currentCell = current.cell ? graph.getCellById(current.cell) : null;\n      const currentPort = current.port;\n      const currentView = currentCell ? graph.findViewByCell(currentCell) : null;\n      const currentPoint = currentCell ? null : Point.create(currentTerminal).toJSON();\n      this.notify('edge:connected', {\n        e,\n        previousCell,\n        previousPort,\n        previousView,\n        previousPoint,\n        currentCell,\n        currentView,\n        currentPort,\n        currentPoint,\n        previousMagnet: data.initialMagnet,\n        currentMagnet: data.currentMagnet,\n        edge: this.cell,\n        view: this,\n        type: terminalType,\n        isNew: data.isNewEdge\n      });\n    }\n  }\n\n  highlightAvailableMagnets(data) {\n    const graph = this.graph;\n    const cells = graph.model.getCells();\n    data.marked = {};\n\n    for (let i = 0, ii = cells.length; i < ii; i += 1) {\n      const view = graph.renderer.findViewByCell(cells[i]);\n\n      if (!view) {\n        continue;\n      }\n\n      const magnets = Array.prototype.slice.call(view.container.querySelectorAll('[magnet]'));\n\n      if (view.container.getAttribute('magnet') !== 'false') {\n        magnets.push(view.container);\n      }\n\n      const availableMagnets = magnets.filter(magnet => graph.hook.validateConnection(...data.getValidateConnectionArgs(view, magnet), view.getEdgeTerminal(magnet, data.x, data.y, this.cell, data.terminalType)));\n\n      if (availableMagnets.length > 0) {\n        // highlight all available magnets\n        for (let j = 0, jj = availableMagnets.length; j < jj; j += 1) {\n          view.highlight(availableMagnets[j], {\n            type: 'magnetAvailable'\n          });\n        } // highlight the entire view\n\n\n        view.highlight(null, {\n          type: 'nodeAvailable'\n        });\n        data.marked[view.cell.id] = availableMagnets;\n      }\n    }\n  }\n\n  unhighlightAvailableMagnets(data) {\n    const marked = data.marked || {};\n    Object.keys(marked).forEach(id => {\n      const view = this.graph.renderer.findViewByCell(id);\n\n      if (view) {\n        const magnets = marked[id];\n        magnets.forEach(magnet => {\n          view.unhighlight(magnet, {\n            type: 'magnetAvailable'\n          });\n        });\n        view.unhighlight(null, {\n          type: 'nodeAvailable'\n        });\n      }\n    });\n    data.marked = null;\n  }\n\n  startArrowheadDragging(e, x, y) {\n    if (!this.can('arrowheadMovable')) {\n      this.notifyUnhandledMouseDown(e, x, y);\n      return;\n    }\n\n    const elem = e.target;\n    const type = elem.getAttribute('data-terminal');\n    const data = this.prepareArrowheadDragging(type, {\n      x,\n      y\n    });\n    this.setEventData(e, data);\n  }\n\n  dragArrowhead(e, x, y) {\n    const data = this.getEventData(e);\n\n    if (this.graph.options.connecting.snap) {\n      this.snapArrowhead(x, y, data);\n    } else {\n      this.arrowheadDragging(this.getEventTarget(e), x, y, data);\n    }\n  }\n\n  stopArrowheadDragging(e, x, y) {\n    const graph = this.graph;\n    const data = this.getEventData(e);\n\n    if (graph.options.connecting.snap) {\n      this.snapArrowheadEnd(data);\n    } else {\n      this.arrowheadDragged(data, x, y);\n    }\n\n    const valid = graph.hook.validateEdge(this.cell, data.terminalType, data.initialTerminal);\n\n    if (valid) {\n      this.finishEmbedding(data);\n      this.notifyConnectionEvent(data, e);\n    } else {\n      // If the changed edge is not allowed, revert to its previous state.\n      this.fallbackConnection(data);\n    }\n\n    this.afterArrowheadDragging(data);\n  } // #endregion\n  // #region drag lable\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  startLabelDragging(e, x, y) {\n    if (this.can('edgeLabelMovable')) {\n      const target = e.currentTarget;\n      const index = parseInt(target.getAttribute('data-index'), 10);\n      const positionAngle = this.getLabelPositionAngle(index);\n      const labelPositionArgs = this.getLabelPositionArgs(index);\n      const defaultLabelPositionArgs = this.getDefaultLabelPositionArgs();\n      const positionArgs = this.mergeLabelPositionArgs(labelPositionArgs, defaultLabelPositionArgs);\n      this.setEventData(e, {\n        index,\n        positionAngle,\n        positionArgs,\n        stopPropagation: true,\n        action: 'drag-label'\n      });\n    } else {\n      // If labels can't be dragged no default action is triggered.\n      this.setEventData(e, {\n        stopPropagation: true\n      });\n    }\n\n    this.graph.view.delegateDragEvents(e, this);\n  }\n\n  dragLabel(e, x, y) {\n    const data = this.getEventData(e);\n    const originLabel = this.cell.getLabelAt(data.index);\n    const label = ObjectExt.merge({}, originLabel, {\n      position: this.getLabelPosition(x, y, data.positionAngle, data.positionArgs)\n    });\n    this.cell.setLabelAt(data.index, label);\n  } // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  stopLabelDragging(e, x, y) {} // #endregion\n  // #region drag vertex\n\n\n  handleVertexAdding(e, x, y) {\n    if (!this.can('vertexAddable')) {\n      this.notifyUnhandledMouseDown(e, x, y);\n      return;\n    } // Store the index at which the new vertex has just been placed.\n    // We'll be update the very same vertex position in `pointermove()`.\n\n\n    const index = this.addVertex({\n      x,\n      y\n    }, {\n      ui: true\n    });\n    this.setEventData(e, {\n      index,\n      action: 'drag-vertex'\n    });\n  }\n\n  handleVertexRemoving(e, x, y) {\n    if (!this.can('vertexDeletable')) {\n      this.notifyUnhandledMouseDown(e, x, y);\n      return;\n    }\n\n    const target = e.target;\n    const index = parseInt(target.getAttribute('idx'), 10);\n    this.cell.removeVertexAt(index);\n  }\n\n  startVertexDragging(e, x, y) {\n    if (!this.can('vertexMovable')) {\n      this.notifyUnhandledMouseDown(e, x, y);\n      return;\n    }\n\n    const target = e.target;\n    const index = parseInt(target.getAttribute('idx'), 10);\n    this.setEventData(e, {\n      index,\n      action: 'drag-vertex'\n    });\n  }\n\n  dragVertex(e, x, y) {\n    const data = this.getEventData(e);\n    this.cell.setVertexAt(data.index, {\n      x,\n      y\n    }, {\n      ui: true\n    });\n  } // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  stopVertexDragging(e, x, y) {}\n\n}\n\n(function (EdgeView) {\n  EdgeView.toStringTag = `X6.${EdgeView.name}`;\n\n  function isEdgeView(instance) {\n    if (instance == null) {\n      return false;\n    }\n\n    if (instance instanceof EdgeView) {\n      return true;\n    }\n\n    const tag = instance[Symbol.toStringTag];\n    const view = instance;\n\n    if ((tag == null || tag === EdgeView.toStringTag) && typeof view.isNodeView === 'function' && typeof view.isEdgeView === 'function' && typeof view.confirmUpdate === 'function' && typeof view.update === 'function' && typeof view.getConnection === 'function') {\n      return true;\n    }\n\n    return false;\n  }\n\n  EdgeView.isEdgeView = isEdgeView;\n})(EdgeView || (EdgeView = {}));\n\nEdgeView.config({\n  isSvgElement: true,\n  priority: 1,\n  bootstrap: ['render', 'source', 'target'],\n  actions: {\n    view: ['render'],\n    markup: ['render'],\n    attrs: ['update'],\n    source: ['source', 'update'],\n    target: ['target', 'update'],\n    router: ['update'],\n    connector: ['update'],\n    labels: ['labels'],\n    defaultLabel: ['labels'],\n    vertices: ['vertices', 'update'],\n    vertexMarkup: ['vertices'],\n    toolMarkup: ['tools'],\n    tools: ['widget']\n  },\n  shortLength: 105,\n  longLength: 155,\n  toolsOffset: 40,\n  doubleTools: false,\n  doubleToolsOffset: 65,\n  sampleInterval: 50\n});\nEdgeView.registry.register('edge', EdgeView, true);","map":{"version":3,"mappings":"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","names":["Rectangle","Polyline","Point","Angle","Path","Line","StringExt","ObjectExt","NumberExt","FunctionExt","Dom","Vector","Router","Connector","NodeAnchor","EdgeAnchor","ConnectionPoint","Edge","Markup","CellView","EdgeView","constructor","Symbol","toStringTag","getContainerClassName","prefixClassName","join","sourceBBox","sourceView","sourceDef","cell","getSource","x","y","sourceMagnet","isEdgeElement","sourceAnchor","getBBoxOfElement","container","targetBBox","targetView","targetDef","getTarget","targetMagnet","targetAnchor","isEdgeView","confirmUpdate","flag","options","ref","hasAction","updateTerminalProperties","removeAction","graph","renderer","isViewMounted","render","handleAction","renderVertexMarkers","update","onLabelsChange","renderTools","updateToolsPosition","renderExternalTools","shouldRerenderLabels","renderLabels","updateLabels","updateLabelPositions","previousLabels","previous","pathArray","propertyPathArray","pathLength","length","index","propertyValue","has","empty","containers","renderMarkup","markup","renderStringMarkup","renderJSONMarkup","TypeError","ret","parseJSONMarkup","selectors","append","fragment","cache","children","createVectors","forEach","child","className","attr","camelCase","node","renderArrowheadMarkers","map","edge","labels","getLabels","count","labelCache","labelSelectors","parentNode","removeChild","createSvgElement","addClass","i","ii","label","normalized","normalizeLabelMarkup","parseLabelMarkup","labelNode","defaultLabel","getDefaultLabel","setAttribute","appendChild","rootSelector","Error","customizeLabels","parseLabelStringMarkup","labelMarkup","document","createDocumentFragment","n","currentChild","DocumentFragment","hasChildNodes","vel","childNodes","nodeName","toUpperCase","create","canLabelMove","can","elem","attrs","merge","updateAttrs","rootBBox","size","fromSize","undefined","mergeLabelAttrs","hasCustomMarkup","labelAttrs","defaultLabelAttrs","hook","onEdgeLabelRendered","tools","toolMarkup","$container","$","isStringMarkup","template","tool","toolCache","doubleTools","tool2","doubleToolMarkup","clone","tool2Cache","getTools","addTools","vertices","vertexMarkup","getVertices","vertex","arrowheads","arrowheadMarkup","sourceArrowhead","end","targetArrowhead","partialAttrs","cleanCache","updateConnection","getAttrs","updateConnectionPath","updateArrowheadMarkers","updateTools","removeRedundantLinearVertices","routePoints","rawCount","polyline","simplify","threshold","simplifiedPoints","points","point","toJSON","simplifiedCount","setVertices","slice","connection","pathData","getConnectionPathData","connectionWrap","sourceMarker","targetMarker","translateAndAutoOrientArrows","getTerminalView","type","getTerminalAnchor","getTerminalConnectionPoint","sourcePoint","targetPoint","getTerminalMagnet","raw","translateBy","isFragmentDescendantOf","tx","ty","translate","translateConnectionPoints","path","anchors","findAnchors","source","target","findRoutePoints","connectionPoints","findConnectionPoints","markerPoints","findMarkerPoints","findPath","firstVertex","lastVertex","priority","findAnchorsOrdered","firstType","firstPoint","secondType","secondPoint","firstAnchor","secondAnchor","firstTerminal","secondTerminal","firstView","secondView","firstMagnet","secondMagnet","firstRef","getAnchor","anchor","secondRef","isPointLike","def","cellView","magnet","terminalType","isEdge","connecting","config","name","defaults","sourceEdgeAnchor","targetEdgeAnchor","edgeAnchor","fn","registry","get","onNotFound","call","args","round","POINT_ROUNDING","defaultRouter","router","presets","normal","getRouter","p","sourceTerminal","targetTerminal","firstRoutePoint","lastRoutePoint","sourcePointRef","sourceLine","connectionPointDef","connectionPoint","sourceConnectionPoint","getConnectionPoint","targetConnectionPointDef","targetConnectionPoint","targetPointRef","targetLine","view","line","endType","updateMarkerAttr","key","partial","getLineWidth","keys","Object","l","strokeWidth","parseFloat","sourceMarkerElem","targetMarkerElem","markerCache","sourceMarkerPoint","targetMarkerPoint","getBBox","width","scale","move","sx","getConnector","connector","method","parse","defaultPosition","normalizeLabelPosition","position","labelPosition","pos","matrix","getLabelTransformationMatrix","matrixToTransformString","offset","toolsOffset","connectionLength","getConnectionLength","shortLength","getPointAtLength","longLength","doubleToolsOffset","style","display","len","terminal","nodeId","viewKey","updateTerminalMagnet","terminalCell","getCellById","endView","findView","propName","terminalView","getMagnetFromEdgeTerminal","sourceArrow","targetArrow","route","translateAndAutoOrient","stage","getLabelPositionAngle","idx","getLabelAt","angle","getLabelPositionArgs","getDefaultLabelPositionArgs","mergeLabelPositionArgs","labelPositionArgs","defaultLabelPositionArgs","addLabel","p1","p2","p3","localX","localY","localAngle","localOptions","positionArgs","getLabelPosition","insertLabel","addVertex","isPoint","getVertexIndex","insertVertex","sendToken","token","callback","duration","reversed","selector","rorate","timing","rotate","dur","repeatCount","calcMode","fill","keyPoints","keyTimes","others","findOne","querySelector","SVGPathElement","parent","revert","remove","vToken","appendTo","onComplete","complete","e","stop","animateAlongPath","getConnection","pathCache","data","serialize","getConnectionSubdivisions","segmentSubdivisions","getSegmentSubdivisions","pointAtLength","getPointAtRatio","ratio","isPercentage","pointAt","getTangentAtLength","tangentAtLength","getTangentAtRatio","tangentAt","getClosestPoint","closestPoint","getClosestPointLength","closestPointLength","getClosestPointRatio","closestPointNormalizedLength","p4","distance","isOffsetAbsolute","absoluteOffset","isDistanceRelative","absoluteDistance","isDistanceAbsoluteReverse","reverseDistance","pathOptions","labelPoint","t","closestPointT","totalLength","labelDistance","lengthAtT","tangent","tangentAtT","labelOffset","pointOffset","pointAtT","labelOffsetDiff","diff","labelAngle","offsetCoord","isKeepGradient","keepGradient","isEnsureLegibility","ensureLegibility","pathOpt","translation","start","setLength","normalize","createSVGMatrix","getLabelCoordinates","f","vertexLength","currentVertex","currentLength","getEventArgs","notifyUnhandledMouseDown","notify","notifyMouseDown","onMouseDown","notifyMouseMove","onMouseMove","notifyMouseUp","onMouseUp","onClick","onDblClick","onContextMenu","getAttribute","startVertexDragging","handleVertexRemoving","handleVertexAdding","startArrowheadDragging","startEdgeDragging","getEventData","action","dragVertex","dragLabel","dragArrowhead","dragEdge","stopVertexDragging","stopLabelDragging","stopArrowheadDragging","stopEdgeDragging","checkMouseleave","onMouseOver","onMouseOut","onMouseEnter","onMouseLeave","onMouseWheel","delta","onCustomEvent","findParentByClass","stopPropagation","ui","onLabelMouseDown","startLabelDragging","setEventData","moving","removeClass","prepareArrowheadDragging","isNewEdge","initialMagnet","initialTerminal","fallbackAction","getValidateConnectionArgs","createValidateConnectionArgs","beforeArrowheadDragging","opposite","j","cellId","findViewByCell","zIndex","toFront","pointerEvents","highlight","highlightAvailableMagnets","afterArrowheadDragging","setZIndex","unhighlightAvailableMagnets","arrowheadDragging","currentTarget","currentMagnet","currentView","unhighlight","findViewByElem","findMagnet","validateConnection","getEdgeTerminal","prop","arrowheadDragged","setTerminal","snapArrowhead","snap","allowEdge","radius","findViewsOption","height","views","findViewsInArea","edgeViews","findEdgeViewsInArea","filter","push","prevView","closestView","prevMagnet","closestMagnet","minDistance","Number","MAX_SAFE_INTEGER","getCenter","querySelectorAll","bbox","changed","snapArrowheadEnd","finishEmbedding","embedding","enabled","updateParent","fallbackConnection","notifyConnectionEvent","currentTerminal","equalTerminals","previousCell","previousPort","port","previousView","previousPoint","current","currentCell","currentPort","currentPoint","previousMagnet","isNew","cells","model","getCells","marked","magnets","Array","prototype","availableMagnets","jj","id","getEventTarget","valid","validateEdge","parseInt","positionAngle","delegateDragEvents","originLabel","setLabelAt","removeVertexAt","setVertexAt","instance","tag","isNodeView","isSvgElement","bootstrap","actions","sampleInterval","register"],"sourceRoot":"","sources":["../../src/view/edge.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}