{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { NodeView, Scheduler } from '@antv/x6';\nimport { isVue2, isVue3, createApp, h, Vue2 } from 'vue-demi';\nexport class VueShapeView extends NodeView {\n  init() {\n    super.init();\n  }\n\n  getComponentContainer() {\n    return this.selectors.foContent;\n  }\n\n  confirmUpdate(flag) {\n    const ret = super.confirmUpdate(flag);\n    return this.handleAction(ret, VueShapeView.action, () => {\n      Scheduler.scheduleTask(() => {\n        this.renderVueComponent();\n      });\n    });\n  }\n\n  renderVueComponent() {\n    this.unmountVueComponent();\n    const root = this.getComponentContainer();\n    const node = this.cell;\n    const graph = this.graph;\n\n    if (root) {\n      const component = this.graph.hook.getVueComponent(node);\n\n      if (isVue2) {\n        const Vue = Vue2;\n        const div = document.createElement('div');\n        div.style.width = '100%';\n        div.style.height = '100%';\n\n        if (typeof component === 'string') {\n          div.innerHTML = component;\n          this.vm = new Vue({\n            el: div\n          });\n        } else {\n          const _a = component,\n                {\n            template\n          } = _a,\n                other = __rest(_a, [\"template\"]);\n\n          div.innerHTML = template;\n          this.vm = new Vue(Object.assign({\n            el: div,\n\n            provide() {\n              return {\n                getGraph: () => graph,\n                getNode: () => node\n              };\n            }\n\n          }, other));\n        }\n\n        root.appendChild(this.vm.$el);\n      } else if (isVue3) {\n        this.vm = createApp({\n          render() {\n            return h(component);\n          },\n\n          provide() {\n            return {\n              getGraph: () => graph,\n              getNode: () => node\n            };\n          }\n\n        });\n        this.vm.mount(root);\n      }\n    }\n  }\n\n  unmountVueComponent() {\n    const root = this.getComponentContainer();\n\n    if (this.vm) {\n      isVue2 && this.vm.$destroy();\n      isVue3 && this.vm.unmount();\n      this.vm = null;\n    }\n\n    root.innerHTML = '';\n    return root;\n  }\n\n  unmount() {\n    this.unmountVueComponent();\n    super.unmount();\n    return this;\n  }\n\n}\n\n(function (VueShapeView) {\n  VueShapeView.action = 'vue';\n  VueShapeView.config({\n    bootstrap: [VueShapeView.action],\n    actions: {\n      component: VueShapeView.action\n    }\n  });\n  NodeView.registry.register('vue-shape-view', VueShapeView, true);\n})(VueShapeView || (VueShapeView = {}));","map":{"version":3,"mappings":"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","names":["NodeView","Scheduler","isVue2","isVue3","createApp","h","Vue2","VueShapeView","init","getComponentContainer","selectors","foContent","confirmUpdate","flag","ret","handleAction","action","scheduleTask","renderVueComponent","unmountVueComponent","root","node","cell","graph","component","hook","getVueComponent","Vue","div","document","createElement","style","width","height","innerHTML","vm","el","_a","template","other","Object","provide","getGraph","getNode","appendChild","$el","render","mount","$destroy","unmount","config","bootstrap","actions","registry","register"],"sourceRoot":"","sources":["../src/view.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}