{"ast":null,"code":"\"use strict\";\n/**\n * @fileOverview random layout\n * @author shiwu.wyy@antfin.com\n */\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ForceLayout = void 0;\n\nvar d3Force = __importStar(require(\"d3-force\"));\n\nvar force_in_a_box_1 = __importDefault(require(\"./force-in-a-box\"));\n\nvar util_1 = require(\"../../util\");\n\nvar base_1 = require(\"../base\");\n\nvar constants_1 = require(\"../constants\");\n/**\n * 经典力导布局 force-directed\n */\n\n\nvar ForceLayout =\n/** @class */\nfunction (_super) {\n  __extends(ForceLayout, _super);\n\n  function ForceLayout(options) {\n    var _this = _super.call(this) || this;\n    /** 向心力作用点 */\n\n\n    _this.center = [0, 0];\n    /** 节点作用力 */\n\n    _this.nodeStrength = null;\n    /** 边的作用力, 默认为根据节点的入度出度自适应 */\n\n    _this.edgeStrength = null;\n    /** 是否防止节点相互覆盖 */\n\n    _this.preventOverlap = false;\n    /** 聚类节点作用力 */\n\n    _this.clusterNodeStrength = null;\n    /** 聚类边作用力 */\n\n    _this.clusterEdgeStrength = null;\n    /** 聚类边长度 */\n\n    _this.clusterEdgeDistance = null;\n    /** 聚类节点大小 / 直径，直径越大，越分散 */\n\n    _this.clusterNodeSize = null;\n    /** 用于 foci 的力 */\n\n    _this.clusterFociStrength = null;\n    /** 默认边长度 */\n\n    _this.linkDistance = 50;\n    /** 迭代阈值的衰减率 [0, 1]，0.028 对应最大迭代数为 300 */\n\n    _this.alphaDecay = 0.028;\n    /** 停止迭代的阈值 */\n\n    _this.alphaMin = 0.001;\n    /** 当前阈值 */\n\n    _this.alpha = 0.3;\n    /** 防止重叠的力强度 */\n\n    _this.collideStrength = 1;\n    /** 是否启用web worker。前提是在web worker里执行布局，否则无效\t*/\n\n    _this.workerEnabled = false;\n\n    _this.tick = function () {};\n    /** 布局完成回调 */\n\n\n    _this.onLayoutEnd = function () {};\n    /** 是否正在布局 */\n\n\n    _this.ticking = undefined;\n\n    if (options) {\n      _this.updateCfg(options);\n    }\n\n    return _this;\n  }\n\n  ForceLayout.prototype.getDefaultCfg = function () {\n    return {\n      center: [0, 0],\n      nodeStrength: null,\n      edgeStrength: null,\n      preventOverlap: false,\n      nodeSize: undefined,\n      nodeSpacing: undefined,\n      linkDistance: 50,\n      forceSimulation: null,\n      alphaDecay: 0.028,\n      alphaMin: 0.001,\n      alpha: 0.3,\n      collideStrength: 1,\n      clustering: false,\n      clusterNodeStrength: -1,\n      clusterEdgeStrength: 0.1,\n      clusterEdgeDistance: 100,\n      clusterFociStrength: 0.8,\n      clusterNodeSize: 10,\n      tick: function () {},\n      onLayoutEnd: function () {},\n      // 是否启用web worker。前提是在web worker里执行布局，否则无效\n      workerEnabled: false\n    };\n  };\n  /**\n   * 初始化\n   * @param {object} data 数据\n   */\n\n\n  ForceLayout.prototype.init = function (data) {\n    var self = this;\n    self.nodes = data.nodes || [];\n    var edges = data.edges || [];\n    self.edges = edges.map(function (edge) {\n      var res = {};\n      var expectKeys = [\"targetNode\", \"sourceNode\", \"startPoint\", \"endPoint\"];\n      Object.keys(edge).forEach(function (key) {\n        if (!(expectKeys.indexOf(key) > -1)) {\n          res[key] = edge[key];\n        }\n      });\n      return res;\n    });\n    self.ticking = false;\n  };\n  /**\n   * 执行布局\n   */\n\n\n  ForceLayout.prototype.execute = function (reloadData) {\n    var self = this;\n    var nodes = self.nodes;\n    var edges = self.edges; // 如果正在布局，忽略布局请求\n\n    if (self.ticking) {\n      return;\n    }\n\n    var simulation = self.forceSimulation;\n    var alphaMin = self.alphaMin;\n    var alphaDecay = self.alphaDecay;\n    var alpha = self.alpha;\n\n    if (!simulation) {\n      try {\n        // 定义节点的力\n        var nodeForce = d3Force.forceManyBody();\n\n        if (self.nodeStrength) {\n          nodeForce.strength(self.nodeStrength);\n        }\n\n        simulation = d3Force.forceSimulation().nodes(nodes);\n\n        if (self.clustering) {\n          var clusterForce = (0, force_in_a_box_1.default)();\n          clusterForce.centerX(self.center[0]).centerY(self.center[1]).template(\"force\").strength(self.clusterFociStrength);\n\n          if (edges) {\n            clusterForce.links(edges);\n          }\n\n          if (nodes) {\n            clusterForce.nodes(nodes);\n          }\n\n          clusterForce.forceLinkDistance(self.clusterEdgeDistance).forceLinkStrength(self.clusterEdgeStrength).forceCharge(self.clusterNodeStrength).forceNodeSize(self.clusterNodeSize);\n          self.clusterForce = clusterForce;\n          simulation.force(\"group\", clusterForce);\n        }\n\n        simulation.force(\"center\", d3Force.forceCenter(self.center[0], self.center[1])).force(\"charge\", nodeForce).alpha(alpha).alphaDecay(alphaDecay).alphaMin(alphaMin);\n\n        if (self.preventOverlap) {\n          self.overlapProcess(simulation);\n        } // 如果有边，定义边的力\n\n\n        if (edges) {\n          // d3 的 forceLayout 会重新生成边的数据模型，为了避免污染源数据\n          var edgeForce = d3Force.forceLink().id(function (d) {\n            return d.id;\n          }).links(edges);\n\n          if (self.edgeStrength) {\n            edgeForce.strength(self.edgeStrength);\n          }\n\n          if (self.linkDistance) {\n            edgeForce.distance(self.linkDistance);\n          }\n\n          self.edgeForce = edgeForce;\n          simulation.force(\"link\", edgeForce);\n        }\n\n        if (self.workerEnabled && !isInWorker()) {\n          // 如果不是运行在web worker里，不用web worker布局\n          self.workerEnabled = false;\n          console.warn(\"workerEnabled option is only supported when running in web worker.\");\n        }\n\n        if (!self.workerEnabled) {\n          simulation.on(\"tick\", function () {\n            self.tick();\n          }).on(\"end\", function () {\n            self.ticking = false;\n            if (self.onLayoutEnd) self.onLayoutEnd();\n          });\n          self.ticking = true;\n        } else {\n          // worker is enabled\n          simulation.stop();\n          var totalTicks = getSimulationTicks(simulation);\n\n          for (var currentTick = 1; currentTick <= totalTicks; currentTick++) {\n            simulation.tick(); // currentTick starts from 1.\n\n            postMessage({\n              nodes: nodes,\n              currentTick: currentTick,\n              totalTicks: totalTicks,\n              type: constants_1.LAYOUT_MESSAGE.TICK\n            }, undefined);\n          }\n\n          self.ticking = false;\n        }\n\n        self.forceSimulation = simulation;\n        self.ticking = true;\n      } catch (e) {\n        self.ticking = false;\n        console.warn(e);\n      }\n    } else {\n      if (reloadData) {\n        if (self.clustering && self.clusterForce) {\n          self.clusterForce.nodes(nodes);\n          self.clusterForce.links(edges);\n        }\n\n        simulation.nodes(nodes);\n        if (edges && self.edgeForce) self.edgeForce.links(edges);else if (edges && !self.edgeForce) {\n          // d3 的 forceLayout 会重新生成边的数据模型，为了避免污染源数据\n          var edgeForce = d3Force.forceLink().id(function (d) {\n            return d.id;\n          }).links(edges);\n\n          if (self.edgeStrength) {\n            edgeForce.strength(self.edgeStrength);\n          }\n\n          if (self.linkDistance) {\n            edgeForce.distance(self.linkDistance);\n          }\n\n          self.edgeForce = edgeForce;\n          simulation.force(\"link\", edgeForce);\n        }\n      }\n\n      if (self.preventOverlap) {\n        self.overlapProcess(simulation);\n      }\n\n      simulation.alpha(alpha).restart();\n      this.ticking = true;\n    }\n  };\n  /**\n   * 防止重叠\n   * @param {object} simulation 力模拟模型\n   */\n\n\n  ForceLayout.prototype.overlapProcess = function (simulation) {\n    var self = this;\n    var nodeSize = self.nodeSize;\n    var nodeSpacing = self.nodeSpacing;\n    var nodeSizeFunc;\n    var nodeSpacingFunc;\n    var collideStrength = self.collideStrength;\n\n    if ((0, util_1.isNumber)(nodeSpacing)) {\n      nodeSpacingFunc = function () {\n        return nodeSpacing;\n      };\n    } else if ((0, util_1.isFunction)(nodeSpacing)) {\n      nodeSpacingFunc = nodeSpacing;\n    } else {\n      nodeSpacingFunc = function () {\n        return 0;\n      };\n    }\n\n    if (!nodeSize) {\n      nodeSizeFunc = function (d) {\n        if (d.size) {\n          if ((0, util_1.isArray)(d.size)) {\n            var res = d.size[0] > d.size[1] ? d.size[0] : d.size[1];\n            return res / 2 + nodeSpacingFunc(d);\n          }\n\n          if ((0, util_1.isObject)(d.size)) {\n            var res = d.size.width > d.size.height ? d.size.width : d.size.height;\n            return res / 2 + nodeSpacingFunc(d);\n          }\n\n          return d.size / 2 + nodeSpacingFunc(d);\n        }\n\n        return 10 + nodeSpacingFunc(d);\n      };\n    } else if ((0, util_1.isFunction)(nodeSize)) {\n      nodeSizeFunc = function (d) {\n        var size = nodeSize(d);\n        return size + nodeSpacingFunc(d);\n      };\n    } else if ((0, util_1.isArray)(nodeSize)) {\n      var larger = nodeSize[0] > nodeSize[1] ? nodeSize[0] : nodeSize[1];\n      var radius_1 = larger / 2;\n\n      nodeSizeFunc = function (d) {\n        return radius_1 + nodeSpacingFunc(d);\n      };\n    } else if ((0, util_1.isNumber)(nodeSize)) {\n      var radius_2 = nodeSize / 2;\n\n      nodeSizeFunc = function (d) {\n        return radius_2 + nodeSpacingFunc(d);\n      };\n    } else {\n      nodeSizeFunc = function () {\n        return 10;\n      };\n    } // forceCollide's parameter is a radius\n\n\n    simulation.force(\"collisionForce\", d3Force.forceCollide(nodeSizeFunc).strength(collideStrength));\n  };\n  /**\n   * 更新布局配置，但不执行布局\n   * @param {object} cfg 需要更新的配置项\n   */\n\n\n  ForceLayout.prototype.updateCfg = function (cfg) {\n    var self = this;\n\n    if (self.ticking) {\n      self.forceSimulation.stop();\n      self.ticking = false;\n    }\n\n    self.forceSimulation = null;\n    Object.assign(self, cfg);\n  };\n\n  ForceLayout.prototype.destroy = function () {\n    var self = this;\n\n    if (self.ticking) {\n      self.forceSimulation.stop();\n      self.ticking = false;\n    }\n\n    self.nodes = null;\n    self.edges = null;\n    self.destroyed = true;\n  };\n\n  return ForceLayout;\n}(base_1.Base);\n\nexports.ForceLayout = ForceLayout; // Return total ticks of d3-force simulation\n\nfunction getSimulationTicks(simulation) {\n  var alphaMin = simulation.alphaMin();\n  var alphaTarget = simulation.alphaTarget();\n  var alpha = simulation.alpha();\n  var totalTicksFloat = Math.log((alphaMin - alphaTarget) / (alpha - alphaTarget)) / Math.log(1 - simulation.alphaDecay());\n  var totalTicks = Math.ceil(totalTicksFloat);\n  return totalTicks;\n} // 判断是否运行在web worker里\n\n\nfunction isInWorker() {\n  // eslint-disable-next-line no-undef\n  return typeof WorkerGlobalScope !== \"undefined\" && self instanceof WorkerGlobalScope;\n}","map":{"version":3,"mappings":"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","names":["__extends","options","_super","_this","undefined","updateCfg","ForceLayout","center","nodeStrength","edgeStrength","preventOverlap","nodeSize","nodeSpacing","linkDistance","forceSimulation","alphaDecay","alphaMin","alpha","collideStrength","clustering","clusterNodeStrength","clusterEdgeStrength","clusterEdgeDistance","clusterFociStrength","clusterNodeSize","tick","onLayoutEnd","workerEnabled","data","self","nodes","edges","map","edge","res","expectKeys","Object","keys","forEach","key","indexOf","ticking","reloadData","simulation","nodeForce","d3Force","forceManyBody","strength","clusterForce","centerX","centerY","template","links","forceLinkDistance","forceLinkStrength","forceCharge","forceNodeSize","force","forceCenter","overlapProcess","edgeForce","forceLink","id","d","distance","isInWorker","console","warn","on","stop","totalTicks","getSimulationTicks","currentTick","postMessage","type","constants_1","TICK","e","restart","nodeSizeFunc","nodeSpacingFunc","size","width","height","larger","radius_1","radius_2","forceCollide","cfg","assign","destroyed","base_1","exports","alphaTarget","totalTicksFloat","Math","log","ceil","WorkerGlobalScope"],"sourceRoot":"","sources":["../../../src/layout/force/force.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}