{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar acyclic_1 = __importDefault(require(\"./acyclic\"));\n\nvar normalize_1 = __importDefault(require(\"./normalize\"));\n\nvar rank_1 = __importDefault(require(\"./rank\"));\n\nvar util_1 = require(\"./util\");\n\nvar parent_dummy_chains_1 = __importDefault(require(\"./parent-dummy-chains\"));\n\nvar nesting_graph_1 = __importDefault(require(\"./nesting-graph\"));\n\nvar add_border_segments_1 = __importDefault(require(\"./add-border-segments\"));\n\nvar coordinate_system_1 = __importDefault(require(\"./coordinate-system\"));\n\nvar order_1 = __importDefault(require(\"./order\"));\n\nvar position_1 = __importDefault(require(\"./position\"));\n\nvar init_data_order_1 = __importDefault(require(\"./order/init-data-order\"));\n\nvar graph_1 = require(\"../graph\");\n\nvar layout = function (g, opts) {\n  var time = opts && opts.debugTiming ? util_1.time : util_1.notime;\n  time(\"layout\", function () {\n    // 如果在原图基础上修改，继承原图的order结果\n    if (opts && !opts.keepNodeOrder && opts.prevGraph) {\n      time(\"  inheritOrder\", function () {\n        inheritOrder(g, opts.prevGraph);\n      });\n    }\n\n    var layoutGraph = time(\"  buildLayoutGraph\", function () {\n      return buildLayoutGraph(g);\n    }); // 控制是否为边的label留位置（这会影响是否在边中间添加dummy node）\n\n    if (!(opts && opts.edgeLabelSpace === false)) {\n      time(\"  makeSpaceForEdgeLabels\", function () {\n        makeSpaceForEdgeLabels(layoutGraph);\n      });\n    } // TODO: 暂时处理层级设置不正确时的异常报错，提示设置正确的层级\n\n\n    try {\n      time(\"  runLayout\", function () {\n        runLayout(layoutGraph, time, opts);\n      });\n    } catch (e) {\n      if (e.message === \"Not possible to find intersection inside of the rectangle\") {\n        console.error(\"The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:\\n\", e);\n        return;\n      }\n\n      throw e;\n    }\n\n    time(\"  updateInputGraph\", function () {\n      updateInputGraph(g, layoutGraph);\n    });\n  });\n};\n\nvar runLayout = function (g, time, opts) {\n  time(\"    removeSelfEdges\", function () {\n    removeSelfEdges(g);\n  });\n  time(\"    acyclic\", function () {\n    acyclic_1.default.run(g);\n  });\n  time(\"    nestingGraph.run\", function () {\n    nesting_graph_1.default.run(g);\n  });\n  time(\"    rank\", function () {\n    (0, rank_1.default)((0, util_1.asNonCompoundGraph)(g));\n  });\n  time(\"    injectEdgeLabelProxies\", function () {\n    injectEdgeLabelProxies(g);\n  });\n  time(\"    removeEmptyRanks\", function () {\n    (0, util_1.removeEmptyRanks)(g);\n  });\n  time(\"    nestingGraph.cleanup\", function () {\n    nesting_graph_1.default.cleanup(g);\n  });\n  time(\"    normalizeRanks\", function () {\n    (0, util_1.normalizeRanks)(g);\n  });\n  time(\"    assignRankMinMax\", function () {\n    assignRankMinMax(g);\n  });\n  time(\"    removeEdgeLabelProxies\", function () {\n    removeEdgeLabelProxies(g);\n  });\n  time(\"    normalize.run\", function () {\n    normalize_1.default.run(g);\n  });\n  time(\"    parentDummyChains\", function () {\n    (0, parent_dummy_chains_1.default)(g);\n  });\n  time(\"    addBorderSegments\", function () {\n    (0, add_border_segments_1.default)(g);\n  });\n\n  if (opts && opts.keepNodeOrder) {\n    time(\"    initDataOrder\", function () {\n      (0, init_data_order_1.default)(g, opts.nodeOrder);\n    });\n  }\n\n  time(\"    order\", function () {\n    (0, order_1.default)(g);\n  });\n  time(\"    insertSelfEdges\", function () {\n    insertSelfEdges(g);\n  });\n  time(\"    adjustCoordinateSystem\", function () {\n    coordinate_system_1.default.adjust(g);\n  });\n  time(\"    position\", function () {\n    (0, position_1.default)(g);\n  });\n  time(\"    positionSelfEdges\", function () {\n    positionSelfEdges(g);\n  });\n  time(\"    removeBorderNodes\", function () {\n    removeBorderNodes(g);\n  });\n  time(\"    normalize.undo\", function () {\n    normalize_1.default.undo(g);\n  });\n  time(\"    fixupEdgeLabelCoords\", function () {\n    fixupEdgeLabelCoords(g);\n  });\n  time(\"    undoCoordinateSystem\", function () {\n    coordinate_system_1.default.undo(g);\n  });\n  time(\"    translateGraph\", function () {\n    translateGraph(g);\n  });\n  time(\"    assignNodeIntersects\", function () {\n    assignNodeIntersects(g);\n  });\n  time(\"    reversePoints\", function () {\n    reversePointsForReversedEdges(g);\n  });\n  time(\"    acyclic.undo\", function () {\n    acyclic_1.default.undo(g);\n  });\n};\n/**\n * 继承上一个布局中的order，防止翻转\n * TODO: 暂时没有考虑涉及层级变动的布局，只保证原来布局层级和相对顺序不变\n */\n\n\nvar inheritOrder = function (currG, prevG) {\n  currG.nodes().forEach(function (n) {\n    var node = currG.node(n);\n    var prevNode = prevG.node(n);\n\n    if (prevNode !== undefined) {\n      node.fixorder = prevNode._order;\n      delete prevNode._order;\n    } else {\n      delete node.fixorder;\n    }\n  });\n};\n/*\n * Copies final layout information from the layout graph back to the input\n * graph. This process only copies whitelisted attributes from the layout graph\n * to the input graph, so it serves as a good place to determine what\n * attributes can influence layout.\n */\n\n\nvar updateInputGraph = function (inputGraph, layoutGraph) {\n  inputGraph.nodes().forEach(function (v) {\n    var _a;\n\n    var inputLabel = inputGraph.node(v);\n\n    if (inputLabel) {\n      var layoutLabel = layoutGraph.node(v);\n      inputLabel.x = layoutLabel.x;\n      inputLabel.y = layoutLabel.y;\n      inputLabel._order = layoutLabel.order;\n      inputLabel._rank = layoutLabel.rank;\n\n      if ((_a = layoutGraph.children(v)) === null || _a === void 0 ? void 0 : _a.length) {\n        inputLabel.width = layoutLabel.width;\n        inputLabel.height = layoutLabel.height;\n      }\n    }\n  });\n  inputGraph.edges().forEach(function (e) {\n    var inputLabel = inputGraph.edge(e);\n    var layoutLabel = layoutGraph.edge(e);\n    inputLabel.points = layoutLabel.points;\n\n    if (layoutLabel.hasOwnProperty(\"x\")) {\n      inputLabel.x = layoutLabel.x;\n      inputLabel.y = layoutLabel.y;\n    }\n  });\n  inputGraph.graph().width = layoutGraph.graph().width;\n  inputGraph.graph().height = layoutGraph.graph().height;\n};\n\nvar graphNumAttrs = [\"nodesep\", \"edgesep\", \"ranksep\", \"marginx\", \"marginy\"];\nvar graphDefaults = {\n  ranksep: 50,\n  edgesep: 20,\n  nodesep: 50,\n  rankdir: \"tb\"\n};\nvar graphAttrs = [\"acyclicer\", \"ranker\", \"rankdir\", \"align\"];\nvar nodeNumAttrs = [\"width\", \"height\", \"layer\", \"fixorder\"]; // 需要传入layer, fixOrder作为参数参考\n\nvar nodeDefaults = {\n  width: 0,\n  height: 0\n};\nvar edgeNumAttrs = [\"minlen\", \"weight\", \"width\", \"height\", \"labeloffset\"];\nvar edgeDefaults = {\n  minlen: 1,\n  weight: 1,\n  width: 0,\n  height: 0,\n  labeloffset: 10,\n  labelpos: \"r\"\n};\nvar edgeAttrs = [\"labelpos\"];\n/*\n * Constructs a new graph from the input graph, which can be used for layout.\n * This process copies only whitelisted attributes from the input graph to the\n * layout graph. Thus this function serves as a good place to determine what\n * attributes can influence layout.\n */\n\nvar buildLayoutGraph = function (inputGraph) {\n  var g = new graph_1.Graph({\n    multigraph: true,\n    compound: true\n  });\n  var graph = canonicalize(inputGraph.graph());\n  var pickedProperties = {};\n  graphAttrs === null || graphAttrs === void 0 ? void 0 : graphAttrs.forEach(function (key) {\n    if (graph[key] !== undefined) pickedProperties[key] = graph[key];\n  });\n  g.setGraph(Object.assign({}, graphDefaults, selectNumberAttrs(graph, graphNumAttrs), pickedProperties));\n  inputGraph.nodes().forEach(function (v) {\n    var node = canonicalize(inputGraph.node(v));\n\n    var defaultNode = __assign(__assign({}, nodeDefaults), node);\n\n    var defaultAttrs = selectNumberAttrs(defaultNode, nodeNumAttrs);\n    g.setNode(v, defaultAttrs);\n    g.setParent(v, inputGraph.parent(v));\n  });\n  inputGraph.edges().forEach(function (e) {\n    var edge = canonicalize(inputGraph.edge(e));\n    var pickedProperties = {};\n    edgeAttrs === null || edgeAttrs === void 0 ? void 0 : edgeAttrs.forEach(function (key) {\n      if (edge[key] !== undefined) pickedProperties[key] = edge[key];\n    });\n    g.setEdgeObj(e, Object.assign({}, edgeDefaults, selectNumberAttrs(edge, edgeNumAttrs), pickedProperties));\n  });\n  return g;\n};\n/*\n * This idea comes from the Gansner paper: to account for edge labels in our\n * layout we split each rank in half by doubling minlen and halving ranksep.\n * Then we can place labels at these mid-points between nodes.\n *\n * We also add some minimal padding to the width to push the label for the edge\n * away from the edge itself a bit.\n */\n\n\nvar makeSpaceForEdgeLabels = function (g) {\n  var graph = g.graph();\n  if (!graph.ranksep) graph.ranksep = 0;\n  graph.ranksep /= 2;\n  g.nodes().forEach(function (n) {\n    var node = g.node(n);\n\n    if (!isNaN(node.layer)) {\n      if (!node.layer) node.layer = 0;else node.layer *= 2; // TODO: 因为默认的rank变为两倍，设定的layer也*2\n    }\n  });\n  g.edges().forEach(function (e) {\n    var _a;\n\n    var edge = g.edge(e);\n    edge.minlen *= 2;\n\n    if (((_a = edge.labelpos) === null || _a === void 0 ? void 0 : _a.toLowerCase()) !== \"c\") {\n      if (graph.rankdir === \"TB\" || graph.rankdir === \"BT\") {\n        edge.width += edge.labeloffset;\n      } else {\n        edge.height += edge.labeloffset;\n      }\n    }\n  });\n};\n/*\n * Creates temporary dummy nodes that capture the rank in which each edge's\n * label is going to, if it has one of non-zero width and height. We do this\n * so that we can safely remove empty ranks while preserving balance for the\n * label's position.\n */\n\n\nvar injectEdgeLabelProxies = function (g) {\n  g.edges().forEach(function (e) {\n    var edge = g.edge(e);\n\n    if (edge.width && edge.height) {\n      var v = g.node(e.v);\n      var w = g.node(e.w);\n      var label = {\n        e: e,\n        rank: (w.rank - v.rank) / 2 + v.rank\n      };\n      (0, util_1.addDummyNode)(g, \"edge-proxy\", label, \"_ep\");\n    }\n  });\n};\n\nvar assignRankMinMax = function (g) {\n  var maxRank = 0;\n  g.nodes().forEach(function (v) {\n    var _a, _b;\n\n    var node = g.node(v);\n\n    if (node.borderTop) {\n      node.minRank = (_a = g.node(node.borderTop)) === null || _a === void 0 ? void 0 : _a.rank;\n      node.maxRank = (_b = g.node(node.borderBottom)) === null || _b === void 0 ? void 0 : _b.rank;\n      maxRank = Math.max(maxRank, node.maxRank || -Infinity);\n    }\n  });\n  g.graph().maxRank = maxRank;\n};\n\nvar removeEdgeLabelProxies = function (g) {\n  g.nodes().forEach(function (v) {\n    var node = g.node(v);\n\n    if (node.dummy === \"edge-proxy\") {\n      g.edge(node.e).labelRank = node.rank;\n      g.removeNode(v);\n    }\n  });\n};\n\nvar translateGraph = function (g) {\n  var minX;\n  var maxX = 0;\n  var minY;\n  var maxY = 0;\n  var graphLabel = g.graph();\n  var marginX = graphLabel.marginx || 0;\n  var marginY = graphLabel.marginy || 0;\n\n  var getExtremes = function (attrs) {\n    if (!attrs) return;\n    var x = attrs.x;\n    var y = attrs.y;\n    var w = attrs.width;\n    var h = attrs.height;\n\n    if (!isNaN(x) && !isNaN(w)) {\n      if (minX === undefined) {\n        minX = x - w / 2;\n      }\n\n      minX = Math.min(minX, x - w / 2);\n      maxX = Math.max(maxX, x + w / 2);\n    }\n\n    if (!isNaN(y) && !isNaN(h)) {\n      if (minY === undefined) {\n        minY = y - h / 2;\n      }\n\n      minY = Math.min(minY, y - h / 2);\n      maxY = Math.max(maxY, y + h / 2);\n    }\n  };\n\n  g.nodes().forEach(function (v) {\n    getExtremes(g.node(v));\n  });\n  g.edges().forEach(function (e) {\n    var edge = g.edge(e);\n\n    if (edge === null || edge === void 0 ? void 0 : edge.hasOwnProperty(\"x\")) {\n      getExtremes(edge);\n    }\n  });\n  minX -= marginX;\n  minY -= marginY;\n  g.nodes().forEach(function (v) {\n    var node = g.node(v);\n\n    if (node) {\n      node.x -= minX;\n      node.y -= minY;\n    }\n  });\n  g.edges().forEach(function (e) {\n    var _a;\n\n    var edge = g.edge(e);\n    (_a = edge.points) === null || _a === void 0 ? void 0 : _a.forEach(function (p) {\n      p.x -= minX;\n      p.y -= minY;\n    });\n\n    if (edge.hasOwnProperty(\"x\")) {\n      edge.x -= minX;\n    }\n\n    if (edge.hasOwnProperty(\"y\")) {\n      edge.y -= minY;\n    }\n  });\n  graphLabel.width = maxX - minX + marginX;\n  graphLabel.height = maxY - minY + marginY;\n};\n\nvar assignNodeIntersects = function (g) {\n  g.edges().forEach(function (e) {\n    var edge = g.edge(e);\n    var nodeV = g.node(e.v);\n    var nodeW = g.node(e.w);\n    var p1;\n    var p2;\n\n    if (!edge.points) {\n      edge.points = [];\n      p1 = nodeW;\n      p2 = nodeV;\n    } else {\n      p1 = edge.points[0];\n      p2 = edge.points[edge.points.length - 1];\n    }\n\n    edge.points.unshift((0, util_1.intersectRect)(nodeV, p1));\n    edge.points.push((0, util_1.intersectRect)(nodeW, p2));\n  });\n};\n\nvar fixupEdgeLabelCoords = function (g) {\n  g.edges().forEach(function (e) {\n    var edge = g.edge(e);\n\n    if (edge === null || edge === void 0 ? void 0 : edge.hasOwnProperty(\"x\")) {\n      if (edge.labelpos === \"l\" || edge.labelpos === \"r\") {\n        edge.width -= edge.labeloffset;\n      }\n\n      switch (edge.labelpos) {\n        case \"l\":\n          edge.x -= edge.width / 2 + edge.labeloffset;\n          break;\n\n        case \"r\":\n          edge.x += edge.width / 2 + edge.labeloffset;\n          break;\n      }\n    }\n  });\n};\n\nvar reversePointsForReversedEdges = function (g) {\n  g.edges().forEach(function (e) {\n    var _a;\n\n    var edge = g.edge(e);\n\n    if (edge.reversed) {\n      (_a = edge.points) === null || _a === void 0 ? void 0 : _a.reverse();\n    }\n  });\n};\n\nvar removeBorderNodes = function (g) {\n  g.nodes().forEach(function (v) {\n    var _a, _b, _c;\n\n    if ((_a = g.children(v)) === null || _a === void 0 ? void 0 : _a.length) {\n      var node = g.node(v);\n      var t = g.node(node.borderTop);\n      var b = g.node(node.borderBottom);\n      var l = g.node(node.borderLeft[((_b = node.borderLeft) === null || _b === void 0 ? void 0 : _b.length) - 1]);\n      var r = g.node(node.borderRight[((_c = node.borderRight) === null || _c === void 0 ? void 0 : _c.length) - 1]);\n      node.width = Math.abs((r === null || r === void 0 ? void 0 : r.x) - (l === null || l === void 0 ? void 0 : l.x)) || 10;\n      node.height = Math.abs((b === null || b === void 0 ? void 0 : b.y) - (t === null || t === void 0 ? void 0 : t.y)) || 10;\n      node.x = ((l === null || l === void 0 ? void 0 : l.x) || 0) + node.width / 2;\n      node.y = ((t === null || t === void 0 ? void 0 : t.y) || 0) + node.height / 2;\n    }\n  });\n  g.nodes().forEach(function (v) {\n    var _a;\n\n    if (((_a = g.node(v)) === null || _a === void 0 ? void 0 : _a.dummy) === \"border\") {\n      g.removeNode(v);\n    }\n  });\n};\n\nvar removeSelfEdges = function (g) {\n  g.edges().forEach(function (e) {\n    if (e.v === e.w) {\n      var node = g.node(e.v);\n\n      if (!node.selfEdges) {\n        node.selfEdges = [];\n      }\n\n      node.selfEdges.push({\n        e: e,\n        label: g.edge(e)\n      });\n      g.removeEdgeObj(e);\n    }\n  });\n};\n\nvar insertSelfEdges = function (g) {\n  var layers = (0, util_1.buildLayerMatrix)(g);\n  layers === null || layers === void 0 ? void 0 : layers.forEach(function (layer) {\n    var orderShift = 0;\n    layer === null || layer === void 0 ? void 0 : layer.forEach(function (v, i) {\n      var _a;\n\n      var node = g.node(v);\n      node.order = i + orderShift;\n      (_a = node.selfEdges) === null || _a === void 0 ? void 0 : _a.forEach(function (selfEdge) {\n        (0, util_1.addDummyNode)(g, \"selfedge\", {\n          width: selfEdge.label.width,\n          height: selfEdge.label.height,\n          rank: node.rank,\n          order: i + ++orderShift,\n          e: selfEdge.e,\n          label: selfEdge.label\n        }, \"_se\");\n      });\n      delete node.selfEdges;\n    });\n  });\n};\n\nvar positionSelfEdges = function (g) {\n  g.nodes().forEach(function (v) {\n    var node = g.node(v);\n\n    if (node.dummy === \"selfedge\") {\n      var selfNode = g.node(node.e.v);\n      var x = selfNode.x + selfNode.width / 2;\n      var y = selfNode.y;\n      var dx = node.x - x;\n      var dy = selfNode.height / 2;\n      g.setEdgeObj(node.e, node.label);\n      g.removeNode(v);\n      node.label.points = [{\n        x: x + 2 * dx / 3,\n        y: y - dy\n      }, {\n        x: x + 5 * dx / 6,\n        y: y - dy\n      }, {\n        y: y,\n        x: x + dx\n      }, {\n        x: x + 5 * dx / 6,\n        y: y + dy\n      }, {\n        x: x + 2 * dx / 3,\n        y: y + dy\n      }];\n      node.label.x = node.x;\n      node.label.y = node.y;\n    }\n  });\n};\n\nvar selectNumberAttrs = function (obj, attrs) {\n  var pickedProperties = {};\n  attrs === null || attrs === void 0 ? void 0 : attrs.forEach(function (key) {\n    if (obj[key] === undefined) return;\n    pickedProperties[key] = +obj[key];\n  });\n  return pickedProperties;\n};\n\nvar canonicalize = function (attrs) {\n  if (attrs === void 0) {\n    attrs = {};\n  }\n\n  var newAttrs = {};\n  Object.keys(attrs).forEach(function (k) {\n    newAttrs[k.toLowerCase()] = attrs[k];\n  });\n  return newAttrs;\n};\n\nexports.default = layout;","map":{"version":3,"mappings":"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","names":["layout","g","opts","time","debugTiming","util_1","keepNodeOrder","prevGraph","inheritOrder","layoutGraph","buildLayoutGraph","edgeLabelSpace","makeSpaceForEdgeLabels","runLayout","e","message","console","error","updateInputGraph","removeSelfEdges","acyclic_1","run","nesting_graph_1","injectEdgeLabelProxies","cleanup","assignRankMinMax","removeEdgeLabelProxies","normalize_1","nodeOrder","insertSelfEdges","coordinate_system_1","adjust","positionSelfEdges","removeBorderNodes","undo","fixupEdgeLabelCoords","translateGraph","assignNodeIntersects","reversePointsForReversedEdges","currG","prevG","nodes","forEach","n","node","prevNode","undefined","fixorder","_order","inputGraph","v","inputLabel","layoutLabel","x","y","order","_rank","rank","children","_a","length","width","height","edges","edge","points","hasOwnProperty","graph","graphNumAttrs","graphDefaults","ranksep","edgesep","nodesep","rankdir","graphAttrs","nodeNumAttrs","nodeDefaults","edgeNumAttrs","edgeDefaults","minlen","weight","labeloffset","labelpos","edgeAttrs","graph_1","multigraph","compound","canonicalize","pickedProperties","key","setGraph","Object","assign","selectNumberAttrs","defaultNode","__assign","defaultAttrs","setNode","setParent","parent","setEdgeObj","isNaN","layer","toLowerCase","w","label","maxRank","borderTop","minRank","borderBottom","_b","Math","max","Infinity","dummy","labelRank","removeNode","minX","maxX","minY","maxY","graphLabel","marginX","marginx","marginY","marginy","getExtremes","attrs","h","min","p","nodeV","nodeW","p1","p2","unshift","push","reversed","reverse","t","b","l","borderLeft","r","borderRight","_c","abs","selfEdges","removeEdgeObj","layers","orderShift","i","selfEdge","selfNode","dx","dy","obj","newAttrs","keys","k","exports"],"sourceRoot":"","sources":["../../../../src/layout/dagre/src/layout.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}