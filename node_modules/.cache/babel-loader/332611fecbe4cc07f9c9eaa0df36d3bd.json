{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { StringExt, Dom, Vector } from '../util';\nimport { Filter } from '../registry';\nimport { Markup } from '../view';\nimport { Base } from './base';\nexport class DefsManager extends Base {\n  get cid() {\n    return this.graph.view.cid;\n  }\n\n  get svg() {\n    return this.view.svg;\n  }\n\n  get defs() {\n    return this.view.defs;\n  }\n\n  isDefined(id) {\n    return this.svg.getElementById(id) != null;\n  }\n\n  filter(options) {\n    let filterId = options.id;\n    const name = options.name;\n\n    if (!filterId) {\n      filterId = `filter-${name}-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n    }\n\n    if (!this.isDefined(filterId)) {\n      const fn = Filter.registry.get(name);\n\n      if (fn == null) {\n        return Filter.registry.onNotFound(name);\n      }\n\n      const markup = fn(options.args || {}); // Set the filter area to be 3x the bounding box of the cell\n      // and center the filter around the cell.\n\n      const attrs = Object.assign(Object.assign({\n        x: -1,\n        y: -1,\n        width: 3,\n        height: 3,\n        filterUnits: 'objectBoundingBox'\n      }, options.attrs), {\n        id: filterId\n      });\n      Vector.create(Markup.sanitize(markup), attrs).appendTo(this.defs);\n    }\n\n    return filterId;\n  }\n\n  gradient(options) {\n    let id = options.id;\n    const type = options.type;\n\n    if (!id) {\n      id = `gradient-${type}-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n    }\n\n    if (!this.isDefined(id)) {\n      const stops = options.stops;\n      const arr = stops.map(stop => {\n        const opacity = stop.opacity != null && Number.isFinite(stop.opacity) ? stop.opacity : 1;\n        return `<stop offset=\"${stop.offset}\" stop-color=\"${stop.color}\" stop-opacity=\"${opacity}\"/>`;\n      });\n      const markup = `<${type}>${arr.join('')}</${type}>`;\n      const attrs = Object.assign({\n        id\n      }, options.attrs);\n      Vector.create(markup, attrs).appendTo(this.defs);\n    }\n\n    return id;\n  }\n\n  marker(options) {\n    const {\n      id,\n      refX,\n      refY,\n      markerUnits,\n      markerOrient,\n      tagName,\n      children\n    } = options,\n          attrs = __rest(options, [\"id\", \"refX\", \"refY\", \"markerUnits\", \"markerOrient\", \"tagName\", \"children\"]);\n\n    let markerId = id;\n\n    if (!markerId) {\n      markerId = `marker-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n    }\n\n    if (!this.isDefined(markerId)) {\n      if (tagName !== 'path') {\n        // remove unnecessary d attribute inherit from standard edge.\n        delete attrs.d;\n      }\n\n      const pathMarker = Vector.create('marker', {\n        refX,\n        refY,\n        id: markerId,\n        overflow: 'visible',\n        orient: markerOrient != null ? markerOrient : 'auto',\n        markerUnits: markerUnits || 'userSpaceOnUse'\n      }, children ? children.map(_a => {\n        var {\n          tagName\n        } = _a,\n            other = __rest(_a, [\"tagName\"]);\n\n        return Vector.create(`${tagName}` || 'path', Dom.kebablizeAttrs(Object.assign(Object.assign({}, attrs), other)));\n      }) : [Vector.create(tagName || 'path', Dom.kebablizeAttrs(attrs))]);\n      this.defs.appendChild(pathMarker.node);\n    }\n\n    return markerId;\n  }\n\n  remove(id) {\n    const elem = this.svg.getElementById(id);\n\n    if (elem && elem.parentNode) {\n      elem.parentNode.removeChild(elem);\n    }\n  }\n\n}","map":{"version":3,"mappings":"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","names":["StringExt","Dom","Vector","Filter","Markup","Base","DefsManager","cid","graph","view","svg","defs","isDefined","id","getElementById","filter","options","filterId","name","hashcode","JSON","stringify","fn","registry","get","onNotFound","markup","args","attrs","x","y","width","height","filterUnits","create","sanitize","appendTo","gradient","type","stops","arr","map","stop","opacity","Number","isFinite","offset","color","join","marker","refX","refY","markerUnits","markerOrient","tagName","children","markerId","d","pathMarker","overflow","orient","_a","other","kebablizeAttrs","Object","appendChild","node","remove","elem","parentNode","removeChild"],"sourceRoot":"","sources":["../../src/graph/defs.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}