{"ast":null,"code":"import { setTransform, setClip } from './svg';\nimport { sortDom, moveTo } from './dom';\nexport function drawChildren(context, children) {\n  children.forEach(function (child) {\n    child.draw(context);\n  });\n}\n/**\n * 更新元素，包括 group 和 shape\n * @param {IElement} element       SVG 元素\n * @param {ChangeType} changeType  更新类型\n */\n\nexport function refreshElement(element, changeType) {\n  // 对于还没有挂载到画布下的元素，canvas 可能为空\n  var canvas = element.get('canvas'); // 只有挂载到画布下，才对元素进行实际渲染\n\n  if (canvas && canvas.get('autoDraw')) {\n    var context = canvas.get('context');\n    var parent_1 = element.getParent();\n    var parentChildren = parent_1 ? parent_1.getChildren() : [canvas];\n    var el = element.get('el');\n\n    if (changeType === 'remove') {\n      var isClipShape = element.get('isClipShape'); // 对于 clip，不仅需要将 clipShape 对于的 SVG 元素删除，还需要将上层的 clipPath 元素也删除\n\n      if (isClipShape) {\n        var clipPathEl = el && el.parentNode;\n        var defsEl = clipPathEl && clipPathEl.parentNode;\n\n        if (clipPathEl && defsEl) {\n          defsEl.removeChild(clipPathEl);\n        }\n      } else if (el && el.parentNode) {\n        el.parentNode.removeChild(el);\n      }\n    } else if (changeType === 'show') {\n      el.setAttribute('visibility', 'visible');\n    } else if (changeType === 'hide') {\n      el.setAttribute('visibility', 'hidden');\n    } else if (changeType === 'zIndex') {\n      moveTo(el, parentChildren.indexOf(element));\n    } else if (changeType === 'sort') {\n      var children_1 = element.get('children');\n\n      if (children_1 && children_1.length) {\n        sortDom(element, function (a, b) {\n          return children_1.indexOf(a) - children_1.indexOf(b) ? 1 : 0;\n        });\n      }\n    } else if (changeType === 'clear') {\n      // el maybe null for group\n      if (el) {\n        el.innerHTML = '';\n      }\n    } else if (changeType === 'matrix') {\n      setTransform(element);\n    } else if (changeType === 'clip') {\n      setClip(element, context);\n    } else if (changeType === 'attr') {// 已在 afterAttrsChange 进行了处理，此处 do nothing\n    } else if (changeType === 'add') {\n      element.draw(context);\n    }\n  }\n}","map":{"version":3,"mappings":"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","names":["setTransform","setClip","sortDom","moveTo","drawChildren","context","children","forEach","child","draw","refreshElement","element","changeType","canvas","get","parent_1","getParent","parentChildren","getChildren","el","isClipShape","clipPathEl","parentNode","defsEl","removeChild","setAttribute","indexOf","children_1","length","a","b","innerHTML"],"sourceRoot":"","sources":["../../src/util/draw.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}