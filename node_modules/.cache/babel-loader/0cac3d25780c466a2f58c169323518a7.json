{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { ModifierKey } from '../types';\nimport { Dom, NumberExt } from '../util';\nimport { Disposable } from '../common';\nexport class MouseWheel extends Disposable {\n  constructor(options) {\n    super();\n    this.options = options;\n    this.cumulatedFactor = 1;\n    const scroller = this.graph.scroller.widget;\n    this.container = scroller ? scroller.container : this.graph.container;\n    this.target = this.options.global ? document : this.container;\n    this.mousewheelHandle = new Dom.MouseWheelHandle(this.target, this.onMouseWheel.bind(this), this.allowMouseWheel.bind(this));\n\n    if (this.options.enabled) {\n      this.enable(true);\n    }\n  }\n\n  get graph() {\n    return this.options.graph;\n  }\n\n  get disabled() {\n    return this.options.enabled !== true;\n  }\n\n  enable(force) {\n    if (this.disabled || force) {\n      this.options.enabled = true;\n      this.graph.options.mousewheel.enabled = true;\n      this.mousewheelHandle.enable();\n    }\n  }\n\n  disable() {\n    if (!this.disabled) {\n      this.options.enabled = false;\n      this.graph.options.mousewheel.enabled = false;\n      this.mousewheelHandle.disable();\n    }\n  }\n\n  allowMouseWheel(evt) {\n    const e = evt.originalEvent || evt;\n    const guard = this.options.guard;\n    return (guard == null || guard.call(this.graph, e)) && ModifierKey.isMatch(e, this.options.modifiers);\n  }\n\n  onMouseWheel(evt) {\n    const e = evt.originalEvent || evt;\n    const guard = this.options.guard;\n\n    if ((guard == null || guard.call(this.graph, e)) && ModifierKey.isMatch(e, this.options.modifiers)) {\n      const factor = this.options.factor || 1.2;\n\n      if (this.currentScale == null) {\n        this.startPos = {\n          x: evt.clientX,\n          y: evt.clientY\n        };\n        this.currentScale = this.graph.scroller.widget ? this.graph.scroller.widget.zoom() : this.graph.transform.getScale().sx;\n      }\n\n      const delta = evt.deltaY;\n\n      if (delta < 0) {\n        // zoomin\n        // ------\n        // Switches to 1% zoom steps below 15%\n        if (this.currentScale < 0.15) {\n          this.cumulatedFactor = (this.currentScale + 0.01) / this.currentScale;\n        } else {\n          // Uses to 5% zoom steps for better grid rendering in\n          // webkit and to avoid rounding errors for zoom steps\n          this.cumulatedFactor = Math.round(this.currentScale * factor * 20) / 20 / this.currentScale;\n        }\n      } else {\n        // zoomout\n        // -------\n        // Switches to 1% zoom steps below 15%\n        if (this.currentScale <= 0.15) {\n          this.cumulatedFactor = (this.currentScale - 0.01) / this.currentScale;\n        } else {\n          // Uses to 5% zoom steps for better grid rendering in\n          // webkit and to avoid rounding errors for zoom steps\n          this.cumulatedFactor = Math.round(this.currentScale * (1 / factor) * 20) / 20 / this.currentScale;\n        }\n      }\n\n      this.cumulatedFactor = Math.max(0.01, Math.min(this.currentScale * this.cumulatedFactor, 160) / this.currentScale);\n      const scroller = this.graph.scroller.widget;\n      const currentScale = this.currentScale;\n      let targetScale = this.graph.transform.clampScale(currentScale * this.cumulatedFactor);\n      const minScale = this.options.minScale || Number.MIN_SAFE_INTEGER;\n      const maxScale = this.options.maxScale || Number.MAX_SAFE_INTEGER;\n      targetScale = NumberExt.clamp(targetScale, minScale, maxScale);\n\n      if (targetScale !== currentScale) {\n        if (scroller) {\n          if (this.options.zoomAtMousePosition) {\n            const origin = this.graph.coord.clientToLocalPoint(this.startPos);\n            scroller.zoom(targetScale, {\n              absolute: true,\n              center: origin.clone()\n            });\n          } else {\n            scroller.zoom(targetScale, {\n              absolute: true\n            });\n          }\n        } else {\n          if (this.options.zoomAtMousePosition) {\n            const origin = this.graph.coord.clientToGraphPoint(this.startPos);\n            this.graph.transform.zoom(targetScale, {\n              absolute: true,\n              center: origin.clone(),\n              ui: true\n            });\n          } else {\n            this.graph.transform.zoom(targetScale, {\n              absolute: true,\n              ui: true\n            });\n          }\n        }\n      }\n\n      this.currentScale = null;\n      this.cumulatedFactor = 1;\n    }\n  }\n\n  dispose() {\n    this.disable();\n  }\n\n}\n\n__decorate([Disposable.dispose()], MouseWheel.prototype, \"dispose\", null);","map":{"version":3,"mappings":"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","names":["ModifierKey","Dom","NumberExt","Disposable","MouseWheel","constructor","options","scroller","graph","widget","container","target","global","document","mousewheelHandle","MouseWheelHandle","onMouseWheel","bind","allowMouseWheel","enabled","enable","disabled","force","mousewheel","disable","evt","e","originalEvent","guard","call","isMatch","modifiers","factor","currentScale","startPos","x","clientX","y","clientY","zoom","transform","getScale","sx","delta","deltaY","cumulatedFactor","Math","round","max","min","targetScale","clampScale","minScale","Number","MIN_SAFE_INTEGER","maxScale","MAX_SAFE_INTEGER","clamp","zoomAtMousePosition","origin","coord","clientToLocalPoint","absolute","center","clone","clientToGraphPoint","ui","dispose","__decorate"],"sourceRoot":"","sources":["../../src/graph/mousewheel.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}