{"ast":null,"code":"import { isEqual } from '@antv/util';\n\nfunction getMinDiff(del, add, modify) {\n  var type = null;\n  var min = modify;\n\n  if (add < min) {\n    min = add;\n    type = 'add';\n  }\n\n  if (del < min) {\n    min = del;\n    type = 'del';\n  }\n\n  return {\n    type: type,\n    min: min\n  };\n}\n/*\n * https://en.wikipedia.org/wiki/Levenshtein_distance\n * 计算两条path的编辑距离\n */\n\n\nvar levenshteinDistance = function (source, target) {\n  var sourceLen = source.length;\n  var targetLen = target.length;\n  var sourceSegment, targetSegment;\n  var temp = 0;\n\n  if (sourceLen === 0 || targetLen === 0) {\n    return null;\n  }\n\n  var dist = [];\n\n  for (var i = 0; i <= sourceLen; i++) {\n    dist[i] = [];\n    dist[i][0] = {\n      min: i\n    };\n  }\n\n  for (var j = 0; j <= targetLen; j++) {\n    dist[0][j] = {\n      min: j\n    };\n  }\n\n  for (var i = 1; i <= sourceLen; i++) {\n    sourceSegment = source[i - 1];\n\n    for (var j = 1; j <= targetLen; j++) {\n      targetSegment = target[j - 1];\n\n      if (isEqual(sourceSegment, targetSegment)) {\n        temp = 0;\n      } else {\n        temp = 1;\n      }\n\n      var del = dist[i - 1][j].min + 1;\n      var add = dist[i][j - 1].min + 1;\n      var modify = dist[i - 1][j - 1].min + temp;\n      dist[i][j] = getMinDiff(del, add, modify);\n    }\n  }\n\n  return dist;\n};\n\nexport default function fillPathByDiff(source, target) {\n  var diffMatrix = levenshteinDistance(source, target);\n  var sourceLen = source.length;\n  var targetLen = target.length;\n  var changes = [];\n  var index = 1;\n  var minPos = 1; // 如果source和target不是完全不相等\n  // @ts-ignore\n\n  if (diffMatrix[sourceLen][targetLen] !== sourceLen) {\n    // 获取从source到target所需改动\n    for (var i = 1; i <= sourceLen; i++) {\n      var min = diffMatrix[i][i].min;\n      minPos = i;\n\n      for (var j = index; j <= targetLen; j++) {\n        if (diffMatrix[i][j].min < min) {\n          min = diffMatrix[i][j].min;\n          minPos = j;\n        }\n      }\n\n      index = minPos;\n\n      if (diffMatrix[i][index].type) {\n        changes.push({\n          index: i - 1,\n          type: diffMatrix[i][index].type\n        });\n      }\n    } // 对source进行增删path\n\n\n    for (var i = changes.length - 1; i >= 0; i--) {\n      index = changes[i].index;\n\n      if (changes[i].type === 'add') {\n        // @ts-ignore\n        source.splice(index, 0, [].concat(source[index]));\n      } else {\n        // @ts-ignore\n        source.splice(index, 1);\n      }\n    }\n  } // source尾部补齐\n\n\n  sourceLen = source.length;\n\n  if (sourceLen < targetLen) {\n    for (var i = 0; i < targetLen - sourceLen; i++) {\n      if (source[sourceLen - 1][0] === 'z' || source[sourceLen - 1][0] === 'Z') {\n        // @ts-ignore\n        source.splice(sourceLen - 2, 0, source[sourceLen - 2]);\n      } else {\n        // @ts-ignore\n        source.push(source[sourceLen - 1]);\n      }\n    }\n  }\n\n  return source;\n}","map":{"version":3,"mappings":"AAAA,SAASA,OAAT,QAAwB,YAAxB;;AAOA,SAASC,UAAT,CAAoBC,GAApB,EAAiCC,GAAjC,EAA8CC,MAA9C,EAA4D;EAC1D,IAAIC,IAAI,GAAG,IAAX;EACA,IAAIC,GAAG,GAAGF,MAAV;;EACA,IAAID,GAAG,GAAGG,GAAV,EAAe;IACbA,GAAG,GAAGH,GAAN;IACAE,IAAI,GAAG,KAAP;EACD;;EACD,IAAIH,GAAG,GAAGI,GAAV,EAAe;IACbA,GAAG,GAAGJ,GAAN;IACAG,IAAI,GAAG,KAAP;EACD;;EACD,OAAO;IACLA,IAAI,MADC;IAELC,GAAG;EAFE,CAAP;AAID;AAED;;;;;;AAIA,IAAMC,mBAAmB,GAAG,UAAUC,MAAV,EAA0BC,MAA1B,EAAwC;EAClE,IAAMC,SAAS,GAAGF,MAAM,CAACG,MAAzB;EACA,IAAMC,SAAS,GAAGH,MAAM,CAACE,MAAzB;EACA,IAAIE,aAAJ,EACEC,aADF;EAEA,IAAIC,IAAI,GAAG,CAAX;;EACA,IAAIL,SAAS,KAAK,CAAd,IAAmBE,SAAS,KAAK,CAArC,EAAwC;IACtC,OAAO,IAAP;EACD;;EACD,IAAMI,IAAI,GAAG,EAAb;;EACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIP,SAArB,EAAgCO,CAAC,EAAjC,EAAqC;IACnCD,IAAI,CAACC,CAAD,CAAJ,GAAU,EAAV;IACAD,IAAI,CAACC,CAAD,CAAJ,CAAQ,CAAR,IAAa;MAAEX,GAAG,EAAEW;IAAP,CAAb;EACD;;EACD,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIN,SAArB,EAAgCM,CAAC,EAAjC,EAAqC;IACnCF,IAAI,CAAC,CAAD,CAAJ,CAAQE,CAAR,IAAa;MAAEZ,GAAG,EAAEY;IAAP,CAAb;EACD;;EAED,KAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIP,SAArB,EAAgCO,CAAC,EAAjC,EAAqC;IACnCJ,aAAa,GAAGL,MAAM,CAACS,CAAC,GAAG,CAAL,CAAtB;;IACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIN,SAArB,EAAgCM,CAAC,EAAjC,EAAqC;MACnCJ,aAAa,GAAGL,MAAM,CAACS,CAAC,GAAG,CAAL,CAAtB;;MACA,IAAIlB,OAAO,CAACa,aAAD,EAAgBC,aAAhB,CAAX,EAA2C;QACzCC,IAAI,GAAG,CAAP;MACD,CAFD,MAEO;QACLA,IAAI,GAAG,CAAP;MACD;;MACD,IAAMb,GAAG,GAAGc,IAAI,CAACC,CAAC,GAAG,CAAL,CAAJ,CAAYC,CAAZ,EAAeZ,GAAf,GAAqB,CAAjC;MACA,IAAMH,GAAG,GAAGa,IAAI,CAACC,CAAD,CAAJ,CAAQC,CAAC,GAAG,CAAZ,EAAeZ,GAAf,GAAqB,CAAjC;MACA,IAAMF,MAAM,GAAGY,IAAI,CAACC,CAAC,GAAG,CAAL,CAAJ,CAAYC,CAAC,GAAG,CAAhB,EAAmBZ,GAAnB,GAAyBS,IAAxC;MACAC,IAAI,CAACC,CAAD,CAAJ,CAAQC,CAAR,IAAajB,UAAU,CAACC,GAAD,EAAMC,GAAN,EAAWC,MAAX,CAAvB;IACD;EACF;;EACD,OAAOY,IAAP;AACD,CAlCD;;AAoCA,eAAc,SAAUG,cAAV,CAAyBX,MAAzB,EAAyCC,MAAzC,EAAuD;EACnE,IAAMW,UAAU,GAAGb,mBAAmB,CAACC,MAAD,EAASC,MAAT,CAAtC;EACA,IAAIC,SAAS,GAAGF,MAAM,CAACG,MAAvB;EACA,IAAMC,SAAS,GAAGH,MAAM,CAACE,MAAzB;EACA,IAAMU,OAAO,GAAG,EAAhB;EACA,IAAIC,KAAK,GAAG,CAAZ;EACA,IAAIC,MAAM,GAAG,CAAb,CANmE,CAOnE;EACA;;EACA,IAAIH,UAAU,CAACV,SAAD,CAAV,CAAsBE,SAAtB,MAAqCF,SAAzC,EAAoD;IAClD;IACA,KAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIP,SAArB,EAAgCO,CAAC,EAAjC,EAAqC;MACnC,IAAIX,GAAG,GAAGc,UAAU,CAACH,CAAD,CAAV,CAAcA,CAAd,EAAiBX,GAA3B;MACAiB,MAAM,GAAGN,CAAT;;MACA,KAAK,IAAIC,CAAC,GAAGI,KAAb,EAAoBJ,CAAC,IAAIN,SAAzB,EAAoCM,CAAC,EAArC,EAAyC;QACvC,IAAIE,UAAU,CAACH,CAAD,CAAV,CAAcC,CAAd,EAAiBZ,GAAjB,GAAuBA,GAA3B,EAAgC;UAC9BA,GAAG,GAAGc,UAAU,CAACH,CAAD,CAAV,CAAcC,CAAd,EAAiBZ,GAAvB;UACAiB,MAAM,GAAGL,CAAT;QACD;MACF;;MACDI,KAAK,GAAGC,MAAR;;MACA,IAAIH,UAAU,CAACH,CAAD,CAAV,CAAcK,KAAd,EAAqBjB,IAAzB,EAA+B;QAC7BgB,OAAO,CAACG,IAAR,CAAa;UAAEF,KAAK,EAAEL,CAAC,GAAG,CAAb;UAAgBZ,IAAI,EAAEe,UAAU,CAACH,CAAD,CAAV,CAAcK,KAAd,EAAqBjB;QAA3C,CAAb;MACD;IACF,CAfiD,CAgBlD;;;IACA,KAAK,IAAIY,CAAC,GAAGI,OAAO,CAACV,MAAR,GAAiB,CAA9B,EAAiCM,CAAC,IAAI,CAAtC,EAAyCA,CAAC,EAA1C,EAA8C;MAC5CK,KAAK,GAAGD,OAAO,CAACJ,CAAD,CAAP,CAAWK,KAAnB;;MACA,IAAID,OAAO,CAACJ,CAAD,CAAP,CAAWZ,IAAX,KAAoB,KAAxB,EAA+B;QAC7B;QACAG,MAAM,CAACiB,MAAP,CAAcH,KAAd,EAAqB,CAArB,EAAwB,GAAGI,MAAH,CAAUlB,MAAM,CAACc,KAAD,CAAhB,CAAxB;MACD,CAHD,MAGO;QACL;QACAd,MAAM,CAACiB,MAAP,CAAcH,KAAd,EAAqB,CAArB;MACD;IACF;EACF,CApCkE,CAsCnE;;;EACAZ,SAAS,GAAGF,MAAM,CAACG,MAAnB;;EACA,IAAID,SAAS,GAAGE,SAAhB,EAA2B;IACzB,KAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAIL,SAAS,GAAGF,SAAjC,EAA6CO,CAAC,EAA9C,EAAkD;MAChD,IAAIT,MAAM,CAACE,SAAS,GAAG,CAAb,CAAN,CAAsB,CAAtB,MAA6B,GAA7B,IAAoCF,MAAM,CAACE,SAAS,GAAG,CAAb,CAAN,CAAsB,CAAtB,MAA6B,GAArE,EAA0E;QACxE;QACAF,MAAM,CAACiB,MAAP,CAAcf,SAAS,GAAG,CAA1B,EAA6B,CAA7B,EAAgCF,MAAM,CAACE,SAAS,GAAG,CAAb,CAAtC;MACD,CAHD,MAGO;QACL;QACAF,MAAM,CAACgB,IAAP,CAAYhB,MAAM,CAACE,SAAS,GAAG,CAAb,CAAlB;MACD;IAEF;EACF;;EACD,OAAOF,MAAP;AACD","names":["isEqual","getMinDiff","del","add","modify","type","min","levenshteinDistance","source","target","sourceLen","length","targetLen","sourceSegment","targetSegment","temp","dist","i","j","fillPathByDiff","diffMatrix","changes","index","minPos","push","splice","concat"],"sourceRoot":"","sources":["../src/fill-path-by-diff.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}