{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { each, isEqual, isFunction, isNumber, isObject, isArray, noop, mix, upperFirst, uniqueId } from '@antv/util';\nimport { ext } from '@antv/matrix-util';\nimport { removeFromArray, isParent } from '../util/util';\nimport { multiplyMatrix, multiplyVec2, invert } from '../util/matrix';\nimport Base from './base';\nvar transform = ext.transform;\nvar MATRIX = 'matrix';\nvar CLONE_CFGS = ['zIndex', 'capture', 'visible', 'type']; // 可以在 toAttrs 中设置，但不属于绘图属性的字段\n\nvar RESERVED_PORPS = ['repeat'];\nvar DELEGATION_SPLIT = ':';\nvar WILDCARD = '*'; // 需要考虑数组嵌套数组的场景\n// 数组嵌套对象的场景不考虑\n\nfunction _cloneArrayAttr(arr) {\n  var result = [];\n\n  for (var i = 0; i < arr.length; i++) {\n    if (isArray(arr[i])) {\n      result.push([].concat(arr[i]));\n    } else {\n      result.push(arr[i]);\n    }\n  }\n\n  return result;\n}\n\nfunction getFormatFromAttrs(toAttrs, shape) {\n  var fromAttrs = {};\n  var attrs = shape.attrs;\n\n  for (var k in toAttrs) {\n    fromAttrs[k] = attrs[k];\n  }\n\n  return fromAttrs;\n}\n\nfunction getFormatToAttrs(props, shape) {\n  var toAttrs = {};\n  var attrs = shape.attr();\n  each(props, function (v, k) {\n    if (RESERVED_PORPS.indexOf(k) === -1 && !isEqual(attrs[k], v)) {\n      toAttrs[k] = v;\n    }\n  });\n  return toAttrs;\n}\n\nfunction checkExistedAttrs(animations, animation) {\n  if (animation.onFrame) {\n    return animations;\n  }\n\n  var startTime = animation.startTime,\n      delay = animation.delay,\n      duration = animation.duration;\n  var hasOwnProperty = Object.prototype.hasOwnProperty;\n  each(animations, function (item) {\n    // 后一个动画开始执行的时间 < 前一个动画的结束时间 && 后一个动画的执行时间 > 前一个动画的延迟\n    if (startTime + delay < item.startTime + item.delay + item.duration && duration > item.delay) {\n      each(animation.toAttrs, function (v, k) {\n        if (hasOwnProperty.call(item.toAttrs, k)) {\n          delete item.toAttrs[k];\n          delete item.fromAttrs[k];\n        }\n      });\n    }\n  });\n  return animations;\n}\n\nvar Element =\n/** @class */\nfunction (_super) {\n  __extends(Element, _super);\n\n  function Element(cfg) {\n    var _this = _super.call(this, cfg) || this;\n    /**\n     * @protected\n     * 图形属性\n     * @type {ShapeAttrs}\n     */\n\n\n    _this.attrs = {};\n\n    var attrs = _this.getDefaultAttrs();\n\n    mix(attrs, cfg.attrs);\n    _this.attrs = attrs;\n\n    _this.initAttrs(attrs);\n\n    _this.initAnimate(); // 初始化动画\n\n\n    return _this;\n  } // override\n\n\n  Element.prototype.getDefaultCfg = function () {\n    return {\n      visible: true,\n      capture: true,\n      zIndex: 0\n    };\n  };\n  /**\n   * @protected\n   * 获取默认的属相\n   */\n\n\n  Element.prototype.getDefaultAttrs = function () {\n    return {\n      matrix: this.getDefaultMatrix(),\n      opacity: 1\n    };\n  };\n  /**\n   * @protected\n   * 一些方法调用会引起画布变化\n   * @param {ChangeType} changeType 改变的类型\n   */\n\n\n  Element.prototype.onCanvasChange = function (changeType) {};\n  /**\n   * @protected\n   * 初始化属性，有些属性需要加工\n   * @param {object} attrs 属性值\n   */\n\n\n  Element.prototype.initAttrs = function (attrs) {};\n  /**\n   * @protected\n   * 初始化动画\n   */\n\n\n  Element.prototype.initAnimate = function () {\n    this.set('animable', true);\n    this.set('animating', false);\n  };\n\n  Element.prototype.isGroup = function () {\n    return false;\n  };\n\n  Element.prototype.getParent = function () {\n    return this.get('parent');\n  };\n\n  Element.prototype.getCanvas = function () {\n    return this.get('canvas');\n  };\n\n  Element.prototype.attr = function () {\n    var _a;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    var name = args[0],\n        value = args[1];\n    if (!name) return this.attrs;\n\n    if (isObject(name)) {\n      for (var k in name) {\n        this.setAttr(k, name[k]);\n      }\n\n      this.afterAttrsChange(name);\n      return this;\n    }\n\n    if (args.length === 2) {\n      this.setAttr(name, value);\n      this.afterAttrsChange((_a = {}, _a[name] = value, _a));\n      return this;\n    }\n\n    return this.attrs[name];\n  }; // 是否被裁剪，被裁剪则不显示，不参与拾取\n\n\n  Element.prototype.isClipped = function (refX, refY) {\n    var clip = this.getClip();\n    return clip && !clip.isHit(refX, refY);\n  };\n  /**\n   * 内部设置属性值的接口\n   * @param {string} name 属性名\n   * @param {any} value 属性值\n   */\n\n\n  Element.prototype.setAttr = function (name, value) {\n    var originValue = this.attrs[name];\n\n    if (originValue !== value) {\n      this.attrs[name] = value;\n      this.onAttrChange(name, value, originValue);\n    }\n  };\n  /**\n   * @protected\n   * 属性值发生改变\n   * @param {string} name 属性名\n   * @param {any} value 属性值\n   * @param {any} originValue 属性值\n   */\n\n\n  Element.prototype.onAttrChange = function (name, value, originValue) {\n    if (name === 'matrix') {\n      this.set('totalMatrix', null);\n    }\n  };\n  /**\n   * 属性更改后需要做的事情\n   * @protected\n   */\n\n\n  Element.prototype.afterAttrsChange = function (targetAttrs) {\n    if (this.cfg.isClipShape) {\n      var applyTo = this.cfg.applyTo;\n\n      if (applyTo) {\n        applyTo.onCanvasChange('clip');\n      }\n    } else {\n      this.onCanvasChange('attr');\n    }\n  };\n\n  Element.prototype.show = function () {\n    // 不是高频操作直接使用 set\n    this.set('visible', true);\n    this.onCanvasChange('show');\n    return this;\n  };\n\n  Element.prototype.hide = function () {\n    // 不是高频操作直接使用 set\n    this.set('visible', false);\n    this.onCanvasChange('hide');\n    return this;\n  };\n\n  Element.prototype.setZIndex = function (zIndex) {\n    this.set('zIndex', zIndex);\n    var parent = this.getParent();\n\n    if (parent) {\n      // 改变 zIndex 不应该立即触发渲染 (调用 onCanvasChange('zIndex'))，需要经过 sort 再触发\n      parent.sort();\n    }\n\n    return this;\n  };\n\n  Element.prototype.toFront = function () {\n    var parent = this.getParent();\n\n    if (!parent) {\n      return;\n    }\n\n    var children = parent.getChildren();\n    var el = this.get('el');\n    var index = children.indexOf(this);\n    children.splice(index, 1);\n    children.push(this);\n    this.onCanvasChange('zIndex');\n  };\n\n  Element.prototype.toBack = function () {\n    var parent = this.getParent();\n\n    if (!parent) {\n      return;\n    }\n\n    var children = parent.getChildren();\n    var el = this.get('el');\n    var index = children.indexOf(this);\n    children.splice(index, 1);\n    children.unshift(this);\n    this.onCanvasChange('zIndex');\n  };\n\n  Element.prototype.remove = function (destroy) {\n    if (destroy === void 0) {\n      destroy = true;\n    }\n\n    var parent = this.getParent();\n\n    if (parent) {\n      removeFromArray(parent.getChildren(), this);\n\n      if (!parent.get('clearing')) {\n        // 如果父元素正在清理，当前元素不触发 remove\n        this.onCanvasChange('remove');\n      }\n    } else {\n      this.onCanvasChange('remove');\n    }\n\n    if (destroy) {\n      this.destroy();\n    }\n  };\n\n  Element.prototype.resetMatrix = function () {\n    this.attr(MATRIX, this.getDefaultMatrix());\n    this.onCanvasChange('matrix');\n  };\n\n  Element.prototype.getMatrix = function () {\n    return this.attr(MATRIX);\n  };\n\n  Element.prototype.setMatrix = function (m) {\n    this.attr(MATRIX, m);\n    this.onCanvasChange('matrix');\n  }; // 获取总的 matrix\n\n\n  Element.prototype.getTotalMatrix = function () {\n    var totalMatrix = this.cfg.totalMatrix;\n\n    if (!totalMatrix) {\n      var currentMatrix = this.attr('matrix');\n      var parentMatrix = this.cfg.parentMatrix;\n\n      if (parentMatrix && currentMatrix) {\n        totalMatrix = multiplyMatrix(parentMatrix, currentMatrix);\n      } else {\n        totalMatrix = currentMatrix || parentMatrix;\n      }\n\n      this.set('totalMatrix', totalMatrix);\n    }\n\n    return totalMatrix;\n  }; // 上层分组设置 matrix\n\n\n  Element.prototype.applyMatrix = function (matrix) {\n    var currentMatrix = this.attr('matrix');\n    var totalMatrix = null;\n\n    if (matrix && currentMatrix) {\n      totalMatrix = multiplyMatrix(matrix, currentMatrix);\n    } else {\n      totalMatrix = currentMatrix || matrix;\n    }\n\n    this.set('totalMatrix', totalMatrix);\n    this.set('parentMatrix', matrix);\n  };\n  /**\n   * @protected\n   * 获取默认的矩阵\n   * @returns {number[]|null} 默认的矩阵\n   */\n\n\n  Element.prototype.getDefaultMatrix = function () {\n    return null;\n  }; // 将向量应用设置的矩阵\n\n\n  Element.prototype.applyToMatrix = function (v) {\n    var matrix = this.attr('matrix');\n\n    if (matrix) {\n      return multiplyVec2(matrix, v);\n    }\n\n    return v;\n  }; // 根据设置的矩阵，将向量转换相对于图形/分组的位置\n\n\n  Element.prototype.invertFromMatrix = function (v) {\n    var matrix = this.attr('matrix');\n\n    if (matrix) {\n      var invertMatrix = invert(matrix);\n\n      if (invertMatrix) {\n        return multiplyVec2(invertMatrix, v);\n      }\n    }\n\n    return v;\n  }; // 设置 clip\n\n\n  Element.prototype.setClip = function (clipCfg) {\n    var canvas = this.getCanvas(); // 应该只设置当前元素的 clip，不应该去修改 clip 本身，方便 clip 被复用\n    // TODO: setClip 的传参既 shape 配置，也支持 shape 对象\n    // const preShape = this.get('clipShape');\n    // if (preShape) {\n    //   // 将之前的 clipShape 销毁\n    //   preShape.destroy();\n    // }\n\n    var clipShape = null; // 如果配置项为 null，则不移除 clipShape\n\n    if (clipCfg) {\n      var ShapeBase = this.getShapeBase();\n      var shapeType = upperFirst(clipCfg.type);\n      var Cons = ShapeBase[shapeType];\n\n      if (Cons) {\n        clipShape = new Cons({\n          type: clipCfg.type,\n          isClipShape: true,\n          applyTo: this,\n          attrs: clipCfg.attrs,\n          canvas: canvas\n        });\n      }\n    }\n\n    this.set('clipShape', clipShape);\n    this.onCanvasChange('clip');\n    return clipShape;\n  };\n\n  Element.prototype.getClip = function () {\n    // 高频率调用的地方直接使用 this.cfg.xxx\n    var clipShape = this.cfg.clipShape; // 未设置时返回 Null，保证一致性\n\n    if (!clipShape) {\n      return null;\n    }\n\n    return clipShape;\n  };\n\n  Element.prototype.clone = function () {\n    var _this = this;\n\n    var originAttrs = this.attrs;\n    var attrs = {};\n    each(originAttrs, function (i, k) {\n      if (isArray(originAttrs[k])) {\n        attrs[k] = _cloneArrayAttr(originAttrs[k]);\n      } else {\n        attrs[k] = originAttrs[k];\n      }\n    });\n    var cons = this.constructor; // @ts-ignore\n\n    var clone = new cons({\n      attrs: attrs\n    });\n    each(CLONE_CFGS, function (cfgName) {\n      clone.set(cfgName, _this.get(cfgName));\n    });\n    return clone;\n  };\n\n  Element.prototype.destroy = function () {\n    var destroyed = this.destroyed;\n\n    if (destroyed) {\n      return;\n    }\n\n    this.attrs = {};\n\n    _super.prototype.destroy.call(this); // this.onCanvasChange('destroy');\n\n  };\n  /**\n   * 是否处于动画暂停状态\n   * @return {boolean} 是否处于动画暂停状态\n   */\n\n\n  Element.prototype.isAnimatePaused = function () {\n    return this.get('_pause').isPaused;\n  };\n  /**\n   * 执行动画，支持多种函数签名\n   * 1. animate(toAttrs: ElementAttrs, duration: number, easing?: string, callback?: () => void, delay?: number)\n   * 2. animate(onFrame: OnFrame, duration: number, easing?: string, callback?: () => void, delay?: number)\n   * 3. animate(toAttrs: ElementAttrs, cfg: AnimateCfg)\n   * 4. animate(onFrame: OnFrame, cfg: AnimateCfg)\n   * 各个参数的含义为:\n   *   toAttrs  动画最终状态\n   *   onFrame  自定义帧动画函数\n   *   duration 动画执行时间\n   *   easing   动画缓动效果\n   *   callback 动画执行后的回调\n   *   delay    动画延迟时间\n   */\n\n\n  Element.prototype.animate = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (!this.get('timeline') && !this.get('canvas')) {\n      return;\n    }\n\n    this.set('animating', true);\n    var timeline = this.get('timeline');\n\n    if (!timeline) {\n      timeline = this.get('canvas').get('timeline');\n      this.set('timeline', timeline);\n    }\n\n    var animations = this.get('animations') || []; // 初始化 tick\n\n    if (!timeline.timer) {\n      timeline.initTimer();\n    }\n\n    var toAttrs = args[0],\n        duration = args[1],\n        _a = args[2],\n        easing = _a === void 0 ? 'easeLinear' : _a,\n        _b = args[3],\n        callback = _b === void 0 ? noop : _b,\n        _c = args[4],\n        delay = _c === void 0 ? 0 : _c;\n    var onFrame;\n    var repeat;\n    var pauseCallback;\n    var resumeCallback;\n    var animateCfg; // 第二个参数，既可以是动画最终状态 toAttrs，也可以是自定义帧动画函数 onFrame\n\n    if (isFunction(toAttrs)) {\n      onFrame = toAttrs;\n      toAttrs = {};\n    } else if (isObject(toAttrs) && toAttrs.onFrame) {\n      // 兼容 3.0 中的写法，onFrame 和 repeat 可在 toAttrs 中设置\n      onFrame = toAttrs.onFrame;\n      repeat = toAttrs.repeat;\n    } // 第二个参数，既可以是执行时间 duration，也可以是动画参数 animateCfg\n\n\n    if (isObject(duration)) {\n      animateCfg = duration;\n      duration = animateCfg.duration;\n      easing = animateCfg.easing || 'easeLinear';\n      delay = animateCfg.delay || 0; // animateCfg 中的设置优先级更高\n\n      repeat = animateCfg.repeat || repeat || false;\n      callback = animateCfg.callback || noop;\n      pauseCallback = animateCfg.pauseCallback || noop;\n      resumeCallback = animateCfg.resumeCallback || noop;\n    } else {\n      // 第四个参数，既可以是回调函数 callback，也可以是延迟时间 delay\n      if (isNumber(callback)) {\n        delay = callback;\n        callback = null;\n      } // 第三个参数，既可以是缓动参数 easing，也可以是回调函数 callback\n\n\n      if (isFunction(easing)) {\n        callback = easing;\n        easing = 'easeLinear';\n      } else {\n        easing = easing || 'easeLinear';\n      }\n    }\n\n    var formatToAttrs = getFormatToAttrs(toAttrs, this);\n    var animation = {\n      fromAttrs: getFormatFromAttrs(formatToAttrs, this),\n      toAttrs: formatToAttrs,\n      duration: duration,\n      easing: easing,\n      repeat: repeat,\n      callback: callback,\n      pauseCallback: pauseCallback,\n      resumeCallback: resumeCallback,\n      delay: delay,\n      startTime: timeline.getTime(),\n      id: uniqueId(),\n      onFrame: onFrame,\n      pathFormatted: false\n    }; // 如果动画元素队列中已经有这个图形了\n\n    if (animations.length > 0) {\n      // 先检查是否需要合并属性。若有相同的动画，将该属性从前一个动画中删除,直接用后一个动画中\n      animations = checkExistedAttrs(animations, animation);\n    } else {\n      // 否则将图形添加到动画元素队列\n      timeline.addAnimator(this);\n    }\n\n    animations.push(animation);\n    this.set('animations', animations);\n    this.set('_pause', {\n      isPaused: false\n    });\n  };\n  /**\n   * 停止动画\n   * @param {boolean} toEnd 是否到动画的最终状态\n   */\n\n\n  Element.prototype.stopAnimate = function (toEnd) {\n    var _this = this;\n\n    if (toEnd === void 0) {\n      toEnd = true;\n    }\n\n    var animations = this.get('animations');\n    each(animations, function (animation) {\n      // 将动画执行到最后一帧\n      if (toEnd) {\n        if (animation.onFrame) {\n          _this.attr(animation.onFrame(1));\n        } else {\n          _this.attr(animation.toAttrs);\n        }\n      }\n\n      if (animation.callback) {\n        // 动画停止时的回调\n        animation.callback();\n      }\n    });\n    this.set('animating', false);\n    this.set('animations', []);\n  };\n  /**\n   * 暂停动画\n   */\n\n\n  Element.prototype.pauseAnimate = function () {\n    var timeline = this.get('timeline');\n    var animations = this.get('animations');\n    var pauseTime = timeline.getTime();\n    each(animations, function (animation) {\n      animation._paused = true;\n      animation._pauseTime = pauseTime;\n\n      if (animation.pauseCallback) {\n        // 动画暂停时的回调\n        animation.pauseCallback();\n      }\n    }); // 记录下是在什么时候暂停的\n\n    this.set('_pause', {\n      isPaused: true,\n      pauseTime: pauseTime\n    });\n    return this;\n  };\n  /**\n   * 恢复动画\n   */\n\n\n  Element.prototype.resumeAnimate = function () {\n    var timeline = this.get('timeline');\n    var current = timeline.getTime();\n    var animations = this.get('animations');\n    var pauseTime = this.get('_pause').pauseTime; // 之后更新属性需要计算动画已经执行的时长，如果暂停了，就把初始时间调后\n\n    each(animations, function (animation) {\n      animation.startTime = animation.startTime + (current - pauseTime);\n      animation._paused = false;\n      animation._pauseTime = null;\n\n      if (animation.resumeCallback) {\n        animation.resumeCallback();\n      }\n    });\n    this.set('_pause', {\n      isPaused: false\n    });\n    this.set('animations', animations);\n    return this;\n  };\n  /**\n   * 触发委托事件\n   * @param  {string}     type 事件类型\n   * @param  {GraphEvent} eventObj 事件对象\n   */\n\n\n  Element.prototype.emitDelegation = function (type, eventObj) {\n    var _this = this;\n\n    var paths = eventObj.propagationPath;\n    var events = this.getEvents();\n    var relativeShape;\n\n    if (type === 'mouseenter') {\n      relativeShape = eventObj.fromShape;\n    } else if (type === 'mouseleave') {\n      relativeShape = eventObj.toShape;\n    }\n\n    var _loop_1 = function (i) {\n      var element = paths[i]; // 暂定跟 name 绑定\n\n      var name_1 = element.get('name');\n\n      if (name_1) {\n        // 第一个 mouseenter 和 mouseleave 的停止即可，因为后面的都是前面的 Parent\n        if ( // 只有 element 是 Group 或者 Canvas 的时候，才需要判断 isParent\n        (element.isGroup() || element.isCanvas && element.isCanvas()) && relativeShape && isParent(element, relativeShape)) {\n          return \"break\";\n        }\n\n        if (isArray(name_1)) {\n          each(name_1, function (subName) {\n            _this.emitDelegateEvent(element, subName, eventObj);\n          });\n        } else {\n          this_1.emitDelegateEvent(element, name_1, eventObj);\n        }\n      }\n    };\n\n    var this_1 = this; // 至少有一个对象，且第一个对象为 shape\n\n    for (var i = 0; i < paths.length; i++) {\n      var state_1 = _loop_1(i);\n\n      if (state_1 === \"break\") break;\n    }\n  };\n\n  Element.prototype.emitDelegateEvent = function (element, name, eventObj) {\n    var events = this.getEvents(); // 事件委托的形式 name:type\n\n    var eventName = name + DELEGATION_SPLIT + eventObj.type;\n\n    if (events[eventName] || events[WILDCARD]) {\n      // 对于通配符 *，事件名称 = 委托事件名称\n      eventObj.name = eventName;\n      eventObj.currentTarget = element;\n      eventObj.delegateTarget = this; // 将委托事件的监听对象 delegateObject 挂载到事件对象上\n\n      eventObj.delegateObject = element.get('delegateObject');\n      this.emit(eventName, eventObj);\n    }\n  };\n  /**\n   * 移动元素\n   * @param {number} translateX 水平移动距离\n   * @param {number} translateY 垂直移动距离\n   * @return {IElement} 元素\n   */\n\n\n  Element.prototype.translate = function (translateX, translateY) {\n    if (translateX === void 0) {\n      translateX = 0;\n    }\n\n    if (translateY === void 0) {\n      translateY = 0;\n    }\n\n    var matrix = this.getMatrix();\n    var newMatrix = transform(matrix, [['t', translateX, translateY]]);\n    this.setMatrix(newMatrix);\n    return this;\n  };\n  /**\n   * 移动元素到目标位置\n   * @param {number} targetX 目标位置的水平坐标\n   * @param {number} targetX 目标位置的垂直坐标\n   * @return {IElement} 元素\n   */\n\n\n  Element.prototype.move = function (targetX, targetY) {\n    var x = this.attr('x') || 0;\n    var y = this.attr('y') || 0;\n    this.translate(targetX - x, targetY - y);\n    return this;\n  };\n  /**\n   * 移动元素到目标位置，等价于 move 方法。由于 moveTo 的语义性更强，因此在文档中推荐使用 moveTo 方法\n   * @param {number} targetX 目标位置的 x 轴坐标\n   * @param {number} targetY 目标位置的 y 轴坐标\n   * @return {IElement} 元素\n   */\n\n\n  Element.prototype.moveTo = function (targetX, targetY) {\n    return this.move(targetX, targetY);\n  };\n  /**\n   * 缩放元素\n   * @param {number} ratioX 水平缩放比例\n   * @param {number} ratioY 垂直缩放比例\n   * @return {IElement} 元素\n   */\n\n\n  Element.prototype.scale = function (ratioX, ratioY) {\n    var matrix = this.getMatrix();\n    var newMatrix = transform(matrix, [['s', ratioX, ratioY || ratioX]]);\n    this.setMatrix(newMatrix);\n    return this;\n  };\n  /**\n   * 以画布左上角 (0, 0) 为中心旋转元素\n   * @param {number} radian 旋转角度(弧度值)\n   * @return {IElement} 元素\n   */\n\n\n  Element.prototype.rotate = function (radian) {\n    var matrix = this.getMatrix();\n    var newMatrix = transform(matrix, [['r', radian]]);\n    this.setMatrix(newMatrix);\n    return this;\n  };\n  /**\n   * 以起始点为中心旋转元素\n   * @param {number} radian 旋转角度(弧度值)\n   * @return {IElement} 元素\n   */\n\n\n  Element.prototype.rotateAtStart = function (rotate) {\n    var _a = this.attr(),\n        x = _a.x,\n        y = _a.y;\n\n    var matrix = this.getMatrix();\n    var newMatrix = transform(matrix, [['t', -x, -y], ['r', rotate], ['t', x, y]]);\n    this.setMatrix(newMatrix);\n    return this;\n  };\n  /**\n   * 以任意点 (x, y) 为中心旋转元素\n   * @param {number} radian 旋转角度(弧度值)\n   * @return {IElement} 元素\n   */\n\n\n  Element.prototype.rotateAtPoint = function (x, y, rotate) {\n    var matrix = this.getMatrix();\n    var newMatrix = transform(matrix, [['t', -x, -y], ['r', rotate], ['t', x, y]]);\n    this.setMatrix(newMatrix);\n    return this;\n  };\n\n  return Element;\n}(Base);\n\nexport default Element;","map":{"version":3,"mappings":";AAAA,SAASA,IAAT,EAAeC,OAAf,EAAwBC,UAAxB,EAAoCC,QAApC,EAA8CC,QAA9C,EAAwDC,OAAxD,EAAiEC,IAAjE,EAAuEC,GAAvE,EAA4EC,UAA5E,EAAwFC,QAAxF,QAAwG,YAAxG;AACA,SAASC,GAAT,QAAoB,mBAApB;AAGA,SAASC,eAAT,EAA0BC,QAA1B,QAA0C,cAA1C;AACA,SAASC,cAAT,EAAyBC,YAAzB,EAAuCC,MAAvC,QAAqD,gBAArD;AACA,OAAOC,IAAP,MAAiB,QAAjB;AAGQ,aAAS,GAAKN,GAAG,UAAjB;AAER,IAAMO,MAAM,GAAG,QAAf;AACA,IAAMC,UAAU,GAAG,CAAC,QAAD,EAAW,SAAX,EAAsB,SAAtB,EAAiC,MAAjC,CAAnB,C,CAEA;;AACA,IAAMC,cAAc,GAAG,CAAC,QAAD,CAAvB;AAEA,IAAMC,gBAAgB,GAAG,GAAzB;AACA,IAAMC,QAAQ,GAAG,GAAjB,C,CAEA;AACA;;AACA,SAASC,eAAT,CAAyBC,GAAzB,EAA4B;EAC1B,IAAMC,MAAM,GAAG,EAAf;;EACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,GAAG,CAACG,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;IACnC,IAAIpB,OAAO,CAACkB,GAAG,CAACE,CAAD,CAAJ,CAAX,EAAqB;MACnBD,MAAM,CAACG,IAAP,CAAY,GAAGC,MAAH,CAAUL,GAAG,CAACE,CAAD,CAAb,CAAZ;IACD,CAFD,MAEO;MACLD,MAAM,CAACG,IAAP,CAAYJ,GAAG,CAACE,CAAD,CAAf;IACD;EACF;;EACD,OAAOD,MAAP;AACD;;AAED,SAASK,kBAAT,CAA4BC,OAA5B,EAAqCC,KAArC,EAA0C;EACxC,IAAMC,SAAS,GAAG,EAAlB;EACA,IAAMC,KAAK,GAAGF,KAAK,CAACE,KAApB;;EACA,KAAK,IAAMC,CAAX,IAAgBJ,OAAhB,EAAyB;IACvBE,SAAS,CAACE,CAAD,CAAT,GAAeD,KAAK,CAACC,CAAD,CAApB;EACD;;EACD,OAAOF,SAAP;AACD;;AAED,SAASG,gBAAT,CAA0BC,KAA1B,EAAiCL,KAAjC,EAAsC;EACpC,IAAMD,OAAO,GAAG,EAAhB;EACA,IAAMG,KAAK,GAAGF,KAAK,CAACM,IAAN,EAAd;EACArC,IAAI,CAACoC,KAAD,EAAQ,UAACE,CAAD,EAAIJ,CAAJ,EAAK;IACf,IAAIf,cAAc,CAACoB,OAAf,CAAuBL,CAAvB,MAA8B,CAAC,CAA/B,IAAoC,CAACjC,OAAO,CAACgC,KAAK,CAACC,CAAD,CAAN,EAAWI,CAAX,CAAhD,EAA+D;MAC7DR,OAAO,CAACI,CAAD,CAAP,GAAaI,CAAb;IACD;EACF,CAJG,CAAJ;EAKA,OAAOR,OAAP;AACD;;AAED,SAASU,iBAAT,CAA2BC,UAA3B,EAAoDC,SAApD,EAAwE;EACtE,IAAIA,SAAS,CAACC,OAAd,EAAuB;IACrB,OAAOF,UAAP;EACD;;EACO,aAAS,GAAsBC,SAAS,UAAxC;EAAA,IAAWE,KAAK,GAAeF,SAAS,MAAxC;EAAA,IAAkBG,QAAQ,GAAKH,SAAS,SAAxC;EACR,IAAMI,cAAc,GAAGC,MAAM,CAACC,SAAP,CAAiBF,cAAxC;EACA9C,IAAI,CAACyC,UAAD,EAAa,UAACQ,IAAD,EAAK;IACpB;IACA,IAAIC,SAAS,GAAGN,KAAZ,GAAoBK,IAAI,CAACC,SAAL,GAAiBD,IAAI,CAACL,KAAtB,GAA8BK,IAAI,CAACJ,QAAvD,IAAmEA,QAAQ,GAAGI,IAAI,CAACL,KAAvF,EAA8F;MAC5F5C,IAAI,CAAC0C,SAAS,CAACZ,OAAX,EAAoB,UAACQ,CAAD,EAAIJ,CAAJ,EAAK;QAC3B,IAAIY,cAAc,CAACK,IAAf,CAAoBF,IAAI,CAACnB,OAAzB,EAAkCI,CAAlC,CAAJ,EAA0C;UACxC,OAAOe,IAAI,CAACnB,OAAL,CAAaI,CAAb,CAAP;UACA,OAAOe,IAAI,CAACjB,SAAL,CAAeE,CAAf,CAAP;QACD;MACF,CALG,CAAJ;IAMD;EACF,CAVG,CAAJ;EAYA,OAAOO,UAAP;AACD;;AAED;AAAA;AAAA;EAA+BW;;EAQ7B,iBAAYC,GAAZ,EAAe;IAAf,YACEC,kBAAMD,GAAN,KAAU,IADZ;IAPA;;;;;;;IAKAE,cAAoB,EAApB;;IAIE,IAAMtB,KAAK,GAAGsB,KAAI,CAACC,eAAL,EAAd;;IACAjD,GAAG,CAAC0B,KAAD,EAAQoB,GAAG,CAACpB,KAAZ,CAAH;IACAsB,KAAI,CAACtB,KAAL,GAAaA,KAAb;;IACAsB,KAAI,CAACE,SAAL,CAAexB,KAAf;;IACAsB,KAAI,CAACG,WAAL,GANa,CAMO;;;;EACrB,CAfH,CAiBE;;;EACAC;IACE,OAAO;MACLC,OAAO,EAAE,IADJ;MAELC,OAAO,EAAE,IAFJ;MAGLC,MAAM,EAAE;IAHH,CAAP;EAKD,CAND;EAQA;;;;;;EAIAH;IACE,OAAO;MACLI,MAAM,EAAE,KAAKC,gBAAL,EADH;MAELC,OAAO,EAAE;IAFJ,CAAP;EAID,CALD;EAUA;;;;;;;EAKAN,6CAAeO,UAAf,EAAqC,CAAI,CAAzC;EAEA;;;;;;;EAKAP,wCAAU1B,KAAV,EAA2B,CAAI,CAA/B;EAEA;;;;;;EAIA0B;IACE,KAAKQ,GAAL,CAAS,UAAT,EAAqB,IAArB;IACA,KAAKA,GAAL,CAAS,WAAT,EAAsB,KAAtB;EACD,CAHD;;EAKAR;IACE,OAAO,KAAP;EACD,CAFD;;EAIAA;IACE,OAAO,KAAKS,GAAL,CAAS,QAAT,CAAP;EACD,CAFD;;EAIAT;IACE,OAAO,KAAKS,GAAL,CAAS,QAAT,CAAP;EACD,CAFD;;EAIAT;;;IAAK;;SAAA,yCAAO;MAAPU;;;IACI,QAAI,GAAWA,IAAI,GAAnB;IAAA,IAAMC,KAAK,GAAID,IAAI,GAAnB;IACP,IAAI,CAACE,IAAL,EAAW,OAAO,KAAKtC,KAAZ;;IACX,IAAI7B,QAAQ,CAACmE,IAAD,CAAZ,EAAoB;MAClB,KAAK,IAAMrC,CAAX,IAAgBqC,IAAhB,EAAsB;QACpB,KAAKC,OAAL,CAAatC,CAAb,EAAgBqC,IAAI,CAACrC,CAAD,CAApB;MACD;;MACD,KAAKuC,gBAAL,CAAsBF,IAAtB;MACA,OAAO,IAAP;IACD;;IACD,IAAIF,IAAI,CAAC3C,MAAL,KAAgB,CAApB,EAAuB;MACrB,KAAK8C,OAAL,CAAaD,IAAb,EAAmBD,KAAnB;MACA,KAAKG,gBAAL,EAAqBC,SACnBA,GAACH,IAAD,IAAQD,KADW,IAArB;MAGA,OAAO,IAAP;IACD;;IACD,OAAO,KAAKrC,KAAL,CAAWsC,IAAX,CAAP;EACD,CAlBD,CA3EF,CAoGE;;;EACAZ,wCAAUgB,IAAV,EAAgBC,IAAhB,EAAoB;IAClB,IAAMC,IAAI,GAAG,KAAKC,OAAL,EAAb;IACA,OAAOD,IAAI,IAAI,CAACA,IAAI,CAACE,KAAL,CAAWJ,IAAX,EAAiBC,IAAjB,CAAhB;EACD,CAHD;EAKA;;;;;;;EAKAjB,sCAAQY,IAAR,EAAsBD,KAAtB,EAAgC;IAC9B,IAAMU,WAAW,GAAG,KAAK/C,KAAL,CAAWsC,IAAX,CAApB;;IACA,IAAIS,WAAW,KAAKV,KAApB,EAA2B;MACzB,KAAKrC,KAAL,CAAWsC,IAAX,IAAmBD,KAAnB;MACA,KAAKW,YAAL,CAAkBV,IAAlB,EAAwBD,KAAxB,EAA+BU,WAA/B;IACD;EACF,CAND;EAQA;;;;;;;;;EAOArB,2CAAaY,IAAb,EAA2BD,KAA3B,EAAuCU,WAAvC,EAAuD;IACrD,IAAIT,IAAI,KAAK,QAAb,EAAuB;MACrB,KAAKJ,GAAL,CAAS,aAAT,EAAwB,IAAxB;IACD;EACF,CAJD;EAMA;;;;;;EAIAR,+CAAiBuB,WAAjB,EAA4B;IAC1B,IAAI,KAAK7B,GAAL,CAAS8B,WAAb,EAA0B;MACxB,IAAMC,OAAO,GAAG,KAAK/B,GAAL,CAAS+B,OAAzB;;MACA,IAAIA,OAAJ,EAAa;QACXA,OAAO,CAACC,cAAR,CAAuB,MAAvB;MACD;IACF,CALD,MAKO;MACL,KAAKA,cAAL,CAAoB,MAApB;IACD;EACF,CATD;;EAWA1B;IACE;IACA,KAAKQ,GAAL,CAAS,SAAT,EAAoB,IAApB;IACA,KAAKkB,cAAL,CAAoB,MAApB;IACA,OAAO,IAAP;EACD,CALD;;EAOA1B;IACE;IACA,KAAKQ,GAAL,CAAS,SAAT,EAAoB,KAApB;IACA,KAAKkB,cAAL,CAAoB,MAApB;IACA,OAAO,IAAP;EACD,CALD;;EAOA1B,wCAAUG,MAAV,EAAwB;IACtB,KAAKK,GAAL,CAAS,QAAT,EAAmBL,MAAnB;IACA,IAAMwB,MAAM,GAAG,KAAKC,SAAL,EAAf;;IACA,IAAID,MAAJ,EAAY;MACV;MACAA,MAAM,CAACE,IAAP;IACD;;IACD,OAAO,IAAP;EACD,CARD;;EAUA7B;IACE,IAAM2B,MAAM,GAAG,KAAKC,SAAL,EAAf;;IACA,IAAI,CAACD,MAAL,EAAa;MACX;IACD;;IACD,IAAMG,QAAQ,GAAGH,MAAM,CAACI,WAAP,EAAjB;IACA,IAAMC,EAAE,GAAG,KAAKvB,GAAL,CAAS,IAAT,CAAX;IACA,IAAMwB,KAAK,GAAGH,QAAQ,CAAClD,OAAT,CAAiB,IAAjB,CAAd;IACAkD,QAAQ,CAACI,MAAT,CAAgBD,KAAhB,EAAuB,CAAvB;IACAH,QAAQ,CAAC9D,IAAT,CAAc,IAAd;IACA,KAAK0D,cAAL,CAAoB,QAApB;EACD,CAXD;;EAaA1B;IACE,IAAM2B,MAAM,GAAG,KAAKC,SAAL,EAAf;;IACA,IAAI,CAACD,MAAL,EAAa;MACX;IACD;;IACD,IAAMG,QAAQ,GAAGH,MAAM,CAACI,WAAP,EAAjB;IACA,IAAMC,EAAE,GAAG,KAAKvB,GAAL,CAAS,IAAT,CAAX;IACA,IAAMwB,KAAK,GAAGH,QAAQ,CAAClD,OAAT,CAAiB,IAAjB,CAAd;IACAkD,QAAQ,CAACI,MAAT,CAAgBD,KAAhB,EAAuB,CAAvB;IACAH,QAAQ,CAACK,OAAT,CAAiB,IAAjB;IACA,KAAKT,cAAL,CAAoB,QAApB;EACD,CAXD;;EAaA1B,qCAAOoC,OAAP,EAAqB;IAAd;MAAAA;IAAc;;IACnB,IAAMT,MAAM,GAAG,KAAKC,SAAL,EAAf;;IACA,IAAID,MAAJ,EAAY;MACV3E,eAAe,CAAC2E,MAAM,CAACI,WAAP,EAAD,EAAuB,IAAvB,CAAf;;MACA,IAAI,CAACJ,MAAM,CAAClB,GAAP,CAAW,UAAX,CAAL,EAA6B;QAC3B;QACA,KAAKiB,cAAL,CAAoB,QAApB;MACD;IACF,CAND,MAMO;MACL,KAAKA,cAAL,CAAoB,QAApB;IACD;;IACD,IAAIU,OAAJ,EAAa;MACX,KAAKA,OAAL;IACD;EACF,CAdD;;EAgBApC;IACE,KAAKtB,IAAL,CAAUpB,MAAV,EAAkB,KAAK+C,gBAAL,EAAlB;IACA,KAAKqB,cAAL,CAAoB,QAApB;EACD,CAHD;;EAKA1B;IACE,OAAO,KAAKtB,IAAL,CAAUpB,MAAV,CAAP;EACD,CAFD;;EAIA0C,wCAAUqC,CAAV,EAAqB;IACnB,KAAK3D,IAAL,CAAUpB,MAAV,EAAkB+E,CAAlB;IACA,KAAKX,cAAL,CAAoB,QAApB;EACD,CAHD,CA9NF,CAmOE;;;EACA1B;IACE,IAAIsC,WAAW,GAAG,KAAK5C,GAAL,CAAS4C,WAA3B;;IACA,IAAI,CAACA,WAAL,EAAkB;MAChB,IAAMC,aAAa,GAAG,KAAK7D,IAAL,CAAU,QAAV,CAAtB;MACA,IAAM8D,YAAY,GAAG,KAAK9C,GAAL,CAAS8C,YAA9B;;MACA,IAAIA,YAAY,IAAID,aAApB,EAAmC;QACjCD,WAAW,GAAGpF,cAAc,CAACsF,YAAD,EAAeD,aAAf,CAA5B;MACD,CAFD,MAEO;QACLD,WAAW,GAAGC,aAAa,IAAIC,YAA/B;MACD;;MACD,KAAKhC,GAAL,CAAS,aAAT,EAAwB8B,WAAxB;IACD;;IACD,OAAOA,WAAP;EACD,CAbD,CApOF,CAmPE;;;EACAtC,0CAAYI,MAAZ,EAA4B;IAC1B,IAAMmC,aAAa,GAAG,KAAK7D,IAAL,CAAU,QAAV,CAAtB;IACA,IAAI4D,WAAW,GAAG,IAAlB;;IACA,IAAIlC,MAAM,IAAImC,aAAd,EAA6B;MAC3BD,WAAW,GAAGpF,cAAc,CAACkD,MAAD,EAASmC,aAAT,CAA5B;IACD,CAFD,MAEO;MACLD,WAAW,GAAGC,aAAa,IAAInC,MAA/B;IACD;;IACD,KAAKI,GAAL,CAAS,aAAT,EAAwB8B,WAAxB;IACA,KAAK9B,GAAL,CAAS,cAAT,EAAyBJ,MAAzB;EACD,CAVD;EAYA;;;;;;;EAKAJ;IACE,OAAO,IAAP;EACD,CAFD,CArQF,CAyQE;;;EACAA,4CAAcrB,CAAd,EAAyB;IACvB,IAAMyB,MAAM,GAAG,KAAK1B,IAAL,CAAU,QAAV,CAAf;;IACA,IAAI0B,MAAJ,EAAY;MACV,OAAOjD,YAAY,CAACiD,MAAD,EAASzB,CAAT,CAAnB;IACD;;IACD,OAAOA,CAAP;EACD,CAND,CA1QF,CAkRE;;;EACAqB,+CAAiBrB,CAAjB,EAA4B;IAC1B,IAAMyB,MAAM,GAAG,KAAK1B,IAAL,CAAU,QAAV,CAAf;;IACA,IAAI0B,MAAJ,EAAY;MACV,IAAMqC,YAAY,GAAGrF,MAAM,CAACgD,MAAD,CAA3B;;MACA,IAAIqC,YAAJ,EAAkB;QAChB,OAAOtF,YAAY,CAACsF,YAAD,EAAe9D,CAAf,CAAnB;MACD;IACF;;IACD,OAAOA,CAAP;EACD,CATD,CAnRF,CA8RE;;;EACAqB,sCAAQ0C,OAAR,EAAwB;IACtB,IAAMC,MAAM,GAAG,KAAKC,SAAL,EAAf,CADsB,CAEtB;IACA;IACA;IACA;IACA;IACA;IACA;;IACA,IAAIC,SAAS,GAAG,IAAhB,CATsB,CAUtB;;IACA,IAAIH,OAAJ,EAAa;MACX,IAAMI,SAAS,GAAG,KAAKC,YAAL,EAAlB;MACA,IAAMC,SAAS,GAAGnG,UAAU,CAAC6F,OAAO,CAACO,IAAT,CAA5B;MACA,IAAMC,IAAI,GAAGJ,SAAS,CAACE,SAAD,CAAtB;;MACA,IAAIE,IAAJ,EAAU;QACRL,SAAS,GAAG,IAAIK,IAAJ,CAAS;UACnBD,IAAI,EAAEP,OAAO,CAACO,IADK;UAEnBzB,WAAW,EAAE,IAFM;UAGnBC,OAAO,EAAE,IAHU;UAInBnD,KAAK,EAAEoE,OAAO,CAACpE,KAJI;UAKnBqE,MAAM;QALa,CAAT,CAAZ;MAOD;IACF;;IAED,KAAKnC,GAAL,CAAS,WAAT,EAAsBqC,SAAtB;IACA,KAAKnB,cAAL,CAAoB,MAApB;IACA,OAAOmB,SAAP;EACD,CA7BD;;EA+BA7C;IACE;IACA,IAAM6C,SAAS,GAAG,KAAKnD,GAAL,CAASmD,SAA3B,CAFF,CAGE;;IACA,IAAI,CAACA,SAAL,EAAgB;MACd,OAAO,IAAP;IACD;;IACD,OAAOA,SAAP;EACD,CARD;;EAUA7C;IAAA;;IACE,IAAMmD,WAAW,GAAG,KAAK7E,KAAzB;IACA,IAAMA,KAAK,GAAG,EAAd;IACAjC,IAAI,CAAC8G,WAAD,EAAc,UAACrF,CAAD,EAAIS,CAAJ,EAAK;MACrB,IAAI7B,OAAO,CAACyG,WAAW,CAAC5E,CAAD,CAAZ,CAAX,EAA6B;QAC3BD,KAAK,CAACC,CAAD,CAAL,GAAWZ,eAAe,CAACwF,WAAW,CAAC5E,CAAD,CAAZ,CAA1B;MACD,CAFD,MAEO;QACLD,KAAK,CAACC,CAAD,CAAL,GAAW4E,WAAW,CAAC5E,CAAD,CAAtB;MACD;IACF,CANG,CAAJ;IAOA,IAAM6E,IAAI,GAAG,KAAKC,WAAlB,CAVF,CAWE;;IACA,IAAMC,KAAK,GAAG,IAAIF,IAAJ,CAAS;MAAE9E,KAAK;IAAP,CAAT,CAAd;IACAjC,IAAI,CAACkB,UAAD,EAAa,UAACgG,OAAD,EAAQ;MACvBD,KAAK,CAAC9C,GAAN,CAAU+C,OAAV,EAAmB3D,KAAI,CAACa,GAAL,CAAS8C,OAAT,CAAnB;IACD,CAFG,CAAJ;IAGA,OAAOD,KAAP;EACD,CAjBD;;EAmBAtD;IACE,IAAMwD,SAAS,GAAG,KAAKA,SAAvB;;IACA,IAAIA,SAAJ,EAAe;MACb;IACD;;IACD,KAAKlF,KAAL,GAAa,EAAb;;IACAqB,iBAAMyC,OAAN,CAAa5C,IAAb,CAAa,IAAb,EANF,CAOE;;EACD,CARD;EAUA;;;;;;EAIAQ;IACE,OAAO,KAAKS,GAAL,CAAS,QAAT,EAAmBgD,QAA1B;EACD,CAFD;EAIA;;;;;;;;;;;;;;;;EAcAzD;IAAQ;;SAAA,yCAAO;MAAPU;;;IACN,IAAI,CAAC,KAAKD,GAAL,CAAS,UAAT,CAAD,IAAyB,CAAC,KAAKA,GAAL,CAAS,QAAT,CAA9B,EAAkD;MAChD;IACD;;IACD,KAAKD,GAAL,CAAS,WAAT,EAAsB,IAAtB;IACA,IAAIkD,QAAQ,GAAG,KAAKjD,GAAL,CAAS,UAAT,CAAf;;IACA,IAAI,CAACiD,QAAL,EAAe;MACbA,QAAQ,GAAG,KAAKjD,GAAL,CAAS,QAAT,EAAmBA,GAAnB,CAAuB,UAAvB,CAAX;MACA,KAAKD,GAAL,CAAS,UAAT,EAAqBkD,QAArB;IACD;;IACD,IAAI5E,UAAU,GAAG,KAAK2B,GAAL,CAAS,YAAT,KAA0B,EAA3C,CAVF,CAWE;;IACA,IAAI,CAACiD,QAAQ,CAACC,KAAd,EAAqB;MACnBD,QAAQ,CAACE,SAAT;IACD;;IACI,WAAO,GAAiElD,IAAI,GAA5E;IAAA,IAASxB,QAAQ,GAAuDwB,IAAI,GAA5E;IAAA,IAAmBK,KAAqDL,IAAI,GAA5E;IAAA,IAAmBmD,MAAM,mBAAG,YAAH,GAAe9C,EAAxC;IAAA,IAA0C+C,KAA8BpD,IAAI,GAA5E;IAAA,IAA0CqD,QAAQ,mBAAGpH,IAAH,GAAOmH,EAAzD;IAAA,IAA2DE,KAAatD,IAAI,GAA5E;IAAA,IAA2DzB,KAAK,mBAAG,CAAH,GAAI+E,EAApE;IACL,IAAIhF,OAAJ;IACA,IAAIiF,MAAJ;IACA,IAAIC,aAAJ;IACA,IAAIC,cAAJ;IACA,IAAIC,UAAJ,CApBF,CAqBE;;IACA,IAAI7H,UAAU,CAAC4B,OAAD,CAAd,EAAyB;MACvBa,OAAO,GAAGb,OAAV;MACAA,OAAO,GAAG,EAAV;IACD,CAHD,MAGO,IAAI1B,QAAQ,CAAC0B,OAAD,CAAR,IAAsBA,OAAe,CAACa,OAA1C,EAAmD;MACxD;MACAA,OAAO,GAAIb,OAAe,CAACa,OAA3B;MACAiF,MAAM,GAAI9F,OAAe,CAAC8F,MAA1B;IACD,CA7BH,CA8BE;;;IACA,IAAIxH,QAAQ,CAACyC,QAAD,CAAZ,EAAwB;MACtBkF,UAAU,GAAGlF,QAAb;MACAA,QAAQ,GAAGkF,UAAU,CAAClF,QAAtB;MACA2E,MAAM,GAAGO,UAAU,CAACP,MAAX,IAAqB,YAA9B;MACA5E,KAAK,GAAGmF,UAAU,CAACnF,KAAX,IAAoB,CAA5B,CAJsB,CAKtB;;MACAgF,MAAM,GAAGG,UAAU,CAACH,MAAX,IAAqBA,MAArB,IAA+B,KAAxC;MACAF,QAAQ,GAAGK,UAAU,CAACL,QAAX,IAAuBpH,IAAlC;MACAuH,aAAa,GAAGE,UAAU,CAACF,aAAX,IAA4BvH,IAA5C;MACAwH,cAAc,GAAGC,UAAU,CAACD,cAAX,IAA6BxH,IAA9C;IACD,CAVD,MAUO;MACL;MACA,IAAIH,QAAQ,CAACuH,QAAD,CAAZ,EAAwB;QACtB9E,KAAK,GAAG8E,QAAR;QACAA,QAAQ,GAAG,IAAX;MACD,CALI,CAML;;;MACA,IAAIxH,UAAU,CAACsH,MAAD,CAAd,EAAwB;QACtBE,QAAQ,GAAGF,MAAX;QACAA,MAAM,GAAG,YAAT;MACD,CAHD,MAGO;QACLA,MAAM,GAAGA,MAAM,IAAI,YAAnB;MACD;IACF;;IACD,IAAMQ,aAAa,GAAG7F,gBAAgB,CAACL,OAAD,EAAU,IAAV,CAAtC;IACA,IAAMY,SAAS,GAAc;MAC3BV,SAAS,EAAEH,kBAAkB,CAACmG,aAAD,EAAgB,IAAhB,CADF;MAE3BlG,OAAO,EAAEkG,aAFkB;MAG3BnF,QAAQ,UAHmB;MAI3B2E,MAAM,QAJqB;MAK3BI,MAAM,QALqB;MAM3BF,QAAQ,UANmB;MAO3BG,aAAa,eAPc;MAQ3BC,cAAc,gBARa;MAS3BlF,KAAK,OATsB;MAU3BM,SAAS,EAAEmE,QAAQ,CAACY,OAAT,EAVgB;MAW3BC,EAAE,EAAEzH,QAAQ,EAXe;MAY3BkC,OAAO,SAZoB;MAa3BwF,aAAa,EAAE;IAbY,CAA7B,CAxDF,CAuEE;;IACA,IAAI1F,UAAU,CAACf,MAAX,GAAoB,CAAxB,EAA2B;MACzB;MACAe,UAAU,GAAGD,iBAAiB,CAACC,UAAD,EAAaC,SAAb,CAA9B;IACD,CAHD,MAGO;MACL;MACA2E,QAAQ,CAACe,WAAT,CAAqB,IAArB;IACD;;IACD3F,UAAU,CAACd,IAAX,CAAgBe,SAAhB;IACA,KAAKyB,GAAL,CAAS,YAAT,EAAuB1B,UAAvB;IACA,KAAK0B,GAAL,CAAS,QAAT,EAAmB;MAAEiD,QAAQ,EAAE;IAAZ,CAAnB;EACD,CAlFD;EAoFA;;;;;;EAIAzD,0CAAY0E,KAAZ,EAAwB;IAAxB;;IAAY;MAAAA;IAAY;;IACtB,IAAM5F,UAAU,GAAG,KAAK2B,GAAL,CAAS,YAAT,CAAnB;IACApE,IAAI,CAACyC,UAAD,EAAa,UAACC,SAAD,EAAqB;MACpC;MACA,IAAI2F,KAAJ,EAAW;QACT,IAAI3F,SAAS,CAACC,OAAd,EAAuB;UACrBY,KAAI,CAAClB,IAAL,CAAUK,SAAS,CAACC,OAAV,CAAkB,CAAlB,CAAV;QACD,CAFD,MAEO;UACLY,KAAI,CAAClB,IAAL,CAAUK,SAAS,CAACZ,OAApB;QACD;MACF;;MACD,IAAIY,SAAS,CAACgF,QAAd,EAAwB;QACtB;QACAhF,SAAS,CAACgF,QAAV;MACD;IACF,CAbG,CAAJ;IAcA,KAAKvD,GAAL,CAAS,WAAT,EAAsB,KAAtB;IACA,KAAKA,GAAL,CAAS,YAAT,EAAuB,EAAvB;EACD,CAlBD;EAoBA;;;;;EAGAR;IACE,IAAM0D,QAAQ,GAAG,KAAKjD,GAAL,CAAS,UAAT,CAAjB;IACA,IAAM3B,UAAU,GAAG,KAAK2B,GAAL,CAAS,YAAT,CAAnB;IACA,IAAMkE,SAAS,GAAGjB,QAAQ,CAACY,OAAT,EAAlB;IACAjI,IAAI,CAACyC,UAAD,EAAa,UAACC,SAAD,EAAqB;MACpCA,SAAS,CAAC6F,OAAV,GAAoB,IAApB;MACA7F,SAAS,CAAC8F,UAAV,GAAuBF,SAAvB;;MACA,IAAI5F,SAAS,CAACmF,aAAd,EAA6B;QAC3B;QACAnF,SAAS,CAACmF,aAAV;MACD;IACF,CAPG,CAAJ,CAJF,CAYE;;IACA,KAAK1D,GAAL,CAAS,QAAT,EAAmB;MACjBiD,QAAQ,EAAE,IADO;MAEjBkB,SAAS;IAFQ,CAAnB;IAIA,OAAO,IAAP;EACD,CAlBD;EAoBA;;;;;EAGA3E;IACE,IAAM0D,QAAQ,GAAG,KAAKjD,GAAL,CAAS,UAAT,CAAjB;IACA,IAAMqE,OAAO,GAAGpB,QAAQ,CAACY,OAAT,EAAhB;IACA,IAAMxF,UAAU,GAAG,KAAK2B,GAAL,CAAS,YAAT,CAAnB;IACA,IAAMkE,SAAS,GAAG,KAAKlE,GAAL,CAAS,QAAT,EAAmBkE,SAArC,CAJF,CAKE;;IACAtI,IAAI,CAACyC,UAAD,EAAa,UAACC,SAAD,EAAqB;MACpCA,SAAS,CAACQ,SAAV,GAAsBR,SAAS,CAACQ,SAAV,IAAuBuF,OAAO,GAAGH,SAAjC,CAAtB;MACA5F,SAAS,CAAC6F,OAAV,GAAoB,KAApB;MACA7F,SAAS,CAAC8F,UAAV,GAAuB,IAAvB;;MACA,IAAI9F,SAAS,CAACoF,cAAd,EAA8B;QAC5BpF,SAAS,CAACoF,cAAV;MACD;IACF,CAPG,CAAJ;IAQA,KAAK3D,GAAL,CAAS,QAAT,EAAmB;MACjBiD,QAAQ,EAAE;IADO,CAAnB;IAGA,KAAKjD,GAAL,CAAS,YAAT,EAAuB1B,UAAvB;IACA,OAAO,IAAP;EACD,CAnBD;EAqBA;;;;;;;EAKAkB,6CAAeiD,IAAf,EAA6B8B,QAA7B,EAAiD;IAAjD;;IACE,IAAMC,KAAK,GAAGD,QAAQ,CAACE,eAAvB;IACA,IAAMC,MAAM,GAAG,KAAKC,SAAL,EAAf;IACA,IAAIC,aAAJ;;IACA,IAAInC,IAAI,KAAK,YAAb,EAA2B;MACzBmC,aAAa,GAAGL,QAAQ,CAACM,SAAzB;IACD,CAFD,MAEO,IAAIpC,IAAI,KAAK,YAAb,EAA2B;MAChCmC,aAAa,GAAGL,QAAQ,CAACO,OAAzB;IACD;;4BAEQxH,GAAC;MACR,IAAMyH,OAAO,GAAGP,KAAK,CAAClH,CAAD,CAArB,CADQ,CAER;;MACA,IAAM0H,MAAI,GAAGD,OAAO,CAAC9E,GAAR,CAAY,MAAZ,CAAb;;MACA,IAAI+E,MAAJ,EAAU;QACR;QACA,KACE;QACA,CAACD,OAAO,CAACE,OAAR,MAAsBF,OAAO,CAACG,QAAR,IAAoBH,OAAO,CAACG,QAAR,EAA3C,KACAN,aADA,IAEAnI,QAAQ,CAACsI,OAAD,EAAUH,aAAV,CAJV,EAKE;;QAED;;QACD,IAAI1I,OAAO,CAAC8I,MAAD,CAAX,EAAmB;UACjBnJ,IAAI,CAACmJ,MAAD,EAAO,UAACG,OAAD,EAAQ;YACjB/F,KAAI,CAACgG,iBAAL,CAAuBL,OAAvB,EAAgCI,OAAhC,EAAyCZ,QAAzC;UACD,CAFG,CAAJ;QAGD,CAJD,MAIO;UACLc,OAAKD,iBAAL,CAAuBL,OAAvB,EAAgCC,MAAhC,EAAsCT,QAAtC;QACD;MACF;;;sBA/B4C,CAS/C;;IACA,KAAK,IAAIjH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkH,KAAK,CAACjH,MAA1B,EAAkCD,CAAC,EAAnC,EAAqC;4BAA5BA;;;IAsBR;EACF,CAjCD;;EAmCQkC,sCAAR,UAA0BuF,OAA1B,EAAmC3E,IAAnC,EAAiDmE,QAAjD,EAAqE;IACnE,IAAMG,MAAM,GAAG,KAAKC,SAAL,EAAf,CADmE,CAEnE;;IACA,IAAMW,SAAS,GAAGlF,IAAI,GAAGnD,gBAAP,GAA0BsH,QAAQ,CAAC9B,IAArD;;IACA,IAAIiC,MAAM,CAACY,SAAD,CAAN,IAAqBZ,MAAM,CAACxH,QAAD,CAA/B,EAA2C;MACzC;MACAqH,QAAQ,CAACnE,IAAT,GAAgBkF,SAAhB;MACAf,QAAQ,CAACgB,aAAT,GAAyBR,OAAzB;MACAR,QAAQ,CAACiB,cAAT,GAA0B,IAA1B,CAJyC,CAKzC;;MACAjB,QAAQ,CAACkB,cAAT,GAA0BV,OAAO,CAAC9E,GAAR,CAAY,gBAAZ,CAA1B;MACA,KAAKyF,IAAL,CAAUJ,SAAV,EAAqBf,QAArB;IACD;EACF,CAbO;EAeR;;;;;;;;EAMA/E,wCAAUmG,UAAV,EAAkCC,UAAlC,EAAwD;IAA9C;MAAAD;IAAsB;;IAAE;MAAAC;IAAsB;;IACtD,IAAMhG,MAAM,GAAG,KAAKiG,SAAL,EAAf;IACA,IAAMC,SAAS,GAAGC,SAAS,CAACnG,MAAD,EAAS,CAAC,CAAC,GAAD,EAAM+F,UAAN,EAAkBC,UAAlB,CAAD,CAAT,CAA3B;IACA,KAAKI,SAAL,CAAeF,SAAf;IACA,OAAO,IAAP;EACD,CALD;EAOA;;;;;;;;EAMAtG,mCAAKyG,OAAL,EAAsBC,OAAtB,EAAqC;IACnC,IAAMC,CAAC,GAAG,KAAKjI,IAAL,CAAU,GAAV,KAAkB,CAA5B;IACA,IAAMkI,CAAC,GAAG,KAAKlI,IAAL,CAAU,GAAV,KAAkB,CAA5B;IACA,KAAKmI,SAAL,CAAeJ,OAAO,GAAGE,CAAzB,EAA4BD,OAAO,GAAGE,CAAtC;IACA,OAAO,IAAP;EACD,CALD;EAOA;;;;;;;;EAMA5G,qCAAOyG,OAAP,EAAwBC,OAAxB,EAAuC;IACrC,OAAO,KAAKI,IAAL,CAAUL,OAAV,EAAmBC,OAAnB,CAAP;EACD,CAFD;EAIA;;;;;;;;EAMA1G,oCAAM+G,MAAN,EAAsBC,MAAtB,EAAqC;IACnC,IAAM5G,MAAM,GAAG,KAAKiG,SAAL,EAAf;IACA,IAAMC,SAAS,GAAGC,SAAS,CAACnG,MAAD,EAAS,CAAC,CAAC,GAAD,EAAM2G,MAAN,EAAcC,MAAM,IAAID,MAAxB,CAAD,CAAT,CAA3B;IACA,KAAKP,SAAL,CAAeF,SAAf;IACA,OAAO,IAAP;EACD,CALD;EAOA;;;;;;;EAKAtG,qCAAOiH,MAAP,EAAqB;IACnB,IAAM7G,MAAM,GAAG,KAAKiG,SAAL,EAAf;IACA,IAAMC,SAAS,GAAGC,SAAS,CAACnG,MAAD,EAAS,CAAC,CAAC,GAAD,EAAM6G,MAAN,CAAD,CAAT,CAA3B;IACA,KAAKT,SAAL,CAAeF,SAAf;IACA,OAAO,IAAP;EACD,CALD;EAOA;;;;;;;EAKAtG,4CAAckH,MAAd,EAA4B;IACpB,SAAW,KAAKxI,IAAL,EAAX;IAAA,IAAEiI,CAAC,OAAH;IAAA,IAAKC,CAAC,OAAN;;IACN,IAAMxG,MAAM,GAAG,KAAKiG,SAAL,EAAf;IACA,IAAMC,SAAS,GAAGC,SAAS,CAACnG,MAAD,EAAS,CAClC,CAAC,GAAD,EAAM,CAACuG,CAAP,EAAU,CAACC,CAAX,CADkC,EAElC,CAAC,GAAD,EAAMM,MAAN,CAFkC,EAGlC,CAAC,GAAD,EAAMP,CAAN,EAASC,CAAT,CAHkC,CAAT,CAA3B;IAKA,KAAKJ,SAAL,CAAeF,SAAf;IACA,OAAO,IAAP;EACD,CAVD;EAYA;;;;;;;EAKAtG,4CAAc2G,CAAd,EAAyBC,CAAzB,EAAoCM,MAApC,EAAkD;IAChD,IAAM9G,MAAM,GAAG,KAAKiG,SAAL,EAAf;IACA,IAAMC,SAAS,GAAGC,SAAS,CAACnG,MAAD,EAAS,CAClC,CAAC,GAAD,EAAM,CAACuG,CAAP,EAAU,CAACC,CAAX,CADkC,EAElC,CAAC,GAAD,EAAMM,MAAN,CAFkC,EAGlC,CAAC,GAAD,EAAMP,CAAN,EAASC,CAAT,CAHkC,CAAT,CAA3B;IAKA,KAAKJ,SAAL,CAAeF,SAAf;IACA,OAAO,IAAP;EACD,CATD;;EAUF;AAAC,CA1qBD,CAA+BjJ,IAA/B;;AA4qBA,eAAe2C,OAAf","names":["each","isEqual","isFunction","isNumber","isObject","isArray","noop","mix","upperFirst","uniqueId","ext","removeFromArray","isParent","multiplyMatrix","multiplyVec2","invert","Base","MATRIX","CLONE_CFGS","RESERVED_PORPS","DELEGATION_SPLIT","WILDCARD","_cloneArrayAttr","arr","result","i","length","push","concat","getFormatFromAttrs","toAttrs","shape","fromAttrs","attrs","k","getFormatToAttrs","props","attr","v","indexOf","checkExistedAttrs","animations","animation","onFrame","delay","duration","hasOwnProperty","Object","prototype","item","startTime","call","__extends","cfg","_super","_this","getDefaultAttrs","initAttrs","initAnimate","Element","visible","capture","zIndex","matrix","getDefaultMatrix","opacity","changeType","set","get","args","value","name","setAttr","afterAttrsChange","_a","refX","refY","clip","getClip","isHit","originValue","onAttrChange","targetAttrs","isClipShape","applyTo","onCanvasChange","parent","getParent","sort","children","getChildren","el","index","splice","unshift","destroy","m","totalMatrix","currentMatrix","parentMatrix","invertMatrix","clipCfg","canvas","getCanvas","clipShape","ShapeBase","getShapeBase","shapeType","type","Cons","originAttrs","cons","constructor","clone","cfgName","destroyed","isPaused","timeline","timer","initTimer","easing","_b","callback","_c","repeat","pauseCallback","resumeCallback","animateCfg","formatToAttrs","getTime","id","pathFormatted","addAnimator","toEnd","pauseTime","_paused","_pauseTime","current","eventObj","paths","propagationPath","events","getEvents","relativeShape","fromShape","toShape","element","name_1","isGroup","isCanvas","subName","emitDelegateEvent","this_1","eventName","currentTarget","delegateTarget","delegateObject","emit","translateX","translateY","getMatrix","newMatrix","transform","setMatrix","targetX","targetY","x","y","translate","move","ratioX","ratioY","radian","rotate"],"sourceRoot":"","sources":["../../src/abstract/element.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}