{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { vec2 } from '@antv/matrix-util';\nimport Global from '../global';\nimport { applyMatrix } from './math';\nimport letterAspectRatio from './letterAspectRatio';\nimport { isString, clone, isNumber, isObject, isArray } from '@antv/util';\nvar PI = Math.PI,\n    sin = Math.sin,\n    cos = Math.cos; // 一共支持8个方向的自环，每个环占的角度是45度，在计算时再二分，为22.5度\n\nvar SELF_LINK_SIN = sin(PI / 8);\nvar SELF_LINK_COS = cos(PI / 8);\nexport var getBBox = function getBBox(element, group) {\n  var bbox = element.getBBox();\n  var leftTop = {\n    x: bbox.minX,\n    y: bbox.minY\n  };\n  var rightBottom = {\n    x: bbox.maxX,\n    y: bbox.maxY\n  }; // 根据父元素变换矩阵\n\n  if (group) {\n    var matrix = group.getMatrix();\n\n    if (!matrix) {\n      matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    leftTop = applyMatrix(leftTop, matrix);\n    rightBottom = applyMatrix(rightBottom, matrix);\n  }\n\n  var lx = leftTop.x,\n      ly = leftTop.y;\n  var rx = rightBottom.x,\n      ry = rightBottom.y;\n  return {\n    x: lx,\n    y: ly,\n    minX: lx,\n    minY: ly,\n    maxX: rx,\n    maxY: ry,\n    width: rx - lx,\n    height: ry - ly\n  };\n};\n/**\n * get loop edge config\n * @param cfg edge config\n */\n\nexport var getLoopCfgs = function getLoopCfgs(cfg) {\n  var item = cfg.sourceNode || cfg.targetNode;\n  var container = item.get('group');\n  var containerMatrix = container.getMatrix();\n  if (!containerMatrix) containerMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n  var keyShape = item.getKeyShape();\n  var bbox = keyShape.getBBox();\n  var loopCfg = cfg.loopCfg || {}; // 距离keyShape边的最高距离\n\n  var dist = loopCfg.dist || Math.max(bbox.width, bbox.height) * 2; // 自环边与keyShape的相对位置关系\n\n  var position = loopCfg.position || Global.defaultLoopPosition; // 中心取group上真实位置\n\n  var center = [containerMatrix[6], containerMatrix[7]];\n  var startPoint = [cfg.startPoint.x, cfg.startPoint.y];\n  var endPoint = [cfg.endPoint.x, cfg.endPoint.y];\n  var rstart = bbox.height / 2;\n  var rend = bbox.height / 2;\n  var sinDeltaStart = rstart * SELF_LINK_SIN;\n  var cosDeltaStart = rstart * SELF_LINK_COS;\n  var sinDeltaEnd = rend * SELF_LINK_SIN;\n  var cosDeltaEnd = rend * SELF_LINK_COS; // 如果定义了锚点的，直接用锚点坐标，否则，根据自环的 cfg 计算\n\n  if (startPoint[0] === endPoint[0] && startPoint[1] === endPoint[1]) {\n    switch (position) {\n      case 'top':\n        startPoint = [center[0] - sinDeltaStart, center[1] - cosDeltaStart];\n        endPoint = [center[0] + sinDeltaEnd, center[1] - cosDeltaEnd];\n        break;\n\n      case 'top-right':\n        rstart = bbox.height / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + sinDeltaStart, center[1] - cosDeltaStart];\n        endPoint = [center[0] + cosDeltaEnd, center[1] - sinDeltaEnd];\n        break;\n\n      case 'right':\n        rstart = bbox.width / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + cosDeltaStart, center[1] - sinDeltaStart];\n        endPoint = [center[0] + cosDeltaEnd, center[1] + sinDeltaEnd];\n        break;\n\n      case 'bottom-right':\n        rstart = bbox.width / 2;\n        rend = bbox.height / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + cosDeltaStart, center[1] + sinDeltaStart];\n        endPoint = [center[0] + sinDeltaEnd, center[1] + cosDeltaEnd];\n        break;\n\n      case 'bottom':\n        rstart = bbox.height / 2;\n        rend = bbox.height / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + sinDeltaStart, center[1] + cosDeltaStart];\n        endPoint = [center[0] - sinDeltaEnd, center[1] + cosDeltaEnd];\n        break;\n\n      case 'bottom-left':\n        rstart = bbox.height / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - sinDeltaStart, center[1] + cosDeltaStart];\n        endPoint = [center[0] - cosDeltaEnd, center[1] + sinDeltaEnd];\n        break;\n\n      case 'left':\n        rstart = bbox.width / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - cosDeltaStart, center[1] + sinDeltaStart];\n        endPoint = [center[0] - cosDeltaEnd, center[1] - sinDeltaEnd];\n        break;\n\n      case 'top-left':\n        rstart = bbox.width / 2;\n        rend = bbox.height / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - cosDeltaStart, center[1] - sinDeltaStart];\n        endPoint = [center[0] - sinDeltaEnd, center[1] - cosDeltaEnd];\n        break;\n\n      default:\n        rstart = bbox.width / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - sinDeltaStart, center[1] - cosDeltaStart];\n        endPoint = [center[0] + sinDeltaEnd, center[1] - cosDeltaEnd];\n    } // 如果逆时针画，交换起点和终点\n\n\n    if (loopCfg.clockwise === false) {\n      var swap = [startPoint[0], startPoint[1]];\n      startPoint = [endPoint[0], endPoint[1]];\n      endPoint = [swap[0], swap[1]];\n    }\n  }\n\n  var startVec = [startPoint[0] - center[0], startPoint[1] - center[1]];\n  var scaleRateStart = (rstart + dist) / rstart;\n  var scaleRateEnd = (rend + dist) / rend;\n\n  if (loopCfg.clockwise === false) {\n    scaleRateStart = (rend + dist) / rend;\n    scaleRateEnd = (rstart + dist) / rstart;\n  }\n\n  var startExtendVec = vec2.scale([0, 0], startVec, scaleRateStart);\n  var controlPoint1 = [center[0] + startExtendVec[0], center[1] + startExtendVec[1]];\n  var endVec = [endPoint[0] - center[0], endPoint[1] - center[1]];\n  var endExtendVec = vec2.scale([0, 0], endVec, scaleRateEnd);\n  var controlPoint2 = [center[0] + endExtendVec[0], center[1] + endExtendVec[1]];\n  cfg.startPoint = {\n    x: startPoint[0],\n    y: startPoint[1]\n  };\n  cfg.endPoint = {\n    x: endPoint[0],\n    y: endPoint[1]\n  };\n  cfg.controlPoints = [{\n    x: controlPoint1[0],\n    y: controlPoint1[1]\n  }, {\n    x: controlPoint2[0],\n    y: controlPoint2[1]\n  }];\n  return cfg;\n};\n/**\n * 根据 label 所在线条的位置百分比，计算 label 坐标\n * @param {object}  pathShape  G 的 path 实例，一般是 Edge 实例的 keyShape\n * @param {number}  percent    范围 0 - 1 的线条百分比\n * @param {number}  refX     x 轴正方向为基准的 label 偏移\n * @param {number}  refY     y 轴正方向为基准的 label 偏移\n * @param {boolean} rotate     是否根据线条斜率旋转文本\n * @return {object} 文本的 x, y, 文本的旋转角度\n */\n\nexport var getLabelPosition = function getLabelPosition(pathShape, percent, refX, refY, rotate) {\n  var TAN_OFFSET = 0.0001;\n  var vector = [];\n  var point = pathShape === null || pathShape === void 0 ? void 0 : pathShape.getPoint(percent);\n\n  if (!point) {\n    return {\n      x: 0,\n      y: 0,\n      angle: 0\n    };\n  } // 头尾最可能，放在最前面，使用 g path 上封装的方法\n\n\n  if (percent < TAN_OFFSET) {\n    vector = pathShape.getStartTangent().reverse();\n  } else if (percent > 1 - TAN_OFFSET) {\n    vector = pathShape.getEndTangent();\n  } else {\n    // 否则取指定位置的点,与少量偏移的点，做微分向量\n    var offsetPoint = pathShape === null || pathShape === void 0 ? void 0 : pathShape.getPoint(percent + TAN_OFFSET);\n    vector.push([point.x, point.y]);\n    vector.push([offsetPoint.x, offsetPoint.y]);\n  }\n\n  var rad = Math.atan2(vector[1][1] - vector[0][1], vector[1][0] - vector[0][0]);\n\n  if (rad < 0) {\n    rad += PI * 2;\n  }\n\n  if (refX) {\n    point.x += cos(rad) * refX;\n    point.y += sin(rad) * refX;\n  }\n\n  if (refY) {\n    // 默认方向是 x 轴正方向，法线是 求出角度 - 90°\n    var normal = rad - PI / 2; // 若法线角度在 y 轴负方向，切到正方向，保证 refY 相对于 y 轴正方向\n\n    if (rad > 1 / 2 * PI && rad < 3 * 1 / 2 * PI) {\n      normal -= PI;\n    }\n\n    point.x += cos(normal) * refY;\n    point.y += sin(normal) * refY;\n  }\n\n  var result = {\n    x: point.x,\n    y: point.y,\n    angle: rad\n  };\n\n  if (rotate) {\n    if (rad > 0.5 * PI && rad < 1.5 * PI) {\n      rad -= PI;\n    }\n\n    return __assign({\n      rotate: rad\n    }, result);\n  }\n\n  return result;\n};\n/**\n * depth first traverse, from root to leaves, children in inverse order\n *  if the fn returns false, terminate the traverse\n */\n\nvar traverse = function traverse(data, fn) {\n  if (fn(data) === false) {\n    return false;\n  }\n\n  if (data && data.children) {\n    for (var i = data.children.length - 1; i >= 0; i--) {\n      if (!traverse(data.children[i], fn)) return false;\n    }\n  }\n\n  return true;\n};\n/**\n * depth first traverse, from leaves to root, children in inverse order\n *  if the fn returns false, terminate the traverse\n */\n\n\nvar traverseUp = function traverseUp(data, fn) {\n  if (data && data.children) {\n    for (var i = data.children.length - 1; i >= 0; i--) {\n      if (!traverseUp(data.children[i], fn)) return;\n    }\n  }\n\n  if (fn(data) === false) {\n    return false;\n  }\n\n  return true;\n};\n/**\n * depth first traverse, from root to leaves, children in inverse order\n *  if the fn returns false, terminate the traverse\n */\n\n\nexport var traverseTree = function traverseTree(data, fn) {\n  if (typeof fn !== 'function') {\n    return;\n  }\n\n  traverse(data, fn);\n};\n/**\n * depth first traverse, from leaves to root, children in inverse order\n * if the fn returns false, terminate the traverse\n */\n\nexport var traverseTreeUp = function traverseTreeUp(data, fn) {\n  if (typeof fn !== 'function') {\n    return;\n  }\n\n  traverseUp(data, fn);\n};\n/**\n *\n * @param letter the letter\n * @param fontSize\n * @return the letter's width\n */\n\nexport var getLetterWidth = function getLetterWidth(letter, fontSize) {\n  return fontSize * (letterAspectRatio[letter] || 1);\n};\n/**\n *\n * @param text the text\n * @param fontSize\n * @return the text's size\n */\n\nexport var getTextSize = function getTextSize(text, fontSize) {\n  var width = 0;\n  var pattern = new RegExp(\"[\\u4E00-\\u9FA5]+\");\n  text.split('').forEach(function (letter) {\n    if (pattern.test(letter)) {\n      // 中文字符\n      width += fontSize;\n    } else {\n      width += getLetterWidth(letter, fontSize);\n    }\n  });\n  return [width, fontSize];\n};\nexport var truncateLabelByLength = function truncateLabelByLength(text, length) {\n  if (typeof length !== 'number' || length <= 0 || length >= text.length) {\n    return text;\n  }\n\n  return text.substring(0, length) + '...';\n};\n/**\n * construct the trees from combos data\n * @param array the combos array\n * @param nodes the nodes array\n * @return the tree\n */\n\nexport var plainCombosToTrees = function plainCombosToTrees(array, nodes) {\n  var result = [];\n  var addedMap = {};\n  var modelMap = {};\n  array.forEach(function (d) {\n    modelMap[d.id] = d;\n  });\n  array.forEach(function (d, i) {\n    var cd = clone(d);\n    cd.itemType = 'combo';\n    cd.children = undefined;\n\n    if (cd.parentId === cd.id) {\n      console.warn(\"The parentId for combo \".concat(cd.id, \" can not be the same as the combo's id\"));\n      delete cd.parentId;\n    } else if (cd.parentId && !modelMap[cd.parentId]) {\n      console.warn(\"The parent combo for combo \".concat(cd.id, \" does not exist!\"));\n      delete cd.parentId;\n    }\n\n    var mappedObj = addedMap[cd.id];\n\n    if (mappedObj) {\n      cd.children = mappedObj.children;\n      addedMap[cd.id] = cd;\n      mappedObj = cd;\n\n      if (!mappedObj.parentId) {\n        result.push(mappedObj);\n        return;\n      }\n\n      var mappedParent = addedMap[mappedObj.parentId];\n\n      if (mappedParent) {\n        if (mappedParent.children) mappedParent.children.push(cd);else mappedParent.children = [cd];\n      } else {\n        var parent_1 = {\n          id: mappedObj.parentId,\n          children: [mappedObj]\n        };\n        addedMap[mappedObj.parentId] = parent_1;\n        addedMap[cd.id] = cd;\n      }\n\n      return;\n    }\n\n    if (isString(d.parentId)) {\n      var parent_2 = addedMap[d.parentId];\n\n      if (parent_2) {\n        if (parent_2.children) parent_2.children.push(cd);else parent_2.children = [cd];\n        addedMap[cd.id] = cd;\n      } else {\n        var pa = {\n          id: d.parentId,\n          children: [cd]\n        };\n        addedMap[pa.id] = pa;\n        addedMap[cd.id] = cd;\n      }\n    } else {\n      result.push(cd);\n      addedMap[cd.id] = cd;\n    }\n  }); // proccess the nodes\n\n  var nodeMap = {};\n  (nodes || []).forEach(function (node) {\n    nodeMap[node.id] = node;\n    var combo = addedMap[node.comboId];\n\n    if (combo) {\n      var cnode = {\n        id: node.id,\n        comboId: node.comboId\n      };\n      if (combo.children) combo.children.push(cnode);else combo.children = [cnode];\n      cnode.itemType = 'node';\n      addedMap[node.id] = cnode;\n    }\n  }); // assign the depth for each element\n\n  var maxDepth = 0;\n  result.forEach(function (tree) {\n    tree.depth = maxDepth + 10;\n    traverse(tree, function (child) {\n      var parent;\n      var itemType = addedMap[child.id].itemType;\n\n      if (itemType === 'node') {\n        parent = addedMap[child.comboId];\n      } else {\n        parent = addedMap[child.parentId];\n      }\n\n      if (parent) {\n        if (itemType === 'node') child.depth = maxDepth + 1;else child.depth = maxDepth + 10;\n      } else {\n        child.depth = maxDepth + 10;\n      }\n\n      if (maxDepth < child.depth) maxDepth = child.depth;\n      var oriNodeModel = nodeMap[child.id];\n\n      if (oriNodeModel) {\n        oriNodeModel.depth = child.depth;\n      }\n\n      return true;\n    });\n  });\n  return result;\n};\nexport var reconstructTree = function reconstructTree(trees, subtreeId, newParentId) {\n  var _a;\n\n  var brothers = trees;\n  var subtree;\n  var comboChildsMap = {\n    root: {\n      children: trees\n    }\n  };\n  var foundSubTree = false;\n  var oldParentId = 'root';\n  (trees || []).forEach(function (tree) {\n    if (foundSubTree) return;\n\n    if (tree.id === subtreeId) {\n      subtree = tree;\n\n      if (tree.itemType === 'combo') {\n        subtree.parentId = newParentId;\n      } else {\n        subtree.comboId = newParentId;\n      }\n\n      foundSubTree = true;\n      return;\n    }\n\n    traverseTree(tree, function (child) {\n      var _a;\n\n      comboChildsMap[child.id] = {\n        children: (child === null || child === void 0 ? void 0 : child.children) || []\n      }; // store the old parent id to delete the subtree from the old parent's children in next recursion\n\n      brothers = (_a = comboChildsMap[child.parentId || child.comboId || 'root']) === null || _a === void 0 ? void 0 : _a.children;\n\n      if (child && (child.removed || subtreeId === child.id) && brothers) {\n        oldParentId = child.parentId || child.comboId || 'root';\n        subtree = child; // re-assign the parentId or comboId for the moved subtree\n\n        if (child.itemType === 'combo') {\n          subtree.parentId = newParentId;\n        } else {\n          subtree.comboId = newParentId;\n        }\n\n        foundSubTree = true;\n        return false;\n      }\n\n      return true;\n    });\n  });\n  brothers = (_a = comboChildsMap[oldParentId]) === null || _a === void 0 ? void 0 : _a.children;\n  var index = brothers ? brothers.indexOf(subtree) : -1;\n  if (index > -1) brothers.splice(index, 1); // 如果遍历完整棵树还没有找到，说明之前就不在树中\n\n  if (!foundSubTree) {\n    subtree = {\n      id: subtreeId,\n      itemType: 'node',\n      comboId: newParentId\n    };\n    comboChildsMap[subtreeId] = {\n      children: undefined\n    };\n  } // append to new parent\n\n\n  if (subtreeId) {\n    var found_1 = false; // newParentId is undefined means the subtree will have no parent\n\n    if (newParentId) {\n      var newParentDepth_1 = 0;\n      (trees || []).forEach(function (tree) {\n        if (found_1) return; // terminate\n\n        traverseTree(tree, function (child) {\n          // append subtree to the new parent ans assign the depth to the subtree\n          if (newParentId === child.id) {\n            found_1 = true;\n            if (child.children) child.children.push(subtree);else child.children = [subtree];\n            newParentDepth_1 = child.depth;\n            if (subtree.itemType === 'node') subtree.depth = newParentDepth_1 + 2;else subtree.depth = newParentDepth_1 + 1;\n            return false; // terminate\n          }\n\n          return true;\n        });\n      });\n    } else if ((!newParentId || !found_1) && subtree.itemType !== 'node') {\n      // if the newParentId is undefined or it is not found in the tree, add the subTree to the root\n      trees.push(subtree);\n    } // update the depth of the subtree and its children from the subtree\n\n\n    var currentDepth_1 = subtree.depth;\n    traverseTree(subtree, function (child) {\n      if (child.itemType === 'node') currentDepth_1 += 2;else currentDepth_1 += 1;\n      child.depth = currentDepth_1;\n      return true;\n    });\n  }\n\n  return trees;\n};\nexport var getComboBBox = function getComboBBox(children, graph, combo) {\n  var comboBBox = {\n    minX: Infinity,\n    minY: Infinity,\n    maxX: -Infinity,\n    maxY: -Infinity,\n    x: undefined,\n    y: undefined,\n    width: undefined,\n    height: undefined,\n    centerX: undefined,\n    centerY: undefined\n  };\n\n  if (!children || children.length === 0) {\n    var comboModel = combo === null || combo === void 0 ? void 0 : combo.getModel();\n\n    var _a = comboModel || {},\n        x = _a.x,\n        y = _a.y;\n\n    return {\n      minX: x,\n      minY: y,\n      maxX: x,\n      maxY: y,\n      x: x,\n      y: y,\n      width: undefined,\n      height: undefined\n    };\n  }\n\n  children.forEach(function (child) {\n    var childItem = graph.findById(child.id);\n    if (!childItem || !childItem.isVisible()) return; // ignore hidden children\n\n    childItem.set('bboxCanvasCache', undefined);\n    var childBBox = childItem.getCanvasBBox();\n    if (childBBox.x && comboBBox.minX > childBBox.minX) comboBBox.minX = childBBox.minX;\n    if (childBBox.y && comboBBox.minY > childBBox.minY) comboBBox.minY = childBBox.minY;\n    if (childBBox.x && comboBBox.maxX < childBBox.maxX) comboBBox.maxX = childBBox.maxX;\n    if (childBBox.y && comboBBox.maxY < childBBox.maxY) comboBBox.maxY = childBBox.maxY;\n  });\n  comboBBox.x = (comboBBox.minX + comboBBox.maxX) / 2;\n  comboBBox.y = (comboBBox.minY + comboBBox.maxY) / 2;\n  comboBBox.width = comboBBox.maxX - comboBBox.minX;\n  comboBBox.height = comboBBox.maxY - comboBBox.minY;\n  comboBBox.centerX = (comboBBox.minX + comboBBox.maxX) / 2;\n  comboBBox.centerY = (comboBBox.minY + comboBBox.maxY) / 2;\n  Object.keys(comboBBox).forEach(function (key) {\n    if (comboBBox[key] === Infinity || comboBBox[key] === -Infinity) {\n      comboBBox[key] = undefined;\n    }\n  });\n  return comboBBox;\n};\nexport var shouldRefreshEdge = function shouldRefreshEdge(cfg) {\n  var refreshEdge = isNumber(cfg.x) || isNumber(cfg.y) || cfg.type || cfg.anchorPoints || cfg.size;\n  if (cfg.style) refreshEdge = refreshEdge || isNumber(cfg.style.r) || isNumber(cfg.style.width) || isNumber(cfg.style.height) || isNumber(cfg.style.rx) || isNumber(cfg.style.ry);\n  return refreshEdge;\n};\nexport var cloneBesidesImg = function cloneBesidesImg(obj) {\n  var clonedObj = {};\n  Object.keys(obj).forEach(function (key1) {\n    var obj2 = obj[key1];\n\n    if (isObject(obj2) && !isArray(obj2)) {\n      var clonedObj2_1 = {};\n      Object.keys(obj2).forEach(function (key2) {\n        var v = obj2[key2];\n        if (key2 === 'img' && !isString(v)) return;\n        clonedObj2_1[key2] = clone(v);\n      });\n      clonedObj[key1] = clonedObj2_1;\n    } else {\n      clonedObj[key1] = clone(obj2);\n    }\n  });\n  return clonedObj;\n};\nexport var getAnimateCfgWithCallback = function getAnimateCfgWithCallback(_a) {\n  var animateCfg = _a.animateCfg,\n      callback = _a.callback;\n  var animateConfig;\n\n  if (!animateCfg) {\n    animateConfig = {\n      duration: 500,\n      callback: callback\n    };\n  } else {\n    animateConfig = clone(animateCfg);\n\n    if (animateCfg.callback) {\n      var animateCfgCallback_1 = animateCfg.callback;\n\n      animateConfig.callback = function () {\n        callback();\n        animateCfgCallback_1();\n      };\n    } else {\n      animateConfig.callback = callback;\n    }\n  }\n\n  return animateConfig;\n};","map":{"version":3,"names":["__assign","vec2","Global","applyMatrix","letterAspectRatio","isString","clone","isNumber","isObject","isArray","PI","Math","sin","cos","SELF_LINK_SIN","SELF_LINK_COS","getBBox","element","group","bbox","leftTop","x","minX","y","minY","rightBottom","maxX","maxY","matrix","getMatrix","lx","ly","rx","ry","width","height","getLoopCfgs","cfg","item","sourceNode","targetNode","container","get","containerMatrix","keyShape","getKeyShape","loopCfg","dist","max","position","defaultLoopPosition","center","startPoint","endPoint","rstart","rend","sinDeltaStart","cosDeltaStart","sinDeltaEnd","cosDeltaEnd","clockwise","swap","startVec","scaleRateStart","scaleRateEnd","startExtendVec","scale","controlPoint1","endVec","endExtendVec","controlPoint2","controlPoints","getLabelPosition","pathShape","percent","refX","refY","rotate","TAN_OFFSET","vector","point","getPoint","angle","getStartTangent","reverse","getEndTangent","offsetPoint","push","rad","atan2","normal","result","traverse","data","fn","children","i","length","traverseUp","traverseTree","traverseTreeUp","getLetterWidth","letter","fontSize","getTextSize","text","pattern","RegExp","split","forEach","test","truncateLabelByLength","substring","plainCombosToTrees","array","nodes","addedMap","modelMap","d","id","cd","itemType","undefined","parentId","console","warn","concat","mappedObj","mappedParent","parent_1","parent_2","pa","nodeMap","node","combo","comboId","cnode","maxDepth","tree","depth","child","parent","oriNodeModel","reconstructTree","trees","subtreeId","newParentId","_a","brothers","subtree","comboChildsMap","root","foundSubTree","oldParentId","removed","index","indexOf","splice","found_1","newParentDepth_1","currentDepth_1","getComboBBox","graph","comboBBox","Infinity","centerX","centerY","comboModel","getModel","childItem","findById","isVisible","set","childBBox","getCanvasBBox","Object","keys","key","shouldRefreshEdge","refreshEdge","type","anchorPoints","size","style","r","cloneBesidesImg","obj","clonedObj","key1","obj2","clonedObj2_1","key2","v","getAnimateCfgWithCallback","animateCfg","callback","animateConfig","duration","animateCfgCallback_1"],"sources":["/Users/wawalike/Desktop/ggProject/node_modules/@antv/g6-core/es/util/graphic.js"],"sourcesContent":["import { __assign } from \"tslib\";\nimport { vec2 } from '@antv/matrix-util';\nimport Global from '../global';\nimport { applyMatrix } from './math';\nimport letterAspectRatio from './letterAspectRatio';\nimport { isString, clone, isNumber, isObject, isArray } from '@antv/util';\nvar PI = Math.PI,\n    sin = Math.sin,\n    cos = Math.cos; // 一共支持8个方向的自环，每个环占的角度是45度，在计算时再二分，为22.5度\n\nvar SELF_LINK_SIN = sin(PI / 8);\nvar SELF_LINK_COS = cos(PI / 8);\nexport var getBBox = function getBBox(element, group) {\n  var bbox = element.getBBox();\n  var leftTop = {\n    x: bbox.minX,\n    y: bbox.minY\n  };\n  var rightBottom = {\n    x: bbox.maxX,\n    y: bbox.maxY\n  }; // 根据父元素变换矩阵\n\n  if (group) {\n    var matrix = group.getMatrix();\n\n    if (!matrix) {\n      matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    leftTop = applyMatrix(leftTop, matrix);\n    rightBottom = applyMatrix(rightBottom, matrix);\n  }\n\n  var lx = leftTop.x,\n      ly = leftTop.y;\n  var rx = rightBottom.x,\n      ry = rightBottom.y;\n  return {\n    x: lx,\n    y: ly,\n    minX: lx,\n    minY: ly,\n    maxX: rx,\n    maxY: ry,\n    width: rx - lx,\n    height: ry - ly\n  };\n};\n/**\n * get loop edge config\n * @param cfg edge config\n */\n\nexport var getLoopCfgs = function getLoopCfgs(cfg) {\n  var item = cfg.sourceNode || cfg.targetNode;\n  var container = item.get('group');\n  var containerMatrix = container.getMatrix();\n  if (!containerMatrix) containerMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n  var keyShape = item.getKeyShape();\n  var bbox = keyShape.getBBox();\n  var loopCfg = cfg.loopCfg || {}; // 距离keyShape边的最高距离\n\n  var dist = loopCfg.dist || Math.max(bbox.width, bbox.height) * 2; // 自环边与keyShape的相对位置关系\n\n  var position = loopCfg.position || Global.defaultLoopPosition; // 中心取group上真实位置\n\n  var center = [containerMatrix[6], containerMatrix[7]];\n  var startPoint = [cfg.startPoint.x, cfg.startPoint.y];\n  var endPoint = [cfg.endPoint.x, cfg.endPoint.y];\n  var rstart = bbox.height / 2;\n  var rend = bbox.height / 2;\n  var sinDeltaStart = rstart * SELF_LINK_SIN;\n  var cosDeltaStart = rstart * SELF_LINK_COS;\n  var sinDeltaEnd = rend * SELF_LINK_SIN;\n  var cosDeltaEnd = rend * SELF_LINK_COS; // 如果定义了锚点的，直接用锚点坐标，否则，根据自环的 cfg 计算\n\n  if (startPoint[0] === endPoint[0] && startPoint[1] === endPoint[1]) {\n    switch (position) {\n      case 'top':\n        startPoint = [center[0] - sinDeltaStart, center[1] - cosDeltaStart];\n        endPoint = [center[0] + sinDeltaEnd, center[1] - cosDeltaEnd];\n        break;\n\n      case 'top-right':\n        rstart = bbox.height / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + sinDeltaStart, center[1] - cosDeltaStart];\n        endPoint = [center[0] + cosDeltaEnd, center[1] - sinDeltaEnd];\n        break;\n\n      case 'right':\n        rstart = bbox.width / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + cosDeltaStart, center[1] - sinDeltaStart];\n        endPoint = [center[0] + cosDeltaEnd, center[1] + sinDeltaEnd];\n        break;\n\n      case 'bottom-right':\n        rstart = bbox.width / 2;\n        rend = bbox.height / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + cosDeltaStart, center[1] + sinDeltaStart];\n        endPoint = [center[0] + sinDeltaEnd, center[1] + cosDeltaEnd];\n        break;\n\n      case 'bottom':\n        rstart = bbox.height / 2;\n        rend = bbox.height / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] + sinDeltaStart, center[1] + cosDeltaStart];\n        endPoint = [center[0] - sinDeltaEnd, center[1] + cosDeltaEnd];\n        break;\n\n      case 'bottom-left':\n        rstart = bbox.height / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - sinDeltaStart, center[1] + cosDeltaStart];\n        endPoint = [center[0] - cosDeltaEnd, center[1] + sinDeltaEnd];\n        break;\n\n      case 'left':\n        rstart = bbox.width / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - cosDeltaStart, center[1] + sinDeltaStart];\n        endPoint = [center[0] - cosDeltaEnd, center[1] - sinDeltaEnd];\n        break;\n\n      case 'top-left':\n        rstart = bbox.width / 2;\n        rend = bbox.height / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - cosDeltaStart, center[1] - sinDeltaStart];\n        endPoint = [center[0] - sinDeltaEnd, center[1] - cosDeltaEnd];\n        break;\n\n      default:\n        rstart = bbox.width / 2;\n        rend = bbox.width / 2;\n        sinDeltaStart = rstart * SELF_LINK_SIN;\n        cosDeltaStart = rstart * SELF_LINK_COS;\n        sinDeltaEnd = rend * SELF_LINK_SIN;\n        cosDeltaEnd = rend * SELF_LINK_COS;\n        startPoint = [center[0] - sinDeltaStart, center[1] - cosDeltaStart];\n        endPoint = [center[0] + sinDeltaEnd, center[1] - cosDeltaEnd];\n    } // 如果逆时针画，交换起点和终点\n\n\n    if (loopCfg.clockwise === false) {\n      var swap = [startPoint[0], startPoint[1]];\n      startPoint = [endPoint[0], endPoint[1]];\n      endPoint = [swap[0], swap[1]];\n    }\n  }\n\n  var startVec = [startPoint[0] - center[0], startPoint[1] - center[1]];\n  var scaleRateStart = (rstart + dist) / rstart;\n  var scaleRateEnd = (rend + dist) / rend;\n\n  if (loopCfg.clockwise === false) {\n    scaleRateStart = (rend + dist) / rend;\n    scaleRateEnd = (rstart + dist) / rstart;\n  }\n\n  var startExtendVec = vec2.scale([0, 0], startVec, scaleRateStart);\n  var controlPoint1 = [center[0] + startExtendVec[0], center[1] + startExtendVec[1]];\n  var endVec = [endPoint[0] - center[0], endPoint[1] - center[1]];\n  var endExtendVec = vec2.scale([0, 0], endVec, scaleRateEnd);\n  var controlPoint2 = [center[0] + endExtendVec[0], center[1] + endExtendVec[1]];\n  cfg.startPoint = {\n    x: startPoint[0],\n    y: startPoint[1]\n  };\n  cfg.endPoint = {\n    x: endPoint[0],\n    y: endPoint[1]\n  };\n  cfg.controlPoints = [{\n    x: controlPoint1[0],\n    y: controlPoint1[1]\n  }, {\n    x: controlPoint2[0],\n    y: controlPoint2[1]\n  }];\n  return cfg;\n};\n/**\n * 根据 label 所在线条的位置百分比，计算 label 坐标\n * @param {object}  pathShape  G 的 path 实例，一般是 Edge 实例的 keyShape\n * @param {number}  percent    范围 0 - 1 的线条百分比\n * @param {number}  refX     x 轴正方向为基准的 label 偏移\n * @param {number}  refY     y 轴正方向为基准的 label 偏移\n * @param {boolean} rotate     是否根据线条斜率旋转文本\n * @return {object} 文本的 x, y, 文本的旋转角度\n */\n\nexport var getLabelPosition = function getLabelPosition(pathShape, percent, refX, refY, rotate) {\n  var TAN_OFFSET = 0.0001;\n  var vector = [];\n  var point = pathShape === null || pathShape === void 0 ? void 0 : pathShape.getPoint(percent);\n\n  if (!point) {\n    return {\n      x: 0,\n      y: 0,\n      angle: 0\n    };\n  } // 头尾最可能，放在最前面，使用 g path 上封装的方法\n\n\n  if (percent < TAN_OFFSET) {\n    vector = pathShape.getStartTangent().reverse();\n  } else if (percent > 1 - TAN_OFFSET) {\n    vector = pathShape.getEndTangent();\n  } else {\n    // 否则取指定位置的点,与少量偏移的点，做微分向量\n    var offsetPoint = pathShape === null || pathShape === void 0 ? void 0 : pathShape.getPoint(percent + TAN_OFFSET);\n    vector.push([point.x, point.y]);\n    vector.push([offsetPoint.x, offsetPoint.y]);\n  }\n\n  var rad = Math.atan2(vector[1][1] - vector[0][1], vector[1][0] - vector[0][0]);\n\n  if (rad < 0) {\n    rad += PI * 2;\n  }\n\n  if (refX) {\n    point.x += cos(rad) * refX;\n    point.y += sin(rad) * refX;\n  }\n\n  if (refY) {\n    // 默认方向是 x 轴正方向，法线是 求出角度 - 90°\n    var normal = rad - PI / 2; // 若法线角度在 y 轴负方向，切到正方向，保证 refY 相对于 y 轴正方向\n\n    if (rad > 1 / 2 * PI && rad < 3 * 1 / 2 * PI) {\n      normal -= PI;\n    }\n\n    point.x += cos(normal) * refY;\n    point.y += sin(normal) * refY;\n  }\n\n  var result = {\n    x: point.x,\n    y: point.y,\n    angle: rad\n  };\n\n  if (rotate) {\n    if (rad > 0.5 * PI && rad < 1.5 * PI) {\n      rad -= PI;\n    }\n\n    return __assign({\n      rotate: rad\n    }, result);\n  }\n\n  return result;\n};\n/**\n * depth first traverse, from root to leaves, children in inverse order\n *  if the fn returns false, terminate the traverse\n */\n\nvar traverse = function traverse(data, fn) {\n  if (fn(data) === false) {\n    return false;\n  }\n\n  if (data && data.children) {\n    for (var i = data.children.length - 1; i >= 0; i--) {\n      if (!traverse(data.children[i], fn)) return false;\n    }\n  }\n\n  return true;\n};\n/**\n * depth first traverse, from leaves to root, children in inverse order\n *  if the fn returns false, terminate the traverse\n */\n\n\nvar traverseUp = function traverseUp(data, fn) {\n  if (data && data.children) {\n    for (var i = data.children.length - 1; i >= 0; i--) {\n      if (!traverseUp(data.children[i], fn)) return;\n    }\n  }\n\n  if (fn(data) === false) {\n    return false;\n  }\n\n  return true;\n};\n/**\n * depth first traverse, from root to leaves, children in inverse order\n *  if the fn returns false, terminate the traverse\n */\n\n\nexport var traverseTree = function traverseTree(data, fn) {\n  if (typeof fn !== 'function') {\n    return;\n  }\n\n  traverse(data, fn);\n};\n/**\n * depth first traverse, from leaves to root, children in inverse order\n * if the fn returns false, terminate the traverse\n */\n\nexport var traverseTreeUp = function traverseTreeUp(data, fn) {\n  if (typeof fn !== 'function') {\n    return;\n  }\n\n  traverseUp(data, fn);\n};\n/**\n *\n * @param letter the letter\n * @param fontSize\n * @return the letter's width\n */\n\nexport var getLetterWidth = function getLetterWidth(letter, fontSize) {\n  return fontSize * (letterAspectRatio[letter] || 1);\n};\n/**\n *\n * @param text the text\n * @param fontSize\n * @return the text's size\n */\n\nexport var getTextSize = function getTextSize(text, fontSize) {\n  var width = 0;\n  var pattern = new RegExp(\"[\\u4E00-\\u9FA5]+\");\n  text.split('').forEach(function (letter) {\n    if (pattern.test(letter)) {\n      // 中文字符\n      width += fontSize;\n    } else {\n      width += getLetterWidth(letter, fontSize);\n    }\n  });\n  return [width, fontSize];\n};\nexport var truncateLabelByLength = function truncateLabelByLength(text, length) {\n  if (typeof length !== 'number' || length <= 0 || length >= text.length) {\n    return text;\n  }\n\n  return text.substring(0, length) + '...';\n};\n/**\n * construct the trees from combos data\n * @param array the combos array\n * @param nodes the nodes array\n * @return the tree\n */\n\nexport var plainCombosToTrees = function plainCombosToTrees(array, nodes) {\n  var result = [];\n  var addedMap = {};\n  var modelMap = {};\n  array.forEach(function (d) {\n    modelMap[d.id] = d;\n  });\n  array.forEach(function (d, i) {\n    var cd = clone(d);\n    cd.itemType = 'combo';\n    cd.children = undefined;\n\n    if (cd.parentId === cd.id) {\n      console.warn(\"The parentId for combo \".concat(cd.id, \" can not be the same as the combo's id\"));\n      delete cd.parentId;\n    } else if (cd.parentId && !modelMap[cd.parentId]) {\n      console.warn(\"The parent combo for combo \".concat(cd.id, \" does not exist!\"));\n      delete cd.parentId;\n    }\n\n    var mappedObj = addedMap[cd.id];\n\n    if (mappedObj) {\n      cd.children = mappedObj.children;\n      addedMap[cd.id] = cd;\n      mappedObj = cd;\n\n      if (!mappedObj.parentId) {\n        result.push(mappedObj);\n        return;\n      }\n\n      var mappedParent = addedMap[mappedObj.parentId];\n\n      if (mappedParent) {\n        if (mappedParent.children) mappedParent.children.push(cd);else mappedParent.children = [cd];\n      } else {\n        var parent_1 = {\n          id: mappedObj.parentId,\n          children: [mappedObj]\n        };\n        addedMap[mappedObj.parentId] = parent_1;\n        addedMap[cd.id] = cd;\n      }\n\n      return;\n    }\n\n    if (isString(d.parentId)) {\n      var parent_2 = addedMap[d.parentId];\n\n      if (parent_2) {\n        if (parent_2.children) parent_2.children.push(cd);else parent_2.children = [cd];\n        addedMap[cd.id] = cd;\n      } else {\n        var pa = {\n          id: d.parentId,\n          children: [cd]\n        };\n        addedMap[pa.id] = pa;\n        addedMap[cd.id] = cd;\n      }\n    } else {\n      result.push(cd);\n      addedMap[cd.id] = cd;\n    }\n  }); // proccess the nodes\n\n  var nodeMap = {};\n  (nodes || []).forEach(function (node) {\n    nodeMap[node.id] = node;\n    var combo = addedMap[node.comboId];\n\n    if (combo) {\n      var cnode = {\n        id: node.id,\n        comboId: node.comboId\n      };\n      if (combo.children) combo.children.push(cnode);else combo.children = [cnode];\n      cnode.itemType = 'node';\n      addedMap[node.id] = cnode;\n    }\n  }); // assign the depth for each element\n\n  var maxDepth = 0;\n  result.forEach(function (tree) {\n    tree.depth = maxDepth + 10;\n    traverse(tree, function (child) {\n      var parent;\n      var itemType = addedMap[child.id].itemType;\n\n      if (itemType === 'node') {\n        parent = addedMap[child.comboId];\n      } else {\n        parent = addedMap[child.parentId];\n      }\n\n      if (parent) {\n        if (itemType === 'node') child.depth = maxDepth + 1;else child.depth = maxDepth + 10;\n      } else {\n        child.depth = maxDepth + 10;\n      }\n\n      if (maxDepth < child.depth) maxDepth = child.depth;\n      var oriNodeModel = nodeMap[child.id];\n\n      if (oriNodeModel) {\n        oriNodeModel.depth = child.depth;\n      }\n\n      return true;\n    });\n  });\n  return result;\n};\nexport var reconstructTree = function reconstructTree(trees, subtreeId, newParentId) {\n  var _a;\n\n  var brothers = trees;\n  var subtree;\n  var comboChildsMap = {\n    root: {\n      children: trees\n    }\n  };\n  var foundSubTree = false;\n  var oldParentId = 'root';\n  (trees || []).forEach(function (tree) {\n    if (foundSubTree) return;\n\n    if (tree.id === subtreeId) {\n      subtree = tree;\n\n      if (tree.itemType === 'combo') {\n        subtree.parentId = newParentId;\n      } else {\n        subtree.comboId = newParentId;\n      }\n\n      foundSubTree = true;\n      return;\n    }\n\n    traverseTree(tree, function (child) {\n      var _a;\n\n      comboChildsMap[child.id] = {\n        children: (child === null || child === void 0 ? void 0 : child.children) || []\n      }; // store the old parent id to delete the subtree from the old parent's children in next recursion\n\n      brothers = (_a = comboChildsMap[child.parentId || child.comboId || 'root']) === null || _a === void 0 ? void 0 : _a.children;\n\n      if (child && (child.removed || subtreeId === child.id) && brothers) {\n        oldParentId = child.parentId || child.comboId || 'root';\n        subtree = child; // re-assign the parentId or comboId for the moved subtree\n\n        if (child.itemType === 'combo') {\n          subtree.parentId = newParentId;\n        } else {\n          subtree.comboId = newParentId;\n        }\n\n        foundSubTree = true;\n        return false;\n      }\n\n      return true;\n    });\n  });\n  brothers = (_a = comboChildsMap[oldParentId]) === null || _a === void 0 ? void 0 : _a.children;\n  var index = brothers ? brothers.indexOf(subtree) : -1;\n  if (index > -1) brothers.splice(index, 1); // 如果遍历完整棵树还没有找到，说明之前就不在树中\n\n  if (!foundSubTree) {\n    subtree = {\n      id: subtreeId,\n      itemType: 'node',\n      comboId: newParentId\n    };\n    comboChildsMap[subtreeId] = {\n      children: undefined\n    };\n  } // append to new parent\n\n\n  if (subtreeId) {\n    var found_1 = false; // newParentId is undefined means the subtree will have no parent\n\n    if (newParentId) {\n      var newParentDepth_1 = 0;\n      (trees || []).forEach(function (tree) {\n        if (found_1) return; // terminate\n\n        traverseTree(tree, function (child) {\n          // append subtree to the new parent ans assign the depth to the subtree\n          if (newParentId === child.id) {\n            found_1 = true;\n            if (child.children) child.children.push(subtree);else child.children = [subtree];\n            newParentDepth_1 = child.depth;\n            if (subtree.itemType === 'node') subtree.depth = newParentDepth_1 + 2;else subtree.depth = newParentDepth_1 + 1;\n            return false; // terminate\n          }\n\n          return true;\n        });\n      });\n    } else if ((!newParentId || !found_1) && subtree.itemType !== 'node') {\n      // if the newParentId is undefined or it is not found in the tree, add the subTree to the root\n      trees.push(subtree);\n    } // update the depth of the subtree and its children from the subtree\n\n\n    var currentDepth_1 = subtree.depth;\n    traverseTree(subtree, function (child) {\n      if (child.itemType === 'node') currentDepth_1 += 2;else currentDepth_1 += 1;\n      child.depth = currentDepth_1;\n      return true;\n    });\n  }\n\n  return trees;\n};\nexport var getComboBBox = function getComboBBox(children, graph, combo) {\n  var comboBBox = {\n    minX: Infinity,\n    minY: Infinity,\n    maxX: -Infinity,\n    maxY: -Infinity,\n    x: undefined,\n    y: undefined,\n    width: undefined,\n    height: undefined,\n    centerX: undefined,\n    centerY: undefined\n  };\n\n  if (!children || children.length === 0) {\n    var comboModel = combo === null || combo === void 0 ? void 0 : combo.getModel();\n\n    var _a = comboModel || {},\n        x = _a.x,\n        y = _a.y;\n\n    return {\n      minX: x,\n      minY: y,\n      maxX: x,\n      maxY: y,\n      x: x,\n      y: y,\n      width: undefined,\n      height: undefined\n    };\n  }\n\n  children.forEach(function (child) {\n    var childItem = graph.findById(child.id);\n    if (!childItem || !childItem.isVisible()) return; // ignore hidden children\n\n    childItem.set('bboxCanvasCache', undefined);\n    var childBBox = childItem.getCanvasBBox();\n    if (childBBox.x && comboBBox.minX > childBBox.minX) comboBBox.minX = childBBox.minX;\n    if (childBBox.y && comboBBox.minY > childBBox.minY) comboBBox.minY = childBBox.minY;\n    if (childBBox.x && comboBBox.maxX < childBBox.maxX) comboBBox.maxX = childBBox.maxX;\n    if (childBBox.y && comboBBox.maxY < childBBox.maxY) comboBBox.maxY = childBBox.maxY;\n  });\n  comboBBox.x = (comboBBox.minX + comboBBox.maxX) / 2;\n  comboBBox.y = (comboBBox.minY + comboBBox.maxY) / 2;\n  comboBBox.width = comboBBox.maxX - comboBBox.minX;\n  comboBBox.height = comboBBox.maxY - comboBBox.minY;\n  comboBBox.centerX = (comboBBox.minX + comboBBox.maxX) / 2;\n  comboBBox.centerY = (comboBBox.minY + comboBBox.maxY) / 2;\n  Object.keys(comboBBox).forEach(function (key) {\n    if (comboBBox[key] === Infinity || comboBBox[key] === -Infinity) {\n      comboBBox[key] = undefined;\n    }\n  });\n  return comboBBox;\n};\nexport var shouldRefreshEdge = function shouldRefreshEdge(cfg) {\n  var refreshEdge = isNumber(cfg.x) || isNumber(cfg.y) || cfg.type || cfg.anchorPoints || cfg.size;\n  if (cfg.style) refreshEdge = refreshEdge || isNumber(cfg.style.r) || isNumber(cfg.style.width) || isNumber(cfg.style.height) || isNumber(cfg.style.rx) || isNumber(cfg.style.ry);\n  return refreshEdge;\n};\nexport var cloneBesidesImg = function cloneBesidesImg(obj) {\n  var clonedObj = {};\n  Object.keys(obj).forEach(function (key1) {\n    var obj2 = obj[key1];\n\n    if (isObject(obj2) && !isArray(obj2)) {\n      var clonedObj2_1 = {};\n      Object.keys(obj2).forEach(function (key2) {\n        var v = obj2[key2];\n        if (key2 === 'img' && !isString(v)) return;\n        clonedObj2_1[key2] = clone(v);\n      });\n      clonedObj[key1] = clonedObj2_1;\n    } else {\n      clonedObj[key1] = clone(obj2);\n    }\n  });\n  return clonedObj;\n};\nexport var getAnimateCfgWithCallback = function getAnimateCfgWithCallback(_a) {\n  var animateCfg = _a.animateCfg,\n      callback = _a.callback;\n  var animateConfig;\n\n  if (!animateCfg) {\n    animateConfig = {\n      duration: 500,\n      callback: callback\n    };\n  } else {\n    animateConfig = clone(animateCfg);\n\n    if (animateCfg.callback) {\n      var animateCfgCallback_1 = animateCfg.callback;\n\n      animateConfig.callback = function () {\n        callback();\n        animateCfgCallback_1();\n      };\n    } else {\n      animateConfig.callback = callback;\n    }\n  }\n\n  return animateConfig;\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}