{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { Dom, Vector } from '../../util';\nimport { View } from '../../view/view';\nimport { Point, Angle } from '../../geometry';\nexport class Handle {\n  get handleClassName() {\n    return ClassNames.handle;\n  }\n\n  get pie() {\n    return Object.assign(Object.assign({}, Handle.defaultPieOptions), this.handleOptions.pie);\n  }\n\n  initHandles() {\n    this.handles = [];\n\n    if (this.handleOptions.handles) {\n      this.handleOptions.handles.forEach(handle => this.addHandle(handle));\n    }\n\n    if (this.handleOptions.type === 'pie') {\n      if (this.pie.toggles) {\n        const className = ClassNames.pieToggle;\n        this.$pieToggles = {};\n        this.pie.toggles.forEach(item => {\n          const $elem = this.$('<div/>');\n          this.applyAttrs($elem, item.attrs);\n          $elem.addClass(className).addClass(`${className}-pos-${item.position || 'e'}`).attr('data-name', item.name).appendTo(this.container);\n          this.$pieToggles[item.name] = $elem;\n        });\n      }\n\n      this.setPieIcons();\n    }\n\n    if (this.$handleContainer) {\n      const type = this.handleOptions.type || 'surround';\n      this.$handleContainer.addClass(ClassNames.wrap).addClass(ClassNames.animate).addClass(`${ClassNames.handle}-${type}`);\n    }\n\n    this.delegateEvents({\n      [`mousedown .${ClassNames.handle}`]: 'onHandleMouseDown',\n      [`touchstart .${ClassNames.handle}`]: 'onHandleMouseDown',\n      [`mousedown .${ClassNames.pieToggle}`]: 'onPieToggleMouseDown',\n      [`touchstart .${ClassNames.pieToggle}`]: 'onPieToggleMouseDown'\n    });\n  }\n\n  onHandleMouseDown(evt) {\n    const action = this.$(evt.currentTarget).closest(`.${ClassNames.handle}`).attr('data-action');\n\n    if (action) {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.setEventData(evt, {\n        action,\n        clientX: evt.clientX,\n        clientY: evt.clientY,\n        startX: evt.clientX,\n        startY: evt.clientY\n      });\n\n      if (evt.type === 'mousedown' && evt.button === 2) {\n        this.triggerHandleAction(action, 'contextmenu', evt);\n      } else {\n        this.triggerHandleAction(action, 'mousedown', evt);\n        this.delegateDocumentEvents({\n          mousemove: 'onHandleMouseMove',\n          touchmove: 'onHandleMouseMove',\n          mouseup: 'onHandleMouseUp',\n          touchend: 'onHandleMouseUp',\n          touchcancel: 'onHandleMouseUp'\n        }, evt.data);\n      }\n    }\n  }\n\n  onHandleMouseMove(evt) {\n    const data = this.getEventData(evt);\n    const action = data.action;\n\n    if (action) {\n      this.triggerHandleAction(action, 'mousemove', evt);\n    }\n  }\n\n  onHandleMouseUp(evt) {\n    const data = this.getEventData(evt);\n    const action = data.action;\n\n    if (action) {\n      this.triggerHandleAction(action, 'mouseup', evt);\n      this.undelegateDocumentEvents();\n    }\n  }\n\n  triggerHandleAction(action, eventName, evt, args) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    const e = this.normalizeEvent(evt);\n    const data = this.getEventData(e);\n    const local = this.graph.snapToGrid(e.clientX, e.clientY);\n    const origin = this.graph.snapToGrid(data.clientX, data.clientY);\n    const dx = local.x - origin.x;\n    const dy = local.y - origin.y;\n    this.trigger(`action:${action}:${eventName}`, Object.assign({\n      e,\n      dx,\n      dy,\n      x: local.x,\n      y: local.y,\n      offsetX: evt.clientX - data.startX,\n      offsetY: evt.clientY - data.startY\n    }, args));\n    data.clientX = evt.clientX;\n    data.clientY = evt.clientY;\n  }\n\n  onPieToggleMouseDown(evt) {\n    evt.stopPropagation();\n    const name = this.$(evt.target).closest(`.${ClassNames.pieToggle}`).attr('data-name');\n\n    if (!this.isOpen(name)) {\n      if (this.isOpen()) {\n        this.toggleState();\n      }\n    }\n\n    this.toggleState(name);\n  }\n\n  setPieIcons() {\n    if (this.handleOptions.type === 'pie') {\n      this.$handleContainer.find(`.${ClassNames.handle}`).each((_, elem) => {\n        const $elem = this.$(elem);\n        const action = $elem.attr('data-action');\n        const className = ClassNames.pieSlice;\n        const handle = this.getHandle(action);\n\n        if (!handle || !handle.icon) {\n          const contect = window.getComputedStyle(elem, ':before').getPropertyValue('content');\n\n          if (contect && contect !== 'none') {\n            const $icons = $elem.find(`.${className}-txt`);\n\n            if ($icons.length) {\n              Vector.create($icons[0]).text(contect.replace(/['\"]/g, ''));\n            }\n          }\n\n          const bgImg = $elem.css('background-image');\n\n          if (bgImg) {\n            const matches = bgImg.match(/url\\(['\"]?([^'\"]+)['\"]?\\)/);\n\n            if (matches) {\n              const href = matches[1];\n              const $imgs = $elem.find(`.${className}-img`);\n\n              if ($imgs.length > 0) {\n                Vector.create($imgs[0]).attr('xlink:href', href);\n              }\n            }\n          }\n        }\n      });\n    }\n  }\n\n  getHandleIdx(name) {\n    return this.handles.findIndex(item => item.name === name);\n  }\n\n  hasHandle(name) {\n    return this.getHandleIdx(name) >= 0;\n  }\n\n  getHandle(name) {\n    return this.handles.find(item => item.name === name);\n  }\n\n  renderHandle(handle) {\n    const $handle = this.$('<div/>').addClass(`${ClassNames.handle} ${ClassNames.handle}-${handle.name}`).attr('data-action', handle.name).prop('draggable', false);\n\n    if (this.handleOptions.type === 'pie') {\n      const index = this.getHandleIdx(handle.name);\n      const pie = this.pie;\n      const outerRadius = pie.outerRadius;\n      const innerRadius = pie.innerRadius;\n      const offset = (outerRadius + innerRadius) / 2;\n      const ratio = new Point(outerRadius, outerRadius);\n      const delta = Angle.toRad(pie.sliceAngle);\n      const curRad = index * delta + Angle.toRad(pie.startAngle);\n      const nextRad = curRad + delta;\n      const pathData = Dom.createSlicePathData(innerRadius, outerRadius, curRad, nextRad);\n      const vSvg = Vector.create('svg').addClass(`${ClassNames.pieSlice}-svg`);\n      const vPath = Vector.create('path').addClass(ClassNames.pieSlice).attr('d', pathData).translate(outerRadius, outerRadius);\n      const pos = Point.fromPolar(offset, -curRad - delta / 2, ratio).toJSON();\n      const iconSize = pie.iconSize;\n      const vImg = Vector.create('image').attr(pos).addClass(`${ClassNames.pieSlice}-img`);\n      pos.y = pos.y + iconSize - 2;\n      const vText = Vector.create('text', {\n        'font-size': iconSize\n      }).attr(pos).addClass(`${ClassNames.pieSlice}-txt`);\n      vImg.attr({\n        width: iconSize,\n        height: iconSize\n      });\n      vImg.translate(-iconSize / 2, -iconSize / 2);\n      vText.translate(-iconSize / 2, -iconSize / 2);\n      vSvg.append([vPath, vImg, vText]);\n      $handle.append(vSvg.node);\n    } else {\n      $handle.addClass(`${ClassNames.handle}-pos-${handle.position}`);\n\n      if (handle.content) {\n        if (typeof handle.content === 'string') {\n          $handle.html(handle.content);\n        } else {\n          $handle.append(handle.content);\n        }\n      }\n    }\n\n    this.updateHandleIcon($handle, handle.icon);\n    this.applyAttrs($handle, handle.attrs);\n    return $handle;\n  }\n\n  addHandle(handle) {\n    if (!this.hasHandle(handle.name)) {\n      this.handles.push(handle);\n      const events = handle.events;\n\n      if (events) {\n        Object.keys(events).forEach(action => {\n          const callback = events[action];\n          const name = `action:${handle.name}:${action}`;\n\n          if (typeof callback === 'string') {\n            this.on(name, this[callback], this);\n          } else {\n            this.on(name, callback);\n          }\n        });\n      }\n\n      if (this.$handleContainer) {\n        this.$handleContainer.append(this.renderHandle(handle));\n      }\n    }\n\n    return this;\n  }\n\n  addHandles(handles) {\n    handles.forEach(handle => this.addHandle(handle));\n    return this;\n  }\n\n  removeHandles() {\n    while (this.handles.length) {\n      this.removeHandle(this.handles[0].name);\n    }\n\n    return this;\n  }\n\n  removeHandle(name) {\n    const index = this.getHandleIdx(name);\n    const handle = this.handles[index];\n\n    if (handle) {\n      if (handle.events) {\n        Object.keys(handle.events).forEach(event => {\n          this.off(`action:${name}:${event}`);\n        });\n      }\n\n      this.getHandleElem(name).remove();\n      this.handles.splice(index, 1);\n    }\n\n    return this;\n  }\n\n  changeHandle(name, newHandle) {\n    const handle = this.getHandle(name);\n\n    if (handle) {\n      this.removeHandle(name);\n      this.addHandle(Object.assign(Object.assign({}, handle), newHandle));\n    }\n\n    return this;\n  }\n\n  toggleHandle(name, selected) {\n    const handle = this.getHandle(name);\n\n    if (handle) {\n      const $handle = this.getHandleElem(name);\n      const className = `${ClassNames.handle}-selected`;\n\n      if (selected === undefined) {\n        selected = !$handle.hasClass(className); // eslint-disable-line\n      }\n\n      $handle.toggleClass(className, selected);\n      const icon = selected ? handle.iconSelected : handle.icon;\n\n      if (icon) {\n        this.updateHandleIcon($handle, icon);\n      }\n    }\n\n    return this;\n  }\n\n  selectHandle(name) {\n    return this.toggleHandle(name, true);\n  }\n\n  deselectHandle(name) {\n    return this.toggleHandle(name, false);\n  }\n\n  deselectAllHandles() {\n    this.handles.forEach(handle => this.deselectHandle(handle.name));\n    return this;\n  }\n\n  getHandleElem(name) {\n    return this.$handleContainer.find(`.${ClassNames.handle}-${name}`);\n  }\n\n  updateHandleIcon($handle, icon) {\n    if (this.handleOptions.type === 'pie') {\n      const $icons = $handle.find(`.${ClassNames.pieSliceImg}`);\n      this.$($icons[0]).attr('xlink:href', icon || '');\n    } else {\n      $handle.css('background-image', icon ? `url(${icon})` : '');\n    }\n  }\n\n  isRendered() {\n    return this.$handleContainer != null;\n  }\n\n  isOpen(name) {\n    if (this.isRendered()) {\n      return name ? this.$pieToggles[name].hasClass(ClassNames.pieToggleOpened) : this.$handleContainer.hasClass(`${ClassNames.pieOpended}`);\n    }\n\n    return false;\n  }\n\n  toggleState(name) {\n    if (this.isRendered()) {\n      const $handleContainer = this.$handleContainer;\n      Object.keys(this.$pieToggles).forEach(key => {\n        const $toggle = this.$pieToggles[key];\n        $toggle.removeClass(ClassNames.pieToggleOpened);\n      });\n\n      if (this.isOpen()) {\n        this.trigger('pie:close', {\n          name\n        });\n        $handleContainer.removeClass(ClassNames.pieOpended);\n      } else {\n        this.trigger('pie:open', {\n          name\n        });\n\n        if (name) {\n          const toggles = this.pie.toggles;\n          const toggle = toggles && toggles.find(i => i.name === name);\n\n          if (toggle) {\n            $handleContainer.attr({\n              'data-pie-toggle-name': toggle.name,\n              'data-pie-toggle-position': toggle.position\n            });\n          }\n\n          this.$pieToggles[name].addClass(ClassNames.pieToggleOpened);\n        }\n\n        $handleContainer.addClass(ClassNames.pieOpended);\n      }\n    }\n  }\n\n  applyAttrs(elem, attrs) {\n    if (attrs) {\n      const $elem = View.$(elem);\n      Object.keys(attrs).forEach(selector => {\n        const $element = $elem.find(selector).addBack().filter(selector);\n\n        const _a = attrs[selector],\n              {\n          class: cls\n        } = _a,\n              attr = __rest(_a, [\"class\"]);\n\n        if (cls) {\n          $element.addClass(cls);\n        }\n\n        $element.attr(attr);\n      });\n    }\n  }\n\n}\n\n(function (Handle) {\n  Handle.defaultPieOptions = {\n    innerRadius: 20,\n    outerRadius: 50,\n    sliceAngle: 45,\n    startAngle: 0,\n    iconSize: 14,\n    toggles: [{\n      name: 'default',\n      position: 'e'\n    }]\n  };\n})(Handle || (Handle = {}));\n\nvar ClassNames;\n\n(function (ClassNames) {\n  ClassNames.handle = View.prototype.prefixClassName('widget-handle');\n  ClassNames.wrap = `${ClassNames.handle}-wrap`;\n  ClassNames.animate = `${ClassNames.handle}-animate`;\n  ClassNames.pieOpended = `${ClassNames.handle}-pie-opened`;\n  ClassNames.pieToggle = `${ClassNames.handle}-pie-toggle`;\n  ClassNames.pieToggleOpened = `${ClassNames.handle}-pie-toggle-opened`;\n  ClassNames.pieSlice = `${ClassNames.handle}-pie-slice`;\n  ClassNames.pieSliceImg = `${ClassNames.handle}-pie-slice-img`;\n})(ClassNames || (ClassNames = {}));","map":{"version":3,"mappings":";;;;;;;;;;;AAAA,SAASA,GAAT,EAAcC,MAAd,QAA4B,YAA5B;AACA,SAASC,IAAT,QAAqB,iBAArB;AAEA,SAASC,KAAT,EAAgBC,KAAhB,QAA6B,gBAA7B;AAEA,OAAM,MAAOC,MAAP,CAAa;EAOY,IAAfC,eAAe;IAC3B,OAAOC,UAAU,CAACC,MAAlB;EACD;;EAEgB,IAAHC,GAAG;IACf,uCACKJ,MAAM,CAACK,iBADZ,GAEK,KAAKC,aAAL,CAAmBF,GAFxB;EAID;;EAESG,WAAW;IACnB,KAAKC,OAAL,GAAe,EAAf;;IAEA,IAAI,KAAKF,aAAL,CAAmBE,OAAvB,EAAgC;MAC9B,KAAKF,aAAL,CAAmBE,OAAnB,CAA2BC,OAA3B,CAAoCN,MAAD,IAAY,KAAKO,SAAL,CAAeP,MAAf,CAA/C;IACD;;IAED,IAAI,KAAKG,aAAL,CAAmBK,IAAnB,KAA4B,KAAhC,EAAuC;MACrC,IAAI,KAAKP,GAAL,CAASQ,OAAb,EAAsB;QACpB,MAAMC,SAAS,GAAGX,UAAU,CAACY,SAA7B;QACA,KAAKC,WAAL,GAAmB,EAAnB;QACA,KAAKX,GAAL,CAASQ,OAAT,CAAiBH,OAAjB,CAA0BO,IAAD,IAAS;UAChC,MAAMC,KAAK,GAAG,KAAKC,CAAL,CAAO,QAAP,CAAd;UACA,KAAKC,UAAL,CAAgBF,KAAhB,EAAuBD,IAAI,CAACI,KAA5B;UACAH,KAAK,CACFI,QADH,CACYR,SADZ,EAEGQ,QAFH,CAEY,GAAGR,SAAS,QAAQG,IAAI,CAACM,QAAL,IAAiB,GAAG,EAFpD,EAGGC,IAHH,CAGQ,WAHR,EAGqBP,IAAI,CAACQ,IAH1B,EAIGC,QAJH,CAIY,KAAKC,SAJjB;UAKA,KAAKX,WAAL,CAAiBC,IAAI,CAACQ,IAAtB,IAA8BP,KAA9B;QACD,CATD;MAUD;;MAED,KAAKU,WAAL;IACD;;IAED,IAAI,KAAKC,gBAAT,EAA2B;MACzB,MAAMjB,IAAI,GAAG,KAAKL,aAAL,CAAmBK,IAAnB,IAA2B,UAAxC;MACA,KAAKiB,gBAAL,CACGP,QADH,CACYnB,UAAU,CAAC2B,IADvB,EAEGR,QAFH,CAEYnB,UAAU,CAAC4B,OAFvB,EAGGT,QAHH,CAGY,GAAGnB,UAAU,CAACC,MAAM,IAAIQ,IAAI,EAHxC;IAID;;IAED,KAAKoB,cAAL,CAAoB;MAClB,CAAC,cAAc7B,UAAU,CAACC,MAAM,EAAhC,GAAqC,mBADnB;MAElB,CAAC,eAAeD,UAAU,CAACC,MAAM,EAAjC,GAAsC,mBAFpB;MAGlB,CAAC,cAAcD,UAAU,CAACY,SAAS,EAAnC,GAAwC,sBAHtB;MAIlB,CAAC,eAAeZ,UAAU,CAACY,SAAS,EAApC,GAAyC;IAJvB,CAApB;EAMD;;EAESkB,iBAAiB,CAAsBC,GAAtB,EAAgD;IACzE,MAAMC,MAAM,GAAG,KAAKhB,CAAL,CAAOe,GAAG,CAACE,aAAX,EACZC,OADY,CACJ,IAAIlC,UAAU,CAACC,MAAM,EADjB,EAEZoB,IAFY,CAEP,aAFO,CAAf;;IAIA,IAAIW,MAAJ,EAAY;MACVD,GAAG,CAACI,cAAJ;MACAJ,GAAG,CAACK,eAAJ;MACA,KAAKC,YAAL,CAAoCN,GAApC,EAAyC;QACvCC,MADuC;QAEvCM,OAAO,EAAEP,GAAG,CAACO,OAF0B;QAGvCC,OAAO,EAAER,GAAG,CAACQ,OAH0B;QAIvCC,MAAM,EAAET,GAAG,CAACO,OAJ2B;QAKvCG,MAAM,EAAEV,GAAG,CAACQ;MAL2B,CAAzC;;MAQA,IAAIR,GAAG,CAACtB,IAAJ,KAAa,WAAb,IAA4BsB,GAAG,CAACW,MAAJ,KAAe,CAA/C,EAAkD;QAChD,KAAKC,mBAAL,CAAyBX,MAAzB,EAAiC,aAAjC,EAAgDD,GAAhD;MACD,CAFD,MAEO;QACL,KAAKY,mBAAL,CAAyBX,MAAzB,EAAiC,WAAjC,EAA8CD,GAA9C;QACA,KAAKa,sBAAL,CACE;UACEC,SAAS,EAAE,mBADb;UAEEC,SAAS,EAAE,mBAFb;UAGEC,OAAO,EAAE,iBAHX;UAIEC,QAAQ,EAAE,iBAJZ;UAKEC,WAAW,EAAE;QALf,CADF,EAQElB,GAAG,CAACmB,IARN;MAUD;IACF;EACF;;EAESC,iBAAiB,CAAsBpB,GAAtB,EAAgD;IACzE,MAAMmB,IAAI,GAAG,KAAKE,YAAL,CAAoCrB,GAApC,CAAb;IACA,MAAMC,MAAM,GAAGkB,IAAI,CAAClB,MAApB;;IACA,IAAIA,MAAJ,EAAY;MACV,KAAKW,mBAAL,CAAyBX,MAAzB,EAAiC,WAAjC,EAA8CD,GAA9C;IACD;EACF;;EAESsB,eAAe,CAAsBtB,GAAtB,EAA8C;IACrE,MAAMmB,IAAI,GAAG,KAAKE,YAAL,CAAoCrB,GAApC,CAAb;IACA,MAAMC,MAAM,GAAGkB,IAAI,CAAClB,MAApB;;IACA,IAAIA,MAAJ,EAAY;MACV,KAAKW,mBAAL,CAAyBX,MAAzB,EAAiC,SAAjC,EAA4CD,GAA5C;MACA,KAAKuB,wBAAL;IACD;EACF;;EAESX,mBAAmB,CAE3BX,MAF2B,EAG3BuB,SAH2B,EAI3BxB,GAJ2B,EAK3ByB,IAL2B,EAKjB;IAEVzB,GAAG,CAACI,cAAJ;IACAJ,GAAG,CAACK,eAAJ;IAEA,MAAMqB,CAAC,GAAG,KAAKC,cAAL,CAAoB3B,GAApB,CAAV;IACA,MAAMmB,IAAI,GAAG,KAAKE,YAAL,CAAoCK,CAApC,CAAb;IACA,MAAME,KAAK,GAAG,KAAKC,KAAL,CAAWC,UAAX,CAAsBJ,CAAC,CAACnB,OAAxB,EAAkCmB,CAAC,CAAClB,OAApC,CAAd;IACA,MAAMuB,MAAM,GAAG,KAAKF,KAAL,CAAWC,UAAX,CAAsBX,IAAI,CAACZ,OAA3B,EAAoCY,IAAI,CAACX,OAAzC,CAAf;IACA,MAAMwB,EAAE,GAAGJ,KAAK,CAACK,CAAN,GAAUF,MAAM,CAACE,CAA5B;IACA,MAAMC,EAAE,GAAGN,KAAK,CAACO,CAAN,GAAUJ,MAAM,CAACI,CAA5B;IAEA,KAAKC,OAAL,CAAa,UAAUnC,MAAM,IAAIuB,SAAS,EAA1C,EAA4Ca;MAC1CX,CAD0C;MAE1CM,EAF0C;MAG1CE,EAH0C;MAI1CD,CAAC,EAAEL,KAAK,CAACK,CAJiC;MAK1CE,CAAC,EAAEP,KAAK,CAACO,CALiC;MAM1CG,OAAO,EAAEtC,GAAG,CAACO,OAAJ,GAAeY,IAAI,CAACV,MANa;MAO1C8B,OAAO,EAAEvC,GAAG,CAACQ,OAAJ,GAAeW,IAAI,CAACT;IAPa,GAQvCe,IARuC,CAA5C;IAWAN,IAAI,CAACZ,OAAL,GAAeP,GAAG,CAACO,OAAnB;IACAY,IAAI,CAACX,OAAL,GAAeR,GAAG,CAACQ,OAAnB;EACD;;EAESgC,oBAAoB,CAE5BxC,GAF4B,EAEF;IAE1BA,GAAG,CAACK,eAAJ;IACA,MAAMd,IAAI,GAAG,KAAKN,CAAL,CAAOe,GAAG,CAACyC,MAAX,EACVtC,OADU,CACF,IAAIlC,UAAU,CAACY,SAAS,EADtB,EAEVS,IAFU,CAEL,WAFK,CAAb;;IAGA,IAAI,CAAC,KAAKoD,MAAL,CAAYnD,IAAZ,CAAL,EAAwB;MACtB,IAAI,KAAKmD,MAAL,EAAJ,EAAmB;QACjB,KAAKC,WAAL;MACD;IACF;;IACD,KAAKA,WAAL,CAAiBpD,IAAjB;EACD;;EAESG,WAAW;IACnB,IAAI,KAAKrB,aAAL,CAAmBK,IAAnB,KAA4B,KAAhC,EAAuC;MACrC,KAAKiB,gBAAL,CAAsBiD,IAAtB,CAA2B,IAAI3E,UAAU,CAACC,MAAM,EAAhD,EAAoD2E,IAApD,CAAyD,CAACC,CAAD,EAAIC,IAAJ,KAAY;QACnE,MAAM/D,KAAK,GAAG,KAAKC,CAAL,CAAO8D,IAAP,CAAd;QACA,MAAM9C,MAAM,GAAGjB,KAAK,CAACM,IAAN,CAAW,aAAX,CAAf;QACA,MAAMV,SAAS,GAAGX,UAAU,CAAC+E,QAA7B;QACA,MAAM9E,MAAM,GAAG,KAAK+E,SAAL,CAAehD,MAAf,CAAf;;QAEA,IAAI,CAAC/B,MAAD,IAAW,CAACA,MAAM,CAACgF,IAAvB,EAA6B;UAC3B,MAAMC,OAAO,GAAGC,MAAM,CACnBC,gBADa,CACIN,IADJ,EACU,SADV,EAEbO,gBAFa,CAEI,SAFJ,CAAhB;;UAGA,IAAIH,OAAO,IAAIA,OAAO,KAAK,MAA3B,EAAmC;YACjC,MAAMI,MAAM,GAAGvE,KAAK,CAAC4D,IAAN,CAAgB,IAAIhE,SAAS,MAA7B,CAAf;;YACA,IAAI2E,MAAM,CAACC,MAAX,EAAmB;cACjB7F,MAAM,CAAC8F,MAAP,CAAcF,MAAM,CAAC,CAAD,CAApB,EAAyBG,IAAzB,CAA8BP,OAAO,CAACQ,OAAR,CAAgB,OAAhB,EAAyB,EAAzB,CAA9B;YACD;UACF;;UAED,MAAMC,KAAK,GAAG5E,KAAK,CAAC6E,GAAN,CAAU,kBAAV,CAAd;;UACA,IAAID,KAAJ,EAAW;YACT,MAAME,OAAO,GAAGF,KAAK,CAACG,KAAN,CAAY,2BAAZ,CAAhB;;YACA,IAAID,OAAJ,EAAa;cACX,MAAME,IAAI,GAAGF,OAAO,CAAC,CAAD,CAApB;cACA,MAAMG,KAAK,GAAGjF,KAAK,CAAC4D,IAAN,CAAgB,IAAIhE,SAAS,MAA7B,CAAd;;cACA,IAAIqF,KAAK,CAACT,MAAN,GAAe,CAAnB,EAAsB;gBACpB7F,MAAM,CAAC8F,MAAP,CAAcQ,KAAK,CAAC,CAAD,CAAnB,EAAwB3E,IAAxB,CAA6B,YAA7B,EAA2C0E,IAA3C;cACD;YACF;UACF;QACF;MACF,CA7BD;IA8BD;EACF;;EAEDE,YAAY,CAAC3E,IAAD,EAAa;IACvB,OAAO,KAAKhB,OAAL,CAAa4F,SAAb,CAAwBpF,IAAD,IAAUA,IAAI,CAACQ,IAAL,KAAcA,IAA/C,CAAP;EACD;;EAED6E,SAAS,CAAC7E,IAAD,EAAa;IACpB,OAAO,KAAK2E,YAAL,CAAkB3E,IAAlB,KAA2B,CAAlC;EACD;;EAED0D,SAAS,CAAC1D,IAAD,EAAa;IACpB,OAAO,KAAKhB,OAAL,CAAaqE,IAAb,CAAmB7D,IAAD,IAAUA,IAAI,CAACQ,IAAL,KAAcA,IAA1C,CAAP;EACD;;EAED8E,YAAY,CAAsBnG,MAAtB,EAA6C;IACvD,MAAMoG,OAAO,GAAG,KAAKrF,CAAL,CAAO,QAAP,EACbG,QADa,CACJ,GAAGnB,UAAU,CAACC,MAAM,IAAID,UAAU,CAACC,MAAM,IAAIA,MAAM,CAACqB,IAAI,EADpD,EAEbD,IAFa,CAER,aAFQ,EAEOpB,MAAM,CAACqB,IAFd,EAGbgF,IAHa,CAGR,WAHQ,EAGK,KAHL,CAAhB;;IAKA,IAAI,KAAKlG,aAAL,CAAmBK,IAAnB,KAA4B,KAAhC,EAAuC;MACrC,MAAM8F,KAAK,GAAG,KAAKN,YAAL,CAAkBhG,MAAM,CAACqB,IAAzB,CAAd;MACA,MAAMpB,GAAG,GAAG,KAAKA,GAAjB;MACA,MAAMsG,WAAW,GAAGtG,GAAG,CAACsG,WAAxB;MACA,MAAMC,WAAW,GAAGvG,GAAG,CAACuG,WAAxB;MACA,MAAMC,MAAM,GAAG,CAACF,WAAW,GAAGC,WAAf,IAA8B,CAA7C;MACA,MAAME,KAAK,GAAG,IAAI/G,KAAJ,CAAU4G,WAAV,EAAuBA,WAAvB,CAAd;MACA,MAAMI,KAAK,GAAG/G,KAAK,CAACgH,KAAN,CAAY3G,GAAG,CAAC4G,UAAhB,CAAd;MACA,MAAMC,MAAM,GAAGR,KAAK,GAAGK,KAAR,GAAgB/G,KAAK,CAACgH,KAAN,CAAY3G,GAAG,CAAC8G,UAAhB,CAA/B;MACA,MAAMC,OAAO,GAAGF,MAAM,GAAGH,KAAzB;MACA,MAAMM,QAAQ,GAAGzH,GAAG,CAAC0H,mBAAJ,CACfV,WADe,EAEfD,WAFe,EAGfO,MAHe,EAIfE,OAJe,CAAjB;MAOA,MAAMG,IAAI,GAAG1H,MAAM,CAAC8F,MAAP,CAAc,KAAd,EAAqBrE,QAArB,CAA8B,GAAGnB,UAAU,CAAC+E,QAAQ,MAApD,CAAb;MACA,MAAMsC,KAAK,GAAG3H,MAAM,CAAC8F,MAAP,CAAc,MAAd,EACXrE,QADW,CACFnB,UAAU,CAAC+E,QADT,EAEX1D,IAFW,CAEN,GAFM,EAED6F,QAFC,EAGXI,SAHW,CAGDd,WAHC,EAGYA,WAHZ,CAAd;MAIA,MAAMe,GAAG,GAAG3H,KAAK,CAAC4H,SAAN,CAAgBd,MAAhB,EAAwB,CAACK,MAAD,GAAUH,KAAK,GAAG,CAA1C,EAA6CD,KAA7C,EAAoDc,MAApD,EAAZ;MACA,MAAMC,QAAQ,GAAGxH,GAAG,CAACwH,QAArB;MACA,MAAMC,IAAI,GAAGjI,MAAM,CAAC8F,MAAP,CAAc,OAAd,EACVnE,IADU,CACLkG,GADK,EAEVpG,QAFU,CAED,GAAGnB,UAAU,CAAC+E,QAAQ,MAFrB,CAAb;MAGAwC,GAAG,CAACrD,CAAJ,GAAQqD,GAAG,CAACrD,CAAJ,GAAQwD,QAAR,GAAmB,CAA3B;MACA,MAAME,KAAK,GAAGlI,MAAM,CAAC8F,MAAP,CAAc,MAAd,EAAsB;QAAE,aAAakC;MAAf,CAAtB,EACXrG,IADW,CACNkG,GADM,EAEXpG,QAFW,CAEF,GAAGnB,UAAU,CAAC+E,QAAQ,MAFpB,CAAd;MAIA4C,IAAI,CAACtG,IAAL,CAAU;QACRwG,KAAK,EAAEH,QADC;QAERI,MAAM,EAAEJ;MAFA,CAAV;MAIAC,IAAI,CAACL,SAAL,CAAe,CAACI,QAAD,GAAY,CAA3B,EAA8B,CAACA,QAAD,GAAY,CAA1C;MACAE,KAAK,CAACN,SAAN,CAAgB,CAACI,QAAD,GAAY,CAA5B,EAA+B,CAACA,QAAD,GAAY,CAA3C;MACAN,IAAI,CAACW,MAAL,CAAY,CAACV,KAAD,EAAQM,IAAR,EAAcC,KAAd,CAAZ;MACAvB,OAAO,CAAC0B,MAAR,CAAeX,IAAI,CAACY,IAApB;IACD,CAxCD,MAwCO;MACL3B,OAAO,CAAClF,QAAR,CAAiB,GAAGnB,UAAU,CAACC,MAAM,QAAQA,MAAM,CAACmB,QAAQ,EAA5D;;MACA,IAAInB,MAAM,CAACgI,OAAX,EAAoB;QAClB,IAAI,OAAOhI,MAAM,CAACgI,OAAd,KAA0B,QAA9B,EAAwC;UACtC5B,OAAO,CAAC6B,IAAR,CAAajI,MAAM,CAACgI,OAApB;QACD,CAFD,MAEO;UACL5B,OAAO,CAAC0B,MAAR,CAAe9H,MAAM,CAACgI,OAAtB;QACD;MACF;IACF;;IAED,KAAKE,gBAAL,CAAsB9B,OAAtB,EAA+BpG,MAAM,CAACgF,IAAtC;IACA,KAAKhE,UAAL,CAAgBoF,OAAhB,EAAyBpG,MAAM,CAACiB,KAAhC;IAEA,OAAOmF,OAAP;EACD;;EAED7F,SAAS,CAAsBP,MAAtB,EAA6C;IACpD,IAAI,CAAC,KAAKkG,SAAL,CAAelG,MAAM,CAACqB,IAAtB,CAAL,EAAkC;MAChC,KAAKhB,OAAL,CAAa8H,IAAb,CAAkBnI,MAAlB;MAEA,MAAMoI,MAAM,GAAGpI,MAAM,CAACoI,MAAtB;;MACA,IAAIA,MAAJ,EAAY;QACVjE,MAAM,CAACkE,IAAP,CAAYD,MAAZ,EAAoB9H,OAApB,CAA6ByB,MAAD,IAAW;UACrC,MAAMuG,QAAQ,GAAGF,MAAM,CAACrG,MAAD,CAAvB;UACA,MAAMV,IAAI,GAAG,UAAUrB,MAAM,CAACqB,IAAI,IAAIU,MAAM,EAA5C;;UACA,IAAI,OAAOuG,QAAP,KAAoB,QAAxB,EAAkC;YAChC,KAAKC,EAAL,CAAQlH,IAAR,EAAe,KAAaiH,QAAb,CAAf,EAAuC,IAAvC;UACD,CAFD,MAEO;YACL,KAAKC,EAAL,CAAQlH,IAAR,EAAciH,QAAd;UACD;QACF,CARD;MASD;;MAED,IAAI,KAAK7G,gBAAT,EAA2B;QACzB,KAAKA,gBAAL,CAAsBqG,MAAtB,CAA6B,KAAK3B,YAAL,CAAkBnG,MAAlB,CAA7B;MACD;IACF;;IAED,OAAO,IAAP;EACD;;EAEDwI,UAAU,CAAsBnI,OAAtB,EAAgD;IACxDA,OAAO,CAACC,OAAR,CAAiBN,MAAD,IAAY,KAAKO,SAAL,CAAeP,MAAf,CAA5B;IACA,OAAO,IAAP;EACD;;EAEDyI,aAAa;IACX,OAAO,KAAKpI,OAAL,CAAaiF,MAApB,EAA4B;MAC1B,KAAKoD,YAAL,CAAkB,KAAKrI,OAAL,CAAa,CAAb,EAAgBgB,IAAlC;IACD;;IACD,OAAO,IAAP;EACD;;EAEDqH,YAAY,CAAsBrH,IAAtB,EAAkC;IAC5C,MAAMiF,KAAK,GAAG,KAAKN,YAAL,CAAkB3E,IAAlB,CAAd;IACA,MAAMrB,MAAM,GAAG,KAAKK,OAAL,CAAaiG,KAAb,CAAf;;IACA,IAAItG,MAAJ,EAAY;MACV,IAAIA,MAAM,CAACoI,MAAX,EAAmB;QACjBjE,MAAM,CAACkE,IAAP,CAAYrI,MAAM,CAACoI,MAAnB,EAA2B9H,OAA3B,CAAoCqI,KAAD,IAAU;UAC3C,KAAKC,GAAL,CAAS,UAAUvH,IAAI,IAAIsH,KAAK,EAAhC;QACD,CAFD;MAGD;;MACD,KAAKE,aAAL,CAAmBxH,IAAnB,EAAyByH,MAAzB;MACA,KAAKzI,OAAL,CAAa0I,MAAb,CAAoBzC,KAApB,EAA2B,CAA3B;IACD;;IACD,OAAO,IAAP;EACD;;EAED0C,YAAY,CAEV3H,IAFU,EAGV4H,SAHU,EAGyB;IAEnC,MAAMjJ,MAAM,GAAG,KAAK+E,SAAL,CAAe1D,IAAf,CAAf;;IACA,IAAIrB,MAAJ,EAAY;MACV,KAAK0I,YAAL,CAAkBrH,IAAlB;MACA,KAAKd,SAAL,CAAc4D,gCACTnE,MADS,GAETiJ,SAFS,CAAd;IAID;;IACD,OAAO,IAAP;EACD;;EAEDC,YAAY,CAAsB7H,IAAtB,EAAoC8H,QAApC,EAAsD;IAChE,MAAMnJ,MAAM,GAAG,KAAK+E,SAAL,CAAe1D,IAAf,CAAf;;IACA,IAAIrB,MAAJ,EAAY;MACV,MAAMoG,OAAO,GAAG,KAAKyC,aAAL,CAAmBxH,IAAnB,CAAhB;MACA,MAAMX,SAAS,GAAG,GAAGX,UAAU,CAACC,MAAM,WAAtC;;MACA,IAAImJ,QAAQ,KAAKC,SAAjB,EAA4B;QAC1BD,QAAQ,GAAG,CAAC/C,OAAO,CAACiD,QAAR,CAAiB3I,SAAjB,CAAZ,CAD0B,CACc;MACzC;;MAED0F,OAAO,CAACkD,WAAR,CAAoB5I,SAApB,EAA+ByI,QAA/B;MACA,MAAMnE,IAAI,GAAGmE,QAAQ,GAAGnJ,MAAM,CAACuJ,YAAV,GAAyBvJ,MAAM,CAACgF,IAArD;;MACA,IAAIA,IAAJ,EAAU;QACR,KAAKkD,gBAAL,CAAsB9B,OAAtB,EAA+BpB,IAA/B;MACD;IACF;;IACD,OAAO,IAAP;EACD;;EAEDwE,YAAY,CAAsBnI,IAAtB,EAAkC;IAC5C,OAAO,KAAK6H,YAAL,CAAkB7H,IAAlB,EAAwB,IAAxB,CAAP;EACD;;EAEDoI,cAAc,CAAsBpI,IAAtB,EAAkC;IAC9C,OAAO,KAAK6H,YAAL,CAAkB7H,IAAlB,EAAwB,KAAxB,CAAP;EACD;;EAEDqI,kBAAkB;IAChB,KAAKrJ,OAAL,CAAaC,OAAb,CAAsBN,MAAD,IAAY,KAAKyJ,cAAL,CAAoBzJ,MAAM,CAACqB,IAA3B,CAAjC;IACA,OAAO,IAAP;EACD;;EAESwH,aAAa,CAACxH,IAAD,EAAa;IAClC,OAAO,KAAKI,gBAAL,CAAsBiD,IAAtB,CACL,IAAI3E,UAAU,CAACC,MAAM,IAAIqB,IAAI,EADxB,CAAP;EAGD;;EAES6G,gBAAgB,CAExB9B,OAFwB,EAGxBpB,IAHwB,EAGJ;IAEpB,IAAI,KAAK7E,aAAL,CAAmBK,IAAnB,KAA4B,KAAhC,EAAuC;MACrC,MAAM6E,MAAM,GAAGe,OAAO,CAAC1B,IAAR,CAAa,IAAI3E,UAAU,CAAC4J,WAAW,EAAvC,CAAf;MACA,KAAK5I,CAAL,CAAOsE,MAAM,CAAC,CAAD,CAAb,EAAkBjE,IAAlB,CAAuB,YAAvB,EAAqC4D,IAAI,IAAI,EAA7C;IACD,CAHD,MAGO;MACLoB,OAAO,CAACT,GAAR,CAAY,kBAAZ,EAAgCX,IAAI,GAAG,OAAOA,IAAI,GAAd,GAAoB,EAAxD;IACD;EACF;;EAES4E,UAAU;IAClB,OAAO,KAAKnI,gBAAL,IAAyB,IAAhC;EACD;;EAES+C,MAAM,CAACnD,IAAD,EAAc;IAC5B,IAAI,KAAKuI,UAAL,EAAJ,EAAuB;MACrB,OAAOvI,IAAI,GACP,KAAKT,WAAL,CAAiBS,IAAjB,EAAuBgI,QAAvB,CAAgCtJ,UAAU,CAAC8J,eAA3C,CADO,GAEP,KAAKpI,gBAAL,CAAsB4H,QAAtB,CAA+B,GAAGtJ,UAAU,CAAC+J,UAAU,EAAvD,CAFJ;IAGD;;IACD,OAAO,KAAP;EACD;;EAESrF,WAAW,CAAsBpD,IAAtB,EAAmC;IACtD,IAAI,KAAKuI,UAAL,EAAJ,EAAuB;MACrB,MAAMnI,gBAAgB,GAAG,KAAKA,gBAA9B;MAEA0C,MAAM,CAACkE,IAAP,CAAY,KAAKzH,WAAjB,EAA8BN,OAA9B,CAAuCyJ,GAAD,IAAQ;QAC5C,MAAMC,OAAO,GAAG,KAAKpJ,WAAL,CAAiBmJ,GAAjB,CAAhB;QACAC,OAAO,CAACC,WAAR,CAAoBlK,UAAU,CAAC8J,eAA/B;MACD,CAHD;;MAKA,IAAI,KAAKrF,MAAL,EAAJ,EAAmB;QACjB,KAAKN,OAAL,CAAa,WAAb,EAA0B;UAAE7C;QAAF,CAA1B;QACAI,gBAAgB,CAACwI,WAAjB,CAA6BlK,UAAU,CAAC+J,UAAxC;MACD,CAHD,MAGO;QACL,KAAK5F,OAAL,CAAa,UAAb,EAAyB;UAAE7C;QAAF,CAAzB;;QACA,IAAIA,IAAJ,EAAU;UACR,MAAMZ,OAAO,GAAG,KAAKR,GAAL,CAASQ,OAAzB;UACA,MAAMyJ,MAAM,GAAGzJ,OAAO,IAAIA,OAAO,CAACiE,IAAR,CAAcyF,CAAD,IAAOA,CAAC,CAAC9I,IAAF,KAAWA,IAA/B,CAA1B;;UACA,IAAI6I,MAAJ,EAAY;YACVzI,gBAAgB,CAACL,IAAjB,CAAsB;cACpB,wBAAwB8I,MAAM,CAAC7I,IADX;cAEpB,4BAA4B6I,MAAM,CAAC/I;YAFf,CAAtB;UAID;;UACD,KAAKP,WAAL,CAAiBS,IAAjB,EAAuBH,QAAvB,CAAgCnB,UAAU,CAAC8J,eAA3C;QACD;;QACDpI,gBAAgB,CAACP,QAAjB,CAA0BnB,UAAU,CAAC+J,UAArC;MACD;IACF;EACF;;EAES9I,UAAU,CAClB6D,IADkB,EAElB5D,KAFkB,EAEgC;IAElD,IAAIA,KAAJ,EAAW;MACT,MAAMH,KAAK,GAAGpB,IAAI,CAACqB,CAAL,CAAO8D,IAAP,CAAd;MACAV,MAAM,CAACkE,IAAP,CAAYpH,KAAZ,EAAmBX,OAAnB,CAA4B8J,QAAD,IAAa;QACtC,MAAMC,QAAQ,GAAGvJ,KAAK,CAAC4D,IAAN,CAAW0F,QAAX,EAAqBE,OAArB,GAA+BC,MAA/B,CAAsCH,QAAtC,CAAjB;;QACA,MAAMI,KAA0BvJ,KAAK,CAACmJ,QAAD,CAArC;QAAA,MAAM;UAAEK,KAAK,EAAEC;QAAT,IAAYF,EAAlB;QAAA,MAAuBpJ,IAAI,cAArB,SAAqB,CAA3B;;QACA,IAAIsJ,GAAJ,EAAS;UACPL,QAAQ,CAACnJ,QAAT,CAAkBwJ,GAAlB;QACD;;QACDL,QAAQ,CAACjJ,IAAT,CAAcA,IAAd;MACD,CAPD;IAQD;EACF;;AA7bgB;;AAgcnB,WAAiBvB,MAAjB,EAAuB;EA6CRA,2BAAyB;IACpC2G,WAAW,EAAE,EADuB;IAEpCD,WAAW,EAAE,EAFuB;IAGpCM,UAAU,EAAE,EAHwB;IAIpCE,UAAU,EAAE,CAJwB;IAKpCU,QAAQ,EAAE,EAL0B;IAMpChH,OAAO,EAAE,CACP;MACEY,IAAI,EAAE,SADR;MAEEF,QAAQ,EAAE;IAFZ,CADO;EAN2B,CAAzB;AA+Bd,CA5ED,EAAiBtB,MAAM,KAANA,MAAM,MAAvB;;AA8EA,IAAUE,UAAV;;AAAA,WAAUA,UAAV,EAAoB;EACLA,oBAASL,IAAI,CAACiL,SAAL,CAAeC,eAAf,CAA+B,eAA/B,CAAT;EACA7K,kBAAO,GAAGA,iBAAM,OAAhB;EACAA,qBAAU,GAAGA,iBAAM,UAAnB;EACAA,wBAAa,GAAGA,iBAAM,aAAtB;EACAA,uBAAY,GAAGA,iBAAM,aAArB;EACAA,6BAAkB,GAAGA,iBAAM,oBAA3B;EACAA,sBAAW,GAAGA,iBAAM,YAApB;EACAA,yBAAc,GAAGA,iBAAM,gBAAvB;AACd,CATD,EAAUA,UAAU,KAAVA,UAAU,MAApB","names":["Dom","Vector","View","Point","Angle","Handle","handleClassName","ClassNames","handle","pie","defaultPieOptions","handleOptions","initHandles","handles","forEach","addHandle","type","toggles","className","pieToggle","$pieToggles","item","$elem","$","applyAttrs","attrs","addClass","position","attr","name","appendTo","container","setPieIcons","$handleContainer","wrap","animate","delegateEvents","onHandleMouseDown","evt","action","currentTarget","closest","preventDefault","stopPropagation","setEventData","clientX","clientY","startX","startY","button","triggerHandleAction","delegateDocumentEvents","mousemove","touchmove","mouseup","touchend","touchcancel","data","onHandleMouseMove","getEventData","onHandleMouseUp","undelegateDocumentEvents","eventName","args","e","normalizeEvent","local","graph","snapToGrid","origin","dx","x","dy","y","trigger","Object","offsetX","offsetY","onPieToggleMouseDown","target","isOpen","toggleState","find","each","_","elem","pieSlice","getHandle","icon","contect","window","getComputedStyle","getPropertyValue","$icons","length","create","text","replace","bgImg","css","matches","match","href","$imgs","getHandleIdx","findIndex","hasHandle","renderHandle","$handle","prop","index","outerRadius","innerRadius","offset","ratio","delta","toRad","sliceAngle","curRad","startAngle","nextRad","pathData","createSlicePathData","vSvg","vPath","translate","pos","fromPolar","toJSON","iconSize","vImg","vText","width","height","append","node","content","html","updateHandleIcon","push","events","keys","callback","on","addHandles","removeHandles","removeHandle","event","off","getHandleElem","remove","splice","changeHandle","newHandle","toggleHandle","selected","undefined","hasClass","toggleClass","iconSelected","selectHandle","deselectHandle","deselectAllHandles","pieSliceImg","isRendered","pieToggleOpened","pieOpended","key","$toggle","removeClass","toggle","i","selector","$element","addBack","filter","_a","class","cls","prototype","prefixClassName"],"sourceRoot":"","sources":["../../../src/addon/common/handle.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}