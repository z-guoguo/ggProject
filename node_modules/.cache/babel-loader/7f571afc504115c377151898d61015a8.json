{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport JQuery from 'jquery';\nimport { DataUri, NumberExt, FunctionExt, Vector } from '../util';\nimport { Rectangle } from '../geometry';\nimport { Base } from './base';\nexport class FormatManager extends Base {\n  toSVG(callback, options = {}) {\n    this.graph.trigger('before:export', options);\n    const rawSVG = this.view.svg;\n    const vSVG = Vector.create(rawSVG).clone();\n    let clonedSVG = vSVG.node;\n    const vStage = vSVG.findOne(`.${this.view.prefixClassName('graph-svg-stage')}`);\n    const viewBox = options.viewBox || this.graph.graphToLocal(this.graph.getContentBBox());\n    const dimension = options.preserveDimensions;\n\n    if (dimension) {\n      const size = typeof dimension === 'boolean' ? viewBox : dimension;\n      vSVG.attr({\n        width: size.width,\n        height: size.height\n      });\n    }\n\n    vSVG.removeAttribute('style').attr('viewBox', [viewBox.x, viewBox.y, viewBox.width, viewBox.height].join(' '));\n    vStage.removeAttribute('transform'); // Stores all the CSS declarations from external stylesheets to the\n    // `style` attribute of the SVG document nodes.\n    // This is achieved in three steps.\n    // -----------------------------------\n    // 1. Disabling all the stylesheets in the page and therefore collecting\n    //    only default style values. This, together with the step 2, makes it\n    //    possible to discard default CSS property values and store only those\n    //    that differ.\n    //\n    // 2. Enabling back all the stylesheets in the page and collecting styles\n    //    that differ from the default values.\n    //\n    // 3. Applying the difference between default values and the ones set by\n    //    custom stylesheets onto the `style` attribute of each of the nodes\n    //    in SVG.\n\n    if (options.copyStyles !== false) {\n      const document = rawSVG.ownerDocument;\n      const raws = Array.from(rawSVG.querySelectorAll('*'));\n      const clones = Array.from(clonedSVG.querySelectorAll('*'));\n      const styleSheetCount = document.styleSheets.length;\n      const styleSheetsCopy = [];\n\n      for (let k = styleSheetCount - 1; k >= 0; k -= 1) {\n        // There is a bug (bugSS) in Chrome 14 and Safari. When you set\n        // `stylesheet.disable = true` it will also remove it from\n        // `document.styleSheets`. So we need to store all stylesheets before\n        // we disable them. Later on we put them back to `document.styleSheets`\n        // if needed.\n        // See the bug `https://code.google.com/p/chromium/issues/detail?id=88310`.\n        styleSheetsCopy[k] = document.styleSheets[k];\n        document.styleSheets[k].disabled = true;\n      }\n\n      const defaultComputedStyles = {};\n      raws.forEach((elem, index) => {\n        const computedStyle = window.getComputedStyle(elem, null); // We're making a deep copy of the `computedStyle` so that it's not affected\n        // by that next step when all the stylesheets are re-enabled again.\n\n        const defaultComputedStyle = {};\n        Object.keys(computedStyle).forEach(property => {\n          defaultComputedStyle[property] = computedStyle.getPropertyValue(property);\n        });\n        defaultComputedStyles[index] = defaultComputedStyle;\n      }); // Copy all stylesheets back\n\n      if (styleSheetCount !== document.styleSheets.length) {\n        styleSheetsCopy.forEach((copy, index) => {\n          document.styleSheets[index] = copy;\n        });\n      }\n\n      for (let i = 0; i < styleSheetCount; i += 1) {\n        document.styleSheets[i].disabled = false;\n      }\n\n      const customStyles = {};\n      raws.forEach((elem, index) => {\n        const computedStyle = window.getComputedStyle(elem, null);\n        const defaultComputedStyle = defaultComputedStyles[index];\n        const customStyle = {};\n        Object.keys(computedStyle).forEach(property => {\n          if (!NumberExt.isNumeric(property) && computedStyle.getPropertyValue(property) !== defaultComputedStyle[property]) {\n            customStyle[property] = computedStyle.getPropertyValue(property);\n          }\n        });\n        customStyles[index] = customStyle;\n      });\n      clones.forEach((elem, index) => {\n        JQuery(elem).css(customStyles[index]);\n      });\n    }\n\n    const stylesheet = options.stylesheet;\n\n    if (typeof stylesheet === 'string') {\n      const cDATASection = rawSVG.ownerDocument.implementation.createDocument(null, 'xml', null).createCDATASection(stylesheet);\n      vSVG.prepend(Vector.create('style', {\n        type: 'text/css'\n      }, [cDATASection]));\n    }\n\n    const format = () => {\n      const beforeSerialize = options.beforeSerialize;\n\n      if (typeof beforeSerialize === 'function') {\n        const ret = FunctionExt.call(beforeSerialize, this.graph, clonedSVG);\n\n        if (ret instanceof SVGSVGElement) {\n          clonedSVG = ret;\n        }\n      }\n\n      const dataUri = new XMLSerializer().serializeToString(clonedSVG).replace(/&nbsp;/g, '\\u00a0');\n      this.graph.trigger('after:export', options);\n      callback(dataUri);\n    };\n\n    if (options.serializeImages) {\n      const deferrals = vSVG.find('image').map(vImage => {\n        return new Promise(resolve => {\n          const url = vImage.attr('xlink:href') || vImage.attr('href');\n          DataUri.imageToDataUri(url, (err, dataUri) => {\n            if (!err && dataUri) {\n              vImage.attr('xlink:href', dataUri);\n            }\n\n            resolve();\n          });\n        });\n      });\n      Promise.all(deferrals).then(format);\n    } else {\n      format();\n    }\n  }\n\n  toDataURL(callback, options) {\n    let viewBox = options.viewBox || this.graph.getContentBBox();\n    const padding = NumberExt.normalizeSides(options.padding);\n\n    if (options.width && options.height) {\n      if (padding.left + padding.right >= options.width) {\n        padding.left = padding.right = 0;\n      }\n\n      if (padding.top + padding.bottom >= options.height) {\n        padding.top = padding.bottom = 0;\n      }\n    }\n\n    const expanding = new Rectangle(-padding.left, -padding.top, padding.left + padding.right, padding.top + padding.bottom);\n\n    if (options.width && options.height) {\n      const width = viewBox.width + padding.left + padding.right;\n      const height = viewBox.height + padding.top + padding.bottom;\n      expanding.scale(width / options.width, height / options.height);\n    }\n\n    viewBox = Rectangle.create(viewBox).moveAndExpand(expanding);\n    const rawSize = typeof options.width === 'number' && typeof options.height === 'number' ? {\n      width: options.width,\n      height: options.height\n    } : viewBox;\n    let scale = options.ratio ? parseFloat(options.ratio) : 1;\n\n    if (!Number.isFinite(scale) || scale === 0) {\n      scale = 1;\n    }\n\n    const size = {\n      width: Math.max(Math.round(rawSize.width * scale), 1),\n      height: Math.max(Math.round(rawSize.height * scale), 1)\n    };\n    {\n      const imgDataCanvas = document.createElement('canvas');\n      const context2D = imgDataCanvas.getContext('2d');\n      imgDataCanvas.width = size.width;\n      imgDataCanvas.height = size.height;\n      const x = size.width - 1;\n      const y = size.height - 1;\n      context2D.fillStyle = 'rgb(1,1,1)';\n      context2D.fillRect(x, y, 1, 1);\n      const data = context2D.getImageData(x, y, 1, 1).data;\n\n      if (data[0] !== 1 || data[1] !== 1 || data[2] !== 1) {\n        throw new Error('size exceeded');\n      }\n    }\n    const img = new Image();\n\n    img.onload = () => {\n      const canvas = document.createElement('canvas');\n      canvas.width = size.width;\n      canvas.height = size.height;\n      const context = canvas.getContext('2d');\n      context.fillStyle = options.backgroundColor || 'white';\n      context.fillRect(0, 0, size.width, size.height);\n\n      try {\n        context.drawImage(img, 0, 0, size.width, size.height);\n        const dataUri = canvas.toDataURL(options.type, options.quality);\n        callback(dataUri);\n      } catch (error) {// pass\n      }\n    };\n\n    this.toSVG(dataUri => {\n      img.src = `data:image/svg+xml,${encodeURIComponent(dataUri)}`;\n    }, Object.assign(Object.assign({}, options), {\n      viewBox,\n      serializeImages: true,\n      preserveDimensions: Object.assign({}, size)\n    }));\n  }\n\n  toPNG(callback, options = {}) {\n    this.toDataURL(callback, Object.assign(Object.assign({}, options), {\n      type: 'image/png'\n    }));\n  }\n\n  toJPEG(callback, options = {}) {\n    this.toDataURL(callback, Object.assign(Object.assign({}, options), {\n      type: 'image/jpeg'\n    }));\n  }\n\n}","map":{"version":3,"mappings":"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","names":["JQuery","DataUri","NumberExt","FunctionExt","Vector","Rectangle","Base","FormatManager","toSVG","callback","options","graph","trigger","rawSVG","view","svg","vSVG","create","clone","clonedSVG","node","vStage","findOne","prefixClassName","viewBox","graphToLocal","getContentBBox","dimension","preserveDimensions","size","attr","width","height","removeAttribute","x","y","join","copyStyles","document","ownerDocument","raws","Array","from","querySelectorAll","clones","styleSheetCount","styleSheets","length","styleSheetsCopy","k","disabled","defaultComputedStyles","forEach","elem","index","computedStyle","window","getComputedStyle","defaultComputedStyle","Object","keys","property","getPropertyValue","copy","i","customStyles","customStyle","isNumeric","css","stylesheet","cDATASection","implementation","createDocument","createCDATASection","prepend","type","format","beforeSerialize","ret","call","SVGSVGElement","dataUri","XMLSerializer","serializeToString","replace","serializeImages","deferrals","find","map","vImage","Promise","resolve","url","imageToDataUri","err","all","then","toDataURL","padding","normalizeSides","left","right","top","bottom","expanding","scale","moveAndExpand","rawSize","ratio","parseFloat","Number","isFinite","Math","max","round","imgDataCanvas","createElement","context2D","getContext","fillStyle","fillRect","data","getImageData","Error","img","Image","onload","canvas","context","backgroundColor","drawImage","quality","error","src","encodeURIComponent","toPNG","toJPEG"],"sourceRoot":"","sources":["../../src/graph/format.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}