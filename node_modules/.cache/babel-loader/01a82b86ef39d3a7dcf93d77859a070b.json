{"ast":null,"code":"import line from './line';\nimport { distance, isNumberEqual, getBBoxByArray, piMod } from './util';\nimport { nearestPoint } from './bezier'; // 差值公式\n\nfunction quadraticAt(p0, p1, p2, t) {\n  var onet = 1 - t;\n  return onet * onet * p0 + 2 * t * onet * p1 + t * t * p2;\n} // 求极值\n\n\nfunction extrema(p0, p1, p2) {\n  var a = p0 + p2 - 2 * p1;\n\n  if (isNumberEqual(a, 0)) {\n    return [0.5];\n  }\n\n  var rst = (p0 - p1) / a;\n\n  if (rst <= 1 && rst >= 0) {\n    return [rst];\n  }\n\n  return [];\n}\n\nfunction derivativeAt(p0, p1, p2, t) {\n  return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\n} // 分割贝塞尔曲线\n\n\nfunction divideQuadratic(x1, y1, x2, y2, x3, y3, t) {\n  // 划分点\n  var xt = quadraticAt(x1, x2, x3, t);\n  var yt = quadraticAt(y1, y2, y3, t); // 分割的第一条曲线的控制点\n\n  var controlPoint1 = line.pointAt(x1, y1, x2, y2, t); // 分割的第二条曲线的控制点\n\n  var controlPoint2 = line.pointAt(x2, y2, x3, y3, t);\n  return [[x1, y1, controlPoint1.x, controlPoint1.y, xt, yt], [xt, yt, controlPoint2.x, controlPoint2.y, x3, y3]];\n} // 使用迭代法取贝塞尔曲线的长度\n\n\nfunction quadraticLength(x1, y1, x2, y2, x3, y3, iterationCount) {\n  if (iterationCount === 0) {\n    return (distance(x1, y1, x2, y2) + distance(x2, y2, x3, y3) + distance(x1, y1, x3, y3)) / 2;\n  }\n\n  var quadratics = divideQuadratic(x1, y1, x2, y2, x3, y3, 0.5);\n  var left = quadratics[0];\n  var right = quadratics[1];\n  left.push(iterationCount - 1);\n  right.push(iterationCount - 1);\n  return quadraticLength.apply(null, left) + quadraticLength.apply(null, right);\n}\n\nexport default {\n  box: function (x1, y1, x2, y2, x3, y3) {\n    var xExtrema = extrema(x1, x2, x3)[0];\n    var yExtrema = extrema(y1, y2, y3)[0]; // 控制点不加入 box 的计算\n\n    var xArr = [x1, x3];\n    var yArr = [y1, y3];\n\n    if (xExtrema !== undefined) {\n      xArr.push(quadraticAt(x1, x2, x3, xExtrema));\n    }\n\n    if (yExtrema !== undefined) {\n      yArr.push(quadraticAt(y1, y2, y3, yExtrema));\n    }\n\n    return getBBoxByArray(xArr, yArr);\n  },\n  length: function (x1, y1, x2, y2, x3, y3) {\n    return quadraticLength(x1, y1, x2, y2, x3, y3, 3);\n  },\n  nearestPoint: function (x1, y1, x2, y2, x3, y3, x0, y0) {\n    return nearestPoint([x1, x2, x3], [y1, y2, y3], x0, y0, quadraticAt);\n  },\n  pointDistance: function (x1, y1, x2, y2, x3, y3, x0, y0) {\n    var point = this.nearestPoint(x1, y1, x2, y2, x3, y3, x0, y0);\n    return distance(point.x, point.y, x0, y0);\n  },\n  interpolationAt: quadraticAt,\n  pointAt: function (x1, y1, x2, y2, x3, y3, t) {\n    return {\n      x: quadraticAt(x1, x2, x3, t),\n      y: quadraticAt(y1, y2, y3, t)\n    };\n  },\n  divide: function (x1, y1, x2, y2, x3, y3, t) {\n    return divideQuadratic(x1, y1, x2, y2, x3, y3, t);\n  },\n  tangentAngle: function (x1, y1, x2, y2, x3, y3, t) {\n    var dx = derivativeAt(x1, x2, x3, t);\n    var dy = derivativeAt(y1, y2, y3, t);\n    var angle = Math.atan2(dy, dx);\n    return piMod(angle);\n  }\n};","map":{"version":3,"mappings":"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","names":["line","distance","isNumberEqual","getBBoxByArray","piMod","nearestPoint","quadraticAt","p0","p1","p2","t","onet","extrema","a","rst","derivativeAt","divideQuadratic","x1","y1","x2","y2","x3","y3","xt","yt","controlPoint1","pointAt","controlPoint2","x","y","quadraticLength","iterationCount","quadratics","left","right","push","apply","box","xExtrema","yExtrema","xArr","yArr","undefined","length","x0","y0","pointDistance","point","interpolationAt","divide","tangentAngle","dx","dy","angle","Math","atan2"],"sourceRoot":"","sources":["../src/quadratic.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}