{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Disablable } from '../../common';\nexport class AutoSave extends Disablable {\n  constructor(options) {\n    super();\n    this.delay = 10;\n    this.throttle = 2;\n    this.threshold = 5;\n    this.changeCount = 0;\n    this.timestamp = 0;\n    this.options = Object.assign(Object.assign({}, AutoSave.defaultOptions), options);\n    this.graph.model.on('cell:change:*', this.onModelChanged, this);\n  }\n\n  get graph() {\n    return this.options.graph;\n  }\n\n  onModelChanged() {\n    if (this.disabled) {\n      return;\n    }\n\n    const now = new Date().getTime();\n    const dt = (now - this.timestamp) / 1000;\n\n    if (dt > this.delay || this.changeCount >= this.threshold && dt > this.throttle) {\n      this.save();\n      this.reset();\n    } else {\n      this.changeCount += 1;\n    }\n  }\n\n  save() {\n    this.trigger('save');\n  }\n\n  reset() {\n    this.changeCount = 0;\n    this.timestamp = new Date().getTime();\n  }\n\n  dispose() {\n    this.graph.model.off('cell:change:*', this.onModelChanged, this);\n  }\n\n}\n\n__decorate([Disablable.dispose()], AutoSave.prototype, \"dispose\", null);\n\n(function (AutoSave) {\n  AutoSave.defaultOptions = {\n    delay: 10,\n    throttle: 2,\n    threshold: 5\n  };\n})(AutoSave || (AutoSave = {}));","map":{"version":3,"mappings":";;;;;;;;AAAA,SAASA,UAAT,QAA2B,cAA3B;AAGA,OAAM,MAAOC,QAAP,SAAwBD,UAAxB,CAAsD;EAc1DE,YAAYC,OAAZ,EAAqC;IACnC;IARF,aAAQ,EAAR;IACA,gBAAW,CAAX;IACA,iBAAY,CAAZ;IAEQ,mBAAc,CAAd;IACA,iBAAY,CAAZ;IAIN,KAAKA,OAAL,GAAYC,gCACPH,QAAQ,CAACI,cADF,GAEPF,OAFO,CAAZ;IAIA,KAAKG,KAAL,CAAWC,KAAX,CAAiBC,EAAjB,CAAoB,eAApB,EAAqC,KAAKC,cAA1C,EAA0D,IAA1D;EACD;;EAlBkB,IAALH,KAAK;IACjB,OAAO,KAAKH,OAAL,CAAaG,KAApB;EACD;;EAkBOG,cAAc;IACpB,IAAI,KAAKC,QAAT,EAAmB;MACjB;IACD;;IAED,MAAMC,GAAG,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAZ;IACA,MAAMC,EAAE,GAAG,CAACH,GAAG,GAAG,KAAKI,SAAZ,IAAyB,IAApC;;IAEA,IACED,EAAE,GAAG,KAAKE,KAAV,IACC,KAAKC,WAAL,IAAoB,KAAKC,SAAzB,IAAsCJ,EAAE,GAAG,KAAKK,QAFnD,EAGE;MACA,KAAKC,IAAL;MACA,KAAKC,KAAL;IACD,CAND,MAMO;MACL,KAAKJ,WAAL,IAAoB,CAApB;IACD;EACF;;EAEOG,IAAI;IACV,KAAKE,OAAL,CAAa,MAAb;EACD;;EAEDD,KAAK;IACH,KAAKJ,WAAL,GAAmB,CAAnB;IACA,KAAKF,SAAL,GAAiB,IAAIH,IAAJ,GAAWC,OAAX,EAAjB;EACD;;EAGDU,OAAO;IACL,KAAKjB,KAAL,CAAWC,KAAX,CAAiBiB,GAAjB,CAAqB,eAArB,EAAsC,KAAKf,cAA3C,EAA2D,IAA3D;EACD;;AAtDyD;;AAoD1DgB,YADCzB,UAAU,CAACuB,OAAX,EACD;;AAKF,WAAiBtB,QAAjB,EAAyB;EAkBVA,0BAAmC;IAC9Ce,KAAK,EAAE,EADuC;IAE9CG,QAAQ,EAAE,CAFoC;IAG9CD,SAAS,EAAE;EAHmC,CAAnC;AASd,CA3BD,EAAiBjB,QAAQ,KAARA,QAAQ,MAAzB","names":["Disablable","AutoSave","constructor","options","Object","defaultOptions","graph","model","on","onModelChanged","disabled","now","Date","getTime","dt","timestamp","delay","changeCount","threshold","throttle","save","reset","trigger","dispose","off","__decorate"],"sourceRoot":"","sources":["../../../src/addon/autosave/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}