{"ast":null,"code":"import { mod, toRadian } from '@antv/util'; // 向量长度\n\nfunction vMag(v) {\n  return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n} // u.v/|u||v|，计算夹角的余弦值\n\n\nfunction vRatio(u, v) {\n  // 当存在一个向量的长度为 0 时，夹角也为 0，即夹角的余弦值为 1\n  return vMag(u) * vMag(v) ? (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v)) : 1;\n} // 向量角度\n\n\nfunction vAngle(u, v) {\n  return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n}\n/**\n * 判断两个点是否重合，点坐标的格式为 [x, y]\n * @param {Array} point1 第一个点\n * @param {Array} point2 第二个点\n */\n\n\nexport function isSamePoint(point1, point2) {\n  return point1[0] === point2[0] && point1[1] === point2[1];\n} // A 0:rx 1:ry 2:x-axis-rotation 3:large-arc-flag 4:sweep-flag 5: x 6: y\n\nexport default function getArcParams(startPoint, params) {\n  var rx = params[1];\n  var ry = params[2];\n  var xRotation = mod(toRadian(params[3]), Math.PI * 2);\n  var arcFlag = params[4];\n  var sweepFlag = params[5]; // 弧形起点坐标\n\n  var x1 = startPoint[0];\n  var y1 = startPoint[1]; // 弧形终点坐标\n\n  var x2 = params[6];\n  var y2 = params[7];\n  var xp = Math.cos(xRotation) * (x1 - x2) / 2.0 + Math.sin(xRotation) * (y1 - y2) / 2.0;\n  var yp = -1 * Math.sin(xRotation) * (x1 - x2) / 2.0 + Math.cos(xRotation) * (y1 - y2) / 2.0;\n  var lambda = xp * xp / (rx * rx) + yp * yp / (ry * ry);\n\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n  var diff = rx * rx * (yp * yp) + ry * ry * (xp * xp);\n  var f = diff ? Math.sqrt((rx * rx * (ry * ry) - diff) / diff) : 1;\n\n  if (arcFlag === sweepFlag) {\n    f *= -1;\n  }\n\n  if (isNaN(f)) {\n    f = 0;\n  } // 旋转前的起点坐标，且当长半轴和短半轴的长度为 0 时，坐标按 (0, 0) 处理\n\n\n  var cxp = ry ? f * rx * yp / ry : 0;\n  var cyp = rx ? f * -ry * xp / rx : 0; // 椭圆圆心坐标\n\n  var cx = (x1 + x2) / 2.0 + Math.cos(xRotation) * cxp - Math.sin(xRotation) * cyp;\n  var cy = (y1 + y2) / 2.0 + Math.sin(xRotation) * cxp + Math.cos(xRotation) * cyp; // 起始点的单位向量\n\n  var u = [(xp - cxp) / rx, (yp - cyp) / ry]; // 终止点的单位向量\n\n  var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry]; // 计算起始点和圆心的连线，与 x 轴正方向的夹角\n\n  var theta = vAngle([1, 0], u); // 计算圆弧起始点和终止点与椭圆圆心连线的夹角\n\n  var dTheta = vAngle(u, v);\n\n  if (vRatio(u, v) <= -1) {\n    dTheta = Math.PI;\n  }\n\n  if (vRatio(u, v) >= 1) {\n    dTheta = 0;\n  }\n\n  if (sweepFlag === 0 && dTheta > 0) {\n    dTheta = dTheta - 2 * Math.PI;\n  }\n\n  if (sweepFlag === 1 && dTheta < 0) {\n    dTheta = dTheta + 2 * Math.PI;\n  }\n\n  return {\n    cx: cx,\n    cy: cy,\n    // 弧形的起点和终点相同时，长轴和短轴的长度按 0 处理\n    rx: isSamePoint(startPoint, [x2, y2]) ? 0 : rx,\n    ry: isSamePoint(startPoint, [x2, y2]) ? 0 : ry,\n    startAngle: theta,\n    endAngle: theta + dTheta,\n    xRotation: xRotation,\n    arcFlag: arcFlag,\n    sweepFlag: sweepFlag\n  };\n}","map":{"version":3,"mappings":"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","names":["mod","toRadian","vMag","v","Math","sqrt","vRatio","u","vAngle","acos","isSamePoint","point1","point2","getArcParams","startPoint","params","rx","ry","xRotation","PI","arcFlag","sweepFlag","x1","y1","x2","y2","xp","cos","sin","yp","lambda","diff","f","isNaN","cxp","cyp","cx","cy","theta","dTheta","startAngle","endAngle"],"sourceRoot":"","sources":["../src/get-arc-params.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}