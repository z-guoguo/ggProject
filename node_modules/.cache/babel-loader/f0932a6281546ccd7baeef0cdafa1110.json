{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\nimport { __awaiter, __extends, __generator } from \"tslib\";\nimport { Canvas as GCanvas } from '@antv/g-canvas';\nimport { Canvas as GSVGCanvas } from '@antv/g-svg';\nimport { ext } from '@antv/matrix-util';\nimport { clone, deepMix, each, isString, isNumber } from '@antv/util';\nimport { AbstractGraph } from '@antv/g6-core';\nimport Global from '../global';\nimport { LayoutController, EventController } from './controller';\nimport { createDom } from '@antv/dom-util';\nvar transform = ext.transform;\nvar SVG = 'svg';\n\nvar Graph =\n/** @class */\nfunction (_super) {\n  __extends(Graph, _super);\n\n  function Graph(cfg) {\n    var _this = _super.call(this, cfg) || this;\n\n    var defaultNode = _this.get('defaultNode');\n\n    if (!defaultNode) {\n      _this.set('defaultNode', {\n        type: 'circle'\n      });\n    }\n\n    if (!defaultNode.type) {\n      defaultNode.type = 'circle';\n\n      _this.set('defaultNode', defaultNode);\n    }\n\n    _this.destroyed = false;\n    return _this;\n  }\n\n  Graph.prototype.initLayoutController = function () {\n    var layoutController = new LayoutController(this);\n    this.set({\n      layoutController: layoutController\n    });\n  };\n\n  Graph.prototype.initEventController = function () {\n    var eventController = new EventController(this);\n    this.set({\n      eventController: eventController\n    });\n  };\n\n  Graph.prototype.initCanvas = function () {\n    var container = this.get('container');\n\n    if (typeof container === 'string') {\n      container = document.getElementById(container);\n      this.set('container', container);\n    }\n\n    if (!container) {\n      throw new Error('invalid container');\n    }\n\n    var clientWidth = container.clientWidth,\n        clientHeight = container.clientHeight;\n    var width = this.get('width') || clientWidth;\n    var height = this.get('height') || clientHeight;\n\n    if (!this.get('width') && !this.get('height')) {\n      this.set('width', clientWidth);\n      this.set('height', clientHeight);\n    }\n\n    var renderer = this.get('renderer');\n    var canvas;\n\n    if (renderer === SVG) {\n      canvas = new GSVGCanvas({\n        container: container,\n        width: width,\n        height: height\n      });\n    } else {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n    }\n\n    this.set('canvas', canvas);\n  };\n\n  Graph.prototype.initPlugins = function () {\n    var self = this;\n    each(self.get('plugins'), function (plugin) {\n      if (!plugin.destroyed && plugin.initPlugin) {\n        plugin.initPlugin(self);\n      }\n    });\n  };\n  /**\n  * 增加图片下载水印功能\n  */\n\n\n  Graph.prototype.downloadImageWatermark = function (watermarker, context, width, height) {\n    return __awaiter(this, void 0, void 0, function () {\n      var watermarkStr, watermarkbase64, img;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            watermarkStr = watermarker.style.backgroundImage;\n            watermarkbase64 = watermarkStr.slice(5, watermarkStr.length - 2);\n            img = new Image();\n            img.src = watermarkbase64;\n            return [4\n            /*yield*/\n            , new Promise(function (resolve) {\n              img.onload = function () {\n                var pat = context.createPattern(img, \"repeat\");\n                context.rect(0, 0, width, height);\n                context.fillStyle = pat;\n                context.fill();\n                resolve('');\n              };\n            })];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\n   * 用于生成图片 (异步callback)\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   * @return {string} 图片 dataURL\n   */\n\n\n  Graph.prototype.asyncToDataUrl = function (type, backgroundColor, callback, widths, heights, vCanvasEl) {\n    var _this = this;\n\n    var watermarker = document.querySelector('.g6-graph-watermarker');\n    var canvas = this.get('canvas');\n    var renderer = canvas.getRenderer();\n    var canvasDom = vCanvasEl || canvas.get('el');\n    var dataURL = '';\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var cloneNode, svgDocType, svgDoc, svgData, imageData, context, width, height, compositeOperation, pixelRatio;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!(renderer === 'svg')) return [3\n              /*break*/\n              , 1];\n              cloneNode = canvasDom.cloneNode(true);\n              svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n              svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n              svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n              svgData = new XMLSerializer().serializeToString(svgDoc);\n              dataURL = \"data:image/svg+xml;charset=utf8,\".concat(encodeURIComponent(svgData));\n              return [3\n              /*break*/\n              , 4];\n\n            case 1:\n              imageData = void 0;\n              context = canvasDom.getContext('2d');\n              width = widths || this.get('width');\n              height = heights || this.get('height');\n              compositeOperation = void 0;\n              if (!watermarker) return [3\n              /*break*/\n              , 3];\n              return [4\n              /*yield*/\n              , this.downloadImageWatermark(watermarker, context, width, height)];\n\n            case 2:\n              _a.sent();\n\n              _a.label = 3;\n\n            case 3:\n              if (backgroundColor) {\n                pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n\n                try {\n                  imageData = context.getImageData(0, 0, width * pixelRatio, height * pixelRatio);\n                  compositeOperation = context.globalCompositeOperation;\n                  context.globalCompositeOperation = 'destination-over';\n                  context.fillStyle = backgroundColor;\n                  context.fillRect(0, 0, width, height);\n                } catch (error) {\n                  console.error('Download image failed. Out of memory at ImageData creation');\n                }\n              }\n\n              dataURL = canvasDom.toDataURL(type);\n\n              if (backgroundColor) {\n                context.clearRect(0, 0, width, height);\n                context.putImageData(imageData, 0, 0);\n                context.globalCompositeOperation = compositeOperation;\n              }\n\n              _a.label = 4;\n\n            case 4:\n              if (callback) callback(dataURL);\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }, 16);\n  };\n  /**\n   * 返回可见区域的图的 dataUrl，用于生成图片\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   * @return {string} 图片 dataURL\n   */\n\n\n  Graph.prototype.toDataURL = function (type, backgroundColor) {\n    var canvas = this.get('canvas');\n    var renderer = canvas.getRenderer();\n    var canvasDom = canvas.get('el');\n    if (!type) type = 'image/png';\n    var dataURL = '';\n\n    if (renderer === 'svg') {\n      var cloneNode = canvasDom.cloneNode(true);\n      var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n      var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n      svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n      var svgData = new XMLSerializer().serializeToString(svgDoc);\n      dataURL = \"data:image/svg+xml;charset=utf8,\".concat(encodeURIComponent(svgData));\n    } else {\n      var imageData = void 0;\n      var context = canvasDom.getContext('2d');\n      var width = Math.max(this.get('width'), 500);\n      var height = Math.max(this.get('height'), 500);\n      var compositeOperation = void 0;\n\n      if (backgroundColor) {\n        var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio || 1 : 1;\n\n        try {\n          imageData = context.getImageData(0, 0, width * pixelRatio, height * pixelRatio);\n          compositeOperation = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'destination-over';\n          context.fillStyle = backgroundColor;\n          context.fillRect(0, 0, width, height);\n        } catch (error) {\n          console.error('Download image failed. Out of memory at ImageData creation');\n        }\n      }\n\n      dataURL = canvasDom.toDataURL(type);\n\n      if (backgroundColor) {\n        context.clearRect(0, 0, width, height);\n        context.putImageData(imageData, 0, 0);\n        context.globalCompositeOperation = compositeOperation;\n      }\n    }\n\n    return dataURL;\n  };\n  /**\n   * 返回整个图（包括超出可见区域的部分）的 dataUrl，用于生成图片\n   * @param {Function} callback 异步生成 dataUrl 完成后的回调函数，在这里处理生成的 dataUrl 字符串\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.toFullDataURL = function (callback, type, imageConfig) {\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<div id=\"virtual-image\"></div>');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth,\n      quickHit: true\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    var dataURL = '';\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      if (renderer === 'svg') {\n        var cloneNode = vCanvasEl.cloneNode(true);\n        var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n        var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n        svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n        var svgData = new XMLSerializer().serializeToString(svgDoc);\n        dataURL = \"data:image/svg+xml;charset=utf8,\".concat(encodeURIComponent(svgData));\n      } else {\n        var imageData = void 0;\n        var context = vCanvasEl.getContext('2d');\n        var compositeOperation = void 0;\n\n        if (backgroundColor) {\n          var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n\n          try {\n            imageData = context.getImageData(0, 0, vWidth * pixelRatio, vHeight * pixelRatio);\n            compositeOperation = context.globalCompositeOperation;\n            context.globalCompositeOperation = 'destination-over';\n            context.fillStyle = backgroundColor;\n            context.fillRect(0, 0, vWidth, vHeight);\n          } catch (error) {\n            console.error('Download image failed. Out of memory at ImageData creation');\n          }\n        }\n\n        dataURL = vCanvasEl.toDataURL(type);\n\n        if (backgroundColor) {\n          context.clearRect(0, 0, vWidth, vHeight);\n          context.putImageData(imageData, 0, 0);\n          context.globalCompositeOperation = compositeOperation;\n        }\n      }\n\n      if (callback) callback(dataURL);\n    }, 16);\n  };\n  /**\n   * 导出包含全图的图片\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.downloadFullImage = function (name, type, imageConfig) {\n    var _this = this;\n\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<div id=\"virtual-image\"></div>');\n    var watermarker = document.querySelector('.g6-graph-watermarker');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n\n    if (watermarker) {\n      var _a = this.get('graphWaterMarker').cfg || {},\n          wmWidth = _a.width,\n          wmHeight = _a.height;\n\n      vHeight = Math.ceil(vHeight / wmHeight) * wmHeight;\n      vWidth = Math.ceil(vWidth / wmWidth) * wmWidth;\n    }\n\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    if (!type) type = 'image/png';\n    this.asyncToDataUrl(type, backgroundColor, function (dataURL) {\n      var link = document.createElement('a');\n      var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : \".\".concat(type.split('/')[1]));\n\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    }, vWidth, vHeight, vCanvasEl);\n  };\n  /**\n   * 画布导出图片，图片仅包含画布可见区域部分内容\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   */\n\n\n  Graph.prototype.downloadImage = function (name, type, backgroundColor) {\n    var _this = this;\n\n    var self = this;\n    self.stopAnimate();\n    var canvas = self.get('canvas');\n    var renderer = canvas.getRenderer();\n    if (!type) type = 'image/png';\n    var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : type.split('/')[1]);\n    var link = document.createElement('a');\n    self.asyncToDataUrl(type, backgroundColor, function (dataURL) {\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    });\n  };\n\n  Graph.prototype.dataURLToImage = function (dataURL, renderer, link, fileName) {\n    if (!dataURL || dataURL === 'data:') {\n      console.error('Download image failed. The graph is too large or there is invalid attribute values in graph items');\n      return;\n    }\n\n    if (typeof window !== 'undefined') {\n      if (window.Blob && window.URL && renderer !== 'svg') {\n        var arr = dataURL.split(',');\n        var mime = '';\n\n        if (arr && arr.length > 0) {\n          var match = arr[0].match(/:(.*?);/); // eslint-disable-next-line prefer-destructuring\n\n          if (match && match.length >= 2) mime = match[1];\n        }\n\n        var bstr = atob(arr[1]);\n        var n = bstr.length;\n        var u8arr = new Uint8Array(n);\n\n        while (n--) {\n          u8arr[n] = bstr.charCodeAt(n);\n        }\n\n        var blobObj_1 = new Blob([u8arr], {\n          type: mime\n        });\n\n        if (window.navigator.msSaveBlob) {\n          window.navigator.msSaveBlob(blobObj_1, fileName);\n        } else {\n          link.addEventListener('click', function () {\n            link.download = fileName;\n            link.href = window.URL.createObjectURL(blobObj_1);\n          });\n        }\n      } else {\n        link.addEventListener('click', function () {\n          link.download = fileName;\n          link.href = dataURL;\n        });\n      }\n    }\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.addPlugin = function (plugin) {\n    var self = this;\n\n    if (plugin.destroyed) {\n      return;\n    }\n\n    self.get('plugins').push(plugin);\n    plugin.initPlugin(self);\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.removePlugin = function (plugin) {\n    var plugins = this.get('plugins');\n    var index = plugins.indexOf(plugin);\n\n    if (index >= 0) {\n      plugin.destroyPlugin();\n      plugins.splice(index, 1);\n    }\n  };\n  /**\n   * 设置图片水印\n   * @param {string} imgURL 图片水印的url地址\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setImageWaterMarker = function (imgURL, config) {\n    if (imgURL === void 0) {\n      imgURL = Global.waterMarkerImage;\n    }\n\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.imageWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        image = waterMarkerConfig.image;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = image.rotate,\n        x = image.x,\n        y = image.y; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180);\n    var img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.src = imgURL;\n\n    img.onload = function () {\n      ctx.drawImage(img, x, y, image.width, image.height); // 恢复旋转角度\n\n      ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n      if (!compatible) {\n        var box = document.querySelector('.g6-graph-watermarker');\n\n        if (!box) {\n          box = document.createElement('div');\n          box.className = 'g6-graph-watermarker';\n        }\n\n        box.className = 'g6-graph-watermarker';\n\n        if (!canvas.destroyed) {\n          box.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:-1;\");\n          container.appendChild(box);\n        }\n      } else {\n        // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n        container.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;\");\n      }\n    };\n  };\n  /**\n   * 设置文本水印\n   * @param {string[]} texts 水印的文本内容\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setTextWaterMarker = function (texts, config) {\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.textWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        text = waterMarkerConfig.text;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = text.rotate,\n        fill = text.fill,\n        fontFamily = text.fontFamily,\n        fontSize = text.fontSize,\n        baseline = text.baseline,\n        x = text.x,\n        y = text.y,\n        lineHeight = text.lineHeight; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180); // 设置文字样式\n\n    ctx.font = \"\".concat(fontSize, \"px \").concat(fontFamily); // 设置文字颜色\n\n    ctx.fillStyle = fill;\n    ctx.textBaseline = baseline;\n\n    for (var i = texts.length - 1; i >= 0; i--) {\n      // 将文字绘制到画布\n      ctx.fillText(texts[i], x, y + i * lineHeight);\n    } // 恢复旋转角度\n\n\n    ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n    if (!compatible) {\n      var box = document.querySelector('.g6-graph-watermarker');\n\n      if (!box) {\n        box = document.createElement('div');\n        box.className = 'g6-graph-watermarker';\n      }\n\n      box.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:99;\");\n      container.appendChild(box);\n    } else {\n      // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n      container.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;\");\n    }\n  };\n  /**\n   * 销毁画布\n   */\n\n\n  Graph.prototype.destroy = function () {\n    var _a, _b, _c, _d;\n\n    each(this.get('plugins'), function (plugin) {\n      plugin.destroyPlugin();\n    }); // destroy tooltip doms, removed when upgrade G6 4.0\n\n    var tooltipDOMs = this.get('tooltips');\n\n    if (tooltipDOMs) {\n      for (var i = 0; i < tooltipDOMs.length; i++) {\n        var container = tooltipDOMs[i];\n        if (!container) continue;\n        var parent_1 = container.parentElement;\n        if (!parent_1) continue;\n        parent_1.removeChild(container);\n      }\n    }\n\n    (_a = this.get('eventController')) === null || _a === void 0 ? void 0 : _a.destroy();\n    (_b = this.get('layoutController')) === null || _b === void 0 ? void 0 : _b.destroy(); // this.get('eventController').destroy();\n    // this.get('itemController').destroy();\n    // this.get('modeController').destroy();\n    // this.get('viewController').destroy();\n    // this.get('stateController').destroy();\n    // this.get('canvas').destroy();\n\n    (_c = this.get('graphWaterMarker')) === null || _c === void 0 ? void 0 : _c.destroy();\n    (_d = document.querySelector('.g6-graph-watermarker')) === null || _d === void 0 ? void 0 : _d.remove();\n\n    _super.prototype.destroy.call(this);\n  };\n\n  return Graph;\n}(AbstractGraph);\n\nexport default Graph;","map":{"version":3,"names":["__awaiter","__extends","__generator","Canvas","GCanvas","GSVGCanvas","ext","clone","deepMix","each","isString","isNumber","AbstractGraph","Global","LayoutController","EventController","createDom","transform","SVG","Graph","_super","cfg","_this","call","defaultNode","get","set","type","destroyed","prototype","initLayoutController","layoutController","initEventController","eventController","initCanvas","container","document","getElementById","Error","clientWidth","clientHeight","width","height","renderer","canvas","canvasCfg","pixelRatio","initPlugins","self","plugin","initPlugin","downloadImageWatermark","watermarker","context","watermarkStr","watermarkbase64","img","_a","label","style","backgroundImage","slice","length","Image","src","Promise","resolve","onload","pat","createPattern","rect","fillStyle","fill","sent","asyncToDataUrl","backgroundColor","callback","widths","heights","vCanvasEl","querySelector","getRenderer","canvasDom","dataURL","setTimeout","cloneNode","svgDocType","svgDoc","svgData","imageData","compositeOperation","implementation","createDocumentType","createDocument","replaceChild","documentElement","XMLSerializer","serializeToString","concat","encodeURIComponent","getContext","window","devicePixelRatio","getImageData","globalCompositeOperation","fillRect","error","console","toDataURL","clearRect","putImageData","Math","max","toFullDataURL","imageConfig","bbox","getCanvasBBox","vContainerDOM","undefined","padding","vHeight","vWidth","canvasOptions","quickHit","vCanvas","group","vGroup","matrix","getMatrix","centerX","maxX","minX","centerY","maxY","minY","resetMatrix","setMatrix","add","downloadFullImage","name","wmWidth","wmHeight","ceil","link","createElement","fileName","split","dataURLToImage","e","createEvent","initEvent","dispatchEvent","downloadImage","stopAnimate","Blob","URL","arr","mime","match","bstr","atob","n","u8arr","Uint8Array","charCodeAt","blobObj_1","navigator","msSaveBlob","addEventListener","download","href","createObjectURL","addPlugin","push","removePlugin","plugins","index","indexOf","destroyPlugin","splice","setImageWaterMarker","imgURL","config","waterMarkerImage","position","waterMarkerConfig","imageWaterMarkerConfig","compatible","image","capture","display","ctx","rotate","x","y","PI","crossOrigin","drawImage","box","className","cssText","appendChild","setTextWaterMarker","texts","textWaterMarkerConfig","text","fontFamily","fontSize","baseline","lineHeight","font","textBaseline","i","fillText","destroy","_b","_c","_d","tooltipDOMs","parent_1","parentElement","removeChild","remove"],"sources":["/Users/wawalike/Desktop/ggProject/node_modules/@antv/g6-pc/es/graph/graph.js"],"sourcesContent":["import { __awaiter, __extends, __generator } from \"tslib\";\nimport { Canvas as GCanvas } from '@antv/g-canvas';\nimport { Canvas as GSVGCanvas } from '@antv/g-svg';\nimport { ext } from '@antv/matrix-util';\nimport { clone, deepMix, each, isString, isNumber } from '@antv/util';\nimport { AbstractGraph } from '@antv/g6-core';\nimport Global from '../global';\nimport { LayoutController, EventController } from './controller';\nimport { createDom } from '@antv/dom-util';\nvar transform = ext.transform;\nvar SVG = 'svg';\n\nvar Graph =\n/** @class */\nfunction (_super) {\n  __extends(Graph, _super);\n\n  function Graph(cfg) {\n    var _this = _super.call(this, cfg) || this;\n\n    var defaultNode = _this.get('defaultNode');\n\n    if (!defaultNode) {\n      _this.set('defaultNode', {\n        type: 'circle'\n      });\n    }\n\n    if (!defaultNode.type) {\n      defaultNode.type = 'circle';\n\n      _this.set('defaultNode', defaultNode);\n    }\n\n    _this.destroyed = false;\n    return _this;\n  }\n\n  Graph.prototype.initLayoutController = function () {\n    var layoutController = new LayoutController(this);\n    this.set({\n      layoutController: layoutController\n    });\n  };\n\n  Graph.prototype.initEventController = function () {\n    var eventController = new EventController(this);\n    this.set({\n      eventController: eventController\n    });\n  };\n\n  Graph.prototype.initCanvas = function () {\n    var container = this.get('container');\n\n    if (typeof container === 'string') {\n      container = document.getElementById(container);\n      this.set('container', container);\n    }\n\n    if (!container) {\n      throw new Error('invalid container');\n    }\n\n    var clientWidth = container.clientWidth,\n        clientHeight = container.clientHeight;\n    var width = this.get('width') || clientWidth;\n    var height = this.get('height') || clientHeight;\n\n    if (!this.get('width') && !this.get('height')) {\n      this.set('width', clientWidth);\n      this.set('height', clientHeight);\n    }\n\n    var renderer = this.get('renderer');\n    var canvas;\n\n    if (renderer === SVG) {\n      canvas = new GSVGCanvas({\n        container: container,\n        width: width,\n        height: height\n      });\n    } else {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n    }\n\n    this.set('canvas', canvas);\n  };\n\n  Graph.prototype.initPlugins = function () {\n    var self = this;\n    each(self.get('plugins'), function (plugin) {\n      if (!plugin.destroyed && plugin.initPlugin) {\n        plugin.initPlugin(self);\n      }\n    });\n  };\n  /**\n  * 增加图片下载水印功能\n  */\n\n\n  Graph.prototype.downloadImageWatermark = function (watermarker, context, width, height) {\n    return __awaiter(this, void 0, void 0, function () {\n      var watermarkStr, watermarkbase64, img;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            watermarkStr = watermarker.style.backgroundImage;\n            watermarkbase64 = watermarkStr.slice(5, watermarkStr.length - 2);\n            img = new Image();\n            img.src = watermarkbase64;\n            return [4\n            /*yield*/\n            , new Promise(function (resolve) {\n              img.onload = function () {\n                var pat = context.createPattern(img, \"repeat\");\n                context.rect(0, 0, width, height);\n                context.fillStyle = pat;\n                context.fill();\n                resolve('');\n              };\n            })];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\n   * 用于生成图片 (异步callback)\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   * @return {string} 图片 dataURL\n   */\n\n\n  Graph.prototype.asyncToDataUrl = function (type, backgroundColor, callback, widths, heights, vCanvasEl) {\n    var _this = this;\n\n    var watermarker = document.querySelector('.g6-graph-watermarker');\n    var canvas = this.get('canvas');\n    var renderer = canvas.getRenderer();\n    var canvasDom = vCanvasEl || canvas.get('el');\n    var dataURL = '';\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var cloneNode, svgDocType, svgDoc, svgData, imageData, context, width, height, compositeOperation, pixelRatio;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!(renderer === 'svg')) return [3\n              /*break*/\n              , 1];\n              cloneNode = canvasDom.cloneNode(true);\n              svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n              svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n              svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n              svgData = new XMLSerializer().serializeToString(svgDoc);\n              dataURL = \"data:image/svg+xml;charset=utf8,\".concat(encodeURIComponent(svgData));\n              return [3\n              /*break*/\n              , 4];\n\n            case 1:\n              imageData = void 0;\n              context = canvasDom.getContext('2d');\n              width = widths || this.get('width');\n              height = heights || this.get('height');\n              compositeOperation = void 0;\n              if (!watermarker) return [3\n              /*break*/\n              , 3];\n              return [4\n              /*yield*/\n              , this.downloadImageWatermark(watermarker, context, width, height)];\n\n            case 2:\n              _a.sent();\n\n              _a.label = 3;\n\n            case 3:\n              if (backgroundColor) {\n                pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n\n                try {\n                  imageData = context.getImageData(0, 0, width * pixelRatio, height * pixelRatio);\n                  compositeOperation = context.globalCompositeOperation;\n                  context.globalCompositeOperation = 'destination-over';\n                  context.fillStyle = backgroundColor;\n                  context.fillRect(0, 0, width, height);\n                } catch (error) {\n                  console.error('Download image failed. Out of memory at ImageData creation');\n                }\n              }\n\n              dataURL = canvasDom.toDataURL(type);\n\n              if (backgroundColor) {\n                context.clearRect(0, 0, width, height);\n                context.putImageData(imageData, 0, 0);\n                context.globalCompositeOperation = compositeOperation;\n              }\n\n              _a.label = 4;\n\n            case 4:\n              if (callback) callback(dataURL);\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }, 16);\n  };\n  /**\n   * 返回可见区域的图的 dataUrl，用于生成图片\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   * @return {string} 图片 dataURL\n   */\n\n\n  Graph.prototype.toDataURL = function (type, backgroundColor) {\n    var canvas = this.get('canvas');\n    var renderer = canvas.getRenderer();\n    var canvasDom = canvas.get('el');\n    if (!type) type = 'image/png';\n    var dataURL = '';\n\n    if (renderer === 'svg') {\n      var cloneNode = canvasDom.cloneNode(true);\n      var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n      var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n      svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n      var svgData = new XMLSerializer().serializeToString(svgDoc);\n      dataURL = \"data:image/svg+xml;charset=utf8,\".concat(encodeURIComponent(svgData));\n    } else {\n      var imageData = void 0;\n      var context = canvasDom.getContext('2d');\n      var width = Math.max(this.get('width'), 500);\n      var height = Math.max(this.get('height'), 500);\n      var compositeOperation = void 0;\n\n      if (backgroundColor) {\n        var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio || 1 : 1;\n\n        try {\n          imageData = context.getImageData(0, 0, width * pixelRatio, height * pixelRatio);\n          compositeOperation = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'destination-over';\n          context.fillStyle = backgroundColor;\n          context.fillRect(0, 0, width, height);\n        } catch (error) {\n          console.error('Download image failed. Out of memory at ImageData creation');\n        }\n      }\n\n      dataURL = canvasDom.toDataURL(type);\n\n      if (backgroundColor) {\n        context.clearRect(0, 0, width, height);\n        context.putImageData(imageData, 0, 0);\n        context.globalCompositeOperation = compositeOperation;\n      }\n    }\n\n    return dataURL;\n  };\n  /**\n   * 返回整个图（包括超出可见区域的部分）的 dataUrl，用于生成图片\n   * @param {Function} callback 异步生成 dataUrl 完成后的回调函数，在这里处理生成的 dataUrl 字符串\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.toFullDataURL = function (callback, type, imageConfig) {\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<div id=\"virtual-image\"></div>');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth,\n      quickHit: true\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    var dataURL = '';\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      if (renderer === 'svg') {\n        var cloneNode = vCanvasEl.cloneNode(true);\n        var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n        var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n        svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n        var svgData = new XMLSerializer().serializeToString(svgDoc);\n        dataURL = \"data:image/svg+xml;charset=utf8,\".concat(encodeURIComponent(svgData));\n      } else {\n        var imageData = void 0;\n        var context = vCanvasEl.getContext('2d');\n        var compositeOperation = void 0;\n\n        if (backgroundColor) {\n          var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n\n          try {\n            imageData = context.getImageData(0, 0, vWidth * pixelRatio, vHeight * pixelRatio);\n            compositeOperation = context.globalCompositeOperation;\n            context.globalCompositeOperation = 'destination-over';\n            context.fillStyle = backgroundColor;\n            context.fillRect(0, 0, vWidth, vHeight);\n          } catch (error) {\n            console.error('Download image failed. Out of memory at ImageData creation');\n          }\n        }\n\n        dataURL = vCanvasEl.toDataURL(type);\n\n        if (backgroundColor) {\n          context.clearRect(0, 0, vWidth, vHeight);\n          context.putImageData(imageData, 0, 0);\n          context.globalCompositeOperation = compositeOperation;\n        }\n      }\n\n      if (callback) callback(dataURL);\n    }, 16);\n  };\n  /**\n   * 导出包含全图的图片\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.downloadFullImage = function (name, type, imageConfig) {\n    var _this = this;\n\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<div id=\"virtual-image\"></div>');\n    var watermarker = document.querySelector('.g6-graph-watermarker');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n\n    if (watermarker) {\n      var _a = this.get('graphWaterMarker').cfg || {},\n          wmWidth = _a.width,\n          wmHeight = _a.height;\n\n      vHeight = Math.ceil(vHeight / wmHeight) * wmHeight;\n      vWidth = Math.ceil(vWidth / wmWidth) * wmWidth;\n    }\n\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    if (!type) type = 'image/png';\n    this.asyncToDataUrl(type, backgroundColor, function (dataURL) {\n      var link = document.createElement('a');\n      var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : \".\".concat(type.split('/')[1]));\n\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    }, vWidth, vHeight, vCanvasEl);\n  };\n  /**\n   * 画布导出图片，图片仅包含画布可见区域部分内容\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   */\n\n\n  Graph.prototype.downloadImage = function (name, type, backgroundColor) {\n    var _this = this;\n\n    var self = this;\n    self.stopAnimate();\n    var canvas = self.get('canvas');\n    var renderer = canvas.getRenderer();\n    if (!type) type = 'image/png';\n    var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : type.split('/')[1]);\n    var link = document.createElement('a');\n    self.asyncToDataUrl(type, backgroundColor, function (dataURL) {\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    });\n  };\n\n  Graph.prototype.dataURLToImage = function (dataURL, renderer, link, fileName) {\n    if (!dataURL || dataURL === 'data:') {\n      console.error('Download image failed. The graph is too large or there is invalid attribute values in graph items');\n      return;\n    }\n\n    if (typeof window !== 'undefined') {\n      if (window.Blob && window.URL && renderer !== 'svg') {\n        var arr = dataURL.split(',');\n        var mime = '';\n\n        if (arr && arr.length > 0) {\n          var match = arr[0].match(/:(.*?);/); // eslint-disable-next-line prefer-destructuring\n\n          if (match && match.length >= 2) mime = match[1];\n        }\n\n        var bstr = atob(arr[1]);\n        var n = bstr.length;\n        var u8arr = new Uint8Array(n);\n\n        while (n--) {\n          u8arr[n] = bstr.charCodeAt(n);\n        }\n\n        var blobObj_1 = new Blob([u8arr], {\n          type: mime\n        });\n\n        if (window.navigator.msSaveBlob) {\n          window.navigator.msSaveBlob(blobObj_1, fileName);\n        } else {\n          link.addEventListener('click', function () {\n            link.download = fileName;\n            link.href = window.URL.createObjectURL(blobObj_1);\n          });\n        }\n      } else {\n        link.addEventListener('click', function () {\n          link.download = fileName;\n          link.href = dataURL;\n        });\n      }\n    }\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.addPlugin = function (plugin) {\n    var self = this;\n\n    if (plugin.destroyed) {\n      return;\n    }\n\n    self.get('plugins').push(plugin);\n    plugin.initPlugin(self);\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.removePlugin = function (plugin) {\n    var plugins = this.get('plugins');\n    var index = plugins.indexOf(plugin);\n\n    if (index >= 0) {\n      plugin.destroyPlugin();\n      plugins.splice(index, 1);\n    }\n  };\n  /**\n   * 设置图片水印\n   * @param {string} imgURL 图片水印的url地址\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setImageWaterMarker = function (imgURL, config) {\n    if (imgURL === void 0) {\n      imgURL = Global.waterMarkerImage;\n    }\n\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.imageWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        image = waterMarkerConfig.image;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = image.rotate,\n        x = image.x,\n        y = image.y; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180);\n    var img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.src = imgURL;\n\n    img.onload = function () {\n      ctx.drawImage(img, x, y, image.width, image.height); // 恢复旋转角度\n\n      ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n      if (!compatible) {\n        var box = document.querySelector('.g6-graph-watermarker');\n\n        if (!box) {\n          box = document.createElement('div');\n          box.className = 'g6-graph-watermarker';\n        }\n\n        box.className = 'g6-graph-watermarker';\n\n        if (!canvas.destroyed) {\n          box.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:-1;\");\n          container.appendChild(box);\n        }\n      } else {\n        // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n        container.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;\");\n      }\n    };\n  };\n  /**\n   * 设置文本水印\n   * @param {string[]} texts 水印的文本内容\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setTextWaterMarker = function (texts, config) {\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.textWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        text = waterMarkerConfig.text;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = text.rotate,\n        fill = text.fill,\n        fontFamily = text.fontFamily,\n        fontSize = text.fontSize,\n        baseline = text.baseline,\n        x = text.x,\n        y = text.y,\n        lineHeight = text.lineHeight; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180); // 设置文字样式\n\n    ctx.font = \"\".concat(fontSize, \"px \").concat(fontFamily); // 设置文字颜色\n\n    ctx.fillStyle = fill;\n    ctx.textBaseline = baseline;\n\n    for (var i = texts.length - 1; i >= 0; i--) {\n      // 将文字绘制到画布\n      ctx.fillText(texts[i], x, y + i * lineHeight);\n    } // 恢复旋转角度\n\n\n    ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n    if (!compatible) {\n      var box = document.querySelector('.g6-graph-watermarker');\n\n      if (!box) {\n        box = document.createElement('div');\n        box.className = 'g6-graph-watermarker';\n      }\n\n      box.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:99;\");\n      container.appendChild(box);\n    } else {\n      // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n      container.style.cssText = \"background-image: url(\".concat(canvas.get('el').toDataURL('image/png'), \");background-repeat:repeat;\");\n    }\n  };\n  /**\n   * 销毁画布\n   */\n\n\n  Graph.prototype.destroy = function () {\n    var _a, _b, _c, _d;\n\n    each(this.get('plugins'), function (plugin) {\n      plugin.destroyPlugin();\n    }); // destroy tooltip doms, removed when upgrade G6 4.0\n\n    var tooltipDOMs = this.get('tooltips');\n\n    if (tooltipDOMs) {\n      for (var i = 0; i < tooltipDOMs.length; i++) {\n        var container = tooltipDOMs[i];\n        if (!container) continue;\n        var parent_1 = container.parentElement;\n        if (!parent_1) continue;\n        parent_1.removeChild(container);\n      }\n    }\n\n    (_a = this.get('eventController')) === null || _a === void 0 ? void 0 : _a.destroy();\n    (_b = this.get('layoutController')) === null || _b === void 0 ? void 0 : _b.destroy(); // this.get('eventController').destroy();\n    // this.get('itemController').destroy();\n    // this.get('modeController').destroy();\n    // this.get('viewController').destroy();\n    // this.get('stateController').destroy();\n    // this.get('canvas').destroy();\n\n    (_c = this.get('graphWaterMarker')) === null || _c === void 0 ? void 0 : _c.destroy();\n    (_d = document.querySelector('.g6-graph-watermarker')) === null || _d === void 0 ? void 0 : _d.remove();\n\n    _super.prototype.destroy.call(this);\n  };\n\n  return Graph;\n}(AbstractGraph);\n\nexport default Graph;"],"mappings":"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"},"metadata":{},"sourceType":"module"}