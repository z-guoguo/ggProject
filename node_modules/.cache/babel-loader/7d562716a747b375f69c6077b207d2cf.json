{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport Base from '../base';\nimport { isString, isNil } from '@antv/util';\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport { Util } from '@antv/g6-core';\nimport { mat3 } from '@antv/matrix-util';\nvar applyMatrix = Util.applyMatrix;\n\nfunction getImgNaturalDimension(img, callback) {\n  var nWidth, nHeight;\n\n  if (img.naturalWidth) {\n    // 现代浏览器\n    nWidth = img.naturalWidth;\n    nHeight = img.naturalHeight;\n  } else {\n    // IE6/7/8\n    var image_1 = new Image();\n    image_1.src = img.src;\n\n    image_1.onload = function () {\n      if (callback) callback(image_1.width, image_1.height);\n    };\n  }\n\n  return [nWidth, nHeight];\n}\n\nvar ImageMiniMap =\n/** @class */\nfunction (_super) {\n  __extends(ImageMiniMap, _super);\n\n  function ImageMiniMap(config) {\n    return _super.call(this, config) || this;\n  }\n\n  ImageMiniMap.prototype.getDefaultCfgs = function () {\n    return {\n      container: null,\n      className: 'g6-minimap',\n      viewportClassName: 'g6-minimap-viewport',\n      width: 200,\n      delegateStyle: {\n        fill: '#40a9ff',\n        stroke: '#096dd9'\n      },\n      refresh: true\n    };\n  };\n\n  ImageMiniMap.prototype.getEvents = function () {\n    return {\n      beforepaint: 'updateViewport',\n      beforeanimate: 'disableRefresh',\n      afteranimate: 'enableRefresh',\n      viewportchange: 'disableOneRefresh'\n    };\n  }; // 若是正在进行动画，不刷新缩略图\n\n\n  ImageMiniMap.prototype.disableRefresh = function () {\n    this.set('refresh', false);\n  };\n\n  ImageMiniMap.prototype.enableRefresh = function () {\n    this.set('refresh', true);\n    this.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.disableOneRefresh = function () {\n    this.set('viewportChange', true);\n  };\n\n  ImageMiniMap.prototype.initViewport = function () {\n    var _this = this;\n\n    var cfgs = this._cfgs; // cWidth and cHeight are the width and height of the minimap's container\n\n    var graph = cfgs.graph;\n    if (this.destroyed) return;\n    var containerDOM = this.get('container');\n\n    if (isString(containerDOM)) {\n      containerDOM = document.getElementById(containerDOM);\n    }\n\n    var viewport = createDom(\"<div class=\".concat(cfgs.viewportClassName, \"\\n      style='position:absolute;\\n        left:0;\\n        top:0;\\n        box-sizing:border-box;\\n        border: 2px solid #1980ff;\\n        cursor:move'\\n      </div>\")); // 计算拖拽水平方向距离\n\n    var x = 0; // 计算拖拽垂直方向距离\n\n    var y = 0; // 是否在拖拽minimap的视口\n\n    var dragging = false; // 缓存viewport当前对于画布的x\n\n    var left = 0; // 缓存viewport当前对于画布的y\n\n    var top = 0; // 缓存viewport当前宽度\n\n    var width = 0; // 缓存viewport当前高度\n\n    var height = 0;\n    var ratio = 0;\n    var zoom = 0;\n    containerDOM.addEventListener('mousedown', function (e) {\n      cfgs.refresh = false;\n\n      if (e.target !== viewport) {\n        return;\n      } // 如果视口已经最大了，不需要拖拽\n\n\n      var style = viewport.style;\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      if (width > cWidth || height > cHeight) {\n        return;\n      }\n\n      zoom = graph.getZoom();\n      ratio = _this.get('ratio');\n      dragging = true;\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mousemove', function (e) {\n      if (!dragging || isNil(e.clientX) || isNil(e.clientY)) {\n        return;\n      }\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      var style = viewport.style;\n      left = parseInt(style.left, 10);\n      top = parseInt(style.top, 10);\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n      var dx = x - e.clientX;\n      var dy = y - e.clientY; // 若视口移动到最左边或最右边了,仅移动到边界\n\n      if (left - dx < 0) {\n        dx = left;\n      } else if (left - dx + width >= cWidth) {\n        dx = 0;\n      } // 若视口移动到最上或最下边了，仅移动到边界\n\n\n      if (top - dy < 0) {\n        dy = top;\n      } else if (top - dy + height >= cHeight) {\n        dy = 0;\n      }\n\n      left -= dx;\n      top -= dy; // 先移动视口，避免移动到边上以后出现视口闪烁\n\n      modifyCSS(viewport, {\n        left: \"\".concat(left, \"px\"),\n        top: \"\".concat(top, \"px\")\n      }); // graph 移动需要偏移量 dx/dy * 缩放比例才会得到正确的移动距离\n\n      graph.translate(dx * zoom / ratio, dy * zoom / ratio);\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mouseleave', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    containerDOM.addEventListener('mouseup', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    this.set('viewport', viewport);\n    containerDOM.appendChild(viewport);\n  };\n  /**\n   * 更新 viewport 视图\n   */\n\n\n  ImageMiniMap.prototype.updateViewport = function () {\n    if (this.destroyed) return;\n    var ratio = this.get('ratio');\n    var cWidth = this.get('width');\n    var cHeight = this.get('height');\n    var graph = this.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphWidth / graphHeight;\n    var graphGroup = graph.getGroup(); // 主图的 bbox（矩阵变换相关的 bbox）\n\n    var graphCanvasBBox = graphGroup.getCanvasBBox(); // 扩展 graphBBox 到和 graphWidth / graphHeight 等比\n\n    var graphCanvasBBoxMean = [(graphCanvasBBox.minX + graphCanvasBBox.maxX) / 2, (graphCanvasBBox.minY + graphCanvasBBox.maxY) / 2];\n    var graphCanvasBBoxSize = [graphCanvasBBox.maxX - graphCanvasBBox.minX, graphCanvasBBox.maxY - graphCanvasBBox.minY];\n    var expandedGraphCanvasBBox = {\n      centerX: graphCanvasBBoxMean[0],\n      centerY: graphCanvasBBoxMean[1],\n      width: 0,\n      height: 0,\n      minX: 0,\n      minY: 0\n    };\n\n    if (graphCanvasBBox[0] / graphCanvasBBox[1] > aspectRatio) {\n      expandedGraphCanvasBBox.width = graphCanvasBBoxSize[0];\n      expandedGraphCanvasBBox.height = expandedGraphCanvasBBox.width / aspectRatio;\n    } else {\n      expandedGraphCanvasBBox.height = graphCanvasBBoxSize[1];\n      expandedGraphCanvasBBox.width = expandedGraphCanvasBBox.height * aspectRatio;\n    }\n\n    expandedGraphCanvasBBox.minX = graphCanvasBBoxMean[0] - expandedGraphCanvasBBox.width / 2;\n    expandedGraphCanvasBBox.minY = graphCanvasBBoxMean[1] - expandedGraphCanvasBBox.height / 2;\n    var graphMatrix = graphGroup.getMatrix();\n    if (!graphMatrix) graphMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var invertGraphMatrix = mat3.invert([1, 0, 0, 0, 1, 0, 0, 0, 1], graphMatrix);\n    var minXY = applyMatrix({\n      x: expandedGraphCanvasBBox.minX,\n      y: expandedGraphCanvasBBox.minY\n    }, invertGraphMatrix); // 扩展 graphBBox 后的 bbox 的左上角对应的 canvas container 坐标\n\n    var topLeft = graph.getCanvasByPoint(minXY.x, minXY.y);\n    var viewport = this.get('viewport');\n\n    if (!viewport) {\n      this.initViewport();\n    } // Viewport 与 minimap container 的比例 =  Graph container 与 expandedGraphBBox 比例\n\n\n    var vpToMc = graphWidth / expandedGraphCanvasBBox.width; // viewport 宽高 = vpToMc * minimap container 宽高\n\n    var width = vpToMc * cWidth;\n    var height = vpToMc * cHeight; // vierport 左上角到 minimap container 的距离 / minimap container 宽高\n    // = 主图 expandedBBox 左上角 canvas container 坐标距离 / expandedBBox 宽高\n\n    var left = cWidth * -topLeft.x / expandedGraphCanvasBBox.width;\n    var top = cHeight * -topLeft.y / expandedGraphCanvasBBox.height;\n    var right = left + width;\n    var bottom = top + height;\n\n    if (left < 0) {\n      width += left;\n      left = 0;\n    }\n\n    if (right > cWidth) {\n      width = width - (right - cWidth);\n    }\n\n    if (top < 0) {\n      height += top;\n      top = 0;\n    }\n\n    if (bottom > cHeight) {\n      height = height - (bottom - cHeight);\n    } // 缓存目前缩放比，在移动 minimap 视窗时就不用再计算大图的移动量\n\n\n    this.set('ratio', ratio);\n    var correctLeft = \"\".concat(left, \"px\");\n    var correctTop = \"\".concat(top, \"px\");\n    modifyCSS(viewport, {\n      left: correctLeft,\n      top: correctTop,\n      width: \"\".concat(width, \"px\"),\n      height: \"\".concat(height, \"px\")\n    });\n  };\n\n  ImageMiniMap.prototype.init = function () {\n    this.initContainer();\n  };\n  /**\n   * 初始化 Minimap 的容器\n   */\n\n\n  ImageMiniMap.prototype.initContainer = function () {\n    var self = this;\n    var graph = self.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphHeight / graphWidth;\n    var className = self.get('className');\n    var parentNode = self.get('container'); // size of the minimap's container\n\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    if (!cWidth && !cHeight) {\n      cWidth = 200;\n    }\n\n    if (cWidth) {\n      cHeight = aspectRatio * cWidth;\n      self.set('height', cHeight);\n    } else {\n      cWidth = 1 / aspectRatio * cHeight;\n      self.set('width', cWidth);\n    }\n\n    var container = createDom(\"<div class='\".concat(className, \"' style='width: \").concat(cWidth, \"px; height: \").concat(cHeight, \"px; overflow: hidden; position: relative;'></div>\"));\n\n    if (isString(parentNode)) {\n      parentNode = document.getElementById(parentNode);\n    }\n\n    if (parentNode) {\n      parentNode.appendChild(container);\n    } else {\n      graph.get('container').appendChild(container);\n    }\n\n    self.set('container', container);\n    var containerDOM = createDom(\"<div class=\\\"g6-minimap-container\\\" style=\\\"position: relative; width: 100%; height: 100%; text-align: center; display: table;\\\"></div>\");\n    container.appendChild(containerDOM);\n    var span = createDom(\"<span style=\\\"display: table-cell; vertical-align: middle; \\\"></span>\");\n    containerDOM.appendChild(span);\n    self.set('containerDOM', containerDOM);\n    self.set('containerSpan', span);\n    var img = createDom(\"<img alt=\\\"\\\" src=\\\"\".concat(this.get('graphImg'), \"\\\" style=\\\"display: inline-block; user-select: none;\\\" draggable=\\\"false\\\" />\"));\n    self.set('imgDOM', img);\n    self.updateImgSize();\n    span.appendChild(img);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.updateImgSize = function () {\n    var self = this;\n    var imgDOM = self.get('imgDOM');\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    imgDOM.onload = function () {\n      var naturalSize = getImgNaturalDimension(imgDOM);\n\n      if (naturalSize[0] > naturalSize[1]) {\n        imgDOM.width = cWidth;\n      } else {\n        imgDOM.height = cHeight;\n      }\n    };\n  };\n\n  ImageMiniMap.prototype.updateCanvas = function () {\n    // 如果是在动画，则不刷新视图\n    var isRefresh = this.get('refresh');\n\n    if (!isRefresh) {\n      return;\n    }\n\n    var graph = this.get('graph');\n\n    if (graph.get('destroyed')) {\n      return;\n    } // 如果是视口变换，也不刷新视图，但是需要重置视口大小和位置\n\n\n    if (this.get('viewportChange')) {\n      this.set('viewportChange', false);\n      this.updateViewport();\n    }\n\n    var cWidth = this.get('width');\n    var graphBBox = graph.get('canvas').getCanvasBBox();\n    var width = graphBBox.width;\n    var ratio = cWidth / width; // // 更新minimap视口\n\n    this.set('ratio', ratio);\n    this.updateViewport();\n  };\n  /**\n   * 获取minimap的窗口\n   * @return {HTMLElement} 窗口的dom实例\n   */\n\n\n  ImageMiniMap.prototype.getViewport = function () {\n    return this.get('viewport');\n  };\n  /**\n   * 获取minimap的容器dom\n   * @return {HTMLElement} dom\n   */\n\n\n  ImageMiniMap.prototype.getContainer = function () {\n    return this.get('container');\n  };\n\n  ImageMiniMap.prototype.updateGraphImg = function (img) {\n    var self = this;\n    var oriImgDOM = self.get('imgDOM');\n    oriImgDOM.remove();\n    self.set('graphImg', img);\n    var imgDOM = createDom(\"<img alt=\\\"\\\" src=\\\"\".concat(img, \"\\\" style=\\\"display: inline-block;\\\" ondragstart=\\\"return false;\\\" onselectstart=\\\"return false;\\\"/>\"));\n    self.set('imgDOM', imgDOM);\n    imgDOM.src = img;\n    self.updateImgSize();\n    var span = self.get('containerSpan');\n    span.appendChild(imgDOM);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.destroy = function () {\n    var container = this.get('container');\n    container.parentNode.removeChild(container);\n  };\n\n  return ImageMiniMap;\n}(Base);\n\nexport default ImageMiniMap;","map":{"version":3,"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","Base","isString","isNil","modifyCSS","createDom","Util","mat3","applyMatrix","getImgNaturalDimension","img","callback","nWidth","nHeight","naturalWidth","naturalHeight","image_1","Image","src","onload","width","height","ImageMiniMap","_super","config","getDefaultCfgs","container","className","viewportClassName","delegateStyle","fill","stroke","refresh","getEvents","beforepaint","beforeanimate","afteranimate","viewportchange","disableRefresh","set","enableRefresh","updateCanvas","disableOneRefresh","initViewport","_this","cfgs","_cfgs","graph","destroyed","containerDOM","get","document","getElementById","viewport","concat","x","y","dragging","left","top","ratio","zoom","addEventListener","e","target","style","parseInt","cWidth","cHeight","getZoom","clientX","clientY","dx","dy","translate","appendChild","updateViewport","graphWidth","graphHeight","aspectRatio","graphGroup","getGroup","graphCanvasBBox","getCanvasBBox","graphCanvasBBoxMean","minX","maxX","minY","maxY","graphCanvasBBoxSize","expandedGraphCanvasBBox","centerX","centerY","graphMatrix","getMatrix","invertGraphMatrix","invert","minXY","topLeft","getCanvasByPoint","vpToMc","right","bottom","correctLeft","correctTop","init","initContainer","self","parentNode","span","updateImgSize","imgDOM","naturalSize","isRefresh","graphBBox","getViewport","getContainer","updateGraphImg","oriImgDOM","remove","destroy","removeChild"],"sources":["/Users/wawalike/Desktop/ggProject/node_modules/@antv/g6-plugin/es/imageMinimap/index.js"],"sourcesContent":["var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport Base from '../base';\nimport { isString, isNil } from '@antv/util';\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport { Util } from '@antv/g6-core';\nimport { mat3 } from '@antv/matrix-util';\nvar applyMatrix = Util.applyMatrix;\n\nfunction getImgNaturalDimension(img, callback) {\n  var nWidth, nHeight;\n\n  if (img.naturalWidth) {\n    // 现代浏览器\n    nWidth = img.naturalWidth;\n    nHeight = img.naturalHeight;\n  } else {\n    // IE6/7/8\n    var image_1 = new Image();\n    image_1.src = img.src;\n\n    image_1.onload = function () {\n      if (callback) callback(image_1.width, image_1.height);\n    };\n  }\n\n  return [nWidth, nHeight];\n}\n\nvar ImageMiniMap =\n/** @class */\nfunction (_super) {\n  __extends(ImageMiniMap, _super);\n\n  function ImageMiniMap(config) {\n    return _super.call(this, config) || this;\n  }\n\n  ImageMiniMap.prototype.getDefaultCfgs = function () {\n    return {\n      container: null,\n      className: 'g6-minimap',\n      viewportClassName: 'g6-minimap-viewport',\n      width: 200,\n      delegateStyle: {\n        fill: '#40a9ff',\n        stroke: '#096dd9'\n      },\n      refresh: true\n    };\n  };\n\n  ImageMiniMap.prototype.getEvents = function () {\n    return {\n      beforepaint: 'updateViewport',\n      beforeanimate: 'disableRefresh',\n      afteranimate: 'enableRefresh',\n      viewportchange: 'disableOneRefresh'\n    };\n  }; // 若是正在进行动画，不刷新缩略图\n\n\n  ImageMiniMap.prototype.disableRefresh = function () {\n    this.set('refresh', false);\n  };\n\n  ImageMiniMap.prototype.enableRefresh = function () {\n    this.set('refresh', true);\n    this.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.disableOneRefresh = function () {\n    this.set('viewportChange', true);\n  };\n\n  ImageMiniMap.prototype.initViewport = function () {\n    var _this = this;\n\n    var cfgs = this._cfgs; // cWidth and cHeight are the width and height of the minimap's container\n\n    var graph = cfgs.graph;\n    if (this.destroyed) return;\n    var containerDOM = this.get('container');\n\n    if (isString(containerDOM)) {\n      containerDOM = document.getElementById(containerDOM);\n    }\n\n    var viewport = createDom(\"<div class=\".concat(cfgs.viewportClassName, \"\\n      style='position:absolute;\\n        left:0;\\n        top:0;\\n        box-sizing:border-box;\\n        border: 2px solid #1980ff;\\n        cursor:move'\\n      </div>\")); // 计算拖拽水平方向距离\n\n    var x = 0; // 计算拖拽垂直方向距离\n\n    var y = 0; // 是否在拖拽minimap的视口\n\n    var dragging = false; // 缓存viewport当前对于画布的x\n\n    var left = 0; // 缓存viewport当前对于画布的y\n\n    var top = 0; // 缓存viewport当前宽度\n\n    var width = 0; // 缓存viewport当前高度\n\n    var height = 0;\n    var ratio = 0;\n    var zoom = 0;\n    containerDOM.addEventListener('mousedown', function (e) {\n      cfgs.refresh = false;\n\n      if (e.target !== viewport) {\n        return;\n      } // 如果视口已经最大了，不需要拖拽\n\n\n      var style = viewport.style;\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      if (width > cWidth || height > cHeight) {\n        return;\n      }\n\n      zoom = graph.getZoom();\n      ratio = _this.get('ratio');\n      dragging = true;\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mousemove', function (e) {\n      if (!dragging || isNil(e.clientX) || isNil(e.clientY)) {\n        return;\n      }\n\n      var cWidth = _this.get('width');\n\n      var cHeight = _this.get('height');\n\n      var style = viewport.style;\n      left = parseInt(style.left, 10);\n      top = parseInt(style.top, 10);\n      width = parseInt(style.width, 10);\n      height = parseInt(style.height, 10);\n      var dx = x - e.clientX;\n      var dy = y - e.clientY; // 若视口移动到最左边或最右边了,仅移动到边界\n\n      if (left - dx < 0) {\n        dx = left;\n      } else if (left - dx + width >= cWidth) {\n        dx = 0;\n      } // 若视口移动到最上或最下边了，仅移动到边界\n\n\n      if (top - dy < 0) {\n        dy = top;\n      } else if (top - dy + height >= cHeight) {\n        dy = 0;\n      }\n\n      left -= dx;\n      top -= dy; // 先移动视口，避免移动到边上以后出现视口闪烁\n\n      modifyCSS(viewport, {\n        left: \"\".concat(left, \"px\"),\n        top: \"\".concat(top, \"px\")\n      }); // graph 移动需要偏移量 dx/dy * 缩放比例才会得到正确的移动距离\n\n      graph.translate(dx * zoom / ratio, dy * zoom / ratio);\n      x = e.clientX;\n      y = e.clientY;\n    }, false);\n    containerDOM.addEventListener('mouseleave', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    containerDOM.addEventListener('mouseup', function () {\n      dragging = false;\n      cfgs.refresh = true;\n    }, false);\n    this.set('viewport', viewport);\n    containerDOM.appendChild(viewport);\n  };\n  /**\n   * 更新 viewport 视图\n   */\n\n\n  ImageMiniMap.prototype.updateViewport = function () {\n    if (this.destroyed) return;\n    var ratio = this.get('ratio');\n    var cWidth = this.get('width');\n    var cHeight = this.get('height');\n    var graph = this.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphWidth / graphHeight;\n    var graphGroup = graph.getGroup(); // 主图的 bbox（矩阵变换相关的 bbox）\n\n    var graphCanvasBBox = graphGroup.getCanvasBBox(); // 扩展 graphBBox 到和 graphWidth / graphHeight 等比\n\n    var graphCanvasBBoxMean = [(graphCanvasBBox.minX + graphCanvasBBox.maxX) / 2, (graphCanvasBBox.minY + graphCanvasBBox.maxY) / 2];\n    var graphCanvasBBoxSize = [graphCanvasBBox.maxX - graphCanvasBBox.minX, graphCanvasBBox.maxY - graphCanvasBBox.minY];\n    var expandedGraphCanvasBBox = {\n      centerX: graphCanvasBBoxMean[0],\n      centerY: graphCanvasBBoxMean[1],\n      width: 0,\n      height: 0,\n      minX: 0,\n      minY: 0\n    };\n\n    if (graphCanvasBBox[0] / graphCanvasBBox[1] > aspectRatio) {\n      expandedGraphCanvasBBox.width = graphCanvasBBoxSize[0];\n      expandedGraphCanvasBBox.height = expandedGraphCanvasBBox.width / aspectRatio;\n    } else {\n      expandedGraphCanvasBBox.height = graphCanvasBBoxSize[1];\n      expandedGraphCanvasBBox.width = expandedGraphCanvasBBox.height * aspectRatio;\n    }\n\n    expandedGraphCanvasBBox.minX = graphCanvasBBoxMean[0] - expandedGraphCanvasBBox.width / 2;\n    expandedGraphCanvasBBox.minY = graphCanvasBBoxMean[1] - expandedGraphCanvasBBox.height / 2;\n    var graphMatrix = graphGroup.getMatrix();\n    if (!graphMatrix) graphMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var invertGraphMatrix = mat3.invert([1, 0, 0, 0, 1, 0, 0, 0, 1], graphMatrix);\n    var minXY = applyMatrix({\n      x: expandedGraphCanvasBBox.minX,\n      y: expandedGraphCanvasBBox.minY\n    }, invertGraphMatrix); // 扩展 graphBBox 后的 bbox 的左上角对应的 canvas container 坐标\n\n    var topLeft = graph.getCanvasByPoint(minXY.x, minXY.y);\n    var viewport = this.get('viewport');\n\n    if (!viewport) {\n      this.initViewport();\n    } // Viewport 与 minimap container 的比例 =  Graph container 与 expandedGraphBBox 比例\n\n\n    var vpToMc = graphWidth / expandedGraphCanvasBBox.width; // viewport 宽高 = vpToMc * minimap container 宽高\n\n    var width = vpToMc * cWidth;\n    var height = vpToMc * cHeight; // vierport 左上角到 minimap container 的距离 / minimap container 宽高\n    // = 主图 expandedBBox 左上角 canvas container 坐标距离 / expandedBBox 宽高\n\n    var left = cWidth * -topLeft.x / expandedGraphCanvasBBox.width;\n    var top = cHeight * -topLeft.y / expandedGraphCanvasBBox.height;\n    var right = left + width;\n    var bottom = top + height;\n\n    if (left < 0) {\n      width += left;\n      left = 0;\n    }\n\n    if (right > cWidth) {\n      width = width - (right - cWidth);\n    }\n\n    if (top < 0) {\n      height += top;\n      top = 0;\n    }\n\n    if (bottom > cHeight) {\n      height = height - (bottom - cHeight);\n    } // 缓存目前缩放比，在移动 minimap 视窗时就不用再计算大图的移动量\n\n\n    this.set('ratio', ratio);\n    var correctLeft = \"\".concat(left, \"px\");\n    var correctTop = \"\".concat(top, \"px\");\n    modifyCSS(viewport, {\n      left: correctLeft,\n      top: correctTop,\n      width: \"\".concat(width, \"px\"),\n      height: \"\".concat(height, \"px\")\n    });\n  };\n\n  ImageMiniMap.prototype.init = function () {\n    this.initContainer();\n  };\n  /**\n   * 初始化 Minimap 的容器\n   */\n\n\n  ImageMiniMap.prototype.initContainer = function () {\n    var self = this;\n    var graph = self.get('graph');\n    var graphWidth = graph.get('width');\n    var graphHeight = graph.get('height');\n    var aspectRatio = graphHeight / graphWidth;\n    var className = self.get('className');\n    var parentNode = self.get('container'); // size of the minimap's container\n\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    if (!cWidth && !cHeight) {\n      cWidth = 200;\n    }\n\n    if (cWidth) {\n      cHeight = aspectRatio * cWidth;\n      self.set('height', cHeight);\n    } else {\n      cWidth = 1 / aspectRatio * cHeight;\n      self.set('width', cWidth);\n    }\n\n    var container = createDom(\"<div class='\".concat(className, \"' style='width: \").concat(cWidth, \"px; height: \").concat(cHeight, \"px; overflow: hidden; position: relative;'></div>\"));\n\n    if (isString(parentNode)) {\n      parentNode = document.getElementById(parentNode);\n    }\n\n    if (parentNode) {\n      parentNode.appendChild(container);\n    } else {\n      graph.get('container').appendChild(container);\n    }\n\n    self.set('container', container);\n    var containerDOM = createDom(\"<div class=\\\"g6-minimap-container\\\" style=\\\"position: relative; width: 100%; height: 100%; text-align: center; display: table;\\\"></div>\");\n    container.appendChild(containerDOM);\n    var span = createDom(\"<span style=\\\"display: table-cell; vertical-align: middle; \\\"></span>\");\n    containerDOM.appendChild(span);\n    self.set('containerDOM', containerDOM);\n    self.set('containerSpan', span);\n    var img = createDom(\"<img alt=\\\"\\\" src=\\\"\".concat(this.get('graphImg'), \"\\\" style=\\\"display: inline-block; user-select: none;\\\" draggable=\\\"false\\\" />\"));\n    self.set('imgDOM', img);\n    self.updateImgSize();\n    span.appendChild(img);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.updateImgSize = function () {\n    var self = this;\n    var imgDOM = self.get('imgDOM');\n    var cWidth = self.get('width');\n    var cHeight = self.get('height');\n\n    imgDOM.onload = function () {\n      var naturalSize = getImgNaturalDimension(imgDOM);\n\n      if (naturalSize[0] > naturalSize[1]) {\n        imgDOM.width = cWidth;\n      } else {\n        imgDOM.height = cHeight;\n      }\n    };\n  };\n\n  ImageMiniMap.prototype.updateCanvas = function () {\n    // 如果是在动画，则不刷新视图\n    var isRefresh = this.get('refresh');\n\n    if (!isRefresh) {\n      return;\n    }\n\n    var graph = this.get('graph');\n\n    if (graph.get('destroyed')) {\n      return;\n    } // 如果是视口变换，也不刷新视图，但是需要重置视口大小和位置\n\n\n    if (this.get('viewportChange')) {\n      this.set('viewportChange', false);\n      this.updateViewport();\n    }\n\n    var cWidth = this.get('width');\n    var graphBBox = graph.get('canvas').getCanvasBBox();\n    var width = graphBBox.width;\n    var ratio = cWidth / width; // // 更新minimap视口\n\n    this.set('ratio', ratio);\n    this.updateViewport();\n  };\n  /**\n   * 获取minimap的窗口\n   * @return {HTMLElement} 窗口的dom实例\n   */\n\n\n  ImageMiniMap.prototype.getViewport = function () {\n    return this.get('viewport');\n  };\n  /**\n   * 获取minimap的容器dom\n   * @return {HTMLElement} dom\n   */\n\n\n  ImageMiniMap.prototype.getContainer = function () {\n    return this.get('container');\n  };\n\n  ImageMiniMap.prototype.updateGraphImg = function (img) {\n    var self = this;\n    var oriImgDOM = self.get('imgDOM');\n    oriImgDOM.remove();\n    self.set('graphImg', img);\n    var imgDOM = createDom(\"<img alt=\\\"\\\" src=\\\"\".concat(img, \"\\\" style=\\\"display: inline-block;\\\" ondragstart=\\\"return false;\\\" onselectstart=\\\"return false;\\\"/>\"));\n    self.set('imgDOM', imgDOM);\n    imgDOM.src = img;\n    self.updateImgSize();\n    var span = self.get('containerSpan');\n    span.appendChild(imgDOM);\n    self.updateCanvas();\n  };\n\n  ImageMiniMap.prototype.destroy = function () {\n    var container = this.get('container');\n    container.parentNode.removeChild(container);\n  };\n\n  return ImageMiniMap;\n}(Base);\n\nexport default ImageMiniMap;"],"mappings":"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"},"metadata":{},"sourceType":"module"}