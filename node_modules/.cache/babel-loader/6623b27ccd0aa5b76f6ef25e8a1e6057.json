{"ast":null,"code":"var WILDCARD = '*';\n/* event-emitter */\n\nvar EventEmitter =\n/** @class */\nfunction () {\n  function EventEmitter() {\n    this._events = {};\n  }\n  /**\n   * 监听一个事件\n   * @param evt\n   * @param callback\n   * @param once\n   */\n\n\n  EventEmitter.prototype.on = function (evt, callback, once) {\n    if (!this._events[evt]) {\n      this._events[evt] = [];\n    }\n\n    this._events[evt].push({\n      callback: callback,\n      once: !!once\n    });\n\n    return this;\n  };\n  /**\n   * 监听一个事件一次\n   * @param evt\n   * @param callback\n   */\n\n\n  EventEmitter.prototype.once = function (evt, callback) {\n    return this.on(evt, callback, true);\n  };\n  /**\n   * 触发一个事件\n   * @param evt\n   * @param args\n   */\n\n\n  EventEmitter.prototype.emit = function (evt) {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    var events = this._events[evt] || [];\n    var wildcardEvents = this._events[WILDCARD] || []; // 实际的处理 emit 方法\n\n    var doEmit = function (es) {\n      var length = es.length;\n\n      for (var i = 0; i < length; i++) {\n        if (!es[i]) {\n          continue;\n        }\n\n        var _a = es[i],\n            callback = _a.callback,\n            once = _a.once;\n\n        if (once) {\n          es.splice(i, 1);\n\n          if (es.length === 0) {\n            delete _this._events[evt];\n          }\n\n          length--;\n          i--;\n        }\n\n        callback.apply(_this, args);\n      }\n    };\n\n    doEmit(events);\n    doEmit(wildcardEvents);\n  };\n  /**\n   * 取消监听一个事件，或者一个channel\n   * @param evt\n   * @param callback\n   */\n\n\n  EventEmitter.prototype.off = function (evt, callback) {\n    if (!evt) {\n      // evt 为空全部清除\n      this._events = {};\n    } else {\n      if (!callback) {\n        // evt 存在，callback 为空，清除事件所有方法\n        delete this._events[evt];\n      } else {\n        // evt 存在，callback 存在，清除匹配的\n        var events = this._events[evt] || [];\n        var length_1 = events.length;\n\n        for (var i = 0; i < length_1; i++) {\n          if (events[i].callback === callback) {\n            events.splice(i, 1);\n            length_1--;\n            i--;\n          }\n        }\n\n        if (events.length === 0) {\n          delete this._events[evt];\n        }\n      }\n    }\n\n    return this;\n  };\n  /* 当前所有的事件 */\n\n\n  EventEmitter.prototype.getEvents = function () {\n    return this._events;\n  };\n\n  return EventEmitter;\n}();\n\nexport default EventEmitter;","map":{"version":3,"mappings":"AAOA,IAAMA,QAAQ,GAAG,GAAjB;AAEA;;AACA;AAAA;AAAA;EAAA;IACU,eAAsB,EAAtB;EAwGT;EAtGC;;;;;;;;EAMAC,sCAAGC,GAAH,EAAgBC,QAAhB,EAAoCC,IAApC,EAAkD;IAChD,IAAI,CAAC,KAAKC,OAAL,CAAaH,GAAb,CAAL,EAAwB;MACtB,KAAKG,OAAL,CAAaH,GAAb,IAAoB,EAApB;IACD;;IACD,KAAKG,OAAL,CAAaH,GAAb,EAAkBI,IAAlB,CAAuB;MACrBH,QAAQ,UADa;MAErBC,IAAI,EAAE,CAAC,CAACA;IAFa,CAAvB;;IAIA,OAAO,IAAP;EACD,CATD;EAWA;;;;;;;EAKAH,wCAAKC,GAAL,EAAkBC,QAAlB,EAAoC;IAClC,OAAO,KAAKI,EAAL,CAAQL,GAAR,EAAaC,QAAb,EAAuB,IAAvB,CAAP;EACD,CAFD;EAIA;;;;;;;EAKAF,wCAAKC,GAAL,EAAgB;IAAhB;;IAAkB;;SAAA,yCAAc;MAAdM;;;IAChB,IAAMC,MAAM,GAAG,KAAKJ,OAAL,CAAaH,GAAb,KAAqB,EAApC;IACA,IAAMQ,cAAc,GAAG,KAAKL,OAAL,CAAaL,QAAb,KAA0B,EAAjD,CAFc,CAId;;IACA,IAAMW,MAAM,GAAG,UAACC,EAAD,EAAgB;MAC7B,IAAIC,MAAM,GAAGD,EAAE,CAACC,MAAhB;;MACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAApB,EAA4BC,CAAC,EAA7B,EAAiC;QAC/B,IAAI,CAACF,EAAE,CAACE,CAAD,CAAP,EAAY;UACV;QACD;;QACK,SAAqBF,EAAE,CAACE,CAAD,CAAvB;QAAA,IAAEX,QAAQ,cAAV;QAAA,IAAYC,IAAI,UAAhB;;QAEN,IAAIA,IAAJ,EAAU;UACRQ,EAAE,CAACG,MAAH,CAAUD,CAAV,EAAa,CAAb;;UAEA,IAAIF,EAAE,CAACC,MAAH,KAAc,CAAlB,EAAqB;YACnB,OAAOG,KAAI,CAACX,OAAL,CAAaH,GAAb,CAAP;UACD;;UAEDW,MAAM;UACNC,CAAC;QACF;;QAEDX,QAAQ,CAACc,KAAT,CAAeD,KAAf,EAAqBR,IAArB;MACD;IACF,CArBD;;IAuBAG,MAAM,CAACF,MAAD,CAAN;IACAE,MAAM,CAACD,cAAD,CAAN;EACD,CA9BD;EAgCA;;;;;;;EAKAT,uCAAIC,GAAJ,EAAkBC,QAAlB,EAAqC;IACnC,IAAI,CAACD,GAAL,EAAU;MACR;MACA,KAAKG,OAAL,GAAe,EAAf;IACD,CAHD,MAGO;MACL,IAAI,CAACF,QAAL,EAAe;QACb;QACA,OAAO,KAAKE,OAAL,CAAaH,GAAb,CAAP;MACD,CAHD,MAGO;QACL;QACA,IAAMO,MAAM,GAAG,KAAKJ,OAAL,CAAaH,GAAb,KAAqB,EAApC;QAEA,IAAIgB,QAAM,GAAGT,MAAM,CAACI,MAApB;;QACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGI,QAApB,EAA4BJ,CAAC,EAA7B,EAAiC;UAC/B,IAAIL,MAAM,CAACK,CAAD,CAAN,CAAUX,QAAV,KAAuBA,QAA3B,EAAqC;YACnCM,MAAM,CAACM,MAAP,CAAcD,CAAd,EAAiB,CAAjB;YACAI,QAAM;YACNJ,CAAC;UACF;QACF;;QAED,IAAIL,MAAM,CAACI,MAAP,KAAkB,CAAtB,EAAyB;UACvB,OAAO,KAAKR,OAAL,CAAaH,GAAb,CAAP;QACD;MACF;IACF;;IAED,OAAO,IAAP;EACD,CA5BD;EA8BA;;;EACAD;IACE,OAAO,KAAKI,OAAZ;EACD,CAFD;;EAGF;AAAC,CAzGD","names":["WILDCARD","EventEmitter","evt","callback","once","_events","push","on","args","events","wildcardEvents","doEmit","es","length","i","splice","_this","apply","length_1"],"sourceRoot":"","sources":["../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}