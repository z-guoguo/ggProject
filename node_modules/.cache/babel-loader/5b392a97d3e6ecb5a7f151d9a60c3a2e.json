{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar graphWidth = 1200;\nvar graphHeight = 800;\nvar OVERLAP_QUOT = 10000000;\nvar MIN_DIST = 10;\nvar M_PI = 3.14159265358979323846;\nvar M_PI_2 = 1.57079632679489661923;\nvar PI_38 = M_PI * 0.375;\nvar PI_58 = M_PI * 0.625;\nvar nodeEdgeMap = new Map();\nvar CELL_W = 10;\nvar CELL_H = 10;\nvar T = 0.8;\nvar T_MIN = 0.1;\nvar R = 0.5;\n\nfunction distanceToNode(node1, node2, isHoriz) {\n  var x11 = node1.x - node1.size[0] / 2;\n  var y11 = node1.y - node1.size[1] / 2;\n  var x12 = node1.x + node1.size[0] / 2;\n  var y12 = node1.y + node1.size[1] / 2;\n  var x21 = node2.x - node2.size[0] / 2;\n  var y21 = node2.y - node2.size[1] / 2;\n  var x22 = node2.x + node2.size[0] / 2;\n  var y22 = node2.y + node2.size[1] / 2;\n  var cx1 = node1.x;\n  var cy1 = node1.y;\n  var cx2 = node2.x;\n  var cy2 = node2.y;\n  var dcx = cx2 - cx1; // 两个节点间的方位角  \n\n  var qr = Math.atan2(dcx, cy2 - cy1);\n  var dx = 0;\n  var dy = 0;\n  var l1 = 0;\n  var l2 = 0;\n\n  if (qr > M_PI_2) {\n    dy = y11 - y22;\n    dx = x21 - x12;\n    l1 = parseFloat(dy ? (dy / Math.cos(qr)).toFixed(2) : dx.toFixed(2));\n    l2 = parseFloat(dx ? (dx / Math.sin(qr)).toFixed(2) : dy.toFixed(2));\n  } else if (0.0 < qr && qr <= M_PI_2) {\n    dy = y21 - y12;\n    dx = x21 - x12;\n\n    if (dy > dx) {\n      l1 = l2 = parseFloat(dy ? (dy / Math.cos(qr)).toFixed(2) : dx.toFixed(2));\n    } else {\n      l1 = l2 = parseFloat(dx ? (dx / Math.sin(qr)).toFixed(2) : dy.toFixed(2));\n    }\n  } else if (qr < -M_PI_2) {\n    dy = y11 - y22;\n    dx = -(x22 - x11);\n\n    if (dy > dx) {\n      l1 = l2 = parseFloat(dy ? (dy / Math.cos(qr)).toFixed(2) : dx.toFixed(2));\n    } else {\n      l1 = l2 = parseFloat(dx ? (dx / Math.sin(qr)).toFixed(2) : dy.toFixed(2));\n    }\n  } else {\n    dy = y21 - y12;\n\n    if (Math.abs(dcx) > (x12 - x11) / 2) {\n      dx = x11 - x22;\n    } else {\n      dx = dcx;\n    }\n\n    if (dy > dx) {\n      l1 = l2 = parseFloat(dy ? (dy / Math.cos(qr)).toFixed(2) : dx.toFixed(2));\n    } else {\n      l1 = l2 = parseFloat(dx && qr !== 0.0 ? (dx / Math.sin(qr)).toFixed(2) : dy.toFixed(2));\n    }\n  }\n\n  var aqr = parseFloat(qr.toFixed(2)); // 判断是否水平，角度\n\n  var newHoriz = isHoriz;\n\n  if (isHoriz) {\n    newHoriz = PI_38 < aqr && aqr < PI_58;\n  }\n\n  return {\n    distance: Math.abs(l1 < l2 ? l1 : l2),\n    isHoriz: newHoriz\n  };\n}\n\nfunction calcNodePair(nodeA, nodeB) {\n  // 确定两个节点间是否存在连线\n  var edges = nodeEdgeMap.get(nodeA.id) || [];\n  var isLinked = edges.find(function (edge) {\n    return edge.source === nodeB.id || edge.target === nodeB.id;\n  });\n  var areaA = nodeA.size[0] * nodeA.size[1];\n  var areaB = nodeB.size[0] * nodeB.size[1];\n  var node1 = areaA > areaB ? nodeB : nodeA;\n  var node2 = areaA > areaB ? nodeA : nodeB;\n  var x11 = node1.x - node1.size[0] / 2;\n  var y11 = node1.y - node1.size[1] / 2;\n  var x12 = node1.x + node1.size[0] / 2;\n  var y12 = node1.y + node1.size[1] / 2;\n  var x21 = node2.x - node2.size[0] / 2;\n  var y21 = node2.y - node2.size[1] / 2;\n  var x22 = node2.x + node2.size[0] / 2;\n  var y22 = node2.y + node2.size[1] / 2;\n  var cx1 = node1.x;\n  var cy1 = node1.y;\n  var cx2 = node2.x;\n  var cy2 = node2.y; // Detect if nodes overlap  检查节点之间是否存在覆盖问题\n\n  var isoverlap = x12 >= x21 && x22 >= x11 && y12 >= y21 && y22 >= y11;\n  var e = 0;\n  var distance = 0;\n\n  if (isoverlap) {\n    distance = Math.sqrt(Math.pow(cx2 - cx1, 2) + Math.pow(cy2 - cy1, 2)); // calc area of overlap 计算重复区域的坐标和面积\n\n    var sx1 = x11 > x21 ? x11 : x21;\n    var sy1 = y11 > y21 ? y11 : y21;\n    var sx2 = x12 < x22 ? x12 : x22;\n    var sy2 = y12 < y22 ? y12 : y22;\n    var dsx = sx2 - sx1;\n    var dsy = sy2 - sy1;\n    var sov = dsx * dsy;\n\n    if (distance === 0.0) {\n      distance = 0.0000001;\n    }\n\n    e = MIN_DIST * 1 / distance * 100 + sov;\n    e *= OVERLAP_QUOT;\n  } else {\n    var isHoriz = false;\n    var res = distanceToNode(node1, node2, isHoriz);\n    distance = res.distance;\n    isHoriz = res.isHoriz;\n\n    if (distance <= MIN_DIST) {\n      if (distance !== 0) {\n        if (isLinked) {\n          e += MIN_DIST + OVERLAP_QUOT * 1 / distance;\n        } else {\n          e += MIN_DIST + OVERLAP_QUOT * MIN_DIST / distance;\n        }\n      } else {\n        e += OVERLAP_QUOT;\n      }\n    } else {\n      e += distance;\n\n      if (isLinked) {\n        e += distance * distance;\n      }\n    }\n  }\n\n  return e;\n}\n\nfunction calcEnergy(nodes) {\n  var energy = 0;\n\n  for (var i = 0; i < nodes.length; i++) {\n    var node = nodes[i];\n\n    if (node.x < 0 || node.y < 0 || node.x > graphWidth || node.y > graphHeight) {\n      energy += 1000000000000;\n    }\n\n    for (var j = i + 1; j < nodes.length; j++) {\n      energy += calcNodePair(node, nodes[j]);\n    }\n  }\n\n  return energy;\n}\n\nfunction isCorrectPosition(node, newPosition, nodes, edges) {\n  var nodeIdxMap = new Map();\n  nodes.forEach(function (o, i) {\n    nodeIdxMap.set(o.id, o);\n  });\n  var relateEdges = edges.filter(function (edge) {\n    return edge.source === node.id || edge.target === node.id;\n  }) || [];\n  var relateNodes = [];\n  relateEdges.forEach(function (edge) {\n    var otherNodeId = edge.source === node.id ? edge.target : edge.source;\n    var otherNode = nodeIdxMap.get(otherNodeId);\n\n    if (otherNode) {\n      relateNodes.push(otherNode);\n    }\n  });\n  var flag = true;\n\n  for (var i = 0; i < relateNodes.length; i++) {\n    var item = relateNodes[i]; // 判断条件调整，节点的坐标不需要完全一致。可以根据节点间的夹角来判断\n\n    var delta = Math.atan((node.y - item.y) / (item.x - node.y)) * 180;\n    var newDelta = Math.atan((newPosition.y - item.y) / (item.x - newPosition.y)) * 180;\n    var isHor = delta < 30 || delta > 150;\n    var newIsHor = newDelta < 30 || newDelta > 150;\n    var isVer = delta > 70 && delta < 110;\n    var newIsVer = newDelta > 70 && newDelta < 110; // 定义四个相似角度区间，0-15度，75-90度，90到105度，165到180度。\n\n    if (isHor && !newIsHor || delta * newDelta < 0) {\n      flag = false;\n      break;\n    } else if (isVer && !newIsVer || delta * newDelta < 0) {\n      flag = false;\n      break;\n    } else if ((item.x - node.x) * (item.x - newPosition.x) < 0) {\n      flag = false;\n      break;\n    } else if ((item.y - node.y) * (item.y - newPosition.y) < 0) {\n      flag = false;\n      break;\n    }\n  }\n\n  return flag;\n}\n\nfunction shuffle(nodes, edges) {\n  var foundSmallerEnergy = false; // 多次测试发现step为1时的效果最佳。\n\n  var step = 1;\n  var wstep = CELL_W * step;\n  var hstep = CELL_H * step;\n  var wsteps = [wstep, -wstep, 0, 0];\n  var hsteps = [0, 0, hstep, -hstep];\n\n  for (var i = 0; i < nodes.length; ++i) {\n    var node = nodes[i];\n    var nodeEnergy = calcNodeEnergy(node, nodes);\n\n    for (var ns = 0; ns < wsteps.length; ns++) {\n      // 判断新位置与其他连线节点的位置关系是否违规\n      var flag = isCorrectPosition(node, {\n        x: node.x + wsteps[ns],\n        y: node.y + hsteps[ns]\n      }, nodes, edges);\n\n      if (flag) {\n        // 节点朝上下左右四个方向移动，找到能量最小的那个位置\n        node.x += wsteps[ns];\n        node.y += hsteps[ns]; // 计算移动后节点的能量\n\n        var energy = calcNodeEnergy(node, nodes);\n        var rdm = Math.random();\n\n        if (energy < nodeEnergy) {\n          nodeEnergy = energy;\n          foundSmallerEnergy = true;\n        } else if (rdm < T && rdm > T_MIN) {\n          nodeEnergy = energy;\n          foundSmallerEnergy = true;\n        } else {\n          // 回归原位\n          node.x -= wsteps[ns];\n          node.y -= hsteps[ns];\n        }\n      }\n    }\n  }\n\n  if (T > T_MIN) {\n    T *= R;\n  } // 重新计算图整体的能量\n\n\n  if (foundSmallerEnergy) {\n    return calcEnergy(nodes);\n  }\n\n  return 0;\n} // 计算节点的能量，\n\n\nfunction calcNodeEnergy(node, nodes) {\n  var e = 0.0;\n\n  if (node.x < 0 || node.y < 0 || node.x + node.size[0] + 20 > graphWidth || node.y + node.size[1] + 20 > graphHeight) {\n    e += 1000000000000.0;\n  }\n\n  for (var i = 0; i < nodes.length; ++i) {\n    if (node.id !== nodes[i].id) {\n      e += calcNodePair(node, nodes[i]);\n    }\n  }\n\n  return e;\n}\n\nfunction layout(nodes, edges) {\n  if (nodes.length === 0) {\n    return {\n      nodes: nodes,\n      edges: edges\n    };\n  }\n\n  nodes.forEach(function (node) {\n    var relateEdge = edges.filter(function (edge) {\n      return edge.source === node.id || edge.target === node.id;\n    });\n    nodeEdgeMap.set(node, relateEdge);\n  }); // 1. 初始化\n  // 将node按照连接数进行排序\n\n  nodes.sort(function (node1, node2) {\n    var _a, _b;\n\n    return ((_a = nodeEdgeMap.get(node1.id)) === null || _a === void 0 ? void 0 : _a.length) - ((_b = nodeEdgeMap.get(node2.id)) === null || _b === void 0 ? void 0 : _b.length);\n  }); // 2. 计算图能量\n\n  var minEnergy = calcEnergy(nodes);\n  var deSameCount = 20; // de=0 count\n\n  var de = 1; // energy delta\n\n  var prevEnergy = 0; // 定义总的迭代次数。超过就停掉，防止死循环\n\n  var MAX_COUNT = 50;\n  var count = 0;\n\n  while (deSameCount > 0) {\n    count++;\n\n    if (count >= MAX_COUNT) {\n      break;\n    }\n\n    var ea = shuffle(nodes, edges);\n\n    if (ea !== 0) {\n      prevEnergy = ea;\n    }\n\n    de = prevEnergy - minEnergy;\n    minEnergy = prevEnergy;\n\n    if (de === 0) {\n      --deSameCount;\n    } else {\n      deSameCount = 20;\n    }\n  }\n\n  nodes.forEach(function (node) {\n    node.x = node.x - node.size[0] / 2;\n    node.y = node.y - node.size[1] / 2;\n  });\n  return {\n    nodes: nodes,\n    edges: edges\n  };\n}\n\nexports.default = layout;","map":{"version":3,"mappings":"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","names":["graphWidth","graphHeight","OVERLAP_QUOT","MIN_DIST","M_PI","M_PI_2","PI_38","PI_58","nodeEdgeMap","Map","CELL_W","CELL_H","T","T_MIN","R","distanceToNode","node1","node2","isHoriz","x11","x","size","y11","y","x12","y12","x21","y21","x22","y22","cx1","cy1","cx2","cy2","dcx","qr","Math","atan2","dx","dy","l1","l2","parseFloat","cos","toFixed","sin","abs","aqr","newHoriz","distance","calcNodePair","nodeA","nodeB","edges","get","id","isLinked","find","edge","source","target","areaA","areaB","isoverlap","e","sqrt","pow","sx1","sy1","sx2","sy2","dsx","dsy","sov","res","calcEnergy","nodes","energy","i","length","node","j","isCorrectPosition","newPosition","nodeIdxMap","forEach","o","set","relateEdges","filter","relateNodes","otherNodeId","otherNode","push","flag","item","delta","atan","newDelta","isHor","newIsHor","isVer","newIsVer","shuffle","foundSmallerEnergy","step","wstep","hstep","wsteps","hsteps","nodeEnergy","calcNodeEnergy","ns","rdm","random","layout","relateEdge","sort","_a","_b","minEnergy","deSameCount","de","prevEnergy","MAX_COUNT","count","ea","exports"],"sourceRoot":"","sources":["../../../src/layout/er/mysqlWorkbench.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}