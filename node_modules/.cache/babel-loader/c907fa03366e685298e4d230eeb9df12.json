{"ast":null,"code":"import { FunctionExt } from '../util';\nexport class Events {\n  constructor() {\n    this.listeners = {};\n  }\n\n  on(name, handler, context) {\n    if (handler == null) {\n      return this;\n    }\n\n    if (!this.listeners[name]) {\n      this.listeners[name] = [];\n    }\n\n    const cache = this.listeners[name];\n    cache.push(handler, context);\n    return this;\n  }\n\n  once(name, handler, context) {\n    const cb = (...args) => {\n      this.off(name, cb);\n      return Private.call([handler, context], args);\n    };\n\n    return this.on(name, cb, this);\n  }\n\n  off(name, handler, context) {\n    // remove all events.\n    if (!(name || handler || context)) {\n      this.listeners = {};\n      return this;\n    }\n\n    const listeners = this.listeners;\n    const names = name ? [name] : Object.keys(listeners);\n    names.forEach(n => {\n      const cache = listeners[n];\n\n      if (!cache) {\n        return;\n      } // remove all events with specified name.\n\n\n      if (!(handler || context)) {\n        delete listeners[n];\n        return;\n      }\n\n      for (let i = cache.length - 2; i >= 0; i -= 2) {\n        if (!(handler && cache[i] !== handler || context && cache[i + 1] !== context)) {\n          cache.splice(i, 2);\n        }\n      }\n    });\n    return this;\n  }\n\n  trigger(name, ...args) {\n    let returned = true;\n\n    if (name !== '*') {\n      const list = this.listeners[name];\n\n      if (list != null) {\n        returned = Private.call([...list], args);\n      }\n    }\n\n    const list = this.listeners['*'];\n\n    if (list != null) {\n      return FunctionExt.toAsyncBoolean([returned, Private.call([...list], [name, ...args])]);\n    }\n\n    return returned;\n  }\n\n  emit(name, ...args) {\n    return this.trigger(name, ...args);\n  }\n\n}\nvar Private;\n\n(function (Private) {\n  function call(list, args) {\n    const results = [];\n\n    for (let i = 0; i < list.length; i += 2) {\n      const handler = list[i];\n      const context = list[i + 1];\n      const params = Array.isArray(args) ? args : [args];\n      const ret = FunctionExt.apply(handler, context, params);\n      results.push(ret);\n    }\n\n    return FunctionExt.toAsyncBoolean(results);\n  }\n\n  Private.call = call;\n})(Private || (Private = {}));","map":{"version":3,"mappings":"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","names":["FunctionExt","Events","constructor","on","name","handler","context","listeners","cache","push","once","cb","args","off","Private","call","names","Object","keys","forEach","n","i","length","splice","trigger","returned","list","toAsyncBoolean","emit","results","params","Array","isArray","ret","apply"],"sourceRoot":"","sources":["../../src/common/events.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}