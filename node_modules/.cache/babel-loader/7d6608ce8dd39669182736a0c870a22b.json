{"ast":null,"code":"/**\n * @fileoverview image\n * @author dengfuping_develop@163.com\n */\nimport { __assign, __extends } from \"tslib\";\nimport { each, isString } from '@antv/util';\nimport { SVG_ATTR_MAP } from '../constant';\nimport ShapeBase from './base';\n\nvar Image =\n/** @class */\nfunction (_super) {\n  __extends(Image, _super);\n\n  function Image() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'image';\n    _this.canFill = false;\n    _this.canStroke = false;\n    return _this;\n  }\n\n  Image.prototype.getDefaultAttrs = function () {\n    var attrs = _super.prototype.getDefaultAttrs.call(this);\n\n    return __assign(__assign({}, attrs), {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    });\n  };\n\n  Image.prototype.createPath = function (context, targetAttrs) {\n    var _this = this;\n\n    var attrs = this.attr();\n    var el = this.get('el');\n    each(targetAttrs || attrs, function (value, attr) {\n      if (attr === 'img') {\n        _this._setImage(attrs.img);\n      } else if (SVG_ATTR_MAP[attr]) {\n        el.setAttribute(SVG_ATTR_MAP[attr], value);\n      }\n    });\n  };\n\n  Image.prototype.setAttr = function (name, value) {\n    this.attrs[name] = value;\n\n    if (name === 'img') {\n      this._setImage(value);\n    }\n  };\n\n  Image.prototype._setImage = function (img) {\n    var attrs = this.attr();\n    var el = this.get('el');\n\n    if (isString(img)) {\n      el.setAttribute('href', img);\n    } else if (img instanceof window.Image) {\n      if (!attrs.width) {\n        el.setAttribute('width', img.width);\n        this.attr('width', img.width);\n      }\n\n      if (!attrs.height) {\n        el.setAttribute('height', img.height);\n        this.attr('height', img.height);\n      }\n\n      el.setAttribute('href', img.src);\n    } else if (img instanceof HTMLElement && isString(img.nodeName) && img.nodeName.toUpperCase() === 'CANVAS') {\n      // @ts-ignore\n      el.setAttribute('href', img.toDataURL());\n    } else if (img instanceof ImageData) {\n      var canvas = document.createElement('canvas');\n      canvas.setAttribute('width', \"\" + img.width);\n      canvas.setAttribute('height', \"\" + img.height);\n      canvas.getContext('2d').putImageData(img, 0, 0);\n\n      if (!attrs.width) {\n        el.setAttribute('width', \"\" + img.width);\n        this.attr('width', img.width);\n      }\n\n      if (!attrs.height) {\n        el.setAttribute('height', \"\" + img.height);\n        this.attr('height', img.height);\n      }\n\n      el.setAttribute('href', canvas.toDataURL());\n    }\n  };\n\n  return Image;\n}(ShapeBase);\n\nexport default Image;","map":{"version":3,"mappings":"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","names":["each","isString","SVG_ATTR_MAP","ShapeBase","__extends","_this","Image","attrs","_super","getDefaultAttrs","call","x","y","width","height","context","targetAttrs","attr","el","get","value","_setImage","img","setAttribute","name","window","src","HTMLElement","nodeName","toUpperCase","toDataURL","ImageData","canvas","document","createElement","getContext","putImageData"],"sourceRoot":"","sources":["../../src/shape/image.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}