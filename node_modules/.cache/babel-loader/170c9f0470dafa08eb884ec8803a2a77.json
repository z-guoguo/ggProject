{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { isAnyArray } from 'is-any-array';\nimport Matrix from '../matrix';\nimport WrapperMatrix2D from '../wrap/WrapperMatrix2D';\nexport default class nipals {\n  constructor(X, options = {}) {\n    X = WrapperMatrix2D.checkMatrix(X);\n    let {\n      Y\n    } = options;\n    const {\n      scaleScores = false,\n      maxIterations = 1000,\n      terminationCriteria = 1e-10\n    } = options;\n    let u;\n\n    if (Y) {\n      if (isAnyArray(Y) && typeof Y[0] === 'number') {\n        Y = Matrix.columnVector(Y);\n      } else {\n        Y = WrapperMatrix2D.checkMatrix(Y);\n      }\n\n      if (Y.rows !== X.rows) {\n        throw new Error('Y should have the same number of rows as X');\n      }\n\n      u = Y.getColumnVector(0);\n    } else {\n      u = X.getColumnVector(0);\n    }\n\n    let diff = 1;\n    let t, q, w, tOld;\n\n    for (let counter = 0; counter < maxIterations && diff > terminationCriteria; counter++) {\n      w = X.transpose().mmul(u).div(u.transpose().mmul(u).get(0, 0));\n      w = w.div(w.norm());\n      t = X.mmul(w).div(w.transpose().mmul(w).get(0, 0));\n\n      if (counter > 0) {\n        diff = t.clone().sub(tOld).pow(2).sum();\n      }\n\n      tOld = t.clone();\n\n      if (Y) {\n        q = Y.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n        q = q.div(q.norm());\n        u = Y.mmul(q).div(q.transpose().mmul(q).get(0, 0));\n      } else {\n        u = t;\n      }\n    }\n\n    if (Y) {\n      let p = X.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      p = p.div(p.norm());\n      let xResidual = X.clone().sub(t.clone().mmul(p.transpose()));\n      let residual = u.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      let yResidual = Y.clone().sub(t.clone().mulS(residual.get(0, 0)).mmul(q.transpose()));\n      this.t = t;\n      this.p = p.transpose();\n      this.w = w.transpose();\n      this.q = q;\n      this.u = u;\n      this.s = t.transpose().mmul(t);\n      this.xResidual = xResidual;\n      this.yResidual = yResidual;\n      this.betas = residual;\n    } else {\n      this.w = w.transpose();\n      this.s = t.transpose().mmul(t).sqrt();\n\n      if (scaleScores) {\n        this.t = t.clone().div(this.s.get(0, 0));\n      } else {\n        this.t = t;\n      }\n\n      this.xResidual = X.sub(t.mmul(w.transpose()));\n    }\n  }\n\n}","map":{"version":3,"names":["isAnyArray","Matrix","WrapperMatrix2D","nipals","constructor","X","options","checkMatrix","Y","scaleScores","maxIterations","terminationCriteria","u","columnVector","rows","Error","getColumnVector","diff","t","q","w","tOld","counter","transpose","mmul","div","get","norm","clone","sub","pow","sum","p","xResidual","residual","yResidual","mulS","s","betas","sqrt"],"sources":["/Users/wawalike/Desktop/ggProject/node_modules/ml-matrix/src/dc/nipals.js"],"sourcesContent":["import { isAnyArray } from 'is-any-array';\n\nimport Matrix from '../matrix';\nimport WrapperMatrix2D from '../wrap/WrapperMatrix2D';\n\nexport default class nipals {\n  constructor(X, options = {}) {\n    X = WrapperMatrix2D.checkMatrix(X);\n    let { Y } = options;\n    const {\n      scaleScores = false,\n      maxIterations = 1000,\n      terminationCriteria = 1e-10,\n    } = options;\n\n    let u;\n    if (Y) {\n      if (isAnyArray(Y) && typeof Y[0] === 'number') {\n        Y = Matrix.columnVector(Y);\n      } else {\n        Y = WrapperMatrix2D.checkMatrix(Y);\n      }\n      if (Y.rows !== X.rows) {\n        throw new Error('Y should have the same number of rows as X');\n      }\n      u = Y.getColumnVector(0);\n    } else {\n      u = X.getColumnVector(0);\n    }\n\n    let diff = 1;\n    let t, q, w, tOld;\n\n    for (\n      let counter = 0;\n      counter < maxIterations && diff > terminationCriteria;\n      counter++\n    ) {\n      w = X.transpose().mmul(u).div(u.transpose().mmul(u).get(0, 0));\n      w = w.div(w.norm());\n\n      t = X.mmul(w).div(w.transpose().mmul(w).get(0, 0));\n\n      if (counter > 0) {\n        diff = t.clone().sub(tOld).pow(2).sum();\n      }\n      tOld = t.clone();\n\n      if (Y) {\n        q = Y.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n        q = q.div(q.norm());\n\n        u = Y.mmul(q).div(q.transpose().mmul(q).get(0, 0));\n      } else {\n        u = t;\n      }\n    }\n\n    if (Y) {\n      let p = X.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      p = p.div(p.norm());\n      let xResidual = X.clone().sub(t.clone().mmul(p.transpose()));\n      let residual = u.transpose().mmul(t).div(t.transpose().mmul(t).get(0, 0));\n      let yResidual = Y.clone().sub(\n        t.clone().mulS(residual.get(0, 0)).mmul(q.transpose()),\n      );\n\n      this.t = t;\n      this.p = p.transpose();\n      this.w = w.transpose();\n      this.q = q;\n      this.u = u;\n      this.s = t.transpose().mmul(t);\n      this.xResidual = xResidual;\n      this.yResidual = yResidual;\n      this.betas = residual;\n    } else {\n      this.w = w.transpose();\n      this.s = t.transpose().mmul(t).sqrt();\n      if (scaleScores) {\n        this.t = t.clone().div(this.s.get(0, 0));\n      } else {\n        this.t = t;\n      }\n      this.xResidual = X.sub(t.mmul(w.transpose()));\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}