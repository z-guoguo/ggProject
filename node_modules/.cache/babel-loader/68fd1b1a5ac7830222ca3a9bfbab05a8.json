{"ast":null,"code":"import { Util } from '../../global/util';\nimport { Point } from '../../geometry';\nimport { View } from '../../view/view';\nimport { ToolsView } from '../../view/tool';\nexport class Vertices extends ToolsView.ToolItem {\n  constructor() {\n    super(...arguments);\n    this.handles = [];\n  }\n\n  get vertices() {\n    return this.cellView.cell.getVertices();\n  }\n\n  onRender() {\n    this.addClass(this.prefixClassName('edge-tool-vertices'));\n\n    if (this.options.addable) {\n      this.updatePath();\n    }\n\n    this.resetHandles();\n    this.renderHandles();\n    return this;\n  }\n\n  update() {\n    const vertices = this.vertices;\n\n    if (vertices.length === this.handles.length) {\n      this.updateHandles();\n    } else {\n      this.resetHandles();\n      this.renderHandles();\n    }\n\n    if (this.options.addable) {\n      this.updatePath();\n    }\n\n    return this;\n  }\n\n  resetHandles() {\n    const handles = this.handles;\n    this.handles = [];\n\n    if (handles) {\n      handles.forEach(handle => {\n        this.stopHandleListening(handle);\n        handle.remove();\n      });\n    }\n  }\n\n  renderHandles() {\n    const vertices = this.vertices;\n\n    for (let i = 0, l = vertices.length; i < l; i += 1) {\n      const vertex = vertices[i];\n      const createHandle = this.options.createHandle;\n      const processHandle = this.options.processHandle;\n      const handle = createHandle({\n        index: i,\n        graph: this.graph,\n        guard: evt => this.guard(evt),\n        attrs: this.options.attrs || {}\n      });\n\n      if (processHandle) {\n        processHandle(handle);\n      }\n\n      this.graph.hook.onToolItemCreated({\n        name: 'vertices',\n        cell: this.cell,\n        view: this.cellView,\n        tool: handle\n      });\n      handle.updatePosition(vertex.x, vertex.y);\n      this.stamp(handle.container);\n      this.container.appendChild(handle.container);\n      this.handles.push(handle);\n      this.startHandleListening(handle);\n    }\n  }\n\n  updateHandles() {\n    const vertices = this.vertices;\n\n    for (let i = 0, l = vertices.length; i < l; i += 1) {\n      const vertex = vertices[i];\n      const handle = this.handles[i];\n\n      if (handle) {\n        handle.updatePosition(vertex.x, vertex.y);\n      }\n    }\n  }\n\n  updatePath() {\n    const connection = this.childNodes.connection;\n\n    if (connection) {\n      connection.setAttribute('d', this.cellView.getConnectionPathData());\n    }\n  }\n\n  startHandleListening(handle) {\n    const edgeView = this.cellView;\n\n    if (edgeView.can('vertexMovable')) {\n      handle.on('change', this.onHandleChange, this);\n      handle.on('changing', this.onHandleChanging, this);\n      handle.on('changed', this.onHandleChanged, this);\n    }\n\n    if (edgeView.can('vertexDeletable')) {\n      handle.on('remove', this.onHandleRemove, this);\n    }\n  }\n\n  stopHandleListening(handle) {\n    const edgeView = this.cellView;\n\n    if (edgeView.can('vertexMovable')) {\n      handle.off('change', this.onHandleChange, this);\n      handle.off('changing', this.onHandleChanging, this);\n      handle.off('changed', this.onHandleChanged, this);\n    }\n\n    if (edgeView.can('vertexDeletable')) {\n      handle.off('remove', this.onHandleRemove, this);\n    }\n  }\n\n  getNeighborPoints(index) {\n    const edgeView = this.cellView;\n    const vertices = this.vertices;\n    const prev = index > 0 ? vertices[index - 1] : edgeView.sourceAnchor;\n    const next = index < vertices.length - 1 ? vertices[index + 1] : edgeView.targetAnchor;\n    return {\n      prev: Point.create(prev),\n      next: Point.create(next)\n    };\n  }\n\n  getMouseEventArgs(evt) {\n    const e = this.normalizeEvent(evt);\n    const {\n      x,\n      y\n    } = this.graph.snapToGrid(e.clientX, e.clientY);\n    return {\n      e,\n      x,\n      y\n    };\n  }\n\n  onHandleChange({\n    e\n  }) {\n    this.focus();\n    const edgeView = this.cellView;\n    edgeView.cell.startBatch('move-vertex', {\n      ui: true,\n      toolId: this.cid\n    });\n\n    if (!this.options.stopPropagation) {\n      const {\n        e: evt,\n        x,\n        y\n      } = this.getMouseEventArgs(e);\n      edgeView.notifyMouseDown(evt, x, y);\n    }\n  }\n\n  onHandleChanging({\n    handle,\n    e\n  }) {\n    const edgeView = this.cellView;\n    const index = handle.options.index;\n    const {\n      e: evt,\n      x,\n      y\n    } = this.getMouseEventArgs(e);\n    const vertex = {\n      x,\n      y\n    };\n    this.snapVertex(vertex, index);\n    edgeView.cell.setVertexAt(index, vertex, {\n      ui: true,\n      toolId: this.cid\n    });\n    handle.updatePosition(vertex.x, vertex.y);\n\n    if (!this.options.stopPropagation) {\n      edgeView.notifyMouseMove(evt, x, y);\n    }\n  }\n\n  onHandleChanged({\n    e\n  }) {\n    const options = this.options;\n    const edgeView = this.cellView;\n\n    if (options.addable) {\n      this.updatePath();\n    }\n\n    if (!options.removeRedundancies) {\n      return;\n    }\n\n    const verticesRemoved = edgeView.removeRedundantLinearVertices({\n      ui: true,\n      toolId: this.cid\n    });\n\n    if (verticesRemoved) {\n      this.render();\n    }\n\n    this.blur();\n    edgeView.cell.stopBatch('move-vertex', {\n      ui: true,\n      toolId: this.cid\n    });\n\n    if (this.eventData(e).vertexAdded) {\n      edgeView.cell.stopBatch('add-vertex', {\n        ui: true,\n        toolId: this.cid\n      });\n    }\n\n    const {\n      e: evt,\n      x,\n      y\n    } = this.getMouseEventArgs(e);\n\n    if (!this.options.stopPropagation) {\n      edgeView.notifyMouseUp(evt, x, y);\n    }\n\n    edgeView.checkMouseleave(evt);\n    options.onChanged && options.onChanged({\n      edge: edgeView.cell,\n      edgeView\n    });\n  }\n\n  snapVertex(vertex, index) {\n    const snapRadius = this.options.snapRadius || 0;\n\n    if (snapRadius > 0) {\n      const neighbors = this.getNeighborPoints(index);\n      const prev = neighbors.prev;\n      const next = neighbors.next;\n\n      if (Math.abs(vertex.x - prev.x) < snapRadius) {\n        vertex.x = prev.x;\n      } else if (Math.abs(vertex.x - next.x) < snapRadius) {\n        vertex.x = next.x;\n      }\n\n      if (Math.abs(vertex.y - prev.y) < snapRadius) {\n        vertex.y = neighbors.prev.y;\n      } else if (Math.abs(vertex.y - next.y) < snapRadius) {\n        vertex.y = next.y;\n      }\n    }\n  }\n\n  onHandleRemove({\n    handle,\n    e\n  }) {\n    if (this.options.removable) {\n      const index = handle.options.index;\n      const edgeView = this.cellView;\n      edgeView.cell.removeVertexAt(index, {\n        ui: true\n      });\n\n      if (this.options.addable) {\n        this.updatePath();\n      }\n\n      edgeView.checkMouseleave(this.normalizeEvent(e));\n    }\n  }\n\n  onPathMouseDown(evt) {\n    const edgeView = this.cellView;\n\n    if (this.guard(evt) || !this.options.addable || !edgeView.can('vertexAddable')) {\n      return;\n    }\n\n    evt.stopPropagation();\n    evt.preventDefault();\n    const e = this.normalizeEvent(evt);\n    const vertex = this.graph.snapToGrid(e.clientX, e.clientY).toJSON();\n    edgeView.cell.startBatch('add-vertex', {\n      ui: true,\n      toolId: this.cid\n    });\n    const index = edgeView.getVertexIndex(vertex.x, vertex.y);\n    this.snapVertex(vertex, index);\n    edgeView.cell.insertVertex(vertex, index, {\n      ui: true,\n      toolId: this.cid\n    });\n    this.render();\n    const handle = this.handles[index];\n    this.eventData(e, {\n      vertexAdded: true\n    });\n    handle.onMouseDown(e);\n  }\n\n  onRemove() {\n    this.resetHandles();\n  }\n\n}\n\n(function (Vertices) {\n  class Handle extends View {\n    constructor(options) {\n      super();\n      this.options = options;\n      this.render();\n      this.delegateEvents({\n        mousedown: 'onMouseDown',\n        touchstart: 'onMouseDown',\n        dblclick: 'onDoubleClick'\n      });\n    }\n\n    get graph() {\n      return this.options.graph;\n    }\n\n    render() {\n      this.container = View.createElement('circle', true);\n      const attrs = this.options.attrs;\n\n      if (typeof attrs === 'function') {\n        const defaults = Vertices.getDefaults();\n        this.setAttrs(Object.assign(Object.assign({}, defaults.attrs), attrs(this)));\n      } else {\n        this.setAttrs(attrs);\n      }\n\n      this.addClass(this.prefixClassName('edge-tool-vertex'));\n    }\n\n    updatePosition(x, y) {\n      this.setAttrs({\n        cx: x,\n        cy: y\n      });\n    }\n\n    onMouseDown(evt) {\n      if (this.options.guard(evt)) {\n        return;\n      }\n\n      evt.stopPropagation();\n      evt.preventDefault();\n      this.graph.view.undelegateEvents();\n      this.delegateDocumentEvents({\n        mousemove: 'onMouseMove',\n        touchmove: 'onMouseMove',\n        mouseup: 'onMouseUp',\n        touchend: 'onMouseUp',\n        touchcancel: 'onMouseUp'\n      }, evt.data);\n      this.emit('change', {\n        e: evt,\n        handle: this\n      });\n    }\n\n    onMouseMove(evt) {\n      this.emit('changing', {\n        e: evt,\n        handle: this\n      });\n    }\n\n    onMouseUp(evt) {\n      this.emit('changed', {\n        e: evt,\n        handle: this\n      });\n      this.undelegateDocumentEvents();\n      this.graph.view.delegateEvents();\n    }\n\n    onDoubleClick(evt) {\n      this.emit('remove', {\n        e: evt,\n        handle: this\n      });\n    }\n\n  }\n\n  Vertices.Handle = Handle;\n})(Vertices || (Vertices = {}));\n\n(function (Vertices) {\n  const pathClassName = Util.prefix('edge-tool-vertex-path');\n  Vertices.config({\n    name: 'vertices',\n    snapRadius: 20,\n    addable: true,\n    removable: true,\n    removeRedundancies: true,\n    stopPropagation: true,\n    attrs: {\n      r: 6,\n      fill: '#333',\n      stroke: '#fff',\n      cursor: 'move',\n      'stroke-width': 2\n    },\n    createHandle: options => new Vertices.Handle(options),\n    markup: [{\n      tagName: 'path',\n      selector: 'connection',\n      className: pathClassName,\n      attrs: {\n        fill: 'none',\n        stroke: 'transparent',\n        'stroke-width': 10,\n        cursor: 'pointer'\n      }\n    }],\n    events: {\n      [`mousedown .${pathClassName}`]: 'onPathMouseDown',\n      [`touchstart .${pathClassName}`]: 'onPathMouseDown'\n    }\n  });\n})(Vertices || (Vertices = {}));","map":{"version":3,"mappings":"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","names":["Util","Point","View","ToolsView","Vertices","ToolItem","constructor","vertices","cellView","cell","getVertices","onRender","addClass","prefixClassName","options","addable","updatePath","resetHandles","renderHandles","update","length","handles","updateHandles","forEach","handle","stopHandleListening","remove","i","l","vertex","createHandle","processHandle","index","graph","guard","evt","attrs","hook","onToolItemCreated","name","view","tool","updatePosition","x","y","stamp","container","appendChild","push","startHandleListening","connection","childNodes","setAttribute","getConnectionPathData","edgeView","can","on","onHandleChange","onHandleChanging","onHandleChanged","onHandleRemove","off","getNeighborPoints","prev","sourceAnchor","next","targetAnchor","create","getMouseEventArgs","e","normalizeEvent","snapToGrid","clientX","clientY","focus","startBatch","ui","toolId","cid","stopPropagation","notifyMouseDown","snapVertex","setVertexAt","notifyMouseMove","removeRedundancies","verticesRemoved","removeRedundantLinearVertices","render","blur","stopBatch","eventData","vertexAdded","notifyMouseUp","checkMouseleave","onChanged","edge","snapRadius","neighbors","Math","abs","removable","removeVertexAt","onPathMouseDown","preventDefault","toJSON","getVertexIndex","insertVertex","onMouseDown","onRemove","Handle","delegateEvents","mousedown","touchstart","dblclick","createElement","defaults","getDefaults","setAttrs","Object","cx","cy","undelegateEvents","delegateDocumentEvents","mousemove","touchmove","mouseup","touchend","touchcancel","data","emit","onMouseMove","onMouseUp","undelegateDocumentEvents","onDoubleClick","pathClassName","prefix","config","r","fill","stroke","cursor","markup","tagName","selector","className","events"],"sourceRoot":"","sources":["../../../src/registry/tool/vertices.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}