{"ast":null,"code":"import { each, isArray, max, min } from '@antv/util';\nimport { parseStyle } from './parse';\nimport getArcParams from './arc-params';\nimport { mergeRegion, intersectRect } from './util';\nimport * as ArrowUtil from '../util/arrow';\nvar SHAPE_ATTRS_MAP = {\n  fill: 'fillStyle',\n  stroke: 'strokeStyle',\n  opacity: 'globalAlpha'\n};\nexport function applyAttrsToContext(context, element) {\n  var attrs = element.attr();\n\n  for (var k in attrs) {\n    var v = attrs[k]; // 转换一下不与 canvas 兼容的属性名\n\n    var name_1 = SHAPE_ATTRS_MAP[k] ? SHAPE_ATTRS_MAP[k] : k;\n\n    if (name_1 === 'matrix' && v) {\n      // 设置矩阵\n      context.transform(v[0], v[1], v[3], v[4], v[6], v[7]);\n    } else if (name_1 === 'lineDash' && context.setLineDash) {\n      // 设置虚线，只支持数组形式，非数组形式不做任何操作\n      isArray(v) && context.setLineDash(v);\n    } else {\n      if (name_1 === 'strokeStyle' || name_1 === 'fillStyle') {\n        // 如果存在渐变、pattern 这个开销有些大\n        // 可以考虑缓存机制，通过 hasUpdate 来避免一些运算\n        v = parseStyle(context, element, v);\n      } else if (name_1 === 'globalAlpha') {\n        // opacity 效果可以叠加，子元素的 opacity 需要与父元素 opacity 相乘\n        v = v * context.globalAlpha;\n      }\n\n      context[name_1] = v;\n    }\n  }\n}\nexport function drawChildren(context, children, region) {\n  for (var i = 0; i < children.length; i++) {\n    var child = children[i];\n\n    if (child.cfg.visible) {\n      child.draw(context, region);\n    } else {\n      child.skipDraw();\n    }\n  }\n} // 这个地方的逻辑比较复杂，简单画了一张图：https://www.yuque.com/antv/ou292n/pcgt5g#OW1QE\n\nexport function checkRefresh(canvas, children, region) {\n  var refreshElements = canvas.get('refreshElements'); // 先遍历需要刷新的元素，将这些元素的父元素也设置 refresh\n\n  each(refreshElements, function (el) {\n    if (el !== canvas) {\n      var parent_1 = el.cfg.parent;\n\n      while (parent_1 && parent_1 !== canvas && !parent_1.cfg.refresh) {\n        parent_1.cfg.refresh = true;\n        parent_1 = parent_1.cfg.parent;\n      }\n    }\n  });\n\n  if (refreshElements[0] === canvas) {\n    setChildrenRefresh(children, region);\n  } else {\n    // 检查所有子元素是否可以刷新\n    checkChildrenRefresh(children, region);\n  }\n} // 检查所有的子元素是否应该更新\n\nexport function checkChildrenRefresh(children, region) {\n  for (var i = 0; i < children.length; i++) {\n    var child = children[i];\n\n    if (child.cfg.visible) {\n      // 先判断 hasChanged，因为它的优先级判断应该高于 refresh\n      if (child.cfg.hasChanged) {\n        // 如果节点发生了 change，则需要级联设置子元素的 refresh\n        child.cfg.refresh = true;\n\n        if (child.isGroup()) {\n          setChildrenRefresh(child.cfg.children, region);\n        }\n      } else if (child.cfg.refresh) {\n        // 如果当前图形/分组 refresh = true，说明其子节点存在 changed\n        if (child.isGroup()) {\n          checkChildrenRefresh(child.cfg.children, region);\n        }\n      } else {\n        // 这个分支说明此次局部刷新，所有的节点和父元素没有发生变化，仅需要检查包围盒（缓存）是否相交即可\n        var refresh = checkElementRefresh(child, region);\n        child.cfg.refresh = refresh;\n\n        if (refresh && child.isGroup()) {\n          // 如果需要刷新，说明子元素也需要刷新，继续进行判定\n          checkChildrenRefresh(child.cfg.children, region);\n        }\n      }\n    }\n  }\n} // 由于对改变的图形放入 refreshElements 时做了优化，判定父元素 changed 时不加入\n// 那么有可能会出现 elements 都为空，所以最终 group\n\nexport function clearChanged(elements) {\n  for (var i = 0; i < elements.length; i++) {\n    var el = elements[i];\n    el.cfg.hasChanged = false; // 级联清理\n\n    if (el.isGroup() && !el.destroyed) {\n      clearChanged(el.cfg.children);\n    }\n  }\n} // 当某个父元素发生改变时，调用这个方法级联设置 refresh\n\nfunction setChildrenRefresh(children, region) {\n  for (var i = 0; i < children.length; i++) {\n    var child = children[i]; // let refresh = true;\n    // 获取缓存的 bbox，如果这个 bbox 还存在则说明父元素不是矩阵发生了改变\n    // const bbox = child.cfg.canvasBBox;\n    // if (bbox) {\n    //   // 如果这时候\n    //   refresh = intersectRect(bbox, region);\n    // }\n\n    child.cfg.refresh = true; // 如果需要刷新当前节点，所有的子元素设置 refresh\n\n    if (child.isGroup()) {\n      setChildrenRefresh(child.get('children'), region);\n    }\n  }\n}\n\nfunction checkElementRefresh(shape, region) {\n  var bbox = shape.cfg.cacheCanvasBBox;\n  var isAllow = shape.cfg.isInView && bbox && intersectRect(bbox, region);\n  return isAllow;\n} // 绘制 path\n\n\nexport function drawPath(shape, context, attrs, arcParamsCache) {\n  var path = attrs.path,\n      startArrow = attrs.startArrow,\n      endArrow = attrs.endArrow;\n\n  if (!path) {\n    return;\n  }\n\n  var currentPoint = [0, 0]; // 当前图形\n\n  var startMovePoint = [0, 0]; // 开始 M 的点，可能会有多个\n\n  var distance = {\n    dx: 0,\n    dy: 0\n  };\n  context.beginPath();\n\n  for (var i = 0; i < path.length; i++) {\n    var params = path[i];\n    var command = params[0];\n\n    if (i === 0 && startArrow && startArrow.d) {\n      var tangent = shape.getStartTangent();\n      distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], startArrow.d);\n    } else if (i === path.length - 2 && path[i + 1][0] === 'Z' && endArrow && endArrow.d) {\n      // 为了防止结尾为 Z 的 segment 缩短不起效，需要取最后两个 segment 特殊处理\n      var lastPath = path[i + 1];\n\n      if (lastPath[0] === 'Z') {\n        var tangent = shape.getEndTangent();\n        distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], endArrow.d);\n      }\n    } else if (i === path.length - 1 && endArrow && endArrow.d) {\n      if (path[0] !== 'Z') {\n        var tangent = shape.getEndTangent();\n        distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], endArrow.d);\n      }\n    }\n\n    var dx = distance.dx,\n        dy = distance.dy; // V,H,S,T 都在前面被转换成标准形式\n\n    switch (command) {\n      case 'M':\n        context.moveTo(params[1] - dx, params[2] - dy);\n        startMovePoint = [params[1], params[2]];\n        break;\n\n      case 'L':\n        context.lineTo(params[1] - dx, params[2] - dy);\n        break;\n\n      case 'Q':\n        context.quadraticCurveTo(params[1], params[2], params[3] - dx, params[4] - dy);\n        break;\n\n      case 'C':\n        context.bezierCurveTo(params[1], params[2], params[3], params[4], params[5] - dx, params[6] - dy);\n        break;\n\n      case 'A':\n        {\n          var arcParams = void 0; // 为了加速绘制，可以提供参数的缓存，各个图形自己缓存\n\n          if (arcParamsCache) {\n            arcParams = arcParamsCache[i];\n\n            if (!arcParams) {\n              arcParams = getArcParams(currentPoint, params);\n              arcParamsCache[i] = arcParams;\n            }\n          } else {\n            arcParams = getArcParams(currentPoint, params);\n          }\n\n          var cx = arcParams.cx,\n              cy = arcParams.cy,\n              rx = arcParams.rx,\n              ry = arcParams.ry,\n              startAngle = arcParams.startAngle,\n              endAngle = arcParams.endAngle,\n              xRotation = arcParams.xRotation,\n              sweepFlag = arcParams.sweepFlag; // 直接使用椭圆的 api\n\n          if (context.ellipse) {\n            context.ellipse(cx, cy, rx, ry, xRotation, startAngle, endAngle, 1 - sweepFlag);\n          } else {\n            var r = rx > ry ? rx : ry;\n            var scaleX = rx > ry ? 1 : rx / ry;\n            var scaleY = rx > ry ? ry / rx : 1;\n            context.translate(cx, cy);\n            context.rotate(xRotation);\n            context.scale(scaleX, scaleY);\n            context.arc(0, 0, r, startAngle, endAngle, 1 - sweepFlag);\n            context.scale(1 / scaleX, 1 / scaleY);\n            context.rotate(-xRotation);\n            context.translate(-cx, -cy);\n          }\n\n          break;\n        }\n\n      case 'Z':\n        context.closePath();\n        break;\n\n      default:\n        break;\n    } // 有了 Z 后，当前节点从开始 M 的点开始\n\n\n    if (command === 'Z') {\n      currentPoint = startMovePoint;\n    } else {\n      var len = params.length;\n      currentPoint = [params[len - 2], params[len - 1]];\n    }\n  }\n} // 刷新图形元素(Shape 或者 Group)\n\nexport function refreshElement(element, changeType) {\n  var canvas = element.get('canvas'); // 只有存在于 canvas 上时生效\n\n  if (canvas) {\n    if (changeType === 'remove') {\n      // 一旦 remove，则无法在 element 上拿到包围盒\n      // destroy 后所有属性都拿不到，所以需要暂存一下\n      // 这是一段 hack 的代码\n      element._cacheCanvasBBox = element.get('cacheCanvasBBox');\n    } // 防止反复刷新\n\n\n    if (!element.get('hasChanged')) {\n      // 但是始终要标记为 hasChanged，便于后面进行局部渲染\n      element.set('hasChanged', true); // 本来只有局部渲染模式下，才需要记录更新的元素队列\n      // if (canvas.get('localRefresh')) {\n      //   canvas.refreshElement(element, changeType, canvas);\n      // }\n      // 但对于 https://github.com/antvis/g/issues/422 的场景，全局渲染的模式下也需要记录更新的元素队列\n      // 如果当前元素的父元素发生了改变，可以不放入队列，这句话大概能够提升 15% 的初次渲染性能\n\n      if (!(element.cfg.parent && element.cfg.parent.get('hasChanged'))) {\n        canvas.refreshElement(element, changeType, canvas);\n\n        if (canvas.get('autoDraw')) {\n          canvas.draw();\n        }\n      }\n    }\n  }\n}\nexport function getRefreshRegion(element) {\n  var region;\n\n  if (!element.destroyed) {\n    var cacheBox = element.get('cacheCanvasBBox');\n    var validCache = cacheBox && !!(cacheBox.width && cacheBox.height);\n    var bbox = element.getCanvasBBox();\n    var validBBox = bbox && !!(bbox.width && bbox.height); // 是否是有效 bbox 判定，一些 NaN 或者 宽高为 0 的情况过滤掉\n\n    if (validCache && validBBox) {\n      region = mergeRegion(cacheBox, bbox);\n    } else if (validCache) {\n      region = cacheBox;\n    } else if (validBBox) {\n      region = bbox;\n    }\n  } else {\n    // 因为元素已经销毁所以无法获取到缓存的包围盒\n    region = element['_cacheCanvasBBox'];\n  }\n\n  return region;\n}\nexport function getMergedRegion(elements) {\n  if (!elements.length) {\n    return null;\n  }\n\n  var minXArr = [];\n  var minYArr = [];\n  var maxXArr = [];\n  var maxYArr = [];\n  each(elements, function (el) {\n    var region = getRefreshRegion(el);\n\n    if (region) {\n      minXArr.push(region.minX);\n      minYArr.push(region.minY);\n      maxXArr.push(region.maxX);\n      maxYArr.push(region.maxY);\n    }\n  });\n  return {\n    minX: min(minXArr),\n    minY: min(minYArr),\n    maxX: max(maxXArr),\n    maxY: max(maxYArr)\n  };\n}\nexport function mergeView(region, viewRegion) {\n  if (!region || !viewRegion) {\n    return null;\n  } // 不相交，则直接返回 null\n\n\n  if (!intersectRect(region, viewRegion)) {\n    return null;\n  }\n\n  return {\n    minX: Math.max(region.minX, viewRegion.minX),\n    minY: Math.max(region.minY, viewRegion.minY),\n    maxX: Math.min(region.maxX, viewRegion.maxX),\n    maxY: Math.min(region.maxY, viewRegion.maxY)\n  };\n}","map":{"version":3,"mappings":"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","names":["each","isArray","max","min","parseStyle","getArcParams","mergeRegion","intersectRect","ArrowUtil","SHAPE_ATTRS_MAP","fill","stroke","opacity","applyAttrsToContext","context","element","attrs","attr","k","v","name_1","transform","setLineDash","globalAlpha","drawChildren","children","region","i","length","child","cfg","visible","draw","skipDraw","checkRefresh","canvas","refreshElements","get","el","parent_1","parent","refresh","setChildrenRefresh","checkChildrenRefresh","hasChanged","isGroup","checkElementRefresh","clearChanged","elements","destroyed","shape","bbox","cacheCanvasBBox","isAllow","isInView","drawPath","arcParamsCache","startArrow","endArrow","path","currentPoint","startMovePoint","distance","dx","dy","beginPath","params","command","d","tangent","getStartTangent","getShortenOffset","lastPath","getEndTangent","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","arcParams","cy","rx","ry","startAngle","endAngle","xRotation","sweepFlag","ellipse","cx","r","scaleX","scaleY","translate","rotate","scale","arc","closePath","len","refreshElement","changeType","_cacheCanvasBBox","set","getRefreshRegion","cacheBox","validCache","width","height","getCanvasBBox","validBBox","getMergedRegion","minXArr","minYArr","maxXArr","maxYArr","push","minX","minY","maxX","maxY","mergeView","viewRegion","Math"],"sourceRoot":"","sources":["../../src/util/draw.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}