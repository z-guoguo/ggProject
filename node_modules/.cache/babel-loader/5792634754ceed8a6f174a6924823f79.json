{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport { vec3 } from 'gl-matrix';\n/**\n * Axis-Aligned Bounding Box\n * 为了便于后续 Frustum Culling，通过查找表定义 p-vertex 和 n-vertex\n * @see https://github.com/antvis/GWebGPUEngine/issues/3\n */\n\nexport var AABB = /*#__PURE__*/function () {\n  function AABB(center, halfExtents) {\n    _classCallCheck(this, AABB);\n\n    this.center = void 0;\n    this.halfExtents = void 0;\n    this.min = vec3.create();\n    this.max = vec3.create();\n    this.update(center, halfExtents);\n  }\n\n  _createClass(AABB, [{\n    key: \"update\",\n    value: function update(center, halfExtents) {\n      this.center = center || vec3.create();\n      this.halfExtents = halfExtents || vec3.fromValues(0.5, 0.5, 0.5);\n      this.min = vec3.sub(this.min, this.center, this.halfExtents);\n      this.max = vec3.add(this.max, this.center, this.halfExtents);\n    }\n  }, {\n    key: \"setMinMax\",\n    value: function setMinMax(min, max) {\n      vec3.add(this.center, max, min);\n      vec3.scale(this.center, this.center, 0.5);\n      vec3.sub(this.halfExtents, max, min);\n      vec3.scale(this.halfExtents, this.halfExtents, 0.5);\n      vec3.copy(this.min, min);\n      vec3.copy(this.max, max);\n    }\n  }, {\n    key: \"getMin\",\n    value: function getMin() {\n      return this.min;\n    }\n  }, {\n    key: \"getMax\",\n    value: function getMax() {\n      return this.max;\n    }\n  }, {\n    key: \"add\",\n    value: function add(aabb) {\n      var tc = this.center;\n      var tcx = tc[0];\n      var tcy = tc[1];\n      var tcz = tc[2];\n      var th = this.halfExtents;\n      var thx = th[0];\n      var thy = th[1];\n      var thz = th[2];\n      var tminx = tcx - thx;\n      var tmaxx = tcx + thx;\n      var tminy = tcy - thy;\n      var tmaxy = tcy + thy;\n      var tminz = tcz - thz;\n      var tmaxz = tcz + thz;\n      var oc = aabb.center;\n      var ocx = oc[0];\n      var ocy = oc[1];\n      var ocz = oc[2];\n      var oh = aabb.halfExtents;\n      var ohx = oh[0];\n      var ohy = oh[1];\n      var ohz = oh[2];\n      var ominx = ocx - ohx;\n      var omaxx = ocx + ohx;\n      var ominy = ocy - ohy;\n      var omaxy = ocy + ohy;\n      var ominz = ocz - ohz;\n      var omaxz = ocz + ohz;\n\n      if (ominx < tminx) {\n        tminx = ominx;\n      }\n\n      if (omaxx > tmaxx) {\n        tmaxx = omaxx;\n      }\n\n      if (ominy < tminy) {\n        tminy = ominy;\n      }\n\n      if (omaxy > tmaxy) {\n        tmaxy = omaxy;\n      }\n\n      if (ominz < tminz) {\n        tminz = ominz;\n      }\n\n      if (omaxz > tmaxz) {\n        tmaxz = omaxz;\n      }\n\n      tc[0] = (tminx + tmaxx) * 0.5;\n      tc[1] = (tminy + tmaxy) * 0.5;\n      tc[2] = (tminz + tmaxz) * 0.5;\n      th[0] = (tmaxx - tminx) * 0.5;\n      th[1] = (tmaxy - tminy) * 0.5;\n      th[2] = (tmaxz - tminz) * 0.5;\n      this.min[0] = tminx;\n      this.min[1] = tminy;\n      this.min[2] = tminz;\n      this.max[0] = tmaxx;\n      this.max[1] = tmaxy;\n      this.max[2] = tmaxz;\n    }\n  }, {\n    key: \"intersects\",\n    value: function intersects(aabb) {\n      var aMax = this.getMax();\n      var aMin = this.getMin();\n      var bMax = aabb.getMax();\n      var bMin = aabb.getMin();\n      return aMin[0] <= bMax[0] && aMax[0] >= bMin[0] && aMin[1] <= bMax[1] && aMax[1] >= bMin[1] && aMin[2] <= bMax[2] && aMax[2] >= bMin[2];\n    }\n  }, {\n    key: \"containsPoint\",\n    value: function containsPoint(point) {\n      var min = this.getMin();\n      var max = this.getMax();\n      return !(point[0] < min[0] || point[0] > max[0] || point[1] < min[1] || point[1] > max[1] || point[2] < min[2] || point[2] > max[2]);\n    }\n    /**\n     * get n-vertex\n     * @param plane plane of CullingVolume\n     */\n\n  }, {\n    key: \"getNegativeFarPoint\",\n    value: function getNegativeFarPoint(plane) {\n      if (plane.pnVertexFlag === 0x111) {\n        return vec3.copy(vec3.create(), this.min);\n      } else if (plane.pnVertexFlag === 0x110) {\n        return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n      } else if (plane.pnVertexFlag === 0x101) {\n        return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n      } else if (plane.pnVertexFlag === 0x100) {\n        return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n      } else if (plane.pnVertexFlag === 0x011) {\n        return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n      } else if (plane.pnVertexFlag === 0x010) {\n        return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n      } else if (plane.pnVertexFlag === 0x001) {\n        return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n      } else {\n        return vec3.fromValues(this.max[0], this.max[1], this.max[2]);\n      }\n    }\n    /**\n     * get p-vertex\n     * @param plane plane of CullingVolume\n     */\n\n  }, {\n    key: \"getPositiveFarPoint\",\n    value: function getPositiveFarPoint(plane) {\n      if (plane.pnVertexFlag === 0x111) {\n        return vec3.copy(vec3.create(), this.max);\n      } else if (plane.pnVertexFlag === 0x110) {\n        return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n      } else if (plane.pnVertexFlag === 0x101) {\n        return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n      } else if (plane.pnVertexFlag === 0x100) {\n        return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n      } else if (plane.pnVertexFlag === 0x011) {\n        return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n      } else if (plane.pnVertexFlag === 0x010) {\n        return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n      } else if (plane.pnVertexFlag === 0x001) {\n        return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n      } else {\n        return vec3.fromValues(this.min[0], this.min[1], this.min[2]);\n      }\n    }\n  }]);\n\n  return AABB;\n}();","map":{"version":3,"mappings":"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","names":["vec3","AABB","center","halfExtents","_classCallCheck","min","create","max","update","_createClass","key","value","fromValues","sub","add","scale","copy","aabb","tc","tcx","tcy","tcz","th","thx","thy","thz","tminx","tmaxx","tminy","tmaxy","tminz","tmaxz","oc","ocx","ocy","ocz","oh","ohx","ohy","ohz","ominx","omaxx","ominy","omaxy","ominz","omaxz","aMax","getMax","aMin","getMin","bMax","bMin","point","plane","pnVertexFlag"],"sources":["../../src/shape/AABB.ts"],"sourcesContent":["import { vec3 } from 'gl-matrix';\nimport { Plane } from './Plane';\n\n/**\n * Axis-Aligned Bounding Box\n * 为了便于后续 Frustum Culling，通过查找表定义 p-vertex 和 n-vertex\n * @see https://github.com/antvis/GWebGPUEngine/issues/3\n */\nexport class AABB {\n  public center: vec3;\n\n  public halfExtents: vec3;\n\n  private min: vec3 = vec3.create();\n  private max: vec3 = vec3.create();\n\n  constructor(center?: vec3, halfExtents?: vec3) {\n    this.update(center, halfExtents);\n  }\n\n  public update(center?: vec3, halfExtents?: vec3) {\n    this.center = center || vec3.create();\n    this.halfExtents = halfExtents || vec3.fromValues(0.5, 0.5, 0.5);\n    this.min = vec3.sub(this.min, this.center, this.halfExtents);\n    this.max = vec3.add(this.max, this.center, this.halfExtents);\n  }\n\n  public setMinMax(min: vec3, max: vec3) {\n    vec3.add(this.center, max, min);\n    vec3.scale(this.center, this.center, 0.5);\n\n    vec3.sub(this.halfExtents, max, min);\n    vec3.scale(this.halfExtents, this.halfExtents, 0.5);\n\n    vec3.copy(this.min, min);\n    vec3.copy(this.max, max);\n  }\n\n  public getMin() {\n    return this.min;\n  }\n\n  public getMax() {\n    return this.max;\n  }\n\n  public add(aabb: AABB) {\n    const tc = this.center;\n    const tcx = tc[0];\n    const tcy = tc[1];\n    const tcz = tc[2];\n    const th = this.halfExtents;\n    const thx = th[0];\n    const thy = th[1];\n    const thz = th[2];\n    let tminx = tcx - thx;\n    let tmaxx = tcx + thx;\n    let tminy = tcy - thy;\n    let tmaxy = tcy + thy;\n    let tminz = tcz - thz;\n    let tmaxz = tcz + thz;\n\n    const oc = aabb.center;\n    const ocx = oc[0];\n    const ocy = oc[1];\n    const ocz = oc[2];\n    const oh = aabb.halfExtents;\n    const ohx = oh[0];\n    const ohy = oh[1];\n    const ohz = oh[2];\n    const ominx = ocx - ohx;\n    const omaxx = ocx + ohx;\n    const ominy = ocy - ohy;\n    const omaxy = ocy + ohy;\n    const ominz = ocz - ohz;\n    const omaxz = ocz + ohz;\n\n    if (ominx < tminx) {\n      tminx = ominx;\n    }\n    if (omaxx > tmaxx) {\n      tmaxx = omaxx;\n    }\n    if (ominy < tminy) {\n      tminy = ominy;\n    }\n    if (omaxy > tmaxy) {\n      tmaxy = omaxy;\n    }\n    if (ominz < tminz) {\n      tminz = ominz;\n    }\n    if (omaxz > tmaxz) {\n      tmaxz = omaxz;\n    }\n\n    tc[0] = (tminx + tmaxx) * 0.5;\n    tc[1] = (tminy + tmaxy) * 0.5;\n    tc[2] = (tminz + tmaxz) * 0.5;\n    th[0] = (tmaxx - tminx) * 0.5;\n    th[1] = (tmaxy - tminy) * 0.5;\n    th[2] = (tmaxz - tminz) * 0.5;\n\n    this.min[0] = tminx;\n    this.min[1] = tminy;\n    this.min[2] = tminz;\n    this.max[0] = tmaxx;\n    this.max[1] = tmaxy;\n    this.max[2] = tmaxz;\n  }\n\n  public intersects(aabb: AABB) {\n    const aMax = this.getMax();\n    const aMin = this.getMin();\n    const bMax = aabb.getMax();\n    const bMin = aabb.getMin();\n\n    return (\n      aMin[0] <= bMax[0] &&\n      aMax[0] >= bMin[0] &&\n      aMin[1] <= bMax[1] &&\n      aMax[1] >= bMin[1] &&\n      aMin[2] <= bMax[2] &&\n      aMax[2] >= bMin[2]\n    );\n  }\n\n  public containsPoint(point: vec3) {\n    const min = this.getMin();\n    const max = this.getMax();\n\n    return !(\n      point[0] < min[0] ||\n      point[0] > max[0] ||\n      point[1] < min[1] ||\n      point[1] > max[1] ||\n      point[2] < min[2] ||\n      point[2] > max[2]\n    );\n  }\n\n  /**\n   * get n-vertex\n   * @param plane plane of CullingVolume\n   */\n  public getNegativeFarPoint(plane: Plane) {\n    if (plane.pnVertexFlag === 0x111) {\n      return vec3.copy(vec3.create(), this.min);\n    } else if (plane.pnVertexFlag === 0x110) {\n      return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x101) {\n      return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x100) {\n      return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x011) {\n      return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x010) {\n      return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x001) {\n      return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    } else {\n      return vec3.fromValues(this.max[0], this.max[1], this.max[2]);\n    }\n  }\n\n  /**\n   * get p-vertex\n   * @param plane plane of CullingVolume\n   */\n  public getPositiveFarPoint(plane: Plane) {\n    if (plane.pnVertexFlag === 0x111) {\n      return vec3.copy(vec3.create(), this.max);\n    } else if (plane.pnVertexFlag === 0x110) {\n      return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x101) {\n      return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x100) {\n      return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x011) {\n      return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x010) {\n      return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x001) {\n      return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    } else {\n      return vec3.fromValues(this.min[0], this.min[1], this.min[2]);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}