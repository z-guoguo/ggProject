{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar resolveConflicts = function (entries, cg) {\n  var _a, _b, _c;\n\n  var mappedEntries = {};\n  entries === null || entries === void 0 ? void 0 : entries.forEach(function (entry, i) {\n    mappedEntries[entry.v] = {\n      i: i,\n      indegree: 0,\n      in: [],\n      out: [],\n      vs: [entry.v]\n    };\n    var tmp = mappedEntries[entry.v];\n\n    if (entry.barycenter !== undefined) {\n      tmp.barycenter = entry.barycenter;\n      tmp.weight = entry.weight;\n    }\n  });\n  (_a = cg.edges()) === null || _a === void 0 ? void 0 : _a.forEach(function (e) {\n    var entryV = mappedEntries[e.v];\n    var entryW = mappedEntries[e.w];\n\n    if (entryV !== undefined && entryW !== undefined) {\n      entryW.indegree++;\n      entryV.out.push(mappedEntries[e.w]);\n    }\n  });\n  var sourceSet = (_c = (_b = Object.values(mappedEntries)).filter) === null || _c === void 0 ? void 0 : _c.call(_b, function (entry) {\n    return !entry.indegree;\n  });\n  return doResolveConflicts(sourceSet);\n};\n\nvar doResolveConflicts = function (sourceSet) {\n  var _a, _b;\n\n  var entries = [];\n\n  var handleIn = function (vEntry) {\n    return function (uEntry) {\n      if (uEntry.merged) return;\n\n      if (uEntry.barycenter === undefined || vEntry.barycenter === undefined || uEntry.barycenter >= vEntry.barycenter) {\n        mergeEntries(vEntry, uEntry);\n      }\n    };\n  };\n\n  var handleOut = function (vEntry) {\n    return function (wEntry) {\n      wEntry[\"in\"].push(vEntry);\n\n      if (--wEntry.indegree === 0) {\n        sourceSet.push(wEntry);\n      }\n    };\n  };\n\n  var _loop_1 = function () {\n    var entry = sourceSet.pop();\n    entries.push(entry);\n    (_a = entry[\"in\"].reverse()) === null || _a === void 0 ? void 0 : _a.forEach(function (e) {\n      return handleIn(entry)(e);\n    });\n    (_b = entry.out) === null || _b === void 0 ? void 0 : _b.forEach(function (e) {\n      return handleOut(entry)(e);\n    });\n  };\n\n  while (sourceSet === null || sourceSet === void 0 ? void 0 : sourceSet.length) {\n    _loop_1();\n  }\n\n  var filtered = entries.filter(function (entry) {\n    return !entry.merged;\n  });\n  var keys = [\"vs\", \"i\", \"barycenter\", \"weight\"];\n  return filtered.map(function (entry) {\n    var picked = {};\n    keys === null || keys === void 0 ? void 0 : keys.forEach(function (key) {\n      if (entry[key] === undefined) return;\n      picked[key] = entry[key];\n    });\n    return picked;\n  });\n};\n\nvar mergeEntries = function (target, source) {\n  var _a;\n\n  var sum = 0;\n  var weight = 0;\n\n  if (target.weight) {\n    sum += target.barycenter * target.weight;\n    weight += target.weight;\n  }\n\n  if (source.weight) {\n    sum += source.barycenter * source.weight;\n    weight += source.weight;\n  }\n\n  target.vs = (_a = source.vs) === null || _a === void 0 ? void 0 : _a.concat(target.vs);\n  target.barycenter = sum / weight;\n  target.weight = weight;\n  target.i = Math.min(source.i, target.i);\n  source.merged = true;\n};\n\nexports.default = resolveConflicts;","map":{"version":3,"mappings":"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","names":["resolveConflicts","entries","cg","mappedEntries","forEach","entry","i","v","indegree","in","out","vs","tmp","barycenter","undefined","weight","edges","_a","e","entryV","entryW","w","push","sourceSet","values","filter","_c","doResolveConflicts","handleIn","vEntry","uEntry","merged","mergeEntries","handleOut","wEntry","pop","reverse","_b","length","filtered","keys","map","picked","key","target","source","sum","concat","Math","min","exports"],"sourceRoot":"","sources":["../../../../../src/layout/dagre/src/order/resolve-conflicts.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}