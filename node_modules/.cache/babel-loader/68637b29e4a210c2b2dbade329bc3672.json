{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { View } from '../../view';\nexport class Widget extends View {\n  constructor(options) {\n    super();\n\n    const _a = options,\n          {\n      view,\n      cell,\n      node,\n      edge,\n      graph\n    } = _a,\n          localOptions = __rest(_a, [\"view\", \"cell\", \"node\", \"edge\", \"graph\"]);\n\n    if (view) {\n      this.view = view;\n      this.cell = view.cell;\n      this.graph = view.graph;\n      this.model = this.graph.model;\n    } else if ((cell || edge || node) && graph) {\n      this.cell = node || edge || cell;\n      this.view = graph.renderer.findViewByCell(this.cell);\n      this.graph = graph;\n      this.model = this.graph.model;\n    }\n\n    const ctor = this.constructor;\n\n    if (options.clearAll !== false) {\n      ctor.removeInstances(this.graph);\n    }\n\n    ctor.register(this);\n    this.init(localOptions);\n  }\n\n  static ensureCache() {\n    if (!this.instanceCache.has(this)) {\n      this.instanceCache.set(this, {});\n    }\n\n    return this.instanceCache.get(this);\n  }\n\n  static register(instance, graph) {\n    if (graph == null) {\n      // eslint-disable-next-line\n      graph = instance.graph;\n    }\n\n    const dic = this.ensureCache();\n    let cache = dic[graph.view.cid];\n\n    if (cache == null) {\n      cache = dic[graph.view.cid] = {};\n    }\n\n    cache[instance.cid] = instance;\n  }\n\n  static unregister(instance, graph) {\n    if (graph == null) {\n      // eslint-disable-next-line\n      graph = instance.graph;\n    }\n\n    const dic = this.ensureCache();\n\n    if (dic[graph.view.cid]) {\n      delete dic[graph.view.cid][instance.cid];\n    }\n  }\n\n  static removeInstances(graph) {\n    const dic = this.ensureCache();\n    const cache = dic[graph.view.cid];\n\n    if (cache) {\n      Object.keys(cache).forEach(cid => {\n        const instance = cache[cid];\n\n        if (instance) {\n          instance.remove();\n        }\n      });\n    }\n  }\n\n  static getInstances(graph) {\n    const dic = this.ensureCache();\n    return dic[graph.view.cid] || {};\n  }\n\n  init(options) {} // eslint-disable-line\n\n\n  render() {\n    return this;\n  }\n\n  startListening() {\n    if (this.options.clearOnBlankMouseDown !== false) {\n      this.graph.on('blank:mousedown', this.remove, this);\n    }\n  }\n\n  stopListening() {\n    if (this.options.clearOnBlankMouseDown !== false) {\n      this.graph.off('blank:mousedown', this.remove, this);\n    }\n  }\n\n  remove() {\n    this.stopListening();\n    const ctor = this.constructor;\n    ctor.unregister(this);\n    return super.remove();\n  }\n\n  dispose() {\n    this.remove();\n  }\n\n} // #region static\n\nWidget.instanceCache = new WeakMap();\n\n__decorate([View.dispose()], Widget.prototype, \"dispose\", null);","map":{"version":3,"mappings":"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","names":["View","Widget","constructor","options","_a","view","cell","node","edge","graph","localOptions","model","renderer","findViewByCell","ctor","clearAll","removeInstances","register","init","ensureCache","instanceCache","has","set","get","instance","dic","cache","cid","unregister","Object","keys","forEach","remove","getInstances","render","startListening","clearOnBlankMouseDown","on","stopListening","off","dispose","WeakMap","__decorate"],"sourceRoot":"","sources":["../../../src/addon/common/widget.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}