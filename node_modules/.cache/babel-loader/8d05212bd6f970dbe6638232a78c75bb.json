{"ast":null,"code":"import line from './line';\nimport { distance } from './util';\n\nfunction analyzePoints(points) {\n  // 计算每段的长度和总的长度\n  var totalLength = 0;\n  var segments = [];\n\n  for (var i = 0; i < points.length - 1; i++) {\n    var from = points[i];\n    var to = points[i + 1];\n    var length_1 = distance(from[0], from[1], to[0], to[1]);\n    var seg = {\n      from: from,\n      to: to,\n      length: length_1\n    };\n    segments.push(seg);\n    totalLength += length_1;\n  }\n\n  return {\n    segments: segments,\n    totalLength: totalLength\n  };\n}\n\nexport function lengthOfSegment(points) {\n  if (points.length < 2) {\n    return 0;\n  }\n\n  var totalLength = 0;\n\n  for (var i = 0; i < points.length - 1; i++) {\n    var from = points[i];\n    var to = points[i + 1];\n    totalLength += distance(from[0], from[1], to[0], to[1]);\n  }\n\n  return totalLength;\n}\n/**\n * 按照比例在数据片段中获取点\n * @param {array} points 点的集合\n * @param {number} t 百分比 0-1\n * @return {object} 点的坐标\n */\n\nexport function pointAtSegments(points, t) {\n  // 边界判断\n  if (t > 1 || t < 0 || points.length < 2) {\n    return null;\n  }\n\n  var _a = analyzePoints(points),\n      segments = _a.segments,\n      totalLength = _a.totalLength; // 多个点有可能重合\n\n\n  if (totalLength === 0) {\n    return {\n      x: points[0][0],\n      y: points[0][1]\n    };\n  } // 计算比例\n\n\n  var startRatio = 0;\n  var point = null;\n\n  for (var i = 0; i < segments.length; i++) {\n    var seg = segments[i];\n    var from = seg.from,\n        to = seg.to;\n    var currentRatio = seg.length / totalLength;\n\n    if (t >= startRatio && t <= startRatio + currentRatio) {\n      var localRatio = (t - startRatio) / currentRatio;\n      point = line.pointAt(from[0], from[1], to[0], to[1], localRatio);\n      break;\n    }\n\n    startRatio += currentRatio;\n  }\n\n  return point;\n}\n/**\n * 按照比例在数据片段中获取切线的角度\n * @param {array} points 点的集合\n * @param {number} t 百分比 0-1\n */\n\nexport function angleAtSegments(points, t) {\n  // 边界判断\n  if (t > 1 || t < 0 || points.length < 2) {\n    return 0;\n  }\n\n  var _a = analyzePoints(points),\n      segments = _a.segments,\n      totalLength = _a.totalLength; // 计算比例\n\n\n  var startRatio = 0;\n  var angle = 0;\n\n  for (var i = 0; i < segments.length; i++) {\n    var seg = segments[i];\n    var from = seg.from,\n        to = seg.to;\n    var currentRatio = seg.length / totalLength;\n\n    if (t >= startRatio && t <= startRatio + currentRatio) {\n      angle = Math.atan2(to[1] - from[1], to[0] - from[0]);\n      break;\n    }\n\n    startRatio += currentRatio;\n  }\n\n  return angle;\n}\nexport function distanceAtSegment(points, x, y) {\n  var minDistance = Infinity;\n\n  for (var i = 0; i < points.length - 1; i++) {\n    var point = points[i];\n    var nextPoint = points[i + 1];\n    var distance_1 = line.pointDistance(point[0], point[1], nextPoint[0], nextPoint[1], x, y);\n\n    if (distance_1 < minDistance) {\n      minDistance = distance_1;\n    }\n  }\n\n  return minDistance;\n}","map":{"version":3,"mappings":"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","names":["line","distance","analyzePoints","points","totalLength","segments","i","length","from","to","length_1","seg","push","lengthOfSegment","pointAtSegments","t","x","y","startRatio","point","currentRatio","localRatio","pointAt","angleAtSegments","angle","Math","atan2","distanceAtSegment","minDistance","Infinity","nextPoint","distance_1","pointDistance"],"sourceRoot":"","sources":["../src/segments.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}