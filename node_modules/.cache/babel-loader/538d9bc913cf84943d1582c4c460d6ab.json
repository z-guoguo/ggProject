{"ast":null,"code":"import { distance, isNumberEqual, getBBoxByArray, piMod } from './util';\nimport line from './line';\nimport { snapLength, nearestPoint } from './bezier';\n\nfunction cubicAt(p0, p1, p2, p3, t) {\n  var onet = 1 - t; // t * t * t 的性能大概是 Math.pow(t, 3) 的三倍\n\n  return onet * onet * onet * p0 + 3 * p1 * t * onet * onet + 3 * p2 * t * t * onet + p3 * t * t * t;\n}\n\nfunction derivativeAt(p0, p1, p2, p3, t) {\n  var onet = 1 - t;\n  return 3 * (onet * onet * (p1 - p0) + 2 * onet * t * (p2 - p1) + t * t * (p3 - p2));\n}\n\nfunction extrema(p0, p1, p2, p3) {\n  var a = -3 * p0 + 9 * p1 - 9 * p2 + 3 * p3;\n  var b = 6 * p0 - 12 * p1 + 6 * p2;\n  var c = 3 * p1 - 3 * p0;\n  var extremas = [];\n  var t1;\n  var t2;\n  var discSqrt;\n\n  if (isNumberEqual(a, 0)) {\n    if (!isNumberEqual(b, 0)) {\n      t1 = -c / b;\n\n      if (t1 >= 0 && t1 <= 1) {\n        extremas.push(t1);\n      }\n    }\n  } else {\n    var disc = b * b - 4 * a * c;\n\n    if (isNumberEqual(disc, 0)) {\n      extremas.push(-b / (2 * a));\n    } else if (disc > 0) {\n      discSqrt = Math.sqrt(disc);\n      t1 = (-b + discSqrt) / (2 * a);\n      t2 = (-b - discSqrt) / (2 * a);\n\n      if (t1 >= 0 && t1 <= 1) {\n        extremas.push(t1);\n      }\n\n      if (t2 >= 0 && t2 <= 1) {\n        extremas.push(t2);\n      }\n    }\n  }\n\n  return extremas;\n} // 分割贝塞尔曲线\n\n\nfunction divideCubic(x1, y1, x2, y2, x3, y3, x4, y4, t) {\n  // 划分点\n  var xt = cubicAt(x1, x2, x3, x4, t);\n  var yt = cubicAt(y1, y2, y3, y4, t); // 计算两点之间的差值点\n\n  var c1 = line.pointAt(x1, y1, x2, y2, t);\n  var c2 = line.pointAt(x2, y2, x3, y3, t);\n  var c3 = line.pointAt(x3, y3, x4, y4, t);\n  var c12 = line.pointAt(c1.x, c1.y, c2.x, c2.y, t);\n  var c23 = line.pointAt(c2.x, c2.y, c3.x, c3.y, t);\n  return [[x1, y1, c1.x, c1.y, c12.x, c12.y, xt, yt], [xt, yt, c23.x, c23.y, c3.x, c3.y, x4, y4]];\n} // 使用迭代法取贝塞尔曲线的长度，二阶和三阶分开写，更清晰和便于调试\n\n\nfunction cubicLength(x1, y1, x2, y2, x3, y3, x4, y4, iterationCount) {\n  if (iterationCount === 0) {\n    return snapLength([x1, x2, x3, x4], [y1, y2, y3, y4]);\n  }\n\n  var cubics = divideCubic(x1, y1, x2, y2, x3, y3, x4, y4, 0.5);\n  var left = cubics[0];\n  var right = cubics[1];\n  left.push(iterationCount - 1);\n  right.push(iterationCount - 1);\n  return cubicLength.apply(null, left) + cubicLength.apply(null, right);\n}\n\nexport default {\n  extrema: extrema,\n  box: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    var xArr = [x1, x4];\n    var yArr = [y1, y4];\n    var xExtrema = extrema(x1, x2, x3, x4);\n    var yExtrema = extrema(y1, y2, y3, y4);\n\n    for (var i = 0; i < xExtrema.length; i++) {\n      xArr.push(cubicAt(x1, x2, x3, x4, xExtrema[i]));\n    }\n\n    for (var i = 0; i < yExtrema.length; i++) {\n      yArr.push(cubicAt(y1, y2, y3, y4, yExtrema[i]));\n    }\n\n    return getBBoxByArray(xArr, yArr);\n  },\n  length: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    // 迭代三次，划分成 8 段求长度\n    return cubicLength(x1, y1, x2, y2, x3, y3, x4, y4, 3);\n  },\n  nearestPoint: function (x1, y1, x2, y2, x3, y3, x4, y4, x0, y0, length) {\n    return nearestPoint([x1, x2, x3, x4], [y1, y2, y3, y4], x0, y0, cubicAt, length);\n  },\n  pointDistance: function (x1, y1, x2, y2, x3, y3, x4, y4, x0, y0, length) {\n    var point = this.nearestPoint(x1, y1, x2, y2, x3, y3, x4, y4, x0, y0, length);\n    return distance(point.x, point.y, x0, y0);\n  },\n  interpolationAt: cubicAt,\n  pointAt: function (x1, y1, x2, y2, x3, y3, x4, y4, t) {\n    return {\n      x: cubicAt(x1, x2, x3, x4, t),\n      y: cubicAt(y1, y2, y3, y4, t)\n    };\n  },\n  divide: function (x1, y1, x2, y2, x3, y3, x4, y4, t) {\n    return divideCubic(x1, y1, x2, y2, x3, y3, x4, y4, t);\n  },\n  tangentAngle: function (x1, y1, x2, y2, x3, y3, x4, y4, t) {\n    var dx = derivativeAt(x1, x2, x3, x4, t);\n    var dy = derivativeAt(y1, y2, y3, y4, t);\n    return piMod(Math.atan2(dy, dx));\n  }\n};","map":{"version":3,"mappings":"AAAA,SAASA,QAAT,EAAmBC,aAAnB,EAAkCC,cAAlC,EAAkDC,KAAlD,QAA+D,QAA/D;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,SAASC,UAAT,EAAqBC,YAArB,QAAyC,UAAzC;;AAGA,SAASC,OAAT,CAAiBC,EAAjB,EAA6BC,EAA7B,EAAyCC,EAAzC,EAAqDC,EAArD,EAAiEC,CAAjE,EAA0E;EACxE,IAAMC,IAAI,GAAG,IAAID,CAAjB,CADwE,CACpD;;EACpB,OAAOC,IAAI,GAAGA,IAAP,GAAcA,IAAd,GAAqBL,EAArB,GAA0B,IAAIC,EAAJ,GAASG,CAAT,GAAaC,IAAb,GAAoBA,IAA9C,GAAqD,IAAIH,EAAJ,GAASE,CAAT,GAAaA,CAAb,GAAiBC,IAAtE,GAA6EF,EAAE,GAAGC,CAAL,GAASA,CAAT,GAAaA,CAAjG;AACD;;AAED,SAASE,YAAT,CAAsBN,EAAtB,EAAkCC,EAAlC,EAA8CC,EAA9C,EAA0DC,EAA1D,EAAsEC,CAAtE,EAA+E;EAC7E,IAAMC,IAAI,GAAG,IAAID,CAAjB;EACA,OAAO,KAAKC,IAAI,GAAGA,IAAP,IAAeJ,EAAE,GAAGD,EAApB,IAA0B,IAAIK,IAAJ,GAAWD,CAAX,IAAgBF,EAAE,GAAGD,EAArB,CAA1B,GAAqDG,CAAC,GAAGA,CAAJ,IAASD,EAAE,GAAGD,EAAd,CAA1D,CAAP;AACD;;AAED,SAASK,OAAT,CAAiBP,EAAjB,EAA6BC,EAA7B,EAAyCC,EAAzC,EAAqDC,EAArD,EAA+D;EAC7D,IAAMK,CAAC,GAAG,CAAC,CAAD,GAAKR,EAAL,GAAU,IAAIC,EAAd,GAAmB,IAAIC,EAAvB,GAA4B,IAAIC,EAA1C;EACA,IAAMM,CAAC,GAAG,IAAIT,EAAJ,GAAS,KAAKC,EAAd,GAAmB,IAAIC,EAAjC;EACA,IAAMQ,CAAC,GAAG,IAAIT,EAAJ,GAAS,IAAID,EAAvB;EACA,IAAMW,QAAQ,GAAG,EAAjB;EACA,IAAIC,EAAJ;EACA,IAAIC,EAAJ;EACA,IAAIC,QAAJ;;EAEA,IAAIrB,aAAa,CAACe,CAAD,EAAI,CAAJ,CAAjB,EAAyB;IACvB,IAAI,CAACf,aAAa,CAACgB,CAAD,EAAI,CAAJ,CAAlB,EAA0B;MACxBG,EAAE,GAAG,CAACF,CAAD,GAAKD,CAAV;;MACA,IAAIG,EAAE,IAAI,CAAN,IAAWA,EAAE,IAAI,CAArB,EAAwB;QACtBD,QAAQ,CAACI,IAAT,CAAcH,EAAd;MACD;IACF;EACF,CAPD,MAOO;IACL,IAAMI,IAAI,GAAGP,CAAC,GAAGA,CAAJ,GAAQ,IAAID,CAAJ,GAAQE,CAA7B;;IACA,IAAIjB,aAAa,CAACuB,IAAD,EAAO,CAAP,CAAjB,EAA4B;MAC1BL,QAAQ,CAACI,IAAT,CAAc,CAACN,CAAD,IAAM,IAAID,CAAV,CAAd;IACD,CAFD,MAEO,IAAIQ,IAAI,GAAG,CAAX,EAAc;MACnBF,QAAQ,GAAGG,IAAI,CAACC,IAAL,CAAUF,IAAV,CAAX;MACAJ,EAAE,GAAG,CAAC,CAACH,CAAD,GAAKK,QAAN,KAAmB,IAAIN,CAAvB,CAAL;MACAK,EAAE,GAAG,CAAC,CAACJ,CAAD,GAAKK,QAAN,KAAmB,IAAIN,CAAvB,CAAL;;MACA,IAAII,EAAE,IAAI,CAAN,IAAWA,EAAE,IAAI,CAArB,EAAwB;QACtBD,QAAQ,CAACI,IAAT,CAAcH,EAAd;MACD;;MACD,IAAIC,EAAE,IAAI,CAAN,IAAWA,EAAE,IAAI,CAArB,EAAwB;QACtBF,QAAQ,CAACI,IAAT,CAAcF,EAAd;MACD;IACF;EACF;;EACD,OAAOF,QAAP;AACD,C,CAED;;;AACA,SAASQ,WAAT,CACEC,EADF,EAEEC,EAFF,EAGEC,EAHF,EAIEC,EAJF,EAKEC,EALF,EAMEC,EANF,EAOEC,EAPF,EAQEC,EARF,EASEvB,CATF,EASW;EAET;EACA,IAAMwB,EAAE,GAAG7B,OAAO,CAACqB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBtB,CAAjB,CAAlB;EACA,IAAMyB,EAAE,GAAG9B,OAAO,CAACsB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBvB,CAAjB,CAAlB,CAJS,CAKT;;EACA,IAAM0B,EAAE,GAAGlC,IAAI,CAACmC,OAAL,CAAaX,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,EAAzB,EAA6BnB,CAA7B,CAAX;EACA,IAAM4B,EAAE,GAAGpC,IAAI,CAACmC,OAAL,CAAaT,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,EAAzB,EAA6BrB,CAA7B,CAAX;EACA,IAAM6B,EAAE,GAAGrC,IAAI,CAACmC,OAAL,CAAaP,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,EAAzB,EAA6BvB,CAA7B,CAAX;EACA,IAAM8B,GAAG,GAAGtC,IAAI,CAACmC,OAAL,CAAaD,EAAE,CAACK,CAAhB,EAAmBL,EAAE,CAACM,CAAtB,EAAyBJ,EAAE,CAACG,CAA5B,EAA+BH,EAAE,CAACI,CAAlC,EAAqChC,CAArC,CAAZ;EACA,IAAMiC,GAAG,GAAGzC,IAAI,CAACmC,OAAL,CAAaC,EAAE,CAACG,CAAhB,EAAmBH,EAAE,CAACI,CAAtB,EAAyBH,EAAE,CAACE,CAA5B,EAA+BF,EAAE,CAACG,CAAlC,EAAqChC,CAArC,CAAZ;EACA,OAAO,CACL,CAACgB,EAAD,EAAKC,EAAL,EAASS,EAAE,CAACK,CAAZ,EAAeL,EAAE,CAACM,CAAlB,EAAqBF,GAAG,CAACC,CAAzB,EAA4BD,GAAG,CAACE,CAAhC,EAAmCR,EAAnC,EAAuCC,EAAvC,CADK,EAEL,CAACD,EAAD,EAAKC,EAAL,EAASQ,GAAG,CAACF,CAAb,EAAgBE,GAAG,CAACD,CAApB,EAAuBH,EAAE,CAACE,CAA1B,EAA6BF,EAAE,CAACG,CAAhC,EAAmCV,EAAnC,EAAuCC,EAAvC,CAFK,CAAP;AAID,C,CAED;;;AACA,SAASW,WAAT,CACElB,EADF,EAEEC,EAFF,EAGEC,EAHF,EAIEC,EAJF,EAKEC,EALF,EAMEC,EANF,EAOEC,EAPF,EAQEC,EARF,EASEY,cATF,EASwB;EAEtB,IAAIA,cAAc,KAAK,CAAvB,EAA0B;IACxB,OAAO1C,UAAU,CAAC,CAACuB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,CAAD,EAAmB,CAACL,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,CAAnB,CAAjB;EACD;;EACD,IAAMa,MAAM,GAAGrB,WAAW,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,EAAaC,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,EAAzB,EAA6BC,EAA7B,EAAiC,GAAjC,CAA1B;EACA,IAAMc,IAAI,GAAGD,MAAM,CAAC,CAAD,CAAnB;EACA,IAAME,KAAK,GAAGF,MAAM,CAAC,CAAD,CAApB;EACAC,IAAI,CAAC1B,IAAL,CAAUwB,cAAc,GAAG,CAA3B;EACAG,KAAK,CAAC3B,IAAN,CAAWwB,cAAc,GAAG,CAA5B;EACA,OAAOD,WAAW,CAACK,KAAZ,CAAkB,IAAlB,EAAwBF,IAAxB,IAAgCH,WAAW,CAACK,KAAZ,CAAkB,IAAlB,EAAwBD,KAAxB,CAAvC;AACD;;AAED,eAAe;EACbnC,OAAO,SADM;EAEbqC,GAAG,EAAH,UAAIxB,EAAJ,EAAgBC,EAAhB,EAA4BC,EAA5B,EAAwCC,EAAxC,EAAoDC,EAApD,EAAgEC,EAAhE,EAA4EC,EAA5E,EAAwFC,EAAxF,EAAkG;IAChG,IAAMkB,IAAI,GAAG,CAACzB,EAAD,EAAKM,EAAL,CAAb;IACA,IAAMoB,IAAI,GAAG,CAACzB,EAAD,EAAKM,EAAL,CAAb;IACA,IAAMoB,QAAQ,GAAGxC,OAAO,CAACa,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,CAAxB;IACA,IAAMsB,QAAQ,GAAGzC,OAAO,CAACc,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,CAAxB;;IACA,KAAK,IAAIsB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,QAAQ,CAACG,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;MACxCJ,IAAI,CAAC9B,IAAL,CAAUhB,OAAO,CAACqB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBqB,QAAQ,CAACE,CAAD,CAAzB,CAAjB;IACD;;IACD,KAAK,IAAIA,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,QAAQ,CAACE,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;MACxCH,IAAI,CAAC/B,IAAL,CAAUhB,OAAO,CAACsB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBqB,QAAQ,CAACC,CAAD,CAAzB,CAAjB;IACD;;IACD,OAAOvD,cAAc,CAACmD,IAAD,EAAOC,IAAP,CAArB;EACD,CAdY;EAebI,MAAM,EAAN,UAAO9B,EAAP,EAAmBC,EAAnB,EAA+BC,EAA/B,EAA2CC,EAA3C,EAAuDC,EAAvD,EAAmEC,EAAnE,EAA+EC,EAA/E,EAA2FC,EAA3F,EAAqG;IACnG;IACA,OAAOW,WAAW,CAAClB,EAAD,EAAKC,EAAL,EAASC,EAAT,EAAaC,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,EAAzB,EAA6BC,EAA7B,EAAiC,CAAjC,CAAlB;EACD,CAlBY;EAmBb7B,YAAY,EAAZ,UACEsB,EADF,EAEEC,EAFF,EAGEC,EAHF,EAIEC,EAJF,EAKEC,EALF,EAMEC,EANF,EAOEC,EAPF,EAQEC,EARF,EASEwB,EATF,EAUEC,EAVF,EAWEF,MAXF,EAWiB;IAEf,OAAOpD,YAAY,CAAC,CAACsB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,CAAD,EAAmB,CAACL,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,CAAnB,EAAqCwB,EAArC,EAAyCC,EAAzC,EAA6CrD,OAA7C,EAAsDmD,MAAtD,CAAnB;EACD,CAjCY;EAkCbG,aAAa,EAAb,UACEjC,EADF,EAEEC,EAFF,EAGEC,EAHF,EAIEC,EAJF,EAKEC,EALF,EAMEC,EANF,EAOEC,EAPF,EAQEC,EARF,EASEwB,EATF,EAUEC,EAVF,EAWEF,MAXF,EAWiB;IAEf,IAAMI,KAAK,GAAG,KAAKxD,YAAL,CAAkBsB,EAAlB,EAAsBC,EAAtB,EAA0BC,EAA1B,EAA8BC,EAA9B,EAAkCC,EAAlC,EAAsCC,EAAtC,EAA0CC,EAA1C,EAA8CC,EAA9C,EAAkDwB,EAAlD,EAAsDC,EAAtD,EAA0DF,MAA1D,CAAd;IACA,OAAO1D,QAAQ,CAAC8D,KAAK,CAACnB,CAAP,EAAUmB,KAAK,CAAClB,CAAhB,EAAmBe,EAAnB,EAAuBC,EAAvB,CAAf;EACD,CAjDY;EAkDbG,eAAe,EAAExD,OAlDJ;EAmDbgC,OAAO,EAAP,UACEX,EADF,EAEEC,EAFF,EAGEC,EAHF,EAIEC,EAJF,EAKEC,EALF,EAMEC,EANF,EAOEC,EAPF,EAQEC,EARF,EASEvB,CATF,EASW;IAET,OAAO;MACL+B,CAAC,EAAEpC,OAAO,CAACqB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBtB,CAAjB,CADL;MAELgC,CAAC,EAAErC,OAAO,CAACsB,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBvB,CAAjB;IAFL,CAAP;EAID,CAlEY;EAmEboD,MAAM,EAAN,UAAOpC,EAAP,EAAmBC,EAAnB,EAA+BC,EAA/B,EAA2CC,EAA3C,EAAuDC,EAAvD,EAAmEC,EAAnE,EAA+EC,EAA/E,EAA2FC,EAA3F,EAAuGvB,CAAvG,EAAgH;IAC9G,OAAOe,WAAW,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,EAAaC,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,EAAzB,EAA6BC,EAA7B,EAAiCvB,CAAjC,CAAlB;EACD,CArEY;EAsEbqD,YAAY,EAAZ,UACErC,EADF,EAEEC,EAFF,EAGEC,EAHF,EAIEC,EAJF,EAKEC,EALF,EAMEC,EANF,EAOEC,EAPF,EAQEC,EARF,EASEvB,CATF,EASW;IAET,IAAMsD,EAAE,GAAGpD,YAAY,CAACc,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBtB,CAAjB,CAAvB;IACA,IAAMuD,EAAE,GAAGrD,YAAY,CAACe,EAAD,EAAKE,EAAL,EAASE,EAAT,EAAaE,EAAb,EAAiBvB,CAAjB,CAAvB;IACA,OAAOT,KAAK,CAACsB,IAAI,CAAC2C,KAAL,CAAWD,EAAX,EAAeD,EAAf,CAAD,CAAZ;EACD;AApFY,CAAf","names":["distance","isNumberEqual","getBBoxByArray","piMod","line","snapLength","nearestPoint","cubicAt","p0","p1","p2","p3","t","onet","derivativeAt","extrema","a","b","c","extremas","t1","t2","discSqrt","push","disc","Math","sqrt","divideCubic","x1","y1","x2","y2","x3","y3","x4","y4","xt","yt","c1","pointAt","c2","c3","c12","x","y","c23","cubicLength","iterationCount","cubics","left","right","apply","box","xArr","yArr","xExtrema","yExtrema","i","length","x0","y0","pointDistance","point","interpolationAt","divide","tangentAngle","dx","dy","atan2"],"sourceRoot":"","sources":["../src/cubic.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}