{"ast":null,"code":"\"use strict\";\n/**\n * @fileOverview Combo force layout\n * @author shiwu.wyy@antfin.com\n */\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ComboCombinedLayout = void 0;\n\nvar constants_1 = require(\"./constants\");\n\nvar base_1 = require(\"./base\");\n\nvar util_1 = require(\"../util\");\n\nvar _1 = require(\".\");\n/**\n * combined two layouts (inner and outer) for graph with combos\n */\n\n\nvar ComboCombinedLayout =\n/** @class */\nfunction (_super) {\n  __extends(ComboCombinedLayout, _super);\n\n  function ComboCombinedLayout(options) {\n    var _this = _super.call(this) || this;\n    /** 布局中心 */\n\n\n    _this.center = [0, 0];\n    /** 内部计算参数 */\n\n    _this.nodes = [];\n    _this.edges = [];\n    _this.combos = [];\n    _this.comboEdges = [];\n    /** Combo 内部的 padding */\n\n    _this.comboPadding = 10;\n    _this.comboTrees = [];\n\n    _this.updateCfg(options);\n\n    return _this;\n  }\n\n  ComboCombinedLayout.prototype.getDefaultCfg = function () {\n    return {};\n  };\n  /**\n   * 执行布局\n   */\n\n\n  ComboCombinedLayout.prototype.execute = function () {\n    var self = this;\n    var nodes = self.nodes;\n    var center = self.center;\n\n    if (!nodes || nodes.length === 0) {\n      if (self.onLayoutEnd) self.onLayoutEnd();\n      return;\n    }\n\n    if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      if (self.onLayoutEnd) self.onLayoutEnd();\n      return;\n    }\n\n    self.initVals(); // layout\n\n    self.run();\n    if (self.onLayoutEnd) self.onLayoutEnd();\n  };\n\n  ComboCombinedLayout.prototype.run = function () {\n    var _a;\n\n    var self = this;\n    var nodes = self.nodes,\n        edges = self.edges,\n        combos = self.combos,\n        comboEdges = self.comboEdges,\n        center = self.center;\n    var nodeMap = {};\n    nodes.forEach(function (node) {\n      nodeMap[node.id] = node;\n    });\n    var comboMap = {};\n    combos.forEach(function (combo) {\n      comboMap[combo.id] = combo;\n    });\n    var innerGraphs = self.getInnerGraphs(nodeMap); // 每个 innerGraph 作为一个节点，带有大小，参与 force 计算\n\n    var outerNodeIds = [];\n    var outerNodes = [];\n    var nodeAncestorIdMap = {};\n    var allHaveNoPosition = true;\n    this.comboTrees.forEach(function (cTree) {\n      var innerNode = innerGraphs[cTree.id]; // 代表 combo 的节点\n\n      var oNode = __assign(__assign({}, cTree), {\n        x: innerNode.x || comboMap[cTree.id].x,\n        y: innerNode.y || comboMap[cTree.id].y,\n        fx: innerNode.fx || comboMap[cTree.id].fx,\n        fy: innerNode.fy || comboMap[cTree.id].fy,\n        mass: innerNode.mass || comboMap[cTree.id].mass,\n        size: innerNode.size\n      });\n\n      outerNodes.push(oNode);\n\n      if (!isNaN(oNode.x) && oNode.x !== 0 && !isNaN(oNode.y) && oNode.y !== 0) {\n        allHaveNoPosition = false;\n      } else {\n        oNode.x = Math.random() * 100;\n        oNode.y = Math.random() * 100;\n      }\n\n      outerNodeIds.push(cTree.id);\n      (0, util_1.traverseTreeUp)(cTree, function (child) {\n        if (child.id !== cTree.id) nodeAncestorIdMap[child.id] = cTree.id;\n        return true;\n      });\n    });\n    nodes.forEach(function (node) {\n      if (node.comboId && comboMap[node.comboId]) return; // 代表节点的节点\n\n      var oNode = __assign({}, node);\n\n      outerNodes.push(oNode);\n\n      if (!isNaN(oNode.x) && oNode.x !== 0 && !isNaN(oNode.y) && oNode.y !== 0) {\n        allHaveNoPosition = false;\n      } else {\n        oNode.x = Math.random() * 100;\n        oNode.y = Math.random() * 100;\n      }\n\n      outerNodeIds.push(node.id);\n    });\n    var outerEdges = [];\n    edges.concat(comboEdges).forEach(function (edge) {\n      var sourceAncestorId = nodeAncestorIdMap[edge.source] || edge.source;\n      var targetAncestorId = nodeAncestorIdMap[edge.target] || edge.target; // 若两个点的祖先都在力导图的节点中，且是不同的节点，创建一条链接两个祖先的边到力导图的边中\n\n      if (sourceAncestorId !== targetAncestorId && outerNodeIds.includes(sourceAncestorId) && outerNodeIds.includes(targetAncestorId)) {\n        outerEdges.push({\n          source: sourceAncestorId,\n          target: targetAncestorId\n        });\n      }\n    }); // 若有需要最外层的 combo 或节点，则对最外层执行力导向\n\n    if (outerNodes === null || outerNodes === void 0 ? void 0 : outerNodes.length) {\n      if (outerNodes.length === 1) {\n        outerNodes[0].x = center[0];\n        outerNodes[0].y = center[1];\n      } else {\n        var outerData = {\n          nodes: outerNodes,\n          edges: outerEdges\n        }; // 需要使用一个同步的布局\n        // @ts-ignore\n\n        var outerLayout = this.outerLayout || new _1.GForceLayout({\n          gravity: 1,\n          factor: 2,\n          linkDistance: function (edge, source, target) {\n            var _a, _b;\n\n            var nodeSize = ((((_a = source.size) === null || _a === void 0 ? void 0 : _a[0]) || 30) + (((_b = target.size) === null || _b === void 0 ? void 0 : _b[0]) || 30)) / 2;\n            return Math.min(nodeSize * 1.5, 700);\n          }\n        });\n        var outerLayoutType = (_a = outerLayout.getType) === null || _a === void 0 ? void 0 : _a.call(outerLayout);\n        outerLayout.updateCfg({\n          center: center,\n          kg: 5,\n          preventOverlap: true,\n          animate: false\n        }); // 若所有 outerNodes 都没有位置，且 outerLayout 是力导家族的布局，则先执行 preset mds 或 grid\n\n        if (allHaveNoPosition && constants_1.FORCE_LAYOUT_TYPE_MAP[outerLayoutType]) {\n          var outerLayoutPreset = outerNodes.length < 100 ? new _1.MDSLayout() : new _1.GridLayout();\n          outerLayoutPreset.layout(outerData);\n        }\n\n        outerLayout.layout(outerData);\n      } // 根据外部布局结果，平移 innerGraphs 中的节点（第一层）\n\n\n      outerNodes.forEach(function (oNode) {\n        var innerGraph = innerGraphs[oNode.id];\n\n        if (!innerGraph) {\n          var node = nodeMap[oNode.id];\n\n          if (node) {\n            node.x = oNode.x;\n            node.y = oNode.y;\n          }\n\n          return;\n        }\n\n        innerGraph.visited = true;\n        innerGraph.x = oNode.x;\n        innerGraph.y = oNode.y;\n        innerGraph.nodes.forEach(function (node) {\n          node.x += oNode.x;\n          node.y += oNode.y;\n        });\n      });\n    } // 至上而下遍历树处理下面各层节点位置\n\n\n    var innerGraphIds = Object.keys(innerGraphs);\n\n    var _loop_1 = function (i) {\n      var id = innerGraphIds[i];\n      var innerGraph = innerGraphs[id];\n      if (!innerGraph) return \"continue\";\n      innerGraph.nodes.forEach(function (node) {\n        if (!innerGraph.visited) {\n          node.x += innerGraph.x || 0;\n          node.y += innerGraph.y || 0;\n        }\n\n        if (nodeMap[node.id]) {\n          nodeMap[node.id].x = node.x;\n          nodeMap[node.id].y = node.y;\n        }\n      });\n\n      if (comboMap[id]) {\n        comboMap[id].x = innerGraph.x;\n        comboMap[id].y = innerGraph.y;\n      }\n    };\n\n    for (var i = innerGraphIds.length - 1; i >= 0; i--) {\n      _loop_1(i);\n    }\n\n    return {\n      nodes: nodes,\n      edges: edges,\n      combos: combos,\n      comboEdges: comboEdges\n    };\n  };\n\n  ComboCombinedLayout.prototype.getInnerGraphs = function (nodeMap) {\n    var self = this;\n    var comboTrees = self.comboTrees,\n        nodeSize = self.nodeSize,\n        edges = self.edges,\n        comboPadding = self.comboPadding,\n        spacing = self.spacing;\n    var innerGraphs = {}; // @ts-ignore\n\n    var innerGraphLayout = this.innerLayout || new _1.ConcentricLayout({\n      sortBy: 'id'\n    });\n    innerGraphLayout.center = [0, 0];\n    innerGraphLayout.preventOverlap = true;\n    innerGraphLayout.nodeSpacing = spacing;\n    (comboTrees || []).forEach(function (ctree) {\n      (0, util_1.traverseTreeUp)(ctree, function (treeNode) {\n        var _a; // @ts-ignore\n\n\n        var padding = (comboPadding === null || comboPadding === void 0 ? void 0 : comboPadding(treeNode)) || 10; // 返回的最大值\n\n        if ((0, util_1.isArray)(padding)) padding = Math.max.apply(Math, padding);\n\n        if (!((_a = treeNode.children) === null || _a === void 0 ? void 0 : _a.length)) {\n          // 空 combo\n          if (treeNode.itemType === 'combo') {\n            var treeNodeSize = padding ? [padding * 2, padding * 2] : [30, 30];\n            innerGraphs[treeNode.id] = {\n              id: treeNode.id,\n              nodes: [],\n              size: treeNodeSize\n            };\n          }\n        } else {\n          // 非空 combo\n          var innerGraphNodes = treeNode.children.map(function (child) {\n            if (child.itemType === 'combo') return innerGraphs[child.id];\n            var oriNode = nodeMap[child.id] || {};\n            return __assign(__assign({}, oriNode), child);\n          });\n          var innerGraphNodeIds_1 = innerGraphNodes.map(function (node) {\n            return node.id;\n          });\n          var innerGraphData = {\n            nodes: innerGraphNodes,\n            edges: edges.filter(function (edge) {\n              return innerGraphNodeIds_1.includes(edge.source) && innerGraphNodeIds_1.includes(edge.target);\n            })\n          };\n          var minNodeSize_1 = Infinity;\n          innerGraphNodes.forEach(function (node) {\n            var _a; // @ts-ignore\n\n\n            if (!node.size) node.size = ((_a = innerGraphs[node.id]) === null || _a === void 0 ? void 0 : _a.size) || (nodeSize === null || nodeSize === void 0 ? void 0 : nodeSize(node)) || [30, 30];\n            if ((0, util_1.isNumber)(node.size)) node.size = [node.size, node.size];\n            if (minNodeSize_1 > node.size[0]) minNodeSize_1 = node.size[0];\n            if (minNodeSize_1 > node.size[1]) minNodeSize_1 = node.size[1];\n          }); // 根据节点数量、spacing，调整布局参数\n\n          innerGraphLayout.layout(innerGraphData);\n\n          var _b = (0, util_1.findMinMaxNodeXY)(innerGraphNodes),\n              minX = _b.minX,\n              minY = _b.minY,\n              maxX = _b.maxX,\n              maxY = _b.maxY;\n\n          var innerGraphSize = Math.max(maxX - minX, maxY - minY, minNodeSize_1) + padding * 2;\n          innerGraphs[treeNode.id] = {\n            id: treeNode.id,\n            nodes: innerGraphNodes,\n            size: [innerGraphSize, innerGraphSize]\n          };\n        }\n\n        return true;\n      });\n    });\n    return innerGraphs;\n  };\n\n  ComboCombinedLayout.prototype.initVals = function () {\n    var self = this;\n    var nodeSize = self.nodeSize;\n    var spacing = self.spacing;\n    var nodeSizeFunc;\n    var spacingFunc; // nodeSpacing to function\n\n    if ((0, util_1.isNumber)(spacing)) {\n      spacingFunc = function () {\n        return spacing;\n      };\n    } else if ((0, util_1.isFunction)(spacing)) {\n      spacingFunc = spacing;\n    } else {\n      spacingFunc = function () {\n        return 0;\n      };\n    }\n\n    this.spacing = spacingFunc; // nodeSize to function\n\n    if (!nodeSize) {\n      nodeSizeFunc = function (d) {\n        var spacing = spacingFunc(d);\n\n        if (d.size) {\n          if ((0, util_1.isArray)(d.size)) {\n            var res = d.size[0] > d.size[1] ? d.size[0] : d.size[1];\n            return (res + spacing) / 2;\n          }\n\n          if ((0, util_1.isObject)(d.size)) {\n            var res = d.size.width > d.size.height ? d.size.width : d.size.height;\n            return (res + spacing) / 2;\n          }\n\n          return (d.size + spacing) / 2;\n        }\n\n        return 10 + spacing / 2;\n      };\n    } else if ((0, util_1.isFunction)(nodeSize)) {\n      nodeSizeFunc = function (d) {\n        var size = nodeSize(d);\n        var spacing = spacingFunc(d);\n\n        if ((0, util_1.isArray)(d.size)) {\n          var res = d.size[0] > d.size[1] ? d.size[0] : d.size[1];\n          return (res + spacing) / 2;\n        }\n\n        return ((size || 10) + spacing) / 2;\n      };\n    } else if ((0, util_1.isArray)(nodeSize)) {\n      var larger = nodeSize[0] > nodeSize[1] ? nodeSize[0] : nodeSize[1];\n      var radius_1 = larger / 2;\n\n      nodeSizeFunc = function (d) {\n        return radius_1 + spacingFunc(d) / 2;\n      };\n    } else {\n      // number type\n      var radius_2 = nodeSize / 2;\n\n      nodeSizeFunc = function (d) {\n        return radius_2 + spacingFunc(d) / 2;\n      };\n    }\n\n    this.nodeSize = nodeSizeFunc; // comboPadding to function\n\n    var comboPadding = self.comboPadding;\n    var comboPaddingFunc;\n\n    if ((0, util_1.isNumber)(comboPadding)) {\n      comboPaddingFunc = function () {\n        return comboPadding;\n      };\n    } else if ((0, util_1.isArray)(comboPadding)) {\n      comboPaddingFunc = function () {\n        return Math.max.apply(null, comboPadding);\n      };\n    } else if ((0, util_1.isFunction)(comboPadding)) {\n      comboPaddingFunc = comboPadding;\n    } else {\n      // null type\n      comboPaddingFunc = function () {\n        return 0;\n      };\n    }\n\n    this.comboPadding = comboPaddingFunc;\n  };\n\n  ComboCombinedLayout.prototype.getType = function () {\n    return \"comboCombined\";\n  };\n\n  return ComboCombinedLayout;\n}(base_1.Base);\n\nexports.ComboCombinedLayout = ComboCombinedLayout;","map":{"version":3,"mappings":"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","names":["__extends","options","_super","_this","updateCfg","ComboCombinedLayout","self","nodes","center","length","onLayoutEnd","x","y","initVals","run","edges","combos","comboEdges","nodeMap","forEach","node","id","comboMap","combo","innerGraphs","getInnerGraphs","outerNodeIds","outerNodes","nodeAncestorIdMap","allHaveNoPosition","comboTrees","cTree","innerNode","oNode","fx","fy","mass","size","push","isNaN","Math","random","child","comboId","outerEdges","concat","edge","sourceAncestorId","source","targetAncestorId","target","includes","outerData","outerLayout","_1","gravity","factor","linkDistance","nodeSize","_a","_b","min","outerLayoutType","getType","kg","preventOverlap","animate","constants_1","outerLayoutPreset","layout","innerGraph","visited","innerGraphIds","Object","keys","i","comboPadding","spacing","innerGraphLayout","innerLayout","sortBy","nodeSpacing","ctree","treeNode","padding","max","apply","children","itemType","treeNodeSize","innerGraphNodes","map","oriNode","innerGraphNodeIds_1","innerGraphData","filter","minNodeSize_1","Infinity","minX","minY","maxX","maxY","innerGraphSize","nodeSizeFunc","spacingFunc","d","res","width","height","larger","radius_1","radius_2","comboPaddingFunc","base_1","exports"],"sourceRoot":"","sources":["../../src/layout/comboCombined.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}