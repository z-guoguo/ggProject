{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport { __extends, __spreadArrays } from \"tslib\";\nimport { isNil, isNumber } from '@antv/util';\nimport Base from '../base';\n/**\n * 分类度量\n * @class\n */\n\nvar Category =\n/** @class */\nfunction (_super) {\n  __extends(Category, _super);\n\n  function Category() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = 'cat';\n    _this.isCategory = true;\n    return _this;\n  }\n\n  Category.prototype.buildIndexMap = function () {\n    if (!this.translateIndexMap) {\n      this.translateIndexMap = new Map(); // 重新构建缓存\n\n      for (var i = 0; i < this.values.length; i++) {\n        this.translateIndexMap.set(this.values[i], i);\n      }\n    }\n  };\n\n  Category.prototype.translate = function (value) {\n    // 按需构建 map\n    this.buildIndexMap(); // 找得到\n\n    var idx = this.translateIndexMap.get(value);\n\n    if (idx === undefined) {\n      idx = isNumber(value) ? value : NaN;\n    }\n\n    return idx;\n  };\n\n  Category.prototype.scale = function (value) {\n    var order = this.translate(value); // 分类数据允许 0.5 范围内调整\n    // if (order < this.min - 0.5 || order > this.max + 0.5) {\n    //   return NaN;\n    // }\n\n    var percent = this.calcPercent(order, this.min, this.max);\n    return this.calcValue(percent, this.rangeMin(), this.rangeMax());\n  };\n\n  Category.prototype.invert = function (scaledValue) {\n    var domainRange = this.max - this.min;\n    var percent = this.calcPercent(scaledValue, this.rangeMin(), this.rangeMax());\n    var idx = Math.round(domainRange * percent) + this.min;\n\n    if (idx < this.min || idx > this.max) {\n      return NaN;\n    }\n\n    return this.values[idx];\n  };\n\n  Category.prototype.getText = function (value) {\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    var v = value; // value为index\n\n    if (isNumber(value) && !this.values.includes(value)) {\n      v = this.values[v];\n    }\n\n    return _super.prototype.getText.apply(this, __spreadArrays([v], args));\n  }; // 复写属性\n\n\n  Category.prototype.initCfg = function () {\n    this.tickMethod = 'cat';\n  }; // 设置 min, max\n\n\n  Category.prototype.setDomain = function () {\n    // 用户有可能设置 min\n    if (isNil(this.getConfig('min'))) {\n      this.min = 0;\n    }\n\n    if (isNil(this.getConfig('max'))) {\n      var size = this.values.length;\n      this.max = size > 1 ? size - 1 : size;\n    } // scale.init 的时候清除缓存\n\n\n    if (this.translateIndexMap) {\n      this.translateIndexMap = undefined;\n    }\n  };\n\n  return Category;\n}(Base);\n\nexport default Category;","map":{"version":3,"mappings":"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","names":["isNil","isNumber","Base","__extends","_this","Category","translateIndexMap","Map","i","values","length","set","value","buildIndexMap","idx","get","undefined","NaN","order","translate","percent","calcPercent","min","max","calcValue","rangeMin","rangeMax","scaledValue","domainRange","Math","round","args","v","includes","_super","getText","apply","__spreadArrays","tickMethod","getConfig","size"],"sourceRoot":"","sources":["../../src/category/base.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}