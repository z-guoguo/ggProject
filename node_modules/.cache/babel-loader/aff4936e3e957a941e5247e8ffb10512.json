{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar util_1 = require(\"../util\");\n\nvar sort = function (entries, biasRight, usePrev) {\n  var parts = (0, util_1.partition)(entries, function (entry) {\n    // NOTE: 有fixorder的也可以排\n    return entry.hasOwnProperty(\"fixorder\") && !isNaN(entry.fixorder) || entry.hasOwnProperty(\"barycenter\");\n  });\n  var sortable = parts.lhs;\n  var unsortable = parts.rhs.sort(function (a, b) {\n    return -a.i - -b.i;\n  });\n  var vs = [];\n  var sum = 0;\n  var weight = 0;\n  var vsIndex = 0;\n  sortable === null || sortable === void 0 ? void 0 : sortable.sort(compareWithBias(!!biasRight, !!usePrev));\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  sortable === null || sortable === void 0 ? void 0 : sortable.forEach(function (entry) {\n    var _a;\n\n    vsIndex += (_a = entry.vs) === null || _a === void 0 ? void 0 : _a.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n  var result = {\n    vs: vs.flat()\n  };\n\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n\n  return result;\n};\n\nvar consumeUnsortable = function (vs, unsortable, index) {\n  var iindex = index;\n  var last;\n\n  while (unsortable.length && (last = unsortable[unsortable.length - 1]).i <= iindex) {\n    unsortable.pop();\n    vs === null || vs === void 0 ? void 0 : vs.push(last.vs);\n    iindex++;\n  }\n\n  return iindex;\n};\n/**\n * 配置是否考虑使用之前的布局结果\n */\n\n\nvar compareWithBias = function (bias, usePrev) {\n  return function (entryV, entryW) {\n    // 排序的时候先判断fixorder，不行再判断重心\n    if (entryV.fixorder !== undefined && entryW.fixorder !== undefined) {\n      return entryV.fixorder - entryW.fixorder;\n    }\n\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    }\n\n    if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    } // 重心相同，考虑之前排好的顺序\n\n\n    if (usePrev && entryV.order !== undefined && entryW.order !== undefined) {\n      if (entryV.order < entryW.order) {\n        return -1;\n      }\n\n      if (entryV.order > entryW.order) {\n        return 1;\n      }\n    }\n\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n};\n\nexports.default = sort;","map":{"version":3,"mappings":"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","names":["sort","entries","biasRight","usePrev","parts","entry","hasOwnProperty","isNaN","fixorder","sortable","lhs","unsortable","rhs","a","b","i","vs","sum","weight","vsIndex","compareWithBias","consumeUnsortable","forEach","_a","length","push","barycenter","result","flat","index","iindex","last","pop","bias","entryV","entryW","undefined","order","exports"],"sourceRoot":"","sources":["../../../../../src/layout/dagre/src/order/sort.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}