{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.resolve = void 0;\n\nvar ERROR_MSGS = require(\"../constants/error_msgs\");\n\nvar literal_types_1 = require(\"../constants/literal_types\");\n\nvar exceptions_1 = require(\"../utils/exceptions\");\n\nvar serialization_1 = require(\"../utils/serialization\");\n\nvar instantiation_1 = require(\"./instantiation\");\n\nvar invokeFactory = function (factoryType, serviceIdentifier, fn) {\n  try {\n    return fn();\n  } catch (error) {\n    if (exceptions_1.isStackOverflowExeption(error)) {\n      throw new Error(ERROR_MSGS.CIRCULAR_DEPENDENCY_IN_FACTORY(factoryType, serviceIdentifier.toString()));\n    } else {\n      throw error;\n    }\n  }\n};\n\nvar _resolveRequest = function (requestScope) {\n  return function (request) {\n    request.parentContext.setCurrentRequest(request);\n    var bindings = request.bindings;\n    var childRequests = request.childRequests;\n    var targetIsAnArray = request.target && request.target.isArray();\n    var targetParentIsNotAnArray = !request.parentRequest || !request.parentRequest.target || !request.target || !request.parentRequest.target.matchesArray(request.target.serviceIdentifier);\n\n    if (targetIsAnArray && targetParentIsNotAnArray) {\n      return childRequests.map(function (childRequest) {\n        var _f = _resolveRequest(requestScope);\n\n        return _f(childRequest);\n      });\n    } else {\n      var result = null;\n\n      if (request.target.isOptional() && bindings.length === 0) {\n        return undefined;\n      }\n\n      var binding_1 = bindings[0];\n      var isSingleton = binding_1.scope === literal_types_1.BindingScopeEnum.Singleton;\n      var isRequestSingleton = binding_1.scope === literal_types_1.BindingScopeEnum.Request;\n\n      if (isSingleton && binding_1.activated) {\n        return binding_1.cache;\n      }\n\n      if (isRequestSingleton && requestScope !== null && requestScope.has(binding_1.id)) {\n        return requestScope.get(binding_1.id);\n      }\n\n      if (binding_1.type === literal_types_1.BindingTypeEnum.ConstantValue) {\n        result = binding_1.cache;\n        binding_1.activated = true;\n      } else if (binding_1.type === literal_types_1.BindingTypeEnum.Function) {\n        result = binding_1.cache;\n        binding_1.activated = true;\n      } else if (binding_1.type === literal_types_1.BindingTypeEnum.Constructor) {\n        result = binding_1.implementationType;\n      } else if (binding_1.type === literal_types_1.BindingTypeEnum.DynamicValue && binding_1.dynamicValue !== null) {\n        result = invokeFactory(\"toDynamicValue\", binding_1.serviceIdentifier, function () {\n          return binding_1.dynamicValue(request.parentContext);\n        });\n      } else if (binding_1.type === literal_types_1.BindingTypeEnum.Factory && binding_1.factory !== null) {\n        result = invokeFactory(\"toFactory\", binding_1.serviceIdentifier, function () {\n          return binding_1.factory(request.parentContext);\n        });\n      } else if (binding_1.type === literal_types_1.BindingTypeEnum.Provider && binding_1.provider !== null) {\n        result = invokeFactory(\"toProvider\", binding_1.serviceIdentifier, function () {\n          return binding_1.provider(request.parentContext);\n        });\n      } else if (binding_1.type === literal_types_1.BindingTypeEnum.Instance && binding_1.implementationType !== null) {\n        result = instantiation_1.resolveInstance(binding_1.implementationType, childRequests, _resolveRequest(requestScope));\n      } else {\n        var serviceIdentifier = serialization_1.getServiceIdentifierAsString(request.serviceIdentifier);\n        throw new Error(ERROR_MSGS.INVALID_BINDING_TYPE + \" \" + serviceIdentifier);\n      }\n\n      if (typeof binding_1.onActivation === \"function\") {\n        result = binding_1.onActivation(request.parentContext, result);\n      }\n\n      if (isSingleton) {\n        binding_1.cache = result;\n        binding_1.activated = true;\n      }\n\n      if (isRequestSingleton && requestScope !== null && !requestScope.has(binding_1.id)) {\n        requestScope.set(binding_1.id, result);\n      }\n\n      return result;\n    }\n  };\n};\n\nfunction resolve(context) {\n  var _f = _resolveRequest(context.plan.rootRequest.requestScope);\n\n  return _f(context.plan.rootRequest);\n}\n\nexports.resolve = resolve;","map":{"version":3,"mappings":"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","names":["invokeFactory","factoryType","serviceIdentifier","fn","error","exceptions_1","Error","ERROR_MSGS","CIRCULAR_DEPENDENCY_IN_FACTORY","toString","_resolveRequest","requestScope","request","parentContext","setCurrentRequest","bindings","childRequests","targetIsAnArray","target","isArray","targetParentIsNotAnArray","parentRequest","matchesArray","map","childRequest","_f","result","isOptional","length","undefined","binding_1","isSingleton","scope","literal_types_1","Singleton","isRequestSingleton","Request","activated","cache","has","id","get","type","ConstantValue","Function","Constructor","implementationType","DynamicValue","dynamicValue","Factory","factory","Provider","provider","Instance","instantiation_1","serialization_1","INVALID_BINDING_TYPE","onActivation","set","resolve","context","plan","rootRequest","exports"],"sourceRoot":"","sources":["../../src/resolution/resolver.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}