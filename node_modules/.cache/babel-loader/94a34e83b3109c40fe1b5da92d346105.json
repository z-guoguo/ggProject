{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { ModifierKey } from '../types';\nimport { Dom } from '../util';\nimport { Base } from './base';\nexport class PanningManager extends Base {\n  get widgetOptions() {\n    return this.options.panning;\n  }\n\n  get pannable() {\n    return this.widgetOptions && this.widgetOptions.enabled === true;\n  }\n\n  init() {\n    this.startListening();\n    this.updateClassName();\n  }\n\n  startListening() {\n    const eventTypes = this.widgetOptions.eventTypes;\n\n    if (!eventTypes) {\n      return;\n    }\n\n    if (eventTypes.includes('leftMouseDown')) {\n      this.graph.on('blank:mousedown', this.preparePanning, this);\n      this.graph.on('node:unhandled:mousedown', this.preparePanning, this);\n      this.graph.on('edge:unhandled:mousedown', this.preparePanning, this);\n    }\n\n    if (eventTypes.includes('rightMouseDown')) {\n      this.onRightMouseDown = this.onRightMouseDown.bind(this);\n      this.view.$(this.graph.container).on('mousedown', this.onRightMouseDown);\n    }\n\n    if (eventTypes.includes('mouseWheel')) {\n      this.mousewheelHandle = new Dom.MouseWheelHandle(this.graph.container, this.onMouseWheel.bind(this), this.allowMouseWheel.bind(this));\n      this.mousewheelHandle.enable();\n    }\n  }\n\n  stopListening() {\n    const eventTypes = this.widgetOptions.eventTypes;\n\n    if (!eventTypes) {\n      return;\n    }\n\n    if (eventTypes.includes('leftMouseDown')) {\n      this.graph.off('blank:mousedown', this.preparePanning, this);\n      this.graph.off('node:unhandled:mousedown', this.preparePanning, this);\n      this.graph.off('edge:unhandled:mousedown', this.preparePanning, this);\n    }\n\n    if (eventTypes.includes('rightMouseDown')) {\n      this.view.$(this.graph.container).off('mousedown', this.onRightMouseDown);\n    }\n\n    if (eventTypes.includes('mouseWheel')) {\n      if (this.mousewheelHandle) {\n        this.mousewheelHandle.disable();\n      }\n    }\n  }\n\n  preparePanning({\n    e\n  }) {\n    if (this.allowPanning(e, true) || this.allowPanning(e) && !this.graph.selection.allowRubberband(e, true)) {\n      this.startPanning(e);\n    }\n  }\n\n  allowPanning(e, strict) {\n    return this.pannable && ModifierKey.isMatch(e, this.widgetOptions.modifiers, strict) && this.graph.hook.allowPanning(e);\n  }\n\n  startPanning(evt) {\n    const e = this.view.normalizeEvent(evt);\n    this.clientX = e.clientX;\n    this.clientY = e.clientY;\n    this.panning = true;\n    this.updateClassName();\n    this.view.$(document.body).on({\n      'mousemove.panning touchmove.panning': this.pan.bind(this),\n      'mouseup.panning touchend.panning': this.stopPanning.bind(this),\n      'mouseleave.panning': this.stopPanning.bind(this)\n    });\n    this.view.$(window).on('mouseup.panning', this.stopPanning.bind(this));\n  }\n\n  pan(evt) {\n    const e = this.view.normalizeEvent(evt);\n    const dx = e.clientX - this.clientX;\n    const dy = e.clientY - this.clientY;\n    this.clientX = e.clientX;\n    this.clientY = e.clientY;\n    const ts = this.graph.transform.getTranslation();\n    const tx = ts.tx + dx;\n    const ty = ts.ty + dy;\n    this.graph.transform.translate(tx, ty, {\n      ui: true\n    });\n  } // eslint-disable-next-line\n\n\n  stopPanning(e) {\n    this.panning = false;\n    this.updateClassName();\n    this.view.$(document.body).off('.panning');\n    this.view.$(window).off('.panning');\n  }\n\n  updateClassName() {\n    const container = this.view.container;\n    const panning = this.view.prefixClassName('graph-panning');\n    const pannable = this.view.prefixClassName('graph-pannable');\n\n    if (this.pannable) {\n      if (this.panning) {\n        Dom.addClass(container, panning);\n        Dom.removeClass(container, pannable);\n      } else {\n        Dom.removeClass(container, panning);\n        Dom.addClass(container, pannable);\n      }\n    } else {\n      Dom.removeClass(container, panning);\n      Dom.removeClass(container, pannable);\n    }\n  }\n\n  onRightMouseDown(e) {\n    if (e.button === 2 && this.allowPanning(e, true)) {\n      this.startPanning(e);\n    }\n  }\n\n  allowMouseWheel(e) {\n    return this.pannable && !e.ctrlKey;\n  }\n\n  onMouseWheel(e, deltaX, deltaY) {\n    if (!e.ctrlKey) {\n      this.graph.translateBy(-deltaX, -deltaY);\n    }\n  }\n\n  autoPanning(x, y) {\n    const buffer = 10;\n    const graphArea = this.graph.getGraphArea();\n    let dx = 0;\n    let dy = 0;\n\n    if (x <= graphArea.left + buffer) {\n      dx = -buffer;\n    }\n\n    if (y <= graphArea.top + buffer) {\n      dy = -buffer;\n    }\n\n    if (x >= graphArea.right - buffer) {\n      dx = buffer;\n    }\n\n    if (y >= graphArea.bottom - buffer) {\n      dy = buffer;\n    }\n\n    if (dx !== 0 || dy !== 0) {\n      this.graph.translateBy(-dx, -dy);\n    }\n  }\n\n  enablePanning() {\n    if (!this.pannable) {\n      this.widgetOptions.enabled = true;\n      this.updateClassName();\n    }\n  }\n\n  disablePanning() {\n    if (this.pannable) {\n      this.widgetOptions.enabled = false;\n      this.updateClassName();\n    }\n  }\n\n  dispose() {\n    this.stopListening();\n  }\n\n}\n\n__decorate([Base.dispose()], PanningManager.prototype, \"dispose\", null);","map":{"version":3,"mappings":"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","names":["ModifierKey","Dom","Base","PanningManager","widgetOptions","options","panning","pannable","enabled","init","startListening","updateClassName","eventTypes","includes","graph","on","preparePanning","onRightMouseDown","bind","view","$","container","mousewheelHandle","MouseWheelHandle","onMouseWheel","allowMouseWheel","enable","stopListening","off","disable","e","allowPanning","selection","allowRubberband","startPanning","strict","isMatch","modifiers","hook","evt","normalizeEvent","clientX","clientY","document","body","pan","stopPanning","window","dx","dy","ts","transform","getTranslation","tx","ty","translate","ui","prefixClassName","addClass","removeClass","button","ctrlKey","deltaX","deltaY","translateBy","autoPanning","x","y","buffer","graphArea","getGraphArea","left","top","right","bottom","enablePanning","disablePanning","dispose","__decorate"],"sourceRoot":"","sources":["../../src/graph/panning.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}