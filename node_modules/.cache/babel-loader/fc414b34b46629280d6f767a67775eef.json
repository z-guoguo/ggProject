{"ast":null,"code":"/**\n * @fileOverview 自定义边\n * @description 自定义边中有大量逻辑同自定义节点重复，虽然可以提取成为 mixin ，但是考虑到代码的可读性，还是单独实现。\n */\nimport { __assign } from \"tslib\";\nimport { deepMix, mix, each, isNil, isNumber, isArray } from '@antv/util';\nimport { getLabelPosition, getLoopCfgs } from '../util/graphic';\nimport { distance, getCircleCenterByPoints } from '../util/math';\nimport { getControlPoint, getSpline } from '../util/path';\nimport Global from '../global';\nimport Shape from './shape';\nimport { shapeBase, CLS_LABEL_BG_SUFFIX } from './shapeBase';\nvar CLS_SHAPE = 'edge-shape'; // start,end 倒置，center 不变\n\nfunction revertAlign(labelPosition) {\n  var textAlign = labelPosition;\n\n  if (labelPosition === 'start') {\n    textAlign = 'end';\n  } else if (labelPosition === 'end') {\n    textAlign = 'start';\n  }\n\n  return textAlign;\n}\n\nvar singleEdge = {\n  itemType: 'edge',\n\n  /**\n   * 文本的位置\n   * @type {String}\n   */\n  labelPosition: 'center',\n\n  /**\n   * 文本的 x 偏移\n   * @type {Number}\n   */\n  refX: 0,\n\n  /**\n   * 文本的 y 偏移\n   * @type {Number}\n   */\n  refY: 0,\n\n  /**\n   * 文本是否跟着线自动旋转，默认 false\n   * @type {Boolean}\n   */\n  labelAutoRotate: false,\n  // 自定义边时的配置\n  options: {\n    size: Global.defaultEdge.size,\n    style: {\n      x: 0,\n      y: 0,\n      stroke: Global.defaultEdge.style.stroke,\n      lineAppendWidth: Global.defaultEdge.style.lineAppendWidth\n    },\n    labelCfg: {\n      style: {\n        fill: Global.edgeLabel.style.fill,\n        fontSize: Global.edgeLabel.style.fontSize,\n        fontFamily: Global.windowFontFamily\n      }\n    },\n    stateStyles: __assign({}, Global.edgeStateStyles)\n  },\n\n  /**\n   * 获取边的 path\n   * @internal 供扩展的边覆盖\n   * @param  {Array} points 构成边的点的集合\n   * @return {Array} 构成 path 的数组\n   */\n  getPath: function getPath(points) {\n    var path = [];\n    each(points, function (point, index) {\n      if (index === 0) {\n        path.push(['M', point.x, point.y]);\n      } else {\n        path.push(['L', point.x, point.y]);\n      }\n    });\n    return path;\n  },\n  getShapeStyle: function getShapeStyle(cfg) {\n    var defaultStyle = this.options.style;\n    var strokeStyle = {\n      stroke: cfg.color\n    }; // 如果设置了color，则覆盖默认的stroke属性\n\n    var style = mix({}, defaultStyle, strokeStyle, cfg.style);\n    var size = cfg.size || Global.defaultEdge.size;\n    cfg = this.getPathPoints(cfg);\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    var controlPoints = this.getControlPoints(cfg);\n    var points = [startPoint]; // 添加起始点\n    // 添加控制点\n\n    if (controlPoints) {\n      points = points.concat(controlPoints);\n    } // 添加结束点\n\n\n    points.push(endPoint);\n    var path = this.getPath(points);\n    var styles = mix({}, Global.defaultEdge.style, {\n      stroke: Global.defaultEdge.color,\n      lineWidth: size,\n      path: path\n    }, style);\n    return styles;\n  },\n  updateShapeStyle: function updateShapeStyle(cfg, item, updateType) {\n    var _a;\n\n    var group = item.getContainer(); // const strokeStyle: ShapeStyle = {\n    //   stroke: cfg.color,\n    // };\n\n    var shape = ((_a = item.getKeyShape) === null || _a === void 0 ? void 0 : _a.call(item)) || group['shapeMap']['edge-shape']; // group.find((element) => element.get('className') === 'edge-shape');\n\n    var size = cfg.size;\n    cfg = this.getPathPoints(cfg);\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    var controlPoints = this.getControlPoints(cfg); // || cfg.controlPoints;\n\n    var points = [startPoint]; // 添加起始点\n    // 添加控制点\n\n    if (controlPoints) {\n      points = points.concat(controlPoints);\n    } // 添加结束点\n\n\n    points.push(endPoint);\n    var currentAttr = shape.attr(); // const previousStyle = mix({}, strokeStyle, currentAttr, cfg.style);\n\n    var previousStyle = cfg.style || {};\n\n    if (previousStyle.stroke === undefined) {\n      previousStyle.stroke = cfg.color;\n    }\n\n    var source = cfg.sourceNode;\n    var target = cfg.targetNode;\n    var routeCfg = {\n      radius: previousStyle.radius\n    };\n\n    if (!controlPoints) {\n      routeCfg = {\n        source: source,\n        target: target,\n        offset: previousStyle.offset,\n        radius: previousStyle.radius\n      };\n    }\n\n    var path = this.getPath(points, routeCfg);\n    var style = {};\n\n    if (updateType === 'move') {\n      style = {\n        path: path\n      };\n    } else {\n      if (currentAttr.endArrow && previousStyle.endArrow === false) {\n        cfg.style.endArrow = {\n          path: ''\n        };\n      }\n\n      if (currentAttr.startArrow && previousStyle.startArrow === false) {\n        cfg.style.startArrow = {\n          path: ''\n        };\n      }\n\n      style = __assign({}, cfg.style);\n      if (style.lineWidth === undefined) style.lineWdith = (isNumber(size) ? size : size === null || size === void 0 ? void 0 : size[0]) || currentAttr.lineWidth;\n      if (style.path === undefined) style.path = path;\n      if (style.stroke === undefined) style.stroke = currentAttr.stroke || cfg.color;\n    }\n\n    if (shape) {\n      shape.attr(style);\n    }\n  },\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg, group) {\n    var labelPosition = labelCfg.position || this.labelPosition; // 文本的位置用户可以传入\n\n    var style = {};\n    var pathShape = group === null || group === void 0 ? void 0 : group['shapeMap'][CLS_SHAPE]; // group?.find((element) => element.get('className') === CLS_SHAPE);\n    // 不对 pathShape 进行判空，如果线不存在，说明有问题了\n\n    var pointPercent;\n\n    if (labelPosition === 'start') {\n      pointPercent = 0;\n    } else if (labelPosition === 'end') {\n      pointPercent = 1;\n    } else {\n      pointPercent = 0.5;\n    } // 偏移量\n\n\n    var offsetX = labelCfg.refX || this.refX;\n    var offsetY = labelCfg.refY || this.refY; // 如果两个节点重叠，线就变成了一个点，这时候label的位置，就是这个点 + 绝对偏移\n\n    if (cfg.startPoint.x === cfg.endPoint.x && cfg.startPoint.y === cfg.endPoint.y) {\n      style.x = cfg.startPoint.x + offsetX;\n      style.y = cfg.startPoint.y + offsetY;\n      style.text = cfg.label;\n      return style;\n    }\n\n    var autoRotate;\n    if (isNil(labelCfg.autoRotate)) autoRotate = this.labelAutoRotate;else autoRotate = labelCfg.autoRotate;\n    var offsetStyle = getLabelPosition(pathShape, pointPercent, offsetX, offsetY, autoRotate);\n    style.x = offsetStyle.x;\n    style.y = offsetStyle.y;\n    style.rotate = offsetStyle.rotate;\n    style.textAlign = this._getTextAlign(labelPosition, offsetStyle.angle);\n    style.text = cfg.label;\n    return style;\n  },\n  getLabelBgStyleByPosition: function getLabelBgStyleByPosition(label, labelCfg) {\n    if (!label) {\n      return {};\n    }\n\n    var bbox = label.getBBox();\n    var backgroundStyle = labelCfg.style && labelCfg.style.background;\n\n    if (!backgroundStyle) {\n      return {};\n    }\n\n    var padding = backgroundStyle.padding;\n    var backgroundWidth = bbox.width + padding[1] + padding[3];\n    var backgroundHeight = bbox.height + padding[0] + padding[2];\n\n    var style = __assign(__assign({}, backgroundStyle), {\n      width: backgroundWidth,\n      height: backgroundHeight,\n      x: bbox.minX - padding[3],\n      y: bbox.minY - padding[0],\n      matrix: [1, 0, 0, 0, 1, 0, 0, 0, 1]\n    });\n\n    var autoRotate;\n    if (isNil(labelCfg.autoRotate)) autoRotate = this.labelAutoRotate;else autoRotate = labelCfg.autoRotate;\n\n    if (autoRotate) {\n      style.matrix = label.attr('matrix') || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    return style;\n  },\n  // 获取文本对齐方式\n  _getTextAlign: function _getTextAlign(labelPosition, angle) {\n    var textAlign = 'center';\n\n    if (!angle) {\n      return labelPosition;\n    }\n\n    angle = angle % (Math.PI * 2); // 取模\n\n    if (labelPosition !== 'center') {\n      if (angle >= 0 && angle <= Math.PI / 2 || angle >= 3 / 2 * Math.PI && angle < 2 * Math.PI) {\n        textAlign = labelPosition;\n      } else {\n        textAlign = revertAlign(labelPosition);\n      }\n    }\n\n    return textAlign;\n  },\n\n  /**\n   * @internal 获取边的控制点\n   * @param  {Object} cfg 边的配置项\n   * @return {Array} 控制点的数组\n   */\n  getControlPoints: function getControlPoints(cfg) {\n    return cfg.controlPoints;\n  },\n\n  /**\n   * @internal 处理需要重计算点和边的情况\n   * @param {Object} cfg 边的配置项\n   * @return {Object} 边的配置项\n   */\n  getPathPoints: function getPathPoints(cfg) {\n    return cfg;\n  },\n\n  /**\n   * 绘制边\n   * @override\n   * @param  {Object} cfg   边的配置项\n   * @param  {G.Group} group 边的容器\n   * @return {IShape} 图形\n   */\n  drawShape: function drawShape(cfg, group) {\n    var shapeStyle = this.getShapeStyle(cfg);\n    var shape = group.addShape('path', {\n      className: CLS_SHAPE,\n      name: CLS_SHAPE,\n      attrs: shapeStyle\n    });\n    group['shapeMap'][CLS_SHAPE] = shape;\n    return shape;\n  },\n  drawLabel: function drawLabel(cfg, group) {\n    var defaultLabelCfg = this.options.labelCfg;\n    var labelCfg = deepMix({}, defaultLabelCfg, cfg.labelCfg);\n    var labelStyle = this.getLabelStyle(cfg, labelCfg, group);\n    var rotate = labelStyle.rotate;\n    delete labelStyle.rotate;\n    var label = group.addShape('text', {\n      attrs: labelStyle,\n      name: 'text-shape',\n      labelRelated: true\n    });\n    group['shapeMap']['text-shape'] = label;\n\n    if (!isNaN(rotate) && rotate !== '') {\n      label.rotateAtStart(rotate);\n    }\n\n    if (labelStyle.background) {\n      var rect = this.drawLabelBg(cfg, group, label, labelStyle, rotate);\n      var labelBgClassname = this.itemType + CLS_LABEL_BG_SUFFIX;\n      rect.set('classname', labelBgClassname);\n      group['shapeMap'][labelBgClassname] = rect;\n      label.toFront();\n    }\n\n    return label;\n  },\n  drawLabelBg: function drawLabelBg(cfg, group, label, labelStyle, rotate) {\n    var defaultLabelCfg = this.options.labelCfg;\n    var labelCfg = deepMix({}, defaultLabelCfg, cfg.labelCfg);\n    var style = this.getLabelBgStyleByPosition(label, labelCfg);\n    var rect = group.addShape('rect', {\n      name: 'text-bg-shape',\n      attrs: style,\n      labelRelated: true\n    });\n    group['shapeMap']['text-bg-shape'] = rect;\n    return rect;\n  }\n};\n\nvar singleEdgeDef = __assign(__assign({}, shapeBase), singleEdge);\n\nShape.registerEdge('single-edge', singleEdgeDef); // 直线, 不支持控制点\n\nShape.registerEdge('line', {\n  // 控制点不生效\n  getControlPoints: function getControlPoints() {\n    return undefined;\n  }\n}, 'single-edge'); // 直线\n\nShape.registerEdge('spline', {\n  getPath: function getPath(points) {\n    var path = getSpline(points);\n    return path;\n  }\n}, 'single-edge');\nShape.registerEdge('arc', {\n  curveOffset: 20,\n  clockwise: 1,\n  getControlPoints: function getControlPoints(cfg) {\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    var midPoint = {\n      x: (startPoint.x + endPoint.x) / 2,\n      y: (startPoint.y + endPoint.y) / 2\n    };\n    var center;\n    var arcPoint; // 根据给定点计算圆弧\n\n    if (cfg.controlPoints !== undefined) {\n      arcPoint = cfg.controlPoints[0];\n      center = getCircleCenterByPoints(startPoint, arcPoint, endPoint); // 根据控制点和直线关系决定 clockwise值\n\n      if (startPoint.x <= endPoint.x && startPoint.y > endPoint.y) {\n        this.clockwise = center.x > arcPoint.x ? 0 : 1;\n      } else if (startPoint.x <= endPoint.x && startPoint.y < endPoint.y) {\n        this.clockwise = center.x > arcPoint.x ? 1 : 0;\n      } else if (startPoint.x > endPoint.x && startPoint.y <= endPoint.y) {\n        this.clockwise = center.y < arcPoint.y ? 0 : 1;\n      } else {\n        this.clockwise = center.y < arcPoint.y ? 1 : 0;\n      } // 若给定点和两端点共线，无法生成圆弧，绘制直线\n\n\n      if ((arcPoint.x - startPoint.x) / (arcPoint.y - startPoint.y) === (endPoint.x - startPoint.x) / (endPoint.y - startPoint.y)) {\n        return [];\n      }\n    } else {\n      // 根据直线连线中点的的偏移计算圆弧\n      // 若用户给定偏移量则根据其计算，否则按照默认偏移值计算\n      if (cfg.curveOffset === undefined) {\n        cfg.curveOffset = this.curveOffset;\n      }\n\n      if (isArray(cfg.curveOffset)) {\n        cfg.curveOffset = cfg.curveOffset[0];\n      }\n\n      if (cfg.curveOffset < 0) {\n        this.clockwise = 0;\n      } else {\n        this.clockwise = 1;\n      }\n\n      var vec = {\n        x: endPoint.x - startPoint.x,\n        y: endPoint.y - startPoint.y\n      };\n      var edgeAngle = Math.atan2(vec.y, vec.x);\n      arcPoint = {\n        x: cfg.curveOffset * Math.cos(-Math.PI / 2 + edgeAngle) + midPoint.x,\n        y: cfg.curveOffset * Math.sin(-Math.PI / 2 + edgeAngle) + midPoint.y\n      };\n      center = getCircleCenterByPoints(startPoint, arcPoint, endPoint);\n    }\n\n    var radius = distance(startPoint, center);\n    var controlPoints = [{\n      x: radius,\n      y: radius\n    }];\n    return controlPoints;\n  },\n  getPath: function getPath(points) {\n    var path = [];\n    path.push(['M', points[0].x, points[0].y]); // 控制点与端点共线\n\n    if (points.length === 2) {\n      path.push(['L', points[1].x, points[1].y]);\n    } else {\n      path.push(['A', points[1].x, points[1].y, 0, 0, this.clockwise, points[2].x, points[2].y]);\n    }\n\n    return path;\n  }\n}, 'single-edge');\nShape.registerEdge('quadratic', {\n  curvePosition: 0.5,\n  curveOffset: -20,\n  getControlPoints: function getControlPoints(cfg) {\n    var controlPoints = cfg.controlPoints; // 指定controlPoints\n\n    if (!controlPoints || !controlPoints.length) {\n      var startPoint = cfg.startPoint,\n          endPoint = cfg.endPoint;\n      if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n      if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n      if (isArray(this.curveOffset)) cfg.curveOffset = cfg.curveOffset[0];\n      if (isArray(this.curvePosition)) cfg.curvePosition = cfg.curveOffset[0];\n      var innerPoint = getControlPoint(startPoint, endPoint, cfg.curvePosition, cfg.curveOffset);\n      controlPoints = [innerPoint];\n    }\n\n    return controlPoints;\n  },\n  getPath: function getPath(points) {\n    var path = [];\n    path.push(['M', points[0].x, points[0].y]);\n    path.push(['Q', points[1].x, points[1].y, points[2].x, points[2].y]);\n    return path;\n  }\n}, 'single-edge');\nShape.registerEdge('cubic', {\n  curvePosition: [1 / 2, 1 / 2],\n  curveOffset: [-20, 20],\n  getControlPoints: function getControlPoints(cfg) {\n    var controlPoints = cfg.controlPoints; // 指定 controlPoints\n\n    if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n    if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n    if (isNumber(cfg.curveOffset)) cfg.curveOffset = [cfg.curveOffset, -cfg.curveOffset];\n    if (isNumber(cfg.curvePosition)) cfg.curvePosition = [cfg.curvePosition, 1 - cfg.curvePosition];\n\n    if (!controlPoints || !controlPoints.length || controlPoints.length < 2) {\n      var startPoint = cfg.startPoint,\n          endPoint = cfg.endPoint;\n      var innerPoint1 = getControlPoint(startPoint, endPoint, cfg.curvePosition[0], cfg.curveOffset[0]);\n      var innerPoint2 = getControlPoint(startPoint, endPoint, cfg.curvePosition[1], cfg.curveOffset[1]);\n      controlPoints = [innerPoint1, innerPoint2];\n    }\n\n    return controlPoints;\n  },\n  getPath: function getPath(points) {\n    var path = [];\n    path.push(['M', points[0].x, points[0].y]);\n    path.push(['C', points[1].x, points[1].y, points[2].x, points[2].y, points[3].x, points[3].y]);\n    return path;\n  }\n}, 'single-edge'); // 垂直方向的三阶贝塞尔曲线，不再考虑用户外部传入的控制点\n\nShape.registerEdge('cubic-vertical', {\n  curvePosition: [1 / 2, 1 / 2],\n  minCurveOffset: [0, 0],\n  curveOffset: undefined,\n  getControlPoints: function getControlPoints(cfg) {\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n    if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n    if (cfg.minCurveOffset === undefined) cfg.minCurveOffset = this.minCurveOffset;\n    if (isNumber(cfg.curveOffset)) cfg.curveOffset = [cfg.curveOffset, -cfg.curveOffset];\n    if (isNumber(cfg.minCurveOffset)) cfg.minCurveOffset = [cfg.minCurveOffset, -cfg.minCurveOffset];\n    if (isNumber(cfg.curvePosition)) cfg.curvePosition = [cfg.curvePosition, 1 - cfg.curvePosition];\n    var yDist = endPoint.y - startPoint.y;\n    var curveOffset = [0, 0];\n\n    if (cfg.curveOffset) {\n      curveOffset = cfg.curveOffset;\n    } else if (Math.abs(yDist) < Math.abs(cfg.minCurveOffset[0])) {\n      curveOffset = cfg.minCurveOffset;\n    }\n\n    var innerPoint1 = {\n      x: startPoint.x,\n      y: startPoint.y + yDist * this.curvePosition[0] + curveOffset[0]\n    };\n    var innerPoint2 = {\n      x: endPoint.x,\n      y: endPoint.y - yDist * this.curvePosition[1] + curveOffset[1]\n    };\n    return [innerPoint1, innerPoint2];\n  }\n}, 'cubic'); // 水平方向的三阶贝塞尔曲线，不再考虑用户外部传入的控制点\n\nShape.registerEdge('cubic-horizontal', {\n  curvePosition: [1 / 2, 1 / 2],\n  minCurveOffset: [0, 0],\n  curveOffset: undefined,\n  getControlPoints: function getControlPoints(cfg) {\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n    if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n    if (cfg.minCurveOffset === undefined) cfg.minCurveOffset = this.minCurveOffset;\n    if (isNumber(cfg.curveOffset)) cfg.curveOffset = [cfg.curveOffset, -cfg.curveOffset];\n    if (isNumber(cfg.minCurveOffset)) cfg.minCurveOffset = [cfg.minCurveOffset, -cfg.minCurveOffset];\n    if (isNumber(cfg.curvePosition)) cfg.curvePosition = [cfg.curvePosition, 1 - cfg.curvePosition];\n    var xDist = endPoint.x - startPoint.x;\n    var curveOffset = [0, 0];\n\n    if (cfg.curveOffset) {\n      curveOffset = cfg.curveOffset;\n    } else if (Math.abs(xDist) < Math.abs(cfg.minCurveOffset[0])) {\n      curveOffset = cfg.minCurveOffset;\n    }\n\n    var innerPoint1 = {\n      x: startPoint.x + xDist * this.curvePosition[0] + curveOffset[0],\n      y: startPoint.y\n    };\n    var innerPoint2 = {\n      x: endPoint.x - xDist * this.curvePosition[1] + curveOffset[1],\n      y: endPoint.y\n    };\n    var controlPoints = [innerPoint1, innerPoint2];\n    return controlPoints;\n  }\n}, 'cubic');\nShape.registerEdge('loop', {\n  getPathPoints: function getPathPoints(cfg) {\n    return getLoopCfgs(cfg);\n  },\n  getControlPoints: function getControlPoints(cfg) {\n    return cfg.controlPoints;\n  },\n  afterDraw: function afterDraw(cfg) {\n    cfg.controlPoints = undefined;\n  },\n  afterUpdate: function afterUpdate(cfg) {\n    cfg.controlPoints = undefined;\n  }\n}, 'cubic');","map":{"version":3,"names":["__assign","deepMix","mix","each","isNil","isNumber","isArray","getLabelPosition","getLoopCfgs","distance","getCircleCenterByPoints","getControlPoint","getSpline","Global","Shape","shapeBase","CLS_LABEL_BG_SUFFIX","CLS_SHAPE","revertAlign","labelPosition","textAlign","singleEdge","itemType","refX","refY","labelAutoRotate","options","size","defaultEdge","style","x","y","stroke","lineAppendWidth","labelCfg","fill","edgeLabel","fontSize","fontFamily","windowFontFamily","stateStyles","edgeStateStyles","getPath","points","path","point","index","push","getShapeStyle","cfg","defaultStyle","strokeStyle","color","getPathPoints","startPoint","endPoint","controlPoints","getControlPoints","concat","styles","lineWidth","updateShapeStyle","item","updateType","_a","group","getContainer","shape","getKeyShape","call","currentAttr","attr","previousStyle","undefined","source","sourceNode","target","targetNode","routeCfg","radius","offset","endArrow","startArrow","lineWdith","getLabelStyleByPosition","position","pathShape","pointPercent","offsetX","offsetY","text","label","autoRotate","offsetStyle","rotate","_getTextAlign","angle","getLabelBgStyleByPosition","bbox","getBBox","backgroundStyle","background","padding","backgroundWidth","width","backgroundHeight","height","minX","minY","matrix","Math","PI","drawShape","shapeStyle","addShape","className","name","attrs","drawLabel","defaultLabelCfg","labelStyle","getLabelStyle","labelRelated","isNaN","rotateAtStart","rect","drawLabelBg","labelBgClassname","set","toFront","singleEdgeDef","registerEdge","curveOffset","clockwise","midPoint","center","arcPoint","vec","edgeAngle","atan2","cos","sin","length","curvePosition","innerPoint","innerPoint1","innerPoint2","minCurveOffset","yDist","abs","xDist","afterDraw","afterUpdate"],"sources":["/Users/wawalike/Desktop/ggProject/node_modules/@antv/g6-core/es/element/edge.js"],"sourcesContent":["/**\n * @fileOverview 自定义边\n * @description 自定义边中有大量逻辑同自定义节点重复，虽然可以提取成为 mixin ，但是考虑到代码的可读性，还是单独实现。\n */\nimport { __assign } from \"tslib\";\nimport { deepMix, mix, each, isNil, isNumber, isArray } from '@antv/util';\nimport { getLabelPosition, getLoopCfgs } from '../util/graphic';\nimport { distance, getCircleCenterByPoints } from '../util/math';\nimport { getControlPoint, getSpline } from '../util/path';\nimport Global from '../global';\nimport Shape from './shape';\nimport { shapeBase, CLS_LABEL_BG_SUFFIX } from './shapeBase';\nvar CLS_SHAPE = 'edge-shape'; // start,end 倒置，center 不变\n\nfunction revertAlign(labelPosition) {\n  var textAlign = labelPosition;\n\n  if (labelPosition === 'start') {\n    textAlign = 'end';\n  } else if (labelPosition === 'end') {\n    textAlign = 'start';\n  }\n\n  return textAlign;\n}\n\nvar singleEdge = {\n  itemType: 'edge',\n\n  /**\n   * 文本的位置\n   * @type {String}\n   */\n  labelPosition: 'center',\n\n  /**\n   * 文本的 x 偏移\n   * @type {Number}\n   */\n  refX: 0,\n\n  /**\n   * 文本的 y 偏移\n   * @type {Number}\n   */\n  refY: 0,\n\n  /**\n   * 文本是否跟着线自动旋转，默认 false\n   * @type {Boolean}\n   */\n  labelAutoRotate: false,\n  // 自定义边时的配置\n  options: {\n    size: Global.defaultEdge.size,\n    style: {\n      x: 0,\n      y: 0,\n      stroke: Global.defaultEdge.style.stroke,\n      lineAppendWidth: Global.defaultEdge.style.lineAppendWidth\n    },\n    labelCfg: {\n      style: {\n        fill: Global.edgeLabel.style.fill,\n        fontSize: Global.edgeLabel.style.fontSize,\n        fontFamily: Global.windowFontFamily\n      }\n    },\n    stateStyles: __assign({}, Global.edgeStateStyles)\n  },\n\n  /**\n   * 获取边的 path\n   * @internal 供扩展的边覆盖\n   * @param  {Array} points 构成边的点的集合\n   * @return {Array} 构成 path 的数组\n   */\n  getPath: function getPath(points) {\n    var path = [];\n    each(points, function (point, index) {\n      if (index === 0) {\n        path.push(['M', point.x, point.y]);\n      } else {\n        path.push(['L', point.x, point.y]);\n      }\n    });\n    return path;\n  },\n  getShapeStyle: function getShapeStyle(cfg) {\n    var defaultStyle = this.options.style;\n    var strokeStyle = {\n      stroke: cfg.color\n    }; // 如果设置了color，则覆盖默认的stroke属性\n\n    var style = mix({}, defaultStyle, strokeStyle, cfg.style);\n    var size = cfg.size || Global.defaultEdge.size;\n    cfg = this.getPathPoints(cfg);\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    var controlPoints = this.getControlPoints(cfg);\n    var points = [startPoint]; // 添加起始点\n    // 添加控制点\n\n    if (controlPoints) {\n      points = points.concat(controlPoints);\n    } // 添加结束点\n\n\n    points.push(endPoint);\n    var path = this.getPath(points);\n    var styles = mix({}, Global.defaultEdge.style, {\n      stroke: Global.defaultEdge.color,\n      lineWidth: size,\n      path: path\n    }, style);\n    return styles;\n  },\n  updateShapeStyle: function updateShapeStyle(cfg, item, updateType) {\n    var _a;\n\n    var group = item.getContainer(); // const strokeStyle: ShapeStyle = {\n    //   stroke: cfg.color,\n    // };\n\n    var shape = ((_a = item.getKeyShape) === null || _a === void 0 ? void 0 : _a.call(item)) || group['shapeMap']['edge-shape']; // group.find((element) => element.get('className') === 'edge-shape');\n\n    var size = cfg.size;\n    cfg = this.getPathPoints(cfg);\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    var controlPoints = this.getControlPoints(cfg); // || cfg.controlPoints;\n\n    var points = [startPoint]; // 添加起始点\n    // 添加控制点\n\n    if (controlPoints) {\n      points = points.concat(controlPoints);\n    } // 添加结束点\n\n\n    points.push(endPoint);\n    var currentAttr = shape.attr(); // const previousStyle = mix({}, strokeStyle, currentAttr, cfg.style);\n\n    var previousStyle = cfg.style || {};\n\n    if (previousStyle.stroke === undefined) {\n      previousStyle.stroke = cfg.color;\n    }\n\n    var source = cfg.sourceNode;\n    var target = cfg.targetNode;\n    var routeCfg = {\n      radius: previousStyle.radius\n    };\n\n    if (!controlPoints) {\n      routeCfg = {\n        source: source,\n        target: target,\n        offset: previousStyle.offset,\n        radius: previousStyle.radius\n      };\n    }\n\n    var path = this.getPath(points, routeCfg);\n    var style = {};\n\n    if (updateType === 'move') {\n      style = {\n        path: path\n      };\n    } else {\n      if (currentAttr.endArrow && previousStyle.endArrow === false) {\n        cfg.style.endArrow = {\n          path: ''\n        };\n      }\n\n      if (currentAttr.startArrow && previousStyle.startArrow === false) {\n        cfg.style.startArrow = {\n          path: ''\n        };\n      }\n\n      style = __assign({}, cfg.style);\n      if (style.lineWidth === undefined) style.lineWdith = (isNumber(size) ? size : size === null || size === void 0 ? void 0 : size[0]) || currentAttr.lineWidth;\n      if (style.path === undefined) style.path = path;\n      if (style.stroke === undefined) style.stroke = currentAttr.stroke || cfg.color;\n    }\n\n    if (shape) {\n      shape.attr(style);\n    }\n  },\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg, group) {\n    var labelPosition = labelCfg.position || this.labelPosition; // 文本的位置用户可以传入\n\n    var style = {};\n    var pathShape = group === null || group === void 0 ? void 0 : group['shapeMap'][CLS_SHAPE]; // group?.find((element) => element.get('className') === CLS_SHAPE);\n    // 不对 pathShape 进行判空，如果线不存在，说明有问题了\n\n    var pointPercent;\n\n    if (labelPosition === 'start') {\n      pointPercent = 0;\n    } else if (labelPosition === 'end') {\n      pointPercent = 1;\n    } else {\n      pointPercent = 0.5;\n    } // 偏移量\n\n\n    var offsetX = labelCfg.refX || this.refX;\n    var offsetY = labelCfg.refY || this.refY; // 如果两个节点重叠，线就变成了一个点，这时候label的位置，就是这个点 + 绝对偏移\n\n    if (cfg.startPoint.x === cfg.endPoint.x && cfg.startPoint.y === cfg.endPoint.y) {\n      style.x = cfg.startPoint.x + offsetX;\n      style.y = cfg.startPoint.y + offsetY;\n      style.text = cfg.label;\n      return style;\n    }\n\n    var autoRotate;\n    if (isNil(labelCfg.autoRotate)) autoRotate = this.labelAutoRotate;else autoRotate = labelCfg.autoRotate;\n    var offsetStyle = getLabelPosition(pathShape, pointPercent, offsetX, offsetY, autoRotate);\n    style.x = offsetStyle.x;\n    style.y = offsetStyle.y;\n    style.rotate = offsetStyle.rotate;\n    style.textAlign = this._getTextAlign(labelPosition, offsetStyle.angle);\n    style.text = cfg.label;\n    return style;\n  },\n  getLabelBgStyleByPosition: function getLabelBgStyleByPosition(label, labelCfg) {\n    if (!label) {\n      return {};\n    }\n\n    var bbox = label.getBBox();\n    var backgroundStyle = labelCfg.style && labelCfg.style.background;\n\n    if (!backgroundStyle) {\n      return {};\n    }\n\n    var padding = backgroundStyle.padding;\n    var backgroundWidth = bbox.width + padding[1] + padding[3];\n    var backgroundHeight = bbox.height + padding[0] + padding[2];\n\n    var style = __assign(__assign({}, backgroundStyle), {\n      width: backgroundWidth,\n      height: backgroundHeight,\n      x: bbox.minX - padding[3],\n      y: bbox.minY - padding[0],\n      matrix: [1, 0, 0, 0, 1, 0, 0, 0, 1]\n    });\n\n    var autoRotate;\n    if (isNil(labelCfg.autoRotate)) autoRotate = this.labelAutoRotate;else autoRotate = labelCfg.autoRotate;\n\n    if (autoRotate) {\n      style.matrix = label.attr('matrix') || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    return style;\n  },\n  // 获取文本对齐方式\n  _getTextAlign: function _getTextAlign(labelPosition, angle) {\n    var textAlign = 'center';\n\n    if (!angle) {\n      return labelPosition;\n    }\n\n    angle = angle % (Math.PI * 2); // 取模\n\n    if (labelPosition !== 'center') {\n      if (angle >= 0 && angle <= Math.PI / 2 || angle >= 3 / 2 * Math.PI && angle < 2 * Math.PI) {\n        textAlign = labelPosition;\n      } else {\n        textAlign = revertAlign(labelPosition);\n      }\n    }\n\n    return textAlign;\n  },\n\n  /**\n   * @internal 获取边的控制点\n   * @param  {Object} cfg 边的配置项\n   * @return {Array} 控制点的数组\n   */\n  getControlPoints: function getControlPoints(cfg) {\n    return cfg.controlPoints;\n  },\n\n  /**\n   * @internal 处理需要重计算点和边的情况\n   * @param {Object} cfg 边的配置项\n   * @return {Object} 边的配置项\n   */\n  getPathPoints: function getPathPoints(cfg) {\n    return cfg;\n  },\n\n  /**\n   * 绘制边\n   * @override\n   * @param  {Object} cfg   边的配置项\n   * @param  {G.Group} group 边的容器\n   * @return {IShape} 图形\n   */\n  drawShape: function drawShape(cfg, group) {\n    var shapeStyle = this.getShapeStyle(cfg);\n    var shape = group.addShape('path', {\n      className: CLS_SHAPE,\n      name: CLS_SHAPE,\n      attrs: shapeStyle\n    });\n    group['shapeMap'][CLS_SHAPE] = shape;\n    return shape;\n  },\n  drawLabel: function drawLabel(cfg, group) {\n    var defaultLabelCfg = this.options.labelCfg;\n    var labelCfg = deepMix({}, defaultLabelCfg, cfg.labelCfg);\n    var labelStyle = this.getLabelStyle(cfg, labelCfg, group);\n    var rotate = labelStyle.rotate;\n    delete labelStyle.rotate;\n    var label = group.addShape('text', {\n      attrs: labelStyle,\n      name: 'text-shape',\n      labelRelated: true\n    });\n    group['shapeMap']['text-shape'] = label;\n\n    if (!isNaN(rotate) && rotate !== '') {\n      label.rotateAtStart(rotate);\n    }\n\n    if (labelStyle.background) {\n      var rect = this.drawLabelBg(cfg, group, label, labelStyle, rotate);\n      var labelBgClassname = this.itemType + CLS_LABEL_BG_SUFFIX;\n      rect.set('classname', labelBgClassname);\n      group['shapeMap'][labelBgClassname] = rect;\n      label.toFront();\n    }\n\n    return label;\n  },\n  drawLabelBg: function drawLabelBg(cfg, group, label, labelStyle, rotate) {\n    var defaultLabelCfg = this.options.labelCfg;\n    var labelCfg = deepMix({}, defaultLabelCfg, cfg.labelCfg);\n    var style = this.getLabelBgStyleByPosition(label, labelCfg);\n    var rect = group.addShape('rect', {\n      name: 'text-bg-shape',\n      attrs: style,\n      labelRelated: true\n    });\n    group['shapeMap']['text-bg-shape'] = rect;\n    return rect;\n  }\n};\n\nvar singleEdgeDef = __assign(__assign({}, shapeBase), singleEdge);\n\nShape.registerEdge('single-edge', singleEdgeDef); // 直线, 不支持控制点\n\nShape.registerEdge('line', {\n  // 控制点不生效\n  getControlPoints: function getControlPoints() {\n    return undefined;\n  }\n}, 'single-edge'); // 直线\n\nShape.registerEdge('spline', {\n  getPath: function getPath(points) {\n    var path = getSpline(points);\n    return path;\n  }\n}, 'single-edge');\nShape.registerEdge('arc', {\n  curveOffset: 20,\n  clockwise: 1,\n  getControlPoints: function getControlPoints(cfg) {\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    var midPoint = {\n      x: (startPoint.x + endPoint.x) / 2,\n      y: (startPoint.y + endPoint.y) / 2\n    };\n    var center;\n    var arcPoint; // 根据给定点计算圆弧\n\n    if (cfg.controlPoints !== undefined) {\n      arcPoint = cfg.controlPoints[0];\n      center = getCircleCenterByPoints(startPoint, arcPoint, endPoint); // 根据控制点和直线关系决定 clockwise值\n\n      if (startPoint.x <= endPoint.x && startPoint.y > endPoint.y) {\n        this.clockwise = center.x > arcPoint.x ? 0 : 1;\n      } else if (startPoint.x <= endPoint.x && startPoint.y < endPoint.y) {\n        this.clockwise = center.x > arcPoint.x ? 1 : 0;\n      } else if (startPoint.x > endPoint.x && startPoint.y <= endPoint.y) {\n        this.clockwise = center.y < arcPoint.y ? 0 : 1;\n      } else {\n        this.clockwise = center.y < arcPoint.y ? 1 : 0;\n      } // 若给定点和两端点共线，无法生成圆弧，绘制直线\n\n\n      if ((arcPoint.x - startPoint.x) / (arcPoint.y - startPoint.y) === (endPoint.x - startPoint.x) / (endPoint.y - startPoint.y)) {\n        return [];\n      }\n    } else {\n      // 根据直线连线中点的的偏移计算圆弧\n      // 若用户给定偏移量则根据其计算，否则按照默认偏移值计算\n      if (cfg.curveOffset === undefined) {\n        cfg.curveOffset = this.curveOffset;\n      }\n\n      if (isArray(cfg.curveOffset)) {\n        cfg.curveOffset = cfg.curveOffset[0];\n      }\n\n      if (cfg.curveOffset < 0) {\n        this.clockwise = 0;\n      } else {\n        this.clockwise = 1;\n      }\n\n      var vec = {\n        x: endPoint.x - startPoint.x,\n        y: endPoint.y - startPoint.y\n      };\n      var edgeAngle = Math.atan2(vec.y, vec.x);\n      arcPoint = {\n        x: cfg.curveOffset * Math.cos(-Math.PI / 2 + edgeAngle) + midPoint.x,\n        y: cfg.curveOffset * Math.sin(-Math.PI / 2 + edgeAngle) + midPoint.y\n      };\n      center = getCircleCenterByPoints(startPoint, arcPoint, endPoint);\n    }\n\n    var radius = distance(startPoint, center);\n    var controlPoints = [{\n      x: radius,\n      y: radius\n    }];\n    return controlPoints;\n  },\n  getPath: function getPath(points) {\n    var path = [];\n    path.push(['M', points[0].x, points[0].y]); // 控制点与端点共线\n\n    if (points.length === 2) {\n      path.push(['L', points[1].x, points[1].y]);\n    } else {\n      path.push(['A', points[1].x, points[1].y, 0, 0, this.clockwise, points[2].x, points[2].y]);\n    }\n\n    return path;\n  }\n}, 'single-edge');\nShape.registerEdge('quadratic', {\n  curvePosition: 0.5,\n  curveOffset: -20,\n  getControlPoints: function getControlPoints(cfg) {\n    var controlPoints = cfg.controlPoints; // 指定controlPoints\n\n    if (!controlPoints || !controlPoints.length) {\n      var startPoint = cfg.startPoint,\n          endPoint = cfg.endPoint;\n      if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n      if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n      if (isArray(this.curveOffset)) cfg.curveOffset = cfg.curveOffset[0];\n      if (isArray(this.curvePosition)) cfg.curvePosition = cfg.curveOffset[0];\n      var innerPoint = getControlPoint(startPoint, endPoint, cfg.curvePosition, cfg.curveOffset);\n      controlPoints = [innerPoint];\n    }\n\n    return controlPoints;\n  },\n  getPath: function getPath(points) {\n    var path = [];\n    path.push(['M', points[0].x, points[0].y]);\n    path.push(['Q', points[1].x, points[1].y, points[2].x, points[2].y]);\n    return path;\n  }\n}, 'single-edge');\nShape.registerEdge('cubic', {\n  curvePosition: [1 / 2, 1 / 2],\n  curveOffset: [-20, 20],\n  getControlPoints: function getControlPoints(cfg) {\n    var controlPoints = cfg.controlPoints; // 指定 controlPoints\n\n    if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n    if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n    if (isNumber(cfg.curveOffset)) cfg.curveOffset = [cfg.curveOffset, -cfg.curveOffset];\n    if (isNumber(cfg.curvePosition)) cfg.curvePosition = [cfg.curvePosition, 1 - cfg.curvePosition];\n\n    if (!controlPoints || !controlPoints.length || controlPoints.length < 2) {\n      var startPoint = cfg.startPoint,\n          endPoint = cfg.endPoint;\n      var innerPoint1 = getControlPoint(startPoint, endPoint, cfg.curvePosition[0], cfg.curveOffset[0]);\n      var innerPoint2 = getControlPoint(startPoint, endPoint, cfg.curvePosition[1], cfg.curveOffset[1]);\n      controlPoints = [innerPoint1, innerPoint2];\n    }\n\n    return controlPoints;\n  },\n  getPath: function getPath(points) {\n    var path = [];\n    path.push(['M', points[0].x, points[0].y]);\n    path.push(['C', points[1].x, points[1].y, points[2].x, points[2].y, points[3].x, points[3].y]);\n    return path;\n  }\n}, 'single-edge'); // 垂直方向的三阶贝塞尔曲线，不再考虑用户外部传入的控制点\n\nShape.registerEdge('cubic-vertical', {\n  curvePosition: [1 / 2, 1 / 2],\n  minCurveOffset: [0, 0],\n  curveOffset: undefined,\n  getControlPoints: function getControlPoints(cfg) {\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n    if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n    if (cfg.minCurveOffset === undefined) cfg.minCurveOffset = this.minCurveOffset;\n    if (isNumber(cfg.curveOffset)) cfg.curveOffset = [cfg.curveOffset, -cfg.curveOffset];\n    if (isNumber(cfg.minCurveOffset)) cfg.minCurveOffset = [cfg.minCurveOffset, -cfg.minCurveOffset];\n    if (isNumber(cfg.curvePosition)) cfg.curvePosition = [cfg.curvePosition, 1 - cfg.curvePosition];\n    var yDist = endPoint.y - startPoint.y;\n    var curveOffset = [0, 0];\n\n    if (cfg.curveOffset) {\n      curveOffset = cfg.curveOffset;\n    } else if (Math.abs(yDist) < Math.abs(cfg.minCurveOffset[0])) {\n      curveOffset = cfg.minCurveOffset;\n    }\n\n    var innerPoint1 = {\n      x: startPoint.x,\n      y: startPoint.y + yDist * this.curvePosition[0] + curveOffset[0]\n    };\n    var innerPoint2 = {\n      x: endPoint.x,\n      y: endPoint.y - yDist * this.curvePosition[1] + curveOffset[1]\n    };\n    return [innerPoint1, innerPoint2];\n  }\n}, 'cubic'); // 水平方向的三阶贝塞尔曲线，不再考虑用户外部传入的控制点\n\nShape.registerEdge('cubic-horizontal', {\n  curvePosition: [1 / 2, 1 / 2],\n  minCurveOffset: [0, 0],\n  curveOffset: undefined,\n  getControlPoints: function getControlPoints(cfg) {\n    var startPoint = cfg.startPoint,\n        endPoint = cfg.endPoint;\n    if (cfg.curvePosition === undefined) cfg.curvePosition = this.curvePosition;\n    if (cfg.curveOffset === undefined) cfg.curveOffset = this.curveOffset;\n    if (cfg.minCurveOffset === undefined) cfg.minCurveOffset = this.minCurveOffset;\n    if (isNumber(cfg.curveOffset)) cfg.curveOffset = [cfg.curveOffset, -cfg.curveOffset];\n    if (isNumber(cfg.minCurveOffset)) cfg.minCurveOffset = [cfg.minCurveOffset, -cfg.minCurveOffset];\n    if (isNumber(cfg.curvePosition)) cfg.curvePosition = [cfg.curvePosition, 1 - cfg.curvePosition];\n    var xDist = endPoint.x - startPoint.x;\n    var curveOffset = [0, 0];\n\n    if (cfg.curveOffset) {\n      curveOffset = cfg.curveOffset;\n    } else if (Math.abs(xDist) < Math.abs(cfg.minCurveOffset[0])) {\n      curveOffset = cfg.minCurveOffset;\n    }\n\n    var innerPoint1 = {\n      x: startPoint.x + xDist * this.curvePosition[0] + curveOffset[0],\n      y: startPoint.y\n    };\n    var innerPoint2 = {\n      x: endPoint.x - xDist * this.curvePosition[1] + curveOffset[1],\n      y: endPoint.y\n    };\n    var controlPoints = [innerPoint1, innerPoint2];\n    return controlPoints;\n  }\n}, 'cubic');\nShape.registerEdge('loop', {\n  getPathPoints: function getPathPoints(cfg) {\n    return getLoopCfgs(cfg);\n  },\n  getControlPoints: function getControlPoints(cfg) {\n    return cfg.controlPoints;\n  },\n  afterDraw: function afterDraw(cfg) {\n    cfg.controlPoints = undefined;\n  },\n  afterUpdate: function afterUpdate(cfg) {\n    cfg.controlPoints = undefined;\n  }\n}, 'cubic');"],"mappings":"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"},"metadata":{},"sourceType":"module"}