{"ast":null,"code":"import { Point } from '../../geometry';\n\nfunction toPercentage(value, max) {\n  if (max === 0) {\n    return '0%';\n  }\n\n  return `${Math.round(value / max * 100)}%`;\n}\n\nfunction pin(relative) {\n  const strategy = (terminal, view, magnet, coords) => {\n    return view.isEdgeElement(magnet) ? pinEdgeTerminal(relative, terminal, view, magnet, coords) : pinNodeTerminal(relative, terminal, view, magnet, coords);\n  };\n\n  return strategy;\n}\n\nfunction pinNodeTerminal(relative, data, view, magnet, coords) {\n  const node = view.cell;\n  const angle = node.getAngle();\n  const bbox = view.getUnrotatedBBoxOfElement(magnet);\n  const center = node.getBBox().getCenter();\n  const pos = Point.create(coords).rotate(angle, center);\n  let dx = pos.x - bbox.x;\n  let dy = pos.y - bbox.y;\n\n  if (relative) {\n    dx = toPercentage(dx, bbox.width);\n    dy = toPercentage(dy, bbox.height);\n  }\n\n  data.anchor = {\n    name: 'topLeft',\n    args: {\n      dx,\n      dy,\n      rotate: true\n    }\n  };\n  return data;\n}\n\nfunction pinEdgeTerminal(relative, end, view, magnet, coords) {\n  const connection = view.getConnection();\n\n  if (!connection) {\n    return end;\n  }\n\n  const length = connection.closestPointLength(coords);\n\n  if (relative) {\n    const totalLength = connection.length();\n    end.anchor = {\n      name: 'ratio',\n      args: {\n        ratio: length / totalLength\n      }\n    };\n  } else {\n    end.anchor = {\n      name: 'length',\n      args: {\n        length\n      }\n    };\n  }\n\n  return end;\n}\n\nexport const pinRelative = pin(true);\nexport const pinAbsolute = pin(false);","map":{"version":3,"mappings":"AAAA,SAASA,KAAT,QAAsB,gBAAtB;;AAKA,SAASC,YAAT,CAAsBC,KAAtB,EAAqCC,GAArC,EAAgD;EAC9C,IAAIA,GAAG,KAAK,CAAZ,EAAe;IACb,OAAO,IAAP;EACD;;EAED,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAYH,KAAK,GAAGC,GAAT,GAAgB,GAA3B,CAA+B,GAAzC;AACD;;AAED,SAASG,GAAT,CAAaC,QAAb,EAA8B;EAC5B,MAAMC,QAAQ,GAAkC,CAC9CC,QAD8C,EAE9CC,IAF8C,EAG9CC,MAH8C,EAI9CC,MAJ8C,KAK5C;IACF,OAAOF,IAAI,CAACG,aAAL,CAAmBF,MAAnB,IACHG,eAAe,CAACP,QAAD,EAAWE,QAAX,EAAqBC,IAArB,EAAuCC,MAAvC,EAA+CC,MAA/C,CADZ,GAEHG,eAAe,CAACR,QAAD,EAAWE,QAAX,EAAqBC,IAArB,EAAuCC,MAAvC,EAA+CC,MAA/C,CAFnB;EAGD,CATD;;EAWA,OAAOJ,QAAP;AACD;;AAED,SAASO,eAAT,CACER,QADF,EAEES,IAFF,EAGEN,IAHF,EAIEC,MAJF,EAKEC,MALF,EAKyB;EAEvB,MAAMK,IAAI,GAAGP,IAAI,CAACQ,IAAlB;EACA,MAAMC,KAAK,GAAGF,IAAI,CAACG,QAAL,EAAd;EACA,MAAMC,IAAI,GAAGX,IAAI,CAACY,yBAAL,CAA+BX,MAA/B,CAAb;EACA,MAAMY,MAAM,GAAGN,IAAI,CAACO,OAAL,GAAeC,SAAf,EAAf;EACA,MAAMC,GAAG,GAAG1B,KAAK,CAAC2B,MAAN,CAAaf,MAAb,EAAqBgB,MAArB,CAA4BT,KAA5B,EAAmCI,MAAnC,CAAZ;EAEA,IAAIM,EAAE,GAAoBH,GAAG,CAACI,CAAJ,GAAQT,IAAI,CAACS,CAAvC;EACA,IAAIC,EAAE,GAAoBL,GAAG,CAACM,CAAJ,GAAQX,IAAI,CAACW,CAAvC;;EAEA,IAAIzB,QAAJ,EAAc;IACZsB,EAAE,GAAG5B,YAAY,CAAC4B,EAAD,EAAKR,IAAI,CAACY,KAAV,CAAjB;IACAF,EAAE,GAAG9B,YAAY,CAAC8B,EAAD,EAAKV,IAAI,CAACa,MAAV,CAAjB;EACD;;EAEDlB,IAAI,CAACmB,MAAL,GAAc;IACZC,IAAI,EAAE,SADM;IAEZC,IAAI,EAAE;MACJR,EADI;MAEJE,EAFI;MAGJH,MAAM,EAAE;IAHJ;EAFM,CAAd;EASA,OAAOZ,IAAP;AACD;;AAED,SAASF,eAAT,CACEP,QADF,EAEE+B,GAFF,EAGE5B,IAHF,EAIEC,MAJF,EAKEC,MALF,EAKyB;EAEvB,MAAM2B,UAAU,GAAG7B,IAAI,CAAC8B,aAAL,EAAnB;;EACA,IAAI,CAACD,UAAL,EAAiB;IACf,OAAOD,GAAP;EACD;;EAED,MAAMG,MAAM,GAAGF,UAAU,CAACG,kBAAX,CAA8B9B,MAA9B,CAAf;;EACA,IAAIL,QAAJ,EAAc;IACZ,MAAMoC,WAAW,GAAGJ,UAAU,CAACE,MAAX,EAApB;IACAH,GAAG,CAACH,MAAJ,GAAa;MACXC,IAAI,EAAE,OADK;MAEXC,IAAI,EAAE;QACJO,KAAK,EAAEH,MAAM,GAAGE;MADZ;IAFK,CAAb;EAMD,CARD,MAQO;IACLL,GAAG,CAACH,MAAJ,GAAa;MACXC,IAAI,EAAE,QADK;MAEXC,IAAI,EAAE;QACJI;MADI;IAFK,CAAb;EAMD;;EAED,OAAOH,GAAP;AACD;;AAED,OAAO,MAAMO,WAAW,GAAGvC,GAAG,CAAC,IAAD,CAAvB;AACP,OAAO,MAAMwC,WAAW,GAAGxC,GAAG,CAAC,KAAD,CAAvB","names":["Point","toPercentage","value","max","Math","round","pin","relative","strategy","terminal","view","magnet","coords","isEdgeElement","pinEdgeTerminal","pinNodeTerminal","data","node","cell","angle","getAngle","bbox","getUnrotatedBBoxOfElement","center","getBBox","getCenter","pos","create","rotate","dx","x","dy","y","width","height","anchor","name","args","end","connection","getConnection","length","closestPointLength","totalLength","ratio","pinRelative","pinAbsolute"],"sourceRoot":"","sources":["../../../src/registry/connection-strategy/pin.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}