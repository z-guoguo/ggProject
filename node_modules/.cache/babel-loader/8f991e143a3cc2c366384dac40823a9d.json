{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nimport { __assign } from \"tslib\";\nimport Global from '../global';\nimport { ext } from '@antv/matrix-util';\nimport { deepMix, each, mix, isBoolean, isPlainObject, clone } from '@antv/util';\nimport { cloneBesidesImg } from '../util/graphic';\nvar transform = ext.transform;\nvar CLS_SHAPE_SUFFIX = '-shape';\nvar CLS_LABEL_SUFFIX = '-label';\nvar ARROWS = ['startArrow', 'endArrow'];\nvar SHAPE_DEFAULT_ATTRS = {\n  lineWidth: 1,\n  stroke: undefined,\n  fill: undefined,\n  lineAppendWidth: 1,\n  opacity: undefined,\n  strokeOpacity: undefined,\n  fillOpacity: undefined,\n  x: 0,\n  y: 0,\n  r: 10,\n  width: 20,\n  height: 20,\n  shadowColor: undefined,\n  shadowBlur: 0,\n  shadowOffsetX: 0,\n  shadowOffsetY: 0\n};\nvar PATH_SHAPE_DEFAULT_ATTRS = {\n  lineWidth: 1,\n  stroke: '#000',\n  lineDash: undefined,\n  startArrow: false,\n  endArrow: false,\n  opacity: undefined,\n  strokeOpacity: undefined,\n  fillOpacity: undefined,\n  shadowColor: undefined,\n  shadowBlur: 0,\n  shadowOffsetX: 0,\n  shadowOffsetY: 0\n};\nvar SHAPES_DEFAULT_ATTRS = {\n  edge: PATH_SHAPE_DEFAULT_ATTRS,\n  node: SHAPE_DEFAULT_ATTRS,\n  combo: SHAPE_DEFAULT_ATTRS\n};\nexport var CLS_LABEL_BG_SUFFIX = '-label-bg'; // 单个 shape 带有一个 label，共用这段代码\n\nexport var shapeBase = {\n  // 默认样式及配置\n  options: {\n    labelCfg: {\n      style: {\n        fontFamily: Global.windowFontFamily\n      }\n    },\n    descriptionCfg: {\n      style: {\n        fontFamily: Global.windowFontFamily\n      }\n    }\n  },\n  itemType: '',\n\n  /**\n   * 形状的类型，例如 circle，ellipse，polyline...\n   */\n  type: '',\n  getCustomConfig: function getCustomConfig(cfg) {\n    return {};\n  },\n  getOptions: function getOptions(cfg, updateType) {\n    if (updateType === 'move' || (updateType === null || updateType === void 0 ? void 0 : updateType.includes('bbox'))) {\n      return {};\n    }\n\n    return deepMix({}, this.options, this.getCustomConfig(cfg) || {}, cfg);\n  },\n\n  /**\n   * 绘制节点/边，包含文本\n   * @override\n   * @param  {Object} cfg 节点的配置项\n   * @param  {G.Group} group 节点的容器\n   * @return {IShape} 绘制的图形\n   */\n  draw: function draw(cfg, group) {\n    group['shapeMap'] = {};\n    this.mergeStyle = this.getOptions(cfg);\n    var shape = this.drawShape(cfg, group);\n    shape.set('className', this.itemType + CLS_SHAPE_SUFFIX);\n    group['shapeMap'][this.itemType + CLS_SHAPE_SUFFIX] = shape;\n\n    if (cfg.label) {\n      var label = this.drawLabel(cfg, group);\n      label.set('className', this.itemType + CLS_LABEL_SUFFIX);\n      group['shapeMap'][this.itemType + CLS_LABEL_SUFFIX] = label;\n    }\n\n    return shape;\n  },\n\n  /**\n   * 绘制完成后的操作，便于用户继承现有的节点、边\n   * @param cfg\n   * @param group\n   * @param keyShape\n   */\n  afterDraw: function afterDraw(cfg, group, keyShape) {},\n  drawShape: function drawShape(cfg, group) {\n    return null;\n  },\n  drawLabel: function drawLabel(cfg, group) {\n    var defaultLabelCfg = (this.mergeStyle || this.getOptions(cfg) || {}).labelCfg; // image的情况下有可能为null\n\n    var labelCfg = defaultLabelCfg || {};\n    var labelStyle = this.getLabelStyle(cfg, labelCfg, group);\n    var rotate = labelStyle.rotate;\n    delete labelStyle.rotate;\n    var label = group.addShape('text', {\n      attrs: labelStyle,\n      draggable: true,\n      className: 'text-shape',\n      name: 'text-shape',\n      labelRelated: true\n    });\n    group['shapeMap']['text-shape'] = label;\n\n    if (!isNaN(rotate) && rotate !== '') {\n      var labelBBox = label.getBBox();\n      var labelMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n      if (labelStyle.rotateCenter) {\n        switch (labelStyle.rotateCenter) {\n          case 'center':\n            labelMatrix = transform(labelMatrix, [['t', -labelBBox.width / 2, -labelBBox.height / 2], ['r', rotate], ['t', labelBBox.width / 2, labelBBox.height / 2]]);\n            break;\n\n          case 'lefttop':\n            labelMatrix = transform(labelMatrix, [['t', -labelStyle.x, -labelStyle.y], ['r', rotate], ['t', labelStyle.x, labelStyle.y]]);\n            break;\n\n          case 'leftcenter':\n            labelMatrix = transform(labelMatrix, [['t', -labelStyle.x, -labelStyle.y - labelBBox.height / 2], ['r', rotate], ['t', labelStyle.x, labelStyle.y + labelBBox.height / 2]]);\n            break;\n\n          default:\n            labelMatrix = transform(labelMatrix, [['t', -labelBBox.width / 2, -labelBBox.height / 2], ['r', rotate], ['t', labelBBox.width / 2, labelBBox.height / 2]]);\n            break;\n        }\n      } else {\n        labelMatrix = transform(labelMatrix, [['t', -labelStyle.x, -labelStyle.y - labelBBox.height / 2], ['r', rotate], ['t', labelStyle.x, labelStyle.y + labelBBox.height / 2]]);\n      }\n\n      label.setMatrix(labelMatrix);\n    }\n\n    if (labelStyle.background) {\n      var rect = this.drawLabelBg(cfg, group, label);\n      var labelBgClassname = this.itemType + CLS_LABEL_BG_SUFFIX;\n      rect.set('classname', labelBgClassname);\n      group['shapeMap'][labelBgClassname] = rect;\n      label.toFront();\n    }\n\n    return label;\n  },\n  drawLabelBg: function drawLabelBg(cfg, group, label) {\n    var defaultLabelCfg = this.options.labelCfg;\n    var labelCfg = mix({}, defaultLabelCfg, cfg.labelCfg);\n    var style = this.getLabelBgStyleByPosition(label, labelCfg);\n    var rect = group.addShape('rect', {\n      name: 'text-bg-shape',\n      attrs: style,\n      labelRelated: true\n    });\n    group['shapeMap']['text-bg-shape'] = rect;\n    return rect;\n  },\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg, group) {\n    return {\n      text: cfg.label\n    };\n  },\n  getLabelBgStyleByPosition: function getLabelBgStyleByPosition(label, labelCfg) {\n    return {};\n  },\n\n  /**\n   * 获取文本的配置项\n   * @param cfg 节点的配置项\n   * @param labelCfg 文本的配置项\n   * @param group 父容器，label 的定位可能与图形相关\n   */\n  getLabelStyle: function getLabelStyle(cfg, labelCfg, group) {\n    var calculateStyle = this.getLabelStyleByPosition(cfg, labelCfg, group);\n    var attrName = \"\".concat(this.itemType, \"Label\"); // 取 nodeLabel，edgeLabel 的配置项\n\n    var defaultStyle = Global[attrName] ? Global[attrName].style : null;\n    return __assign(__assign(__assign({}, defaultStyle), calculateStyle), labelCfg.style);\n  },\n\n  /**\n   * 获取图形的配置项\n   * @param cfg\n   */\n  getShapeStyle: function getShapeStyle(cfg) {\n    return cfg.style;\n  },\n\n  /**\n   * 更新节点，包含文本\n   * @override\n   * @param  {Object} cfg 节点/边的配置项\n   * @param  {G6.Item} item 节点/边\n   */\n  update: function update(cfg, item, updateType) {\n    this.updateShapeStyle(cfg, item, updateType);\n    this.updateLabel(cfg, item, updateType);\n  },\n  updateShapeStyle: function updateShapeStyle(cfg, item, updateType) {\n    var _a;\n\n    var group = item.getContainer();\n    var shape = item.getKeyShape();\n    var shapeStyle = mix({}, shape.attr(), cfg.style);\n\n    var _loop_1 = function _loop_1(key) {\n      var _b;\n\n      var style = shapeStyle[key];\n\n      if (isPlainObject(style)) {\n        // 更新图元素样式，支持更新子元素\n        var subShape = ((_a = group['shapeMap']) === null || _a === void 0 ? void 0 : _a[key]) || group.find(function (element) {\n          return element.get('name') === key;\n        });\n        subShape === null || subShape === void 0 ? void 0 : subShape.attr(style);\n      } else {\n        shape.attr((_b = {}, _b[key] = style, _b));\n      }\n    };\n\n    for (var key in shapeStyle) {\n      _loop_1(key);\n    }\n  },\n  updateLabel: function updateLabel(cfg, item, updateType) {\n    var _a, _b; // 防止 cfg.label = \"\" 的情况\n\n\n    if (cfg.label || cfg.label === '') {\n      var group = item.getContainer();\n      var _c = (this.mergeStyle || this.getOptions({}, updateType) || {}).labelCfg,\n          labelCfg = _c === void 0 ? {} : _c;\n      var labelClassName_1 = this.itemType + CLS_LABEL_SUFFIX;\n      var label = group['shapeMap'][labelClassName_1] || group.find(function (ele) {\n        return ele.get('className') === labelClassName_1;\n      });\n      var labelBgClassname_1 = this.itemType + CLS_LABEL_BG_SUFFIX;\n      var labelBg = group['shapeMap'][labelBgClassname_1] || group.find(function (ele) {\n        return ele.get('className') === labelBgClassname_1;\n      }); // 若传入的新配置中有 label，（用户没传入但原先有 label，label 也会有值）\n\n      if (!label) {\n        // 若原先不存在 label，则绘制一个新的 label\n        var newLabel = this.drawLabel(cfg, group);\n        newLabel.set('className', labelClassName_1);\n        group['shapeMap'][labelClassName_1] = newLabel;\n      } else {\n        // 若原先存在 label，则更新样式。与 getLabelStyle 不同在于这里需要融合当前 label 的样式\n        // 融合 style 以外的属性：position, offset, ...\n        if (!updateType || updateType === 'bbox|label' || this.itemType === 'edge' && updateType !== 'style') {\n          labelCfg = deepMix(labelCfg, cfg.labelCfg);\n        } // 获取位置信息\n\n\n        var calculateStyle = this.getLabelStyleByPosition(cfg, labelCfg, group); // 取 nodeLabel，edgeLabel 的配置项\n\n        var cfgStyle = (_a = cfg.labelCfg) === null || _a === void 0 ? void 0 : _a.style; // const cfgBgStyle = labelCfg.style?.background;\n        // 需要融合当前\b label 的样式 label.attr()。不再需要全局/默认样式，因为已经应用在当前的 label 上\n\n        var labelStyle = __assign(__assign({}, calculateStyle), cfgStyle);\n\n        var rotate = labelStyle.rotate;\n        delete labelStyle.rotate; // 计算 label 的旋转矩阵\n\n        if (!isNaN(rotate) && rotate !== '') {\n          // if G 4.x define the rotateAtStart, use it directly instead of using the following codes\n          var rotateMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n          rotateMatrix = transform(rotateMatrix, [['t', -labelStyle.x, -labelStyle.y], ['r', rotate], ['t', labelStyle.x, labelStyle.y]]);\n          labelStyle.matrix = rotateMatrix;\n          label.attr(labelStyle);\n        } else {\n          if (((_b = label.getMatrix()) === null || _b === void 0 ? void 0 : _b[4]) !== 1) {\n            label.resetMatrix();\n          }\n\n          label.attr(labelStyle);\n        }\n\n        if (!labelBg) {\n          if (labelStyle.background) {\n            labelBg = this.drawLabelBg(cfg, group, label);\n            labelBg.set('classname', labelBgClassname_1);\n            group['shapeMap'][labelBgClassname_1] = labelBg;\n            label.toFront();\n          }\n        } else if (labelStyle.background) {\n          var calculateBgStyle = this.getLabelBgStyleByPosition(label, labelCfg);\n          labelBg.attr(calculateBgStyle);\n        } else {\n          group.removeChild(labelBg);\n        }\n      }\n    }\n  },\n  // update(cfg, item) // 默认不定义\n  afterUpdate: function afterUpdate(cfg, item) {},\n\n  /**\n   * 设置节点的状态，主要是交互状态，业务状态请在 draw 方法中实现\n   * 单图形的节点仅考虑 selected、active 状态，有其他状态需求的用户自己复写这个方法\n   * @override\n   * @param  {String} name 状态名称\n   * @param  {String | Boolean} value 状态值\n   * @param  {G6.Item} item 节点\n   */\n  setState: function setState(name, value, item) {\n    var _a, _b;\n\n    var _c;\n\n    var shape = item.get('keyShape');\n    if (!shape || shape.destroyed) return;\n    var type = item.getType();\n    var stateName = isBoolean(value) ? name : \"\".concat(name, \":\").concat(value);\n    var shapeStateStyle = this.getStateStyle(stateName, item);\n    var itemStateStyle = item.getStateStyle(stateName); // const originStyle = item.getOriginStyle();\n    // 不允许设置一个不存在的状态\n\n    if (!itemStateStyle && !shapeStateStyle) {\n      return;\n    } // 要设置或取消的状态的样式\n    // 当没有 state 状态时，默认使用 model.stateStyles 中的样式\n\n\n    var styles = mix({}, itemStateStyle || shapeStateStyle);\n    var group = item.getContainer(); // 从图元素现有的样式中删除本次要取消的 states 中存在的属性值。使用对象检索更快\n\n    var keptAttrs = {\n      x: 1,\n      y: 1,\n      cx: 1,\n      cy: 1,\n      matrix: 1\n    };\n\n    if (type === 'combo') {\n      keptAttrs.r = 1;\n      keptAttrs.width = 1;\n      keptAttrs.height = 1;\n    }\n\n    if (value) {\n      var _loop_2 = function _loop_2(key) {\n        var _d;\n\n        var style = styles[key];\n\n        if (isPlainObject(style) && !ARROWS.includes(key)) {\n          var subShape = ((_c = group['shapeMap']) === null || _c === void 0 ? void 0 : _c[key]) || group.find(function (element) {\n            return element.get('name') === key;\n          });\n          subShape === null || subShape === void 0 ? void 0 : subShape.attr(style);\n        } else {\n          // 非纯对象，则认为是设置到 keyShape 上面的\n          shape.attr((_d = {}, _d[key] = style, _d));\n        }\n      }; // style 为要设置的状态的样式\n\n\n      for (var key in styles) {\n        _loop_2(key);\n      }\n    } else {\n      // 所有生效的 state 的样式\n      var enableStatesStyle = cloneBesidesImg(item.getCurrentStatesStyle());\n      var model = item.getModel(); // 原始样式\n\n      var originStyle_1 = mix({}, model.style, cloneBesidesImg(item.getOriginStyle()));\n      var keyShapeName_1 = shape.get('name'); // cloning  shape.attr(), keys.forEach to avoid cloning the img attr, which leads to maximum clone heap #2383\n      // const keyShapeStyles = clone(shape.attr())\n\n      var shapeAttrs_1 = shape.attr();\n      var keyShapeStyles_1 = {};\n      Object.keys(shapeAttrs_1).forEach(function (key) {\n        if (key === 'img') return;\n        var attr = shapeAttrs_1[key];\n\n        if (attr && _typeof(attr) === 'object') {\n          keyShapeStyles_1[key] = clone(attr);\n        } else {\n          keyShapeStyles_1[key] = attr;\n        }\n      }); // 已有样式 - 要取消的状态的样式\n\n      var filtetDisableStatesStyle = {};\n\n      var _loop_3 = function _loop_3(p) {\n        var style = styles[p];\n\n        if (isPlainObject(style) && !ARROWS.includes(p)) {\n          var subShape_1 = group['shapeMap'][p] || group.find(function (ele) {\n            return ele.get('name') === p;\n          });\n\n          if (subShape_1) {\n            var subShapeStyles_1 = cloneBesidesImg(subShape_1.attr());\n            each(style, function (v, key) {\n              if (p === keyShapeName_1 && keyShapeStyles_1[key] && !keptAttrs[key]) {\n                delete keyShapeStyles_1[key];\n                var value_1 = originStyle_1[p][key] || SHAPES_DEFAULT_ATTRS[type][key];\n                shape.attr(key, value_1);\n              } else if (subShapeStyles_1[key] || subShapeStyles_1[key] === 0) {\n                delete subShapeStyles_1[key];\n                var value_2 = originStyle_1[p][key] || SHAPES_DEFAULT_ATTRS[type][key];\n                subShape_1.attr(key, value_2);\n              }\n            });\n            filtetDisableStatesStyle[p] = subShapeStyles_1;\n          }\n        } else {\n          if (keyShapeStyles_1[p] && !keptAttrs[p]) {\n            delete keyShapeStyles_1[p];\n            var value_3 = originStyle_1[p] || (originStyle_1[keyShapeName_1] ? originStyle_1[keyShapeName_1][p] : undefined) || SHAPES_DEFAULT_ATTRS[type][p];\n            shape.attr(p, value_3);\n          }\n        }\n      }; // styles 为要取消的状态的样式\n\n\n      for (var p in styles) {\n        _loop_3(p);\n      } // 从图元素现有的样式中删除本次要取消的 states 中存在的属性值后，\n      // 如果 keyShape 有 name 属性，则 filtetDisableStatesStyle 的格式为 { keyShapeName: {} }\n      // 否则为普通对象\n\n\n      if (!keyShapeName_1) {\n        mix(filtetDisableStatesStyle, keyShapeStyles_1);\n      } else {\n        filtetDisableStatesStyle[keyShapeName_1] = keyShapeStyles_1;\n      }\n\n      for (var key in enableStatesStyle) {\n        if (keptAttrs[key]) continue;\n        var enableStyle = enableStatesStyle[key];\n\n        if (!isPlainObject(enableStyle) || ARROWS.includes(key)) {\n          // 把样式属性merge到keyShape中\n          if (!keyShapeName_1) {\n            mix(originStyle_1, (_a = {}, _a[key] = enableStyle, _a));\n          } else {\n            mix(originStyle_1[keyShapeName_1], (_b = {}, _b[key] = enableStyle, _b));\n            delete originStyle_1[key];\n          }\n\n          delete enableStatesStyle[key];\n        }\n      }\n\n      var originstyles = {};\n      deepMix(originstyles, originStyle_1, filtetDisableStatesStyle, enableStatesStyle);\n      var keyShapeSetted = false;\n\n      var _loop_4 = function _loop_4(originKey) {\n        var _e, _f;\n\n        var style = originstyles[originKey];\n\n        if (isPlainObject(style) && !ARROWS.includes(originKey)) {\n          var subShape = group['shapeMap'][originKey] || group.find(function (ele) {\n            return ele.get('name') === originKey;\n          });\n\n          if (subShape) {\n            // The text's position and matrix is not allowed to be affected by states\n            if (subShape.get('type') === 'text' || subShape.get('labelRelated')) {\n              delete style.x;\n              delete style.y;\n              delete style.matrix;\n            }\n\n            if (originKey === keyShapeName_1) {\n              if (type === 'combo') {\n                delete style.r;\n                delete style.width;\n                delete style.height;\n              }\n\n              keyShapeSetted = true;\n            }\n\n            subShape.attr(style);\n          }\n        } else if (!keyShapeSetted) {\n          var value_4 = style || SHAPES_DEFAULT_ATTRS[type][originKey]; // 当更新 combo 状态时，当不存在 keyShapeName 时候，则认为是设置到 keyShape 上面的\n\n          if (type === 'combo') {\n            if (!keyShapeName_1) {\n              shape.attr((_e = {}, _e[originKey] = value_4, _e));\n            }\n          } else {\n            shape.attr((_f = {}, _f[originKey] = value_4, _f));\n          }\n        }\n      };\n\n      for (var originKey in originstyles) {\n        _loop_4(originKey);\n      }\n    }\n  },\n\n  /**\n   * 获取不同状态下的样式\n   *\n   * @param {string} name 状态名称\n   * @param {Item} item Node或Edge的实例\n   * @return {object} 样式\n   */\n  getStateStyle: function getStateStyle(name, item) {\n    var model = item.getModel();\n    var type = item.getType();\n\n    var _a = this.getOptions(model),\n        stateStyles = _a.stateStyles,\n        _b = _a.style,\n        style = _b === void 0 ? {} : _b;\n\n    var modelStateStyle = model.stateStyles ? model.stateStyles[name] : stateStyles && stateStyles[name];\n\n    if (type === 'combo') {\n      return clone(modelStateStyle);\n    }\n\n    return mix({}, style, modelStateStyle);\n  },\n\n  /**\n   * 获取控制点\n   * @param  {Object} cfg 节点、边的配置项\n   * @return {Array|null} 控制点的数组,如果为 null，则没有控制点\n   */\n  getControlPoints: function getControlPoints(cfg) {\n    return cfg.controlPoints;\n  },\n\n  /**\n   * 获取控制点\n   * @param  {Object} cfg 节点、边的配置项\n   * @return {Array|null} 锚点的数组,如果为 null，则没有锚点\n   */\n  getAnchorPoints: function getAnchorPoints(cfg) {\n    var _a, _b;\n\n    var anchorPoints = (cfg === null || cfg === void 0 ? void 0 : cfg.anchorPoints) || ((_a = this.getCustomConfig(cfg)) === null || _a === void 0 ? void 0 : _a.anchorPoints) || ((_b = this.options) === null || _b === void 0 ? void 0 : _b.anchorPoints);\n    return anchorPoints;\n  }\n};","map":{"version":3,"names":["_typeof","obj","Symbol","iterator","constructor","prototype","__assign","Global","ext","deepMix","each","mix","isBoolean","isPlainObject","clone","cloneBesidesImg","transform","CLS_SHAPE_SUFFIX","CLS_LABEL_SUFFIX","ARROWS","SHAPE_DEFAULT_ATTRS","lineWidth","stroke","undefined","fill","lineAppendWidth","opacity","strokeOpacity","fillOpacity","x","y","r","width","height","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","PATH_SHAPE_DEFAULT_ATTRS","lineDash","startArrow","endArrow","SHAPES_DEFAULT_ATTRS","edge","node","combo","CLS_LABEL_BG_SUFFIX","shapeBase","options","labelCfg","style","fontFamily","windowFontFamily","descriptionCfg","itemType","type","getCustomConfig","cfg","getOptions","updateType","includes","draw","group","mergeStyle","shape","drawShape","set","label","drawLabel","afterDraw","keyShape","defaultLabelCfg","labelStyle","getLabelStyle","rotate","addShape","attrs","draggable","className","name","labelRelated","isNaN","labelBBox","getBBox","labelMatrix","rotateCenter","setMatrix","background","rect","drawLabelBg","labelBgClassname","toFront","getLabelBgStyleByPosition","getLabelStyleByPosition","text","calculateStyle","attrName","concat","defaultStyle","getShapeStyle","update","item","updateShapeStyle","updateLabel","_a","getContainer","getKeyShape","shapeStyle","attr","_loop_1","key","_b","subShape","find","element","get","_c","labelClassName_1","ele","labelBgClassname_1","labelBg","newLabel","cfgStyle","rotateMatrix","matrix","getMatrix","resetMatrix","calculateBgStyle","removeChild","afterUpdate","setState","value","destroyed","getType","stateName","shapeStateStyle","getStateStyle","itemStateStyle","styles","keptAttrs","cx","cy","_loop_2","_d","enableStatesStyle","getCurrentStatesStyle","model","getModel","originStyle_1","getOriginStyle","keyShapeName_1","shapeAttrs_1","keyShapeStyles_1","Object","keys","forEach","filtetDisableStatesStyle","_loop_3","p","subShape_1","subShapeStyles_1","v","value_1","value_2","value_3","enableStyle","originstyles","keyShapeSetted","_loop_4","originKey","_e","_f","value_4","stateStyles","modelStateStyle","getControlPoints","controlPoints","getAnchorPoints","anchorPoints"],"sources":["/Users/wawalike/Desktop/ggProject/node_modules/@antv/g6-core/es/element/shapeBase.js"],"sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nimport { __assign } from \"tslib\";\nimport Global from '../global';\nimport { ext } from '@antv/matrix-util';\nimport { deepMix, each, mix, isBoolean, isPlainObject, clone } from '@antv/util';\nimport { cloneBesidesImg } from '../util/graphic';\nvar transform = ext.transform;\nvar CLS_SHAPE_SUFFIX = '-shape';\nvar CLS_LABEL_SUFFIX = '-label';\nvar ARROWS = ['startArrow', 'endArrow'];\nvar SHAPE_DEFAULT_ATTRS = {\n  lineWidth: 1,\n  stroke: undefined,\n  fill: undefined,\n  lineAppendWidth: 1,\n  opacity: undefined,\n  strokeOpacity: undefined,\n  fillOpacity: undefined,\n  x: 0,\n  y: 0,\n  r: 10,\n  width: 20,\n  height: 20,\n  shadowColor: undefined,\n  shadowBlur: 0,\n  shadowOffsetX: 0,\n  shadowOffsetY: 0\n};\nvar PATH_SHAPE_DEFAULT_ATTRS = {\n  lineWidth: 1,\n  stroke: '#000',\n  lineDash: undefined,\n  startArrow: false,\n  endArrow: false,\n  opacity: undefined,\n  strokeOpacity: undefined,\n  fillOpacity: undefined,\n  shadowColor: undefined,\n  shadowBlur: 0,\n  shadowOffsetX: 0,\n  shadowOffsetY: 0\n};\nvar SHAPES_DEFAULT_ATTRS = {\n  edge: PATH_SHAPE_DEFAULT_ATTRS,\n  node: SHAPE_DEFAULT_ATTRS,\n  combo: SHAPE_DEFAULT_ATTRS\n};\nexport var CLS_LABEL_BG_SUFFIX = '-label-bg'; // 单个 shape 带有一个 label，共用这段代码\n\nexport var shapeBase = {\n  // 默认样式及配置\n  options: {\n    labelCfg: {\n      style: {\n        fontFamily: Global.windowFontFamily\n      }\n    },\n    descriptionCfg: {\n      style: {\n        fontFamily: Global.windowFontFamily\n      }\n    }\n  },\n  itemType: '',\n\n  /**\n   * 形状的类型，例如 circle，ellipse，polyline...\n   */\n  type: '',\n  getCustomConfig: function getCustomConfig(cfg) {\n    return {};\n  },\n  getOptions: function getOptions(cfg, updateType) {\n    if (updateType === 'move' || (updateType === null || updateType === void 0 ? void 0 : updateType.includes('bbox'))) {\n      return {};\n    }\n\n    return deepMix({}, this.options, this.getCustomConfig(cfg) || {}, cfg);\n  },\n\n  /**\n   * 绘制节点/边，包含文本\n   * @override\n   * @param  {Object} cfg 节点的配置项\n   * @param  {G.Group} group 节点的容器\n   * @return {IShape} 绘制的图形\n   */\n  draw: function draw(cfg, group) {\n    group['shapeMap'] = {};\n    this.mergeStyle = this.getOptions(cfg);\n    var shape = this.drawShape(cfg, group);\n    shape.set('className', this.itemType + CLS_SHAPE_SUFFIX);\n    group['shapeMap'][this.itemType + CLS_SHAPE_SUFFIX] = shape;\n\n    if (cfg.label) {\n      var label = this.drawLabel(cfg, group);\n      label.set('className', this.itemType + CLS_LABEL_SUFFIX);\n      group['shapeMap'][this.itemType + CLS_LABEL_SUFFIX] = label;\n    }\n\n    return shape;\n  },\n\n  /**\n   * 绘制完成后的操作，便于用户继承现有的节点、边\n   * @param cfg\n   * @param group\n   * @param keyShape\n   */\n  afterDraw: function afterDraw(cfg, group, keyShape) {},\n  drawShape: function drawShape(cfg, group) {\n    return null;\n  },\n  drawLabel: function drawLabel(cfg, group) {\n    var defaultLabelCfg = (this.mergeStyle || this.getOptions(cfg) || {}).labelCfg; // image的情况下有可能为null\n\n    var labelCfg = defaultLabelCfg || {};\n    var labelStyle = this.getLabelStyle(cfg, labelCfg, group);\n    var rotate = labelStyle.rotate;\n    delete labelStyle.rotate;\n    var label = group.addShape('text', {\n      attrs: labelStyle,\n      draggable: true,\n      className: 'text-shape',\n      name: 'text-shape',\n      labelRelated: true\n    });\n    group['shapeMap']['text-shape'] = label;\n\n    if (!isNaN(rotate) && rotate !== '') {\n      var labelBBox = label.getBBox();\n      var labelMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n      if (labelStyle.rotateCenter) {\n        switch (labelStyle.rotateCenter) {\n          case 'center':\n            labelMatrix = transform(labelMatrix, [['t', -labelBBox.width / 2, -labelBBox.height / 2], ['r', rotate], ['t', labelBBox.width / 2, labelBBox.height / 2]]);\n            break;\n\n          case 'lefttop':\n            labelMatrix = transform(labelMatrix, [['t', -labelStyle.x, -labelStyle.y], ['r', rotate], ['t', labelStyle.x, labelStyle.y]]);\n            break;\n\n          case 'leftcenter':\n            labelMatrix = transform(labelMatrix, [['t', -labelStyle.x, -labelStyle.y - labelBBox.height / 2], ['r', rotate], ['t', labelStyle.x, labelStyle.y + labelBBox.height / 2]]);\n            break;\n\n          default:\n            labelMatrix = transform(labelMatrix, [['t', -labelBBox.width / 2, -labelBBox.height / 2], ['r', rotate], ['t', labelBBox.width / 2, labelBBox.height / 2]]);\n            break;\n        }\n      } else {\n        labelMatrix = transform(labelMatrix, [['t', -labelStyle.x, -labelStyle.y - labelBBox.height / 2], ['r', rotate], ['t', labelStyle.x, labelStyle.y + labelBBox.height / 2]]);\n      }\n\n      label.setMatrix(labelMatrix);\n    }\n\n    if (labelStyle.background) {\n      var rect = this.drawLabelBg(cfg, group, label);\n      var labelBgClassname = this.itemType + CLS_LABEL_BG_SUFFIX;\n      rect.set('classname', labelBgClassname);\n      group['shapeMap'][labelBgClassname] = rect;\n      label.toFront();\n    }\n\n    return label;\n  },\n  drawLabelBg: function drawLabelBg(cfg, group, label) {\n    var defaultLabelCfg = this.options.labelCfg;\n    var labelCfg = mix({}, defaultLabelCfg, cfg.labelCfg);\n    var style = this.getLabelBgStyleByPosition(label, labelCfg);\n    var rect = group.addShape('rect', {\n      name: 'text-bg-shape',\n      attrs: style,\n      labelRelated: true\n    });\n    group['shapeMap']['text-bg-shape'] = rect;\n    return rect;\n  },\n  getLabelStyleByPosition: function getLabelStyleByPosition(cfg, labelCfg, group) {\n    return {\n      text: cfg.label\n    };\n  },\n  getLabelBgStyleByPosition: function getLabelBgStyleByPosition(label, labelCfg) {\n    return {};\n  },\n\n  /**\n   * 获取文本的配置项\n   * @param cfg 节点的配置项\n   * @param labelCfg 文本的配置项\n   * @param group 父容器，label 的定位可能与图形相关\n   */\n  getLabelStyle: function getLabelStyle(cfg, labelCfg, group) {\n    var calculateStyle = this.getLabelStyleByPosition(cfg, labelCfg, group);\n    var attrName = \"\".concat(this.itemType, \"Label\"); // 取 nodeLabel，edgeLabel 的配置项\n\n    var defaultStyle = Global[attrName] ? Global[attrName].style : null;\n    return __assign(__assign(__assign({}, defaultStyle), calculateStyle), labelCfg.style);\n  },\n\n  /**\n   * 获取图形的配置项\n   * @param cfg\n   */\n  getShapeStyle: function getShapeStyle(cfg) {\n    return cfg.style;\n  },\n\n  /**\n   * 更新节点，包含文本\n   * @override\n   * @param  {Object} cfg 节点/边的配置项\n   * @param  {G6.Item} item 节点/边\n   */\n  update: function update(cfg, item, updateType) {\n    this.updateShapeStyle(cfg, item, updateType);\n    this.updateLabel(cfg, item, updateType);\n  },\n  updateShapeStyle: function updateShapeStyle(cfg, item, updateType) {\n    var _a;\n\n    var group = item.getContainer();\n    var shape = item.getKeyShape();\n    var shapeStyle = mix({}, shape.attr(), cfg.style);\n\n    var _loop_1 = function _loop_1(key) {\n      var _b;\n\n      var style = shapeStyle[key];\n\n      if (isPlainObject(style)) {\n        // 更新图元素样式，支持更新子元素\n        var subShape = ((_a = group['shapeMap']) === null || _a === void 0 ? void 0 : _a[key]) || group.find(function (element) {\n          return element.get('name') === key;\n        });\n        subShape === null || subShape === void 0 ? void 0 : subShape.attr(style);\n      } else {\n        shape.attr((_b = {}, _b[key] = style, _b));\n      }\n    };\n\n    for (var key in shapeStyle) {\n      _loop_1(key);\n    }\n  },\n  updateLabel: function updateLabel(cfg, item, updateType) {\n    var _a, _b; // 防止 cfg.label = \"\" 的情况\n\n\n    if (cfg.label || cfg.label === '') {\n      var group = item.getContainer();\n      var _c = (this.mergeStyle || this.getOptions({}, updateType) || {}).labelCfg,\n          labelCfg = _c === void 0 ? {} : _c;\n      var labelClassName_1 = this.itemType + CLS_LABEL_SUFFIX;\n      var label = group['shapeMap'][labelClassName_1] || group.find(function (ele) {\n        return ele.get('className') === labelClassName_1;\n      });\n      var labelBgClassname_1 = this.itemType + CLS_LABEL_BG_SUFFIX;\n      var labelBg = group['shapeMap'][labelBgClassname_1] || group.find(function (ele) {\n        return ele.get('className') === labelBgClassname_1;\n      }); // 若传入的新配置中有 label，（用户没传入但原先有 label，label 也会有值）\n\n      if (!label) {\n        // 若原先不存在 label，则绘制一个新的 label\n        var newLabel = this.drawLabel(cfg, group);\n        newLabel.set('className', labelClassName_1);\n        group['shapeMap'][labelClassName_1] = newLabel;\n      } else {\n        // 若原先存在 label，则更新样式。与 getLabelStyle 不同在于这里需要融合当前 label 的样式\n        // 融合 style 以外的属性：position, offset, ...\n        if (!updateType || updateType === 'bbox|label' || this.itemType === 'edge' && updateType !== 'style') {\n          labelCfg = deepMix(labelCfg, cfg.labelCfg);\n        } // 获取位置信息\n\n\n        var calculateStyle = this.getLabelStyleByPosition(cfg, labelCfg, group); // 取 nodeLabel，edgeLabel 的配置项\n\n        var cfgStyle = (_a = cfg.labelCfg) === null || _a === void 0 ? void 0 : _a.style; // const cfgBgStyle = labelCfg.style?.background;\n        // 需要融合当前\b label 的样式 label.attr()。不再需要全局/默认样式，因为已经应用在当前的 label 上\n\n        var labelStyle = __assign(__assign({}, calculateStyle), cfgStyle);\n\n        var rotate = labelStyle.rotate;\n        delete labelStyle.rotate; // 计算 label 的旋转矩阵\n\n        if (!isNaN(rotate) && rotate !== '') {\n          // if G 4.x define the rotateAtStart, use it directly instead of using the following codes\n          var rotateMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n          rotateMatrix = transform(rotateMatrix, [['t', -labelStyle.x, -labelStyle.y], ['r', rotate], ['t', labelStyle.x, labelStyle.y]]);\n          labelStyle.matrix = rotateMatrix;\n          label.attr(labelStyle);\n        } else {\n          if (((_b = label.getMatrix()) === null || _b === void 0 ? void 0 : _b[4]) !== 1) {\n            label.resetMatrix();\n          }\n\n          label.attr(labelStyle);\n        }\n\n        if (!labelBg) {\n          if (labelStyle.background) {\n            labelBg = this.drawLabelBg(cfg, group, label);\n            labelBg.set('classname', labelBgClassname_1);\n            group['shapeMap'][labelBgClassname_1] = labelBg;\n            label.toFront();\n          }\n        } else if (labelStyle.background) {\n          var calculateBgStyle = this.getLabelBgStyleByPosition(label, labelCfg);\n          labelBg.attr(calculateBgStyle);\n        } else {\n          group.removeChild(labelBg);\n        }\n      }\n    }\n  },\n  // update(cfg, item) // 默认不定义\n  afterUpdate: function afterUpdate(cfg, item) {},\n\n  /**\n   * 设置节点的状态，主要是交互状态，业务状态请在 draw 方法中实现\n   * 单图形的节点仅考虑 selected、active 状态，有其他状态需求的用户自己复写这个方法\n   * @override\n   * @param  {String} name 状态名称\n   * @param  {String | Boolean} value 状态值\n   * @param  {G6.Item} item 节点\n   */\n  setState: function setState(name, value, item) {\n    var _a, _b;\n\n    var _c;\n\n    var shape = item.get('keyShape');\n    if (!shape || shape.destroyed) return;\n    var type = item.getType();\n    var stateName = isBoolean(value) ? name : \"\".concat(name, \":\").concat(value);\n    var shapeStateStyle = this.getStateStyle(stateName, item);\n    var itemStateStyle = item.getStateStyle(stateName); // const originStyle = item.getOriginStyle();\n    // 不允许设置一个不存在的状态\n\n    if (!itemStateStyle && !shapeStateStyle) {\n      return;\n    } // 要设置或取消的状态的样式\n    // 当没有 state 状态时，默认使用 model.stateStyles 中的样式\n\n\n    var styles = mix({}, itemStateStyle || shapeStateStyle);\n    var group = item.getContainer(); // 从图元素现有的样式中删除本次要取消的 states 中存在的属性值。使用对象检索更快\n\n    var keptAttrs = {\n      x: 1,\n      y: 1,\n      cx: 1,\n      cy: 1,\n      matrix: 1\n    };\n\n    if (type === 'combo') {\n      keptAttrs.r = 1;\n      keptAttrs.width = 1;\n      keptAttrs.height = 1;\n    }\n\n    if (value) {\n      var _loop_2 = function _loop_2(key) {\n        var _d;\n\n        var style = styles[key];\n\n        if (isPlainObject(style) && !ARROWS.includes(key)) {\n          var subShape = ((_c = group['shapeMap']) === null || _c === void 0 ? void 0 : _c[key]) || group.find(function (element) {\n            return element.get('name') === key;\n          });\n          subShape === null || subShape === void 0 ? void 0 : subShape.attr(style);\n        } else {\n          // 非纯对象，则认为是设置到 keyShape 上面的\n          shape.attr((_d = {}, _d[key] = style, _d));\n        }\n      }; // style 为要设置的状态的样式\n\n\n      for (var key in styles) {\n        _loop_2(key);\n      }\n    } else {\n      // 所有生效的 state 的样式\n      var enableStatesStyle = cloneBesidesImg(item.getCurrentStatesStyle());\n      var model = item.getModel(); // 原始样式\n\n      var originStyle_1 = mix({}, model.style, cloneBesidesImg(item.getOriginStyle()));\n      var keyShapeName_1 = shape.get('name'); // cloning  shape.attr(), keys.forEach to avoid cloning the img attr, which leads to maximum clone heap #2383\n      // const keyShapeStyles = clone(shape.attr())\n\n      var shapeAttrs_1 = shape.attr();\n      var keyShapeStyles_1 = {};\n      Object.keys(shapeAttrs_1).forEach(function (key) {\n        if (key === 'img') return;\n        var attr = shapeAttrs_1[key];\n\n        if (attr && _typeof(attr) === 'object') {\n          keyShapeStyles_1[key] = clone(attr);\n        } else {\n          keyShapeStyles_1[key] = attr;\n        }\n      }); // 已有样式 - 要取消的状态的样式\n\n      var filtetDisableStatesStyle = {};\n\n      var _loop_3 = function _loop_3(p) {\n        var style = styles[p];\n\n        if (isPlainObject(style) && !ARROWS.includes(p)) {\n          var subShape_1 = group['shapeMap'][p] || group.find(function (ele) {\n            return ele.get('name') === p;\n          });\n\n          if (subShape_1) {\n            var subShapeStyles_1 = cloneBesidesImg(subShape_1.attr());\n            each(style, function (v, key) {\n              if (p === keyShapeName_1 && keyShapeStyles_1[key] && !keptAttrs[key]) {\n                delete keyShapeStyles_1[key];\n                var value_1 = originStyle_1[p][key] || SHAPES_DEFAULT_ATTRS[type][key];\n                shape.attr(key, value_1);\n              } else if (subShapeStyles_1[key] || subShapeStyles_1[key] === 0) {\n                delete subShapeStyles_1[key];\n                var value_2 = originStyle_1[p][key] || SHAPES_DEFAULT_ATTRS[type][key];\n                subShape_1.attr(key, value_2);\n              }\n            });\n            filtetDisableStatesStyle[p] = subShapeStyles_1;\n          }\n        } else {\n          if (keyShapeStyles_1[p] && !keptAttrs[p]) {\n            delete keyShapeStyles_1[p];\n            var value_3 = originStyle_1[p] || (originStyle_1[keyShapeName_1] ? originStyle_1[keyShapeName_1][p] : undefined) || SHAPES_DEFAULT_ATTRS[type][p];\n            shape.attr(p, value_3);\n          }\n        }\n      }; // styles 为要取消的状态的样式\n\n\n      for (var p in styles) {\n        _loop_3(p);\n      } // 从图元素现有的样式中删除本次要取消的 states 中存在的属性值后，\n      // 如果 keyShape 有 name 属性，则 filtetDisableStatesStyle 的格式为 { keyShapeName: {} }\n      // 否则为普通对象\n\n\n      if (!keyShapeName_1) {\n        mix(filtetDisableStatesStyle, keyShapeStyles_1);\n      } else {\n        filtetDisableStatesStyle[keyShapeName_1] = keyShapeStyles_1;\n      }\n\n      for (var key in enableStatesStyle) {\n        if (keptAttrs[key]) continue;\n        var enableStyle = enableStatesStyle[key];\n\n        if (!isPlainObject(enableStyle) || ARROWS.includes(key)) {\n          // 把样式属性merge到keyShape中\n          if (!keyShapeName_1) {\n            mix(originStyle_1, (_a = {}, _a[key] = enableStyle, _a));\n          } else {\n            mix(originStyle_1[keyShapeName_1], (_b = {}, _b[key] = enableStyle, _b));\n            delete originStyle_1[key];\n          }\n\n          delete enableStatesStyle[key];\n        }\n      }\n\n      var originstyles = {};\n      deepMix(originstyles, originStyle_1, filtetDisableStatesStyle, enableStatesStyle);\n      var keyShapeSetted = false;\n\n      var _loop_4 = function _loop_4(originKey) {\n        var _e, _f;\n\n        var style = originstyles[originKey];\n\n        if (isPlainObject(style) && !ARROWS.includes(originKey)) {\n          var subShape = group['shapeMap'][originKey] || group.find(function (ele) {\n            return ele.get('name') === originKey;\n          });\n\n          if (subShape) {\n            // The text's position and matrix is not allowed to be affected by states\n            if (subShape.get('type') === 'text' || subShape.get('labelRelated')) {\n              delete style.x;\n              delete style.y;\n              delete style.matrix;\n            }\n\n            if (originKey === keyShapeName_1) {\n              if (type === 'combo') {\n                delete style.r;\n                delete style.width;\n                delete style.height;\n              }\n\n              keyShapeSetted = true;\n            }\n\n            subShape.attr(style);\n          }\n        } else if (!keyShapeSetted) {\n          var value_4 = style || SHAPES_DEFAULT_ATTRS[type][originKey]; // 当更新 combo 状态时，当不存在 keyShapeName 时候，则认为是设置到 keyShape 上面的\n\n          if (type === 'combo') {\n            if (!keyShapeName_1) {\n              shape.attr((_e = {}, _e[originKey] = value_4, _e));\n            }\n          } else {\n            shape.attr((_f = {}, _f[originKey] = value_4, _f));\n          }\n        }\n      };\n\n      for (var originKey in originstyles) {\n        _loop_4(originKey);\n      }\n    }\n  },\n\n  /**\n   * 获取不同状态下的样式\n   *\n   * @param {string} name 状态名称\n   * @param {Item} item Node或Edge的实例\n   * @return {object} 样式\n   */\n  getStateStyle: function getStateStyle(name, item) {\n    var model = item.getModel();\n    var type = item.getType();\n\n    var _a = this.getOptions(model),\n        stateStyles = _a.stateStyles,\n        _b = _a.style,\n        style = _b === void 0 ? {} : _b;\n\n    var modelStateStyle = model.stateStyles ? model.stateStyles[name] : stateStyles && stateStyles[name];\n\n    if (type === 'combo') {\n      return clone(modelStateStyle);\n    }\n\n    return mix({}, style, modelStateStyle);\n  },\n\n  /**\n   * 获取控制点\n   * @param  {Object} cfg 节点、边的配置项\n   * @return {Array|null} 控制点的数组,如果为 null，则没有控制点\n   */\n  getControlPoints: function getControlPoints(cfg) {\n    return cfg.controlPoints;\n  },\n\n  /**\n   * 获取控制点\n   * @param  {Object} cfg 节点、边的配置项\n   * @return {Array|null} 锚点的数组,如果为 null，则没有锚点\n   */\n  getAnchorPoints: function getAnchorPoints(cfg) {\n    var _a, _b;\n\n    var anchorPoints = (cfg === null || cfg === void 0 ? void 0 : cfg.anchorPoints) || ((_a = this.getCustomConfig(cfg)) === null || _a === void 0 ? void 0 : _a.anchorPoints) || ((_b = this.options) === null || _b === void 0 ? void 0 : _b.anchorPoints);\n    return anchorPoints;\n  }\n};"],"mappings":";;AAAA,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;EAAE;;EAA2B,OAAOD,OAAO,GAAG,cAAc,OAAOE,MAArB,IAA+B,YAAY,OAAOA,MAAM,CAACC,QAAzD,GAAoE,UAAUF,GAAV,EAAe;IAAE,OAAO,OAAOA,GAAd;EAAoB,CAAzG,GAA4G,UAAUA,GAAV,EAAe;IAAE,OAAOA,GAAG,IAAI,cAAc,OAAOC,MAA5B,IAAsCD,GAAG,CAACG,WAAJ,KAAoBF,MAA1D,IAAoED,GAAG,KAAKC,MAAM,CAACG,SAAnF,GAA+F,QAA/F,GAA0G,OAAOJ,GAAxH;EAA8H,CAArQ,EAAuQD,OAAO,CAACC,GAAD,CAArR;AAA6R;;AAEhV,SAASK,QAAT,QAAyB,OAAzB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,SAASC,GAAT,QAAoB,mBAApB;AACA,SAASC,OAAT,EAAkBC,IAAlB,EAAwBC,GAAxB,EAA6BC,SAA7B,EAAwCC,aAAxC,EAAuDC,KAAvD,QAAoE,YAApE;AACA,SAASC,eAAT,QAAgC,iBAAhC;AACA,IAAIC,SAAS,GAAGR,GAAG,CAACQ,SAApB;AACA,IAAIC,gBAAgB,GAAG,QAAvB;AACA,IAAIC,gBAAgB,GAAG,QAAvB;AACA,IAAIC,MAAM,GAAG,CAAC,YAAD,EAAe,UAAf,CAAb;AACA,IAAIC,mBAAmB,GAAG;EACxBC,SAAS,EAAE,CADa;EAExBC,MAAM,EAAEC,SAFgB;EAGxBC,IAAI,EAAED,SAHkB;EAIxBE,eAAe,EAAE,CAJO;EAKxBC,OAAO,EAAEH,SALe;EAMxBI,aAAa,EAAEJ,SANS;EAOxBK,WAAW,EAAEL,SAPW;EAQxBM,CAAC,EAAE,CARqB;EASxBC,CAAC,EAAE,CATqB;EAUxBC,CAAC,EAAE,EAVqB;EAWxBC,KAAK,EAAE,EAXiB;EAYxBC,MAAM,EAAE,EAZgB;EAaxBC,WAAW,EAAEX,SAbW;EAcxBY,UAAU,EAAE,CAdY;EAexBC,aAAa,EAAE,CAfS;EAgBxBC,aAAa,EAAE;AAhBS,CAA1B;AAkBA,IAAIC,wBAAwB,GAAG;EAC7BjB,SAAS,EAAE,CADkB;EAE7BC,MAAM,EAAE,MAFqB;EAG7BiB,QAAQ,EAAEhB,SAHmB;EAI7BiB,UAAU,EAAE,KAJiB;EAK7BC,QAAQ,EAAE,KALmB;EAM7Bf,OAAO,EAAEH,SANoB;EAO7BI,aAAa,EAAEJ,SAPc;EAQ7BK,WAAW,EAAEL,SARgB;EAS7BW,WAAW,EAAEX,SATgB;EAU7BY,UAAU,EAAE,CAViB;EAW7BC,aAAa,EAAE,CAXc;EAY7BC,aAAa,EAAE;AAZc,CAA/B;AAcA,IAAIK,oBAAoB,GAAG;EACzBC,IAAI,EAAEL,wBADmB;EAEzBM,IAAI,EAAExB,mBAFmB;EAGzByB,KAAK,EAAEzB;AAHkB,CAA3B;AAKA,OAAO,IAAI0B,mBAAmB,GAAG,WAA1B,C,CAAuC;;AAE9C,OAAO,IAAIC,SAAS,GAAG;EACrB;EACAC,OAAO,EAAE;IACPC,QAAQ,EAAE;MACRC,KAAK,EAAE;QACLC,UAAU,EAAE5C,MAAM,CAAC6C;MADd;IADC,CADH;IAMPC,cAAc,EAAE;MACdH,KAAK,EAAE;QACLC,UAAU,EAAE5C,MAAM,CAAC6C;MADd;IADO;EANT,CAFY;EAcrBE,QAAQ,EAAE,EAdW;;EAgBrB;AACF;AACA;EACEC,IAAI,EAAE,EAnBe;EAoBrBC,eAAe,EAAE,SAASA,eAAT,CAAyBC,GAAzB,EAA8B;IAC7C,OAAO,EAAP;EACD,CAtBoB;EAuBrBC,UAAU,EAAE,SAASA,UAAT,CAAoBD,GAApB,EAAyBE,UAAzB,EAAqC;IAC/C,IAAIA,UAAU,KAAK,MAAf,KAA0BA,UAAU,KAAK,IAAf,IAAuBA,UAAU,KAAK,KAAK,CAA3C,GAA+C,KAAK,CAApD,GAAwDA,UAAU,CAACC,QAAX,CAAoB,MAApB,CAAlF,CAAJ,EAAoH;MAClH,OAAO,EAAP;IACD;;IAED,OAAOnD,OAAO,CAAC,EAAD,EAAK,KAAKuC,OAAV,EAAmB,KAAKQ,eAAL,CAAqBC,GAArB,KAA6B,EAAhD,EAAoDA,GAApD,CAAd;EACD,CA7BoB;;EA+BrB;AACF;AACA;AACA;AACA;AACA;AACA;EACEI,IAAI,EAAE,SAASA,IAAT,CAAcJ,GAAd,EAAmBK,KAAnB,EAA0B;IAC9BA,KAAK,CAAC,UAAD,CAAL,GAAoB,EAApB;IACA,KAAKC,UAAL,GAAkB,KAAKL,UAAL,CAAgBD,GAAhB,CAAlB;IACA,IAAIO,KAAK,GAAG,KAAKC,SAAL,CAAeR,GAAf,EAAoBK,KAApB,CAAZ;IACAE,KAAK,CAACE,GAAN,CAAU,WAAV,EAAuB,KAAKZ,QAAL,GAAgBrC,gBAAvC;IACA6C,KAAK,CAAC,UAAD,CAAL,CAAkB,KAAKR,QAAL,GAAgBrC,gBAAlC,IAAsD+C,KAAtD;;IAEA,IAAIP,GAAG,CAACU,KAAR,EAAe;MACb,IAAIA,KAAK,GAAG,KAAKC,SAAL,CAAeX,GAAf,EAAoBK,KAApB,CAAZ;MACAK,KAAK,CAACD,GAAN,CAAU,WAAV,EAAuB,KAAKZ,QAAL,GAAgBpC,gBAAvC;MACA4C,KAAK,CAAC,UAAD,CAAL,CAAkB,KAAKR,QAAL,GAAgBpC,gBAAlC,IAAsDiD,KAAtD;IACD;;IAED,OAAOH,KAAP;EACD,CApDoB;;EAsDrB;AACF;AACA;AACA;AACA;AACA;EACEK,SAAS,EAAE,SAASA,SAAT,CAAmBZ,GAAnB,EAAwBK,KAAxB,EAA+BQ,QAA/B,EAAyC,CAAE,CA5DjC;EA6DrBL,SAAS,EAAE,SAASA,SAAT,CAAmBR,GAAnB,EAAwBK,KAAxB,EAA+B;IACxC,OAAO,IAAP;EACD,CA/DoB;EAgErBM,SAAS,EAAE,SAASA,SAAT,CAAmBX,GAAnB,EAAwBK,KAAxB,EAA+B;IACxC,IAAIS,eAAe,GAAG,CAAC,KAAKR,UAAL,IAAmB,KAAKL,UAAL,CAAgBD,GAAhB,CAAnB,IAA2C,EAA5C,EAAgDR,QAAtE,CADwC,CACwC;;IAEhF,IAAIA,QAAQ,GAAGsB,eAAe,IAAI,EAAlC;IACA,IAAIC,UAAU,GAAG,KAAKC,aAAL,CAAmBhB,GAAnB,EAAwBR,QAAxB,EAAkCa,KAAlC,CAAjB;IACA,IAAIY,MAAM,GAAGF,UAAU,CAACE,MAAxB;IACA,OAAOF,UAAU,CAACE,MAAlB;IACA,IAAIP,KAAK,GAAGL,KAAK,CAACa,QAAN,CAAe,MAAf,EAAuB;MACjCC,KAAK,EAAEJ,UAD0B;MAEjCK,SAAS,EAAE,IAFsB;MAGjCC,SAAS,EAAE,YAHsB;MAIjCC,IAAI,EAAE,YAJ2B;MAKjCC,YAAY,EAAE;IALmB,CAAvB,CAAZ;IAOAlB,KAAK,CAAC,UAAD,CAAL,CAAkB,YAAlB,IAAkCK,KAAlC;;IAEA,IAAI,CAACc,KAAK,CAACP,MAAD,CAAN,IAAkBA,MAAM,KAAK,EAAjC,EAAqC;MACnC,IAAIQ,SAAS,GAAGf,KAAK,CAACgB,OAAN,EAAhB;MACA,IAAIC,WAAW,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,CAAlB;;MAEA,IAAIZ,UAAU,CAACa,YAAf,EAA6B;QAC3B,QAAQb,UAAU,CAACa,YAAnB;UACE,KAAK,QAAL;YACED,WAAW,GAAGpE,SAAS,CAACoE,WAAD,EAAc,CAAC,CAAC,GAAD,EAAM,CAACF,SAAS,CAAClD,KAAX,GAAmB,CAAzB,EAA4B,CAACkD,SAAS,CAACjD,MAAX,GAAoB,CAAhD,CAAD,EAAqD,CAAC,GAAD,EAAMyC,MAAN,CAArD,EAAoE,CAAC,GAAD,EAAMQ,SAAS,CAAClD,KAAV,GAAkB,CAAxB,EAA2BkD,SAAS,CAACjD,MAAV,GAAmB,CAA9C,CAApE,CAAd,CAAvB;YACA;;UAEF,KAAK,SAAL;YACEmD,WAAW,GAAGpE,SAAS,CAACoE,WAAD,EAAc,CAAC,CAAC,GAAD,EAAM,CAACZ,UAAU,CAAC3C,CAAlB,EAAqB,CAAC2C,UAAU,CAAC1C,CAAjC,CAAD,EAAsC,CAAC,GAAD,EAAM4C,MAAN,CAAtC,EAAqD,CAAC,GAAD,EAAMF,UAAU,CAAC3C,CAAjB,EAAoB2C,UAAU,CAAC1C,CAA/B,CAArD,CAAd,CAAvB;YACA;;UAEF,KAAK,YAAL;YACEsD,WAAW,GAAGpE,SAAS,CAACoE,WAAD,EAAc,CAAC,CAAC,GAAD,EAAM,CAACZ,UAAU,CAAC3C,CAAlB,EAAqB,CAAC2C,UAAU,CAAC1C,CAAZ,GAAgBoD,SAAS,CAACjD,MAAV,GAAmB,CAAxD,CAAD,EAA6D,CAAC,GAAD,EAAMyC,MAAN,CAA7D,EAA4E,CAAC,GAAD,EAAMF,UAAU,CAAC3C,CAAjB,EAAoB2C,UAAU,CAAC1C,CAAX,GAAeoD,SAAS,CAACjD,MAAV,GAAmB,CAAtD,CAA5E,CAAd,CAAvB;YACA;;UAEF;YACEmD,WAAW,GAAGpE,SAAS,CAACoE,WAAD,EAAc,CAAC,CAAC,GAAD,EAAM,CAACF,SAAS,CAAClD,KAAX,GAAmB,CAAzB,EAA4B,CAACkD,SAAS,CAACjD,MAAX,GAAoB,CAAhD,CAAD,EAAqD,CAAC,GAAD,EAAMyC,MAAN,CAArD,EAAoE,CAAC,GAAD,EAAMQ,SAAS,CAAClD,KAAV,GAAkB,CAAxB,EAA2BkD,SAAS,CAACjD,MAAV,GAAmB,CAA9C,CAApE,CAAd,CAAvB;YACA;QAfJ;MAiBD,CAlBD,MAkBO;QACLmD,WAAW,GAAGpE,SAAS,CAACoE,WAAD,EAAc,CAAC,CAAC,GAAD,EAAM,CAACZ,UAAU,CAAC3C,CAAlB,EAAqB,CAAC2C,UAAU,CAAC1C,CAAZ,GAAgBoD,SAAS,CAACjD,MAAV,GAAmB,CAAxD,CAAD,EAA6D,CAAC,GAAD,EAAMyC,MAAN,CAA7D,EAA4E,CAAC,GAAD,EAAMF,UAAU,CAAC3C,CAAjB,EAAoB2C,UAAU,CAAC1C,CAAX,GAAeoD,SAAS,CAACjD,MAAV,GAAmB,CAAtD,CAA5E,CAAd,CAAvB;MACD;;MAEDkC,KAAK,CAACmB,SAAN,CAAgBF,WAAhB;IACD;;IAED,IAAIZ,UAAU,CAACe,UAAf,EAA2B;MACzB,IAAIC,IAAI,GAAG,KAAKC,WAAL,CAAiBhC,GAAjB,EAAsBK,KAAtB,EAA6BK,KAA7B,CAAX;MACA,IAAIuB,gBAAgB,GAAG,KAAKpC,QAAL,GAAgBR,mBAAvC;MACA0C,IAAI,CAACtB,GAAL,CAAS,WAAT,EAAsBwB,gBAAtB;MACA5B,KAAK,CAAC,UAAD,CAAL,CAAkB4B,gBAAlB,IAAsCF,IAAtC;MACArB,KAAK,CAACwB,OAAN;IACD;;IAED,OAAOxB,KAAP;EACD,CAtHoB;EAuHrBsB,WAAW,EAAE,SAASA,WAAT,CAAqBhC,GAArB,EAA0BK,KAA1B,EAAiCK,KAAjC,EAAwC;IACnD,IAAII,eAAe,GAAG,KAAKvB,OAAL,CAAaC,QAAnC;IACA,IAAIA,QAAQ,GAAGtC,GAAG,CAAC,EAAD,EAAK4D,eAAL,EAAsBd,GAAG,CAACR,QAA1B,CAAlB;IACA,IAAIC,KAAK,GAAG,KAAK0C,yBAAL,CAA+BzB,KAA/B,EAAsClB,QAAtC,CAAZ;IACA,IAAIuC,IAAI,GAAG1B,KAAK,CAACa,QAAN,CAAe,MAAf,EAAuB;MAChCI,IAAI,EAAE,eAD0B;MAEhCH,KAAK,EAAE1B,KAFyB;MAGhC8B,YAAY,EAAE;IAHkB,CAAvB,CAAX;IAKAlB,KAAK,CAAC,UAAD,CAAL,CAAkB,eAAlB,IAAqC0B,IAArC;IACA,OAAOA,IAAP;EACD,CAlIoB;EAmIrBK,uBAAuB,EAAE,SAASA,uBAAT,CAAiCpC,GAAjC,EAAsCR,QAAtC,EAAgDa,KAAhD,EAAuD;IAC9E,OAAO;MACLgC,IAAI,EAAErC,GAAG,CAACU;IADL,CAAP;EAGD,CAvIoB;EAwIrByB,yBAAyB,EAAE,SAASA,yBAAT,CAAmCzB,KAAnC,EAA0ClB,QAA1C,EAAoD;IAC7E,OAAO,EAAP;EACD,CA1IoB;;EA4IrB;AACF;AACA;AACA;AACA;AACA;EACEwB,aAAa,EAAE,SAASA,aAAT,CAAuBhB,GAAvB,EAA4BR,QAA5B,EAAsCa,KAAtC,EAA6C;IAC1D,IAAIiC,cAAc,GAAG,KAAKF,uBAAL,CAA6BpC,GAA7B,EAAkCR,QAAlC,EAA4Ca,KAA5C,CAArB;IACA,IAAIkC,QAAQ,GAAG,GAAGC,MAAH,CAAU,KAAK3C,QAAf,EAAyB,OAAzB,CAAf,CAF0D,CAER;;IAElD,IAAI4C,YAAY,GAAG3F,MAAM,CAACyF,QAAD,CAAN,GAAmBzF,MAAM,CAACyF,QAAD,CAAN,CAAiB9C,KAApC,GAA4C,IAA/D;IACA,OAAO5C,QAAQ,CAACA,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK4F,YAAL,CAAT,EAA6BH,cAA7B,CAAT,EAAuD9C,QAAQ,CAACC,KAAhE,CAAf;EACD,CAxJoB;;EA0JrB;AACF;AACA;AACA;EACEiD,aAAa,EAAE,SAASA,aAAT,CAAuB1C,GAAvB,EAA4B;IACzC,OAAOA,GAAG,CAACP,KAAX;EACD,CAhKoB;;EAkKrB;AACF;AACA;AACA;AACA;AACA;EACEkD,MAAM,EAAE,SAASA,MAAT,CAAgB3C,GAAhB,EAAqB4C,IAArB,EAA2B1C,UAA3B,EAAuC;IAC7C,KAAK2C,gBAAL,CAAsB7C,GAAtB,EAA2B4C,IAA3B,EAAiC1C,UAAjC;IACA,KAAK4C,WAAL,CAAiB9C,GAAjB,EAAsB4C,IAAtB,EAA4B1C,UAA5B;EACD,CA3KoB;EA4KrB2C,gBAAgB,EAAE,SAASA,gBAAT,CAA0B7C,GAA1B,EAA+B4C,IAA/B,EAAqC1C,UAArC,EAAiD;IACjE,IAAI6C,EAAJ;;IAEA,IAAI1C,KAAK,GAAGuC,IAAI,CAACI,YAAL,EAAZ;IACA,IAAIzC,KAAK,GAAGqC,IAAI,CAACK,WAAL,EAAZ;IACA,IAAIC,UAAU,GAAGhG,GAAG,CAAC,EAAD,EAAKqD,KAAK,CAAC4C,IAAN,EAAL,EAAmBnD,GAAG,CAACP,KAAvB,CAApB;;IAEA,IAAI2D,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;MAClC,IAAIC,EAAJ;;MAEA,IAAI7D,KAAK,GAAGyD,UAAU,CAACG,GAAD,CAAtB;;MAEA,IAAIjG,aAAa,CAACqC,KAAD,CAAjB,EAA0B;QACxB;QACA,IAAI8D,QAAQ,GAAG,CAAC,CAACR,EAAE,GAAG1C,KAAK,CAAC,UAAD,CAAX,MAA6B,IAA7B,IAAqC0C,EAAE,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,EAAE,CAACM,GAAD,CAAjE,KAA2EhD,KAAK,CAACmD,IAAN,CAAW,UAAUC,OAAV,EAAmB;UACtH,OAAOA,OAAO,CAACC,GAAR,CAAY,MAAZ,MAAwBL,GAA/B;QACD,CAFyF,CAA1F;QAGAE,QAAQ,KAAK,IAAb,IAAqBA,QAAQ,KAAK,KAAK,CAAvC,GAA2C,KAAK,CAAhD,GAAoDA,QAAQ,CAACJ,IAAT,CAAc1D,KAAd,CAApD;MACD,CAND,MAMO;QACLc,KAAK,CAAC4C,IAAN,EAAYG,EAAE,GAAG,EAAL,EAASA,EAAE,CAACD,GAAD,CAAF,GAAU5D,KAAnB,EAA0B6D,EAAtC;MACD;IACF,CAdD;;IAgBA,KAAK,IAAID,GAAT,IAAgBH,UAAhB,EAA4B;MAC1BE,OAAO,CAACC,GAAD,CAAP;IACD;EACF,CAtMoB;EAuMrBP,WAAW,EAAE,SAASA,WAAT,CAAqB9C,GAArB,EAA0B4C,IAA1B,EAAgC1C,UAAhC,EAA4C;IACvD,IAAI6C,EAAJ,EAAQO,EAAR,CADuD,CAC3C;;;IAGZ,IAAItD,GAAG,CAACU,KAAJ,IAAaV,GAAG,CAACU,KAAJ,KAAc,EAA/B,EAAmC;MACjC,IAAIL,KAAK,GAAGuC,IAAI,CAACI,YAAL,EAAZ;MACA,IAAIW,EAAE,GAAG,CAAC,KAAKrD,UAAL,IAAmB,KAAKL,UAAL,CAAgB,EAAhB,EAAoBC,UAApB,CAAnB,IAAsD,EAAvD,EAA2DV,QAApE;MAAA,IACIA,QAAQ,GAAGmE,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EADpC;MAEA,IAAIC,gBAAgB,GAAG,KAAK/D,QAAL,GAAgBpC,gBAAvC;MACA,IAAIiD,KAAK,GAAGL,KAAK,CAAC,UAAD,CAAL,CAAkBuD,gBAAlB,KAAuCvD,KAAK,CAACmD,IAAN,CAAW,UAAUK,GAAV,EAAe;QAC3E,OAAOA,GAAG,CAACH,GAAJ,CAAQ,WAAR,MAAyBE,gBAAhC;MACD,CAFkD,CAAnD;MAGA,IAAIE,kBAAkB,GAAG,KAAKjE,QAAL,GAAgBR,mBAAzC;MACA,IAAI0E,OAAO,GAAG1D,KAAK,CAAC,UAAD,CAAL,CAAkByD,kBAAlB,KAAyCzD,KAAK,CAACmD,IAAN,CAAW,UAAUK,GAAV,EAAe;QAC/E,OAAOA,GAAG,CAACH,GAAJ,CAAQ,WAAR,MAAyBI,kBAAhC;MACD,CAFsD,CAAvD,CATiC,CAW7B;;MAEJ,IAAI,CAACpD,KAAL,EAAY;QACV;QACA,IAAIsD,QAAQ,GAAG,KAAKrD,SAAL,CAAeX,GAAf,EAAoBK,KAApB,CAAf;QACA2D,QAAQ,CAACvD,GAAT,CAAa,WAAb,EAA0BmD,gBAA1B;QACAvD,KAAK,CAAC,UAAD,CAAL,CAAkBuD,gBAAlB,IAAsCI,QAAtC;MACD,CALD,MAKO;QACL;QACA;QACA,IAAI,CAAC9D,UAAD,IAAeA,UAAU,KAAK,YAA9B,IAA8C,KAAKL,QAAL,KAAkB,MAAlB,IAA4BK,UAAU,KAAK,OAA7F,EAAsG;UACpGV,QAAQ,GAAGxC,OAAO,CAACwC,QAAD,EAAWQ,GAAG,CAACR,QAAf,CAAlB;QACD,CALI,CAKH;;;QAGF,IAAI8C,cAAc,GAAG,KAAKF,uBAAL,CAA6BpC,GAA7B,EAAkCR,QAAlC,EAA4Ca,KAA5C,CAArB,CARK,CAQoE;;QAEzE,IAAI4D,QAAQ,GAAG,CAAClB,EAAE,GAAG/C,GAAG,CAACR,QAAV,MAAwB,IAAxB,IAAgCuD,EAAE,KAAK,KAAK,CAA5C,GAAgD,KAAK,CAArD,GAAyDA,EAAE,CAACtD,KAA3E,CAVK,CAU6E;QAClF;;QAEA,IAAIsB,UAAU,GAAGlE,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKyF,cAAL,CAAT,EAA+B2B,QAA/B,CAAzB;;QAEA,IAAIhD,MAAM,GAAGF,UAAU,CAACE,MAAxB;QACA,OAAOF,UAAU,CAACE,MAAlB,CAhBK,CAgBqB;;QAE1B,IAAI,CAACO,KAAK,CAACP,MAAD,CAAN,IAAkBA,MAAM,KAAK,EAAjC,EAAqC;UACnC;UACA,IAAIiD,YAAY,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,CAAnB;UACAA,YAAY,GAAG3G,SAAS,CAAC2G,YAAD,EAAe,CAAC,CAAC,GAAD,EAAM,CAACnD,UAAU,CAAC3C,CAAlB,EAAqB,CAAC2C,UAAU,CAAC1C,CAAjC,CAAD,EAAsC,CAAC,GAAD,EAAM4C,MAAN,CAAtC,EAAqD,CAAC,GAAD,EAAMF,UAAU,CAAC3C,CAAjB,EAAoB2C,UAAU,CAAC1C,CAA/B,CAArD,CAAf,CAAxB;UACA0C,UAAU,CAACoD,MAAX,GAAoBD,YAApB;UACAxD,KAAK,CAACyC,IAAN,CAAWpC,UAAX;QACD,CAND,MAMO;UACL,IAAI,CAAC,CAACuC,EAAE,GAAG5C,KAAK,CAAC0D,SAAN,EAAN,MAA6B,IAA7B,IAAqCd,EAAE,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,EAAE,CAAC,CAAD,CAAjE,MAA0E,CAA9E,EAAiF;YAC/E5C,KAAK,CAAC2D,WAAN;UACD;;UAED3D,KAAK,CAACyC,IAAN,CAAWpC,UAAX;QACD;;QAED,IAAI,CAACgD,OAAL,EAAc;UACZ,IAAIhD,UAAU,CAACe,UAAf,EAA2B;YACzBiC,OAAO,GAAG,KAAK/B,WAAL,CAAiBhC,GAAjB,EAAsBK,KAAtB,EAA6BK,KAA7B,CAAV;YACAqD,OAAO,CAACtD,GAAR,CAAY,WAAZ,EAAyBqD,kBAAzB;YACAzD,KAAK,CAAC,UAAD,CAAL,CAAkByD,kBAAlB,IAAwCC,OAAxC;YACArD,KAAK,CAACwB,OAAN;UACD;QACF,CAPD,MAOO,IAAInB,UAAU,CAACe,UAAf,EAA2B;UAChC,IAAIwC,gBAAgB,GAAG,KAAKnC,yBAAL,CAA+BzB,KAA/B,EAAsClB,QAAtC,CAAvB;UACAuE,OAAO,CAACZ,IAAR,CAAamB,gBAAb;QACD,CAHM,MAGA;UACLjE,KAAK,CAACkE,WAAN,CAAkBR,OAAlB;QACD;MACF;IACF;EACF,CA5QoB;EA6QrB;EACAS,WAAW,EAAE,SAASA,WAAT,CAAqBxE,GAArB,EAA0B4C,IAA1B,EAAgC,CAAE,CA9Q1B;;EAgRrB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE6B,QAAQ,EAAE,SAASA,QAAT,CAAkBnD,IAAlB,EAAwBoD,KAAxB,EAA+B9B,IAA/B,EAAqC;IAC7C,IAAIG,EAAJ,EAAQO,EAAR;;IAEA,IAAIK,EAAJ;;IAEA,IAAIpD,KAAK,GAAGqC,IAAI,CAACc,GAAL,CAAS,UAAT,CAAZ;IACA,IAAI,CAACnD,KAAD,IAAUA,KAAK,CAACoE,SAApB,EAA+B;IAC/B,IAAI7E,IAAI,GAAG8C,IAAI,CAACgC,OAAL,EAAX;IACA,IAAIC,SAAS,GAAG1H,SAAS,CAACuH,KAAD,CAAT,GAAmBpD,IAAnB,GAA0B,GAAGkB,MAAH,CAAUlB,IAAV,EAAgB,GAAhB,EAAqBkB,MAArB,CAA4BkC,KAA5B,CAA1C;IACA,IAAII,eAAe,GAAG,KAAKC,aAAL,CAAmBF,SAAnB,EAA8BjC,IAA9B,CAAtB;IACA,IAAIoC,cAAc,GAAGpC,IAAI,CAACmC,aAAL,CAAmBF,SAAnB,CAArB,CAV6C,CAUO;IACpD;;IAEA,IAAI,CAACG,cAAD,IAAmB,CAACF,eAAxB,EAAyC;MACvC;IACD,CAf4C,CAe3C;IACF;;;IAGA,IAAIG,MAAM,GAAG/H,GAAG,CAAC,EAAD,EAAK8H,cAAc,IAAIF,eAAvB,CAAhB;IACA,IAAIzE,KAAK,GAAGuC,IAAI,CAACI,YAAL,EAAZ,CApB6C,CAoBZ;;IAEjC,IAAIkC,SAAS,GAAG;MACd9G,CAAC,EAAE,CADW;MAEdC,CAAC,EAAE,CAFW;MAGd8G,EAAE,EAAE,CAHU;MAIdC,EAAE,EAAE,CAJU;MAKdjB,MAAM,EAAE;IALM,CAAhB;;IAQA,IAAIrE,IAAI,KAAK,OAAb,EAAsB;MACpBoF,SAAS,CAAC5G,CAAV,GAAc,CAAd;MACA4G,SAAS,CAAC3G,KAAV,GAAkB,CAAlB;MACA2G,SAAS,CAAC1G,MAAV,GAAmB,CAAnB;IACD;;IAED,IAAIkG,KAAJ,EAAW;MACT,IAAIW,OAAO,GAAG,SAASA,OAAT,CAAiBhC,GAAjB,EAAsB;QAClC,IAAIiC,EAAJ;;QAEA,IAAI7F,KAAK,GAAGwF,MAAM,CAAC5B,GAAD,CAAlB;;QAEA,IAAIjG,aAAa,CAACqC,KAAD,CAAb,IAAwB,CAAC/B,MAAM,CAACyC,QAAP,CAAgBkD,GAAhB,CAA7B,EAAmD;UACjD,IAAIE,QAAQ,GAAG,CAAC,CAACI,EAAE,GAAGtD,KAAK,CAAC,UAAD,CAAX,MAA6B,IAA7B,IAAqCsD,EAAE,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,EAAE,CAACN,GAAD,CAAjE,KAA2EhD,KAAK,CAACmD,IAAN,CAAW,UAAUC,OAAV,EAAmB;YACtH,OAAOA,OAAO,CAACC,GAAR,CAAY,MAAZ,MAAwBL,GAA/B;UACD,CAFyF,CAA1F;UAGAE,QAAQ,KAAK,IAAb,IAAqBA,QAAQ,KAAK,KAAK,CAAvC,GAA2C,KAAK,CAAhD,GAAoDA,QAAQ,CAACJ,IAAT,CAAc1D,KAAd,CAApD;QACD,CALD,MAKO;UACL;UACAc,KAAK,CAAC4C,IAAN,EAAYmC,EAAE,GAAG,EAAL,EAASA,EAAE,CAACjC,GAAD,CAAF,GAAU5D,KAAnB,EAA0B6F,EAAtC;QACD;MACF,CAdD,CADS,CAeN;;;MAGH,KAAK,IAAIjC,GAAT,IAAgB4B,MAAhB,EAAwB;QACtBI,OAAO,CAAChC,GAAD,CAAP;MACD;IACF,CArBD,MAqBO;MACL;MACA,IAAIkC,iBAAiB,GAAGjI,eAAe,CAACsF,IAAI,CAAC4C,qBAAL,EAAD,CAAvC;MACA,IAAIC,KAAK,GAAG7C,IAAI,CAAC8C,QAAL,EAAZ,CAHK,CAGwB;;MAE7B,IAAIC,aAAa,GAAGzI,GAAG,CAAC,EAAD,EAAKuI,KAAK,CAAChG,KAAX,EAAkBnC,eAAe,CAACsF,IAAI,CAACgD,cAAL,EAAD,CAAjC,CAAvB;MACA,IAAIC,cAAc,GAAGtF,KAAK,CAACmD,GAAN,CAAU,MAAV,CAArB,CANK,CAMmC;MACxC;;MAEA,IAAIoC,YAAY,GAAGvF,KAAK,CAAC4C,IAAN,EAAnB;MACA,IAAI4C,gBAAgB,GAAG,EAAvB;MACAC,MAAM,CAACC,IAAP,CAAYH,YAAZ,EAA0BI,OAA1B,CAAkC,UAAU7C,GAAV,EAAe;QAC/C,IAAIA,GAAG,KAAK,KAAZ,EAAmB;QACnB,IAAIF,IAAI,GAAG2C,YAAY,CAACzC,GAAD,CAAvB;;QAEA,IAAIF,IAAI,IAAI5G,OAAO,CAAC4G,IAAD,CAAP,KAAkB,QAA9B,EAAwC;UACtC4C,gBAAgB,CAAC1C,GAAD,CAAhB,GAAwBhG,KAAK,CAAC8F,IAAD,CAA7B;QACD,CAFD,MAEO;UACL4C,gBAAgB,CAAC1C,GAAD,CAAhB,GAAwBF,IAAxB;QACD;MACF,CATD,EAXK,CAoBD;;MAEJ,IAAIgD,wBAAwB,GAAG,EAA/B;;MAEA,IAAIC,OAAO,GAAG,SAASA,OAAT,CAAiBC,CAAjB,EAAoB;QAChC,IAAI5G,KAAK,GAAGwF,MAAM,CAACoB,CAAD,CAAlB;;QAEA,IAAIjJ,aAAa,CAACqC,KAAD,CAAb,IAAwB,CAAC/B,MAAM,CAACyC,QAAP,CAAgBkG,CAAhB,CAA7B,EAAiD;UAC/C,IAAIC,UAAU,GAAGjG,KAAK,CAAC,UAAD,CAAL,CAAkBgG,CAAlB,KAAwBhG,KAAK,CAACmD,IAAN,CAAW,UAAUK,GAAV,EAAe;YACjE,OAAOA,GAAG,CAACH,GAAJ,CAAQ,MAAR,MAAoB2C,CAA3B;UACD,CAFwC,CAAzC;;UAIA,IAAIC,UAAJ,EAAgB;YACd,IAAIC,gBAAgB,GAAGjJ,eAAe,CAACgJ,UAAU,CAACnD,IAAX,EAAD,CAAtC;YACAlG,IAAI,CAACwC,KAAD,EAAQ,UAAU+G,CAAV,EAAanD,GAAb,EAAkB;cAC5B,IAAIgD,CAAC,KAAKR,cAAN,IAAwBE,gBAAgB,CAAC1C,GAAD,CAAxC,IAAiD,CAAC6B,SAAS,CAAC7B,GAAD,CAA/D,EAAsE;gBACpE,OAAO0C,gBAAgB,CAAC1C,GAAD,CAAvB;gBACA,IAAIoD,OAAO,GAAGd,aAAa,CAACU,CAAD,CAAb,CAAiBhD,GAAjB,KAAyBpE,oBAAoB,CAACa,IAAD,CAApB,CAA2BuD,GAA3B,CAAvC;gBACA9C,KAAK,CAAC4C,IAAN,CAAWE,GAAX,EAAgBoD,OAAhB;cACD,CAJD,MAIO,IAAIF,gBAAgB,CAAClD,GAAD,CAAhB,IAAyBkD,gBAAgB,CAAClD,GAAD,CAAhB,KAA0B,CAAvD,EAA0D;gBAC/D,OAAOkD,gBAAgB,CAAClD,GAAD,CAAvB;gBACA,IAAIqD,OAAO,GAAGf,aAAa,CAACU,CAAD,CAAb,CAAiBhD,GAAjB,KAAyBpE,oBAAoB,CAACa,IAAD,CAApB,CAA2BuD,GAA3B,CAAvC;gBACAiD,UAAU,CAACnD,IAAX,CAAgBE,GAAhB,EAAqBqD,OAArB;cACD;YACF,CAVG,CAAJ;YAWAP,wBAAwB,CAACE,CAAD,CAAxB,GAA8BE,gBAA9B;UACD;QACF,CApBD,MAoBO;UACL,IAAIR,gBAAgB,CAACM,CAAD,CAAhB,IAAuB,CAACnB,SAAS,CAACmB,CAAD,CAArC,EAA0C;YACxC,OAAON,gBAAgB,CAACM,CAAD,CAAvB;YACA,IAAIM,OAAO,GAAGhB,aAAa,CAACU,CAAD,CAAb,KAAqBV,aAAa,CAACE,cAAD,CAAb,GAAgCF,aAAa,CAACE,cAAD,CAAb,CAA8BQ,CAA9B,CAAhC,GAAmEvI,SAAxF,KAAsGmB,oBAAoB,CAACa,IAAD,CAApB,CAA2BuG,CAA3B,CAApH;YACA9F,KAAK,CAAC4C,IAAN,CAAWkD,CAAX,EAAcM,OAAd;UACD;QACF;MACF,CA9BD,CAxBK,CAsDF;;;MAGH,KAAK,IAAIN,CAAT,IAAcpB,MAAd,EAAsB;QACpBmB,OAAO,CAACC,CAAD,CAAP;MACD,CA3DI,CA2DH;MACF;MACA;;;MAGA,IAAI,CAACR,cAAL,EAAqB;QACnB3I,GAAG,CAACiJ,wBAAD,EAA2BJ,gBAA3B,CAAH;MACD,CAFD,MAEO;QACLI,wBAAwB,CAACN,cAAD,CAAxB,GAA2CE,gBAA3C;MACD;;MAED,KAAK,IAAI1C,GAAT,IAAgBkC,iBAAhB,EAAmC;QACjC,IAAIL,SAAS,CAAC7B,GAAD,CAAb,EAAoB;QACpB,IAAIuD,WAAW,GAAGrB,iBAAiB,CAAClC,GAAD,CAAnC;;QAEA,IAAI,CAACjG,aAAa,CAACwJ,WAAD,CAAd,IAA+BlJ,MAAM,CAACyC,QAAP,CAAgBkD,GAAhB,CAAnC,EAAyD;UACvD;UACA,IAAI,CAACwC,cAAL,EAAqB;YACnB3I,GAAG,CAACyI,aAAD,GAAiB5C,EAAE,GAAG,EAAL,EAASA,EAAE,CAACM,GAAD,CAAF,GAAUuD,WAAnB,EAAgC7D,EAAjD,EAAH;UACD,CAFD,MAEO;YACL7F,GAAG,CAACyI,aAAa,CAACE,cAAD,CAAd,GAAiCvC,EAAE,GAAG,EAAL,EAASA,EAAE,CAACD,GAAD,CAAF,GAAUuD,WAAnB,EAAgCtD,EAAjE,EAAH;YACA,OAAOqC,aAAa,CAACtC,GAAD,CAApB;UACD;;UAED,OAAOkC,iBAAiB,CAAClC,GAAD,CAAxB;QACD;MACF;;MAED,IAAIwD,YAAY,GAAG,EAAnB;MACA7J,OAAO,CAAC6J,YAAD,EAAelB,aAAf,EAA8BQ,wBAA9B,EAAwDZ,iBAAxD,CAAP;MACA,IAAIuB,cAAc,GAAG,KAArB;;MAEA,IAAIC,OAAO,GAAG,SAASA,OAAT,CAAiBC,SAAjB,EAA4B;QACxC,IAAIC,EAAJ,EAAQC,EAAR;;QAEA,IAAIzH,KAAK,GAAGoH,YAAY,CAACG,SAAD,CAAxB;;QAEA,IAAI5J,aAAa,CAACqC,KAAD,CAAb,IAAwB,CAAC/B,MAAM,CAACyC,QAAP,CAAgB6G,SAAhB,CAA7B,EAAyD;UACvD,IAAIzD,QAAQ,GAAGlD,KAAK,CAAC,UAAD,CAAL,CAAkB2G,SAAlB,KAAgC3G,KAAK,CAACmD,IAAN,CAAW,UAAUK,GAAV,EAAe;YACvE,OAAOA,GAAG,CAACH,GAAJ,CAAQ,MAAR,MAAoBsD,SAA3B;UACD,CAF8C,CAA/C;;UAIA,IAAIzD,QAAJ,EAAc;YACZ;YACA,IAAIA,QAAQ,CAACG,GAAT,CAAa,MAAb,MAAyB,MAAzB,IAAmCH,QAAQ,CAACG,GAAT,CAAa,cAAb,CAAvC,EAAqE;cACnE,OAAOjE,KAAK,CAACrB,CAAb;cACA,OAAOqB,KAAK,CAACpB,CAAb;cACA,OAAOoB,KAAK,CAAC0E,MAAb;YACD;;YAED,IAAI6C,SAAS,KAAKnB,cAAlB,EAAkC;cAChC,IAAI/F,IAAI,KAAK,OAAb,EAAsB;gBACpB,OAAOL,KAAK,CAACnB,CAAb;gBACA,OAAOmB,KAAK,CAAClB,KAAb;gBACA,OAAOkB,KAAK,CAACjB,MAAb;cACD;;cAEDsI,cAAc,GAAG,IAAjB;YACD;;YAEDvD,QAAQ,CAACJ,IAAT,CAAc1D,KAAd;UACD;QACF,CAzBD,MAyBO,IAAI,CAACqH,cAAL,EAAqB;UAC1B,IAAIK,OAAO,GAAG1H,KAAK,IAAIR,oBAAoB,CAACa,IAAD,CAApB,CAA2BkH,SAA3B,CAAvB,CAD0B,CACoC;;UAE9D,IAAIlH,IAAI,KAAK,OAAb,EAAsB;YACpB,IAAI,CAAC+F,cAAL,EAAqB;cACnBtF,KAAK,CAAC4C,IAAN,EAAY8D,EAAE,GAAG,EAAL,EAASA,EAAE,CAACD,SAAD,CAAF,GAAgBG,OAAzB,EAAkCF,EAA9C;YACD;UACF,CAJD,MAIO;YACL1G,KAAK,CAAC4C,IAAN,EAAY+D,EAAE,GAAG,EAAL,EAASA,EAAE,CAACF,SAAD,CAAF,GAAgBG,OAAzB,EAAkCD,EAA9C;UACD;QACF;MACF,CAzCD;;MA2CA,KAAK,IAAIF,SAAT,IAAsBH,YAAtB,EAAoC;QAClCE,OAAO,CAACC,SAAD,CAAP;MACD;IACF;EACF,CA3doB;;EA6drB;AACF;AACA;AACA;AACA;AACA;AACA;EACEjC,aAAa,EAAE,SAASA,aAAT,CAAuBzD,IAAvB,EAA6BsB,IAA7B,EAAmC;IAChD,IAAI6C,KAAK,GAAG7C,IAAI,CAAC8C,QAAL,EAAZ;IACA,IAAI5F,IAAI,GAAG8C,IAAI,CAACgC,OAAL,EAAX;;IAEA,IAAI7B,EAAE,GAAG,KAAK9C,UAAL,CAAgBwF,KAAhB,CAAT;IAAA,IACI2B,WAAW,GAAGrE,EAAE,CAACqE,WADrB;IAAA,IAEI9D,EAAE,GAAGP,EAAE,CAACtD,KAFZ;IAAA,IAGIA,KAAK,GAAG6D,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EAHjC;;IAKA,IAAI+D,eAAe,GAAG5B,KAAK,CAAC2B,WAAN,GAAoB3B,KAAK,CAAC2B,WAAN,CAAkB9F,IAAlB,CAApB,GAA8C8F,WAAW,IAAIA,WAAW,CAAC9F,IAAD,CAA9F;;IAEA,IAAIxB,IAAI,KAAK,OAAb,EAAsB;MACpB,OAAOzC,KAAK,CAACgK,eAAD,CAAZ;IACD;;IAED,OAAOnK,GAAG,CAAC,EAAD,EAAKuC,KAAL,EAAY4H,eAAZ,CAAV;EACD,CApfoB;;EAsfrB;AACF;AACA;AACA;AACA;EACEC,gBAAgB,EAAE,SAASA,gBAAT,CAA0BtH,GAA1B,EAA+B;IAC/C,OAAOA,GAAG,CAACuH,aAAX;EACD,CA7foB;;EA+frB;AACF;AACA;AACA;AACA;EACEC,eAAe,EAAE,SAASA,eAAT,CAAyBxH,GAAzB,EAA8B;IAC7C,IAAI+C,EAAJ,EAAQO,EAAR;;IAEA,IAAImE,YAAY,GAAG,CAACzH,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,KAAK,CAA7B,GAAiC,KAAK,CAAtC,GAA0CA,GAAG,CAACyH,YAA/C,MAAiE,CAAC1E,EAAE,GAAG,KAAKhD,eAAL,CAAqBC,GAArB,CAAN,MAAqC,IAArC,IAA6C+C,EAAE,KAAK,KAAK,CAAzD,GAA6D,KAAK,CAAlE,GAAsEA,EAAE,CAAC0E,YAA1I,MAA4J,CAACnE,EAAE,GAAG,KAAK/D,OAAX,MAAwB,IAAxB,IAAgC+D,EAAE,KAAK,KAAK,CAA5C,GAAgD,KAAK,CAArD,GAAyDA,EAAE,CAACmE,YAAxN,CAAnB;IACA,OAAOA,YAAP;EACD;AAzgBoB,CAAhB"},"metadata":{},"sourceType":"module"}