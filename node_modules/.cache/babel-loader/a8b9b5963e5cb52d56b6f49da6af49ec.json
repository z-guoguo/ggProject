{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n/**\n * @fileOverview 从xml建立自定义Node，包含update\n * @author xuzhi.mxz@antfin.com\n */\n\n\nimport { __assign, __rest } from \"tslib\";\nimport { get } from '@antv/util';\nimport { getTextSize } from '../util/graphic';\n/**\n * 一种更宽松的JSON 解析，如果遇到不符合规范的字段会直接转为字符串\n * @param text json 内容\n */\n\nfunction looseJSONParse(text) {\n  if (typeof text !== 'string') {\n    return text;\n  }\n\n  var safeParse = function safeParse(str) {\n    if (typeof str !== 'string') {\n      return str;\n    }\n\n    try {\n      return JSON.parse(str.trim());\n    } catch (e) {\n      return str.trim();\n    }\n  };\n\n  var firstAttempt = safeParse(text);\n\n  if (typeof firstAttempt !== 'string') {\n    return firstAttempt;\n  }\n\n  var tail = function tail(arr) {\n    return arr[arr.length - 1];\n  };\n\n  var str = text.trim();\n  var objectStack = [];\n  var syntaxStack = [];\n\n  var isLastPair = function isLastPair() {\n    var syntaxes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      syntaxes[_i] = arguments[_i];\n    }\n\n    return syntaxes.some(function (syntax) {\n      return tail(syntaxStack) === syntax;\n    });\n  };\n\n  var getValueStore = function getValueStore() {\n    return tail(objectStack);\n  };\n\n  var rst = null;\n  var i = 0;\n  var temp = '';\n\n  while (i < str.length) {\n    var nowChar = str[i];\n    var isInString = isLastPair('\"', \"'\");\n\n    if (!isInString && !nowChar.trim()) {\n      i += 1;\n      continue;\n    }\n\n    var isLastTranslate = str[i - 1] === '\\\\';\n    var isInObject = isLastPair('}');\n    var isInArray = isLastPair(']');\n    var isWaitingValue = isLastPair(',');\n    var tempArr = getValueStore();\n\n    if (isInString) {\n      if (tail(syntaxStack) === nowChar && !isLastTranslate) {\n        syntaxStack.pop();\n        var value = safeParse(temp);\n        tempArr.push(value);\n        rst = value;\n        temp = '';\n      } else {\n        temp += nowChar;\n      }\n    } else if (isInArray && nowChar === ',') {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n    } else if (isInObject && nowChar === ':') {\n      syntaxStack.push(',');\n\n      if (temp) {\n        tempArr.push(temp);\n        temp = '';\n      }\n    } else if (isWaitingValue && nowChar === ',') {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n\n      syntaxStack.pop();\n    } else if (nowChar === '}' && (isInObject || isWaitingValue)) {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n\n      if (isWaitingValue) {\n        syntaxStack.pop();\n      }\n\n      var obj = {};\n\n      for (var c = 1; c < tempArr.length; c += 2) {\n        obj[tempArr[c - 1]] = tempArr[c];\n      }\n\n      objectStack.pop();\n\n      if (objectStack.length) {\n        tail(objectStack).push(obj);\n      }\n\n      syntaxStack.pop();\n      rst = obj;\n    } else if (nowChar === ']' && isInArray) {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n\n      objectStack.pop();\n\n      if (objectStack.length) {\n        tail(objectStack).push(tempArr);\n      }\n\n      syntaxStack.pop();\n      rst = tempArr;\n    } else if (nowChar === '{') {\n      objectStack.push([]);\n      syntaxStack.push('}');\n    } else if (nowChar === '[') {\n      objectStack.push([]);\n      syntaxStack.push(']');\n    } else if (nowChar === '\"') {\n      syntaxStack.push('\"');\n    } else if (nowChar === \"'\") {\n      syntaxStack.push(\"'\");\n    } else {\n      temp += nowChar;\n    }\n\n    i += 1;\n  }\n\n  return rst || temp;\n}\n\nvar keyConvert = function keyConvert(str) {\n  return str.split('-').reduce(function (a, b) {\n    return a + b.charAt(0).toUpperCase() + b.slice(1);\n  });\n};\n/**\n * 简单的一个{{}}模板渲染，不包含任何复杂语法\n * @param xml\n */\n\n\nexport var xmlDataRenderer = function xmlDataRenderer(xml) {\n  return function (data) {\n    var len = xml.length;\n    var arr = [];\n    var i = 0;\n    var tmp = '';\n\n    while (i < len) {\n      if (xml[i] === '{' && xml[i + 1] === '{') {\n        arr.push(tmp);\n        tmp = '';\n        i += 2;\n      } else if (xml[i] === '}' && xml[i + 1] === '}') {\n        if (arr.length) {\n          var last = arr.pop();\n          tmp = get(data, tmp, last.endsWith('=') ? \"\\\"{\".concat(tmp, \"}\\\"\") : tmp);\n          arr.push(last + tmp);\n        }\n\n        i += 2;\n        tmp = '';\n      } else {\n        tmp += xml[i];\n        i += 1;\n      }\n    }\n\n    arr.push(tmp);\n    return arr.map(function (e, index) {\n      return arr[index - 1] && arr[index - 1].endsWith('=') ? \"\\\"{\".concat(e, \"}\\\"\") : e;\n    }).join('');\n  };\n};\n/**\n * 解析XML，并转化为相应的JSON结构\n * @param xml xml解析后的节点\n */\n\nexport function parseXML(xml, cfg) {\n  var attrs = {};\n  var keys = xml.getAttributeNames && xml.getAttributeNames() || [];\n  var children = xml.children && Array.from(xml.children).map(function (e) {\n    return parseXML(e, cfg);\n  });\n  var rst = {};\n  var tagName = xml.tagName ? xml.tagName.toLowerCase() : 'group';\n\n  if (tagName === 'text') {\n    attrs.text = xml.innerText;\n  }\n\n  rst.type = tagName;\n\n  if (tagName === 'img') {\n    rst.type = 'image';\n  }\n\n  Array.from(keys).forEach(function (k) {\n    var key = keyConvert(k);\n    var val = xml.getAttribute(k);\n\n    try {\n      if (key === 'style' || key === 'attrs') {\n        var style = looseJSONParse(val);\n        attrs = __assign(__assign({}, attrs), style);\n      } else {\n        rst[key] = looseJSONParse(val);\n      }\n    } catch (e) {\n      if (key === 'style') {\n        throw e;\n      }\n\n      rst[key] = val;\n    }\n  });\n  rst.attrs = attrs;\n\n  if (cfg && cfg.style && rst.name && _typeof(cfg.style[rst.name]) === 'object') {\n    rst.attrs = __assign(__assign({}, rst.attrs), cfg.style[rst.name]);\n  }\n\n  if (cfg && cfg.style && rst.keyshape) {\n    rst.attrs = __assign(__assign({}, rst.attrs), cfg.style);\n  }\n\n  if (children.length) {\n    rst.children = children;\n  }\n\n  return rst;\n}\n/**\n * 根据偏移量和内部节点最终的bounding box来得出该shape最终的bbox\n */\n\nexport function getBBox(node, offset, chilrenBBox) {\n  var _a = node.attrs,\n      attrs = _a === void 0 ? {} : _a;\n  var bbox = {\n    x: offset.x || 0,\n    y: offset.y || 0,\n    width: chilrenBBox.width || 0,\n    height: chilrenBBox.height || 0\n  };\n  var shapeHeight, shapeWidth;\n\n  switch (node.type) {\n    case 'maker':\n    case 'circle':\n      if (attrs.r) {\n        shapeWidth = 2 * attrs.r;\n        shapeHeight = 2 * attrs.r;\n      }\n\n      break;\n\n    case 'text':\n      if (attrs.text) {\n        shapeWidth = getTextSize(attrs.text, attrs.fontSize || 12)[0];\n        shapeHeight = 16;\n        bbox.y += shapeHeight;\n        bbox.height = shapeHeight;\n        bbox.width = shapeWidth;\n        node.attrs = __assign({\n          fontSize: 12,\n          fill: '#000'\n        }, attrs);\n      }\n\n      break;\n\n    default:\n      if (attrs.width) {\n        shapeWidth = attrs.width;\n      }\n\n      if (attrs.height) {\n        shapeHeight = attrs.height;\n      }\n\n  }\n\n  if (shapeHeight >= 0) {\n    bbox.height = shapeHeight;\n  }\n\n  if (shapeWidth >= 0) {\n    bbox.width = shapeWidth;\n  }\n\n  if (attrs.marginTop) {\n    bbox.y += attrs.marginTop;\n  }\n\n  if (attrs.marginLeft) {\n    bbox.x += attrs.marginLeft;\n  }\n\n  return bbox;\n}\n/**\n * 把从xml计算出的结构填上位置信息，补全attrs\n * @param target\n * @param lastOffset\n */\n\nexport function generateTarget(target, lastOffset) {\n  var _a;\n\n  if (lastOffset === void 0) {\n    lastOffset = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  var defaultBbox = __assign({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0\n  }, lastOffset);\n\n  if ((_a = target.children) === null || _a === void 0 ? void 0 : _a.length) {\n    var _b = target.attrs,\n        attrs = _b === void 0 ? {} : _b;\n    var marginTop = attrs.marginTop;\n\n    var offset = __assign({}, lastOffset);\n\n    if (marginTop) {\n      offset.y += marginTop;\n    }\n\n    for (var index = 0; index < target.children.length; index++) {\n      target.children[index].attrs.key = \"\".concat(attrs.key || 'root', \" -\").concat(index, \" \");\n      var node = generateTarget(target.children[index], offset);\n\n      if (node.bbox) {\n        var bbox = node.bbox;\n\n        if (node.attrs.next === 'inline') {\n          offset.x += node.bbox.width;\n        } else {\n          offset.y += node.bbox.height;\n        }\n\n        if (bbox.width + bbox.x > defaultBbox.width) {\n          defaultBbox.width = bbox.width + bbox.x;\n        }\n\n        if (bbox.height + bbox.y > defaultBbox.height) {\n          defaultBbox.height = bbox.height + bbox.y;\n        }\n      }\n    }\n  }\n\n  target.bbox = getBBox(target, lastOffset, defaultBbox);\n  target.attrs = __assign(__assign({}, target.attrs), target.bbox);\n  return target;\n}\n/**\n * 对比前后两个最终计算出来的node，并对比出最小改动,\n * 动作： 'add' 添加节点 ｜ ’delete‘ 删除节点 ｜ ’change‘ 改变节点attrs ｜ 'restructure' 重构节点\n * @param nowTarget\n * @param formerTarget\n */\n\nexport function compareTwoTarget(nowTarget, formerTarget) {\n  var _a, _b, _c, _d;\n\n  var type = (nowTarget || {}).type;\n  var key = ((formerTarget === null || formerTarget === void 0 ? void 0 : formerTarget.attrs) || {}).key;\n\n  if (key && nowTarget) {\n    nowTarget.attrs.key = key;\n  }\n\n  if (!nowTarget && formerTarget) {\n    return {\n      action: 'delete',\n      val: formerTarget,\n      type: type,\n      key: key\n    };\n  }\n\n  if (nowTarget && !formerTarget) {\n    return {\n      action: 'add',\n      val: nowTarget,\n      type: type\n    };\n  }\n\n  if (!nowTarget && !formerTarget) {\n    return {\n      action: 'same',\n      type: type\n    };\n  }\n\n  var children = [];\n\n  if (((_a = nowTarget.children) === null || _a === void 0 ? void 0 : _a.length) > 0 || ((_b = formerTarget.children) === null || _b === void 0 ? void 0 : _b.length) > 0) {\n    var length_1 = Math.max((_c = nowTarget.children) === null || _c === void 0 ? void 0 : _c.length, (_d = formerTarget.children) === null || _d === void 0 ? void 0 : _d.length);\n    var formerChilren = formerTarget.children || [];\n    var nowChilren = nowTarget.children || [];\n\n    for (var index = 0; index < length_1; index += 1) {\n      children.push(compareTwoTarget(nowChilren[index], formerChilren[index]));\n    }\n  }\n\n  var formerKeys = Object.keys(formerTarget.attrs);\n  var nowKeys = Object.keys(nowTarget.attrs);\n\n  if (formerTarget.type !== nowTarget.type) {\n    return {\n      action: 'restructure',\n      nowTarget: nowTarget,\n      formerTarget: formerTarget,\n      key: key,\n      children: children\n    };\n  }\n\n  if (formerKeys.filter(function (e) {\n    return e !== 'children';\n  }).some(function (e) {\n    return nowTarget.attrs[e] !== formerTarget.attrs[e] || !nowKeys.includes(e);\n  })) {\n    return {\n      action: 'change',\n      val: nowTarget,\n      children: children,\n      type: type,\n      key: key\n    };\n  }\n\n  return {\n    action: 'same',\n    children: children,\n    type: type,\n    key: key\n  };\n}\n/**\n * 根据xml或者返回xml的函数构建自定义节点的结构\n * @param gen\n */\n\nexport function createNodeFromXML(gen) {\n  var structures = {};\n\n  var compileXML = function compileXML(cfg) {\n    var rawStr = typeof gen === 'function' ? gen(cfg) : gen;\n    var target = xmlDataRenderer(rawStr)(cfg);\n    var xmlParser = document.createElement('div');\n    xmlParser.innerHTML = target;\n    var xml = xmlParser.children[0];\n    var result = generateTarget(parseXML(xml, cfg));\n    xmlParser.remove();\n    return result;\n  };\n\n  return {\n    draw: function draw(cfg, group) {\n      var resultTarget = compileXML(cfg);\n      var keyshape = group;\n\n      var renderTarget = function renderTarget(target) {\n        var _a = target.attrs,\n            attrs = _a === void 0 ? {} : _a,\n            bbox = target.bbox,\n            type = target.type,\n            children = target.children,\n            rest = __rest(target, [\"attrs\", \"bbox\", \"type\", \"children\"]);\n\n        if (target.type !== 'group') {\n          var shape = group.addShape(target.type, __assign({\n            attrs: attrs,\n            origin: {\n              bbox: bbox,\n              type: type,\n              children: children\n            }\n          }, rest));\n\n          if (target.keyshape) {\n            keyshape = shape;\n          }\n        }\n\n        if (target.children) {\n          target.children.forEach(function (n) {\n            return renderTarget(n);\n          });\n        }\n      };\n\n      renderTarget(resultTarget);\n      structures[cfg.id] = [resultTarget];\n      return keyshape;\n    },\n    update: function update(cfg, node) {\n      if (!structures[cfg.id]) {\n        structures[cfg.id] = [];\n      }\n\n      var container = node.getContainer();\n      var children = container.get('children');\n      var newTarget = compileXML(cfg);\n      var lastTarget = structures[cfg.id].pop();\n      var diffResult = compareTwoTarget(newTarget, lastTarget);\n\n      var addShape = function addShape(shape) {\n        var _a;\n\n        if (shape.type !== 'group') {\n          container.addShape(shape.type, {\n            attrs: shape.attrs\n          });\n        }\n\n        if ((_a = shape.children) === null || _a === void 0 ? void 0 : _a.length) {\n          shape.children.map(function (e) {\n            return addShape(e);\n          });\n        }\n      };\n\n      var delShape = function delShape(shape) {\n        var _a;\n\n        var targetShape = children.find(function (e) {\n          return e.attrs.key === shape.attrs.key;\n        });\n\n        if (targetShape) {\n          container.removeChild(targetShape);\n        }\n\n        if ((_a = shape.children) === null || _a === void 0 ? void 0 : _a.length) {\n          shape.children.map(function (e) {\n            return delShape(e);\n          });\n        }\n      };\n\n      var updateTarget = function updateTarget(target) {\n        var key = target.key;\n\n        if (target.type !== 'group') {\n          var targetShape = children.find(function (e) {\n            return e.attrs.key === key;\n          });\n\n          switch (target.action) {\n            case 'change':\n              if (targetShape) {\n                var originAttr = target.val.keyshape ? node.getOriginStyle() : {};\n                targetShape.attr(__assign(__assign({}, originAttr), target.val.attrs));\n              }\n\n              break;\n\n            case 'add':\n              addShape(target.val);\n              break;\n\n            case 'delete':\n              delShape(target.val);\n              break;\n\n            case 'restructure':\n              delShape(target.formerTarget);\n              addShape(target.nowTarget);\n              break;\n\n            default:\n              break;\n          }\n        }\n\n        if (target.children) {\n          target.children.forEach(function (n) {\n            return updateTarget(n);\n          });\n        }\n      };\n\n      updateTarget(diffResult);\n      structures[cfg.id].push(newTarget);\n    },\n    getAnchorPoints: function getAnchorPoints() {\n      return [[0, 0.5], [1, 0.5], [0.5, 1], [0.5, 0]];\n    }\n  };\n}","map":{"version":3,"names":["_typeof","obj","Symbol","iterator","constructor","prototype","__assign","__rest","get","getTextSize","looseJSONParse","text","safeParse","str","JSON","parse","trim","e","firstAttempt","tail","arr","length","objectStack","syntaxStack","isLastPair","syntaxes","_i","arguments","some","syntax","getValueStore","rst","i","temp","nowChar","isInString","isLastTranslate","isInObject","isInArray","isWaitingValue","tempArr","pop","value","push","c","keyConvert","split","reduce","a","b","charAt","toUpperCase","slice","xmlDataRenderer","xml","data","len","tmp","last","endsWith","concat","map","index","join","parseXML","cfg","attrs","keys","getAttributeNames","children","Array","from","tagName","toLowerCase","innerText","type","forEach","k","key","val","getAttribute","style","name","keyshape","getBBox","node","offset","chilrenBBox","_a","bbox","x","y","width","height","shapeHeight","shapeWidth","r","fontSize","fill","marginTop","marginLeft","generateTarget","target","lastOffset","defaultBbox","_b","next","compareTwoTarget","nowTarget","formerTarget","_c","_d","action","length_1","Math","max","formerChilren","nowChilren","formerKeys","Object","nowKeys","filter","includes","createNodeFromXML","gen","structures","compileXML","rawStr","xmlParser","document","createElement","innerHTML","result","remove","draw","group","resultTarget","renderTarget","rest","shape","addShape","origin","n","id","update","container","getContainer","newTarget","lastTarget","diffResult","delShape","targetShape","find","removeChild","updateTarget","originAttr","getOriginStyle","attr","getAnchorPoints"],"sources":["/Users/wawalike/Desktop/ggProject/node_modules/@antv/g6-core/es/element/xml.js"],"sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\n/**\n * @fileOverview 从xml建立自定义Node，包含update\n * @author xuzhi.mxz@antfin.com\n */\nimport { __assign, __rest } from \"tslib\";\nimport { get } from '@antv/util';\nimport { getTextSize } from '../util/graphic';\n/**\n * 一种更宽松的JSON 解析，如果遇到不符合规范的字段会直接转为字符串\n * @param text json 内容\n */\n\nfunction looseJSONParse(text) {\n  if (typeof text !== 'string') {\n    return text;\n  }\n\n  var safeParse = function safeParse(str) {\n    if (typeof str !== 'string') {\n      return str;\n    }\n\n    try {\n      return JSON.parse(str.trim());\n    } catch (e) {\n      return str.trim();\n    }\n  };\n\n  var firstAttempt = safeParse(text);\n\n  if (typeof firstAttempt !== 'string') {\n    return firstAttempt;\n  }\n\n  var tail = function tail(arr) {\n    return arr[arr.length - 1];\n  };\n\n  var str = text.trim();\n  var objectStack = [];\n  var syntaxStack = [];\n\n  var isLastPair = function isLastPair() {\n    var syntaxes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      syntaxes[_i] = arguments[_i];\n    }\n\n    return syntaxes.some(function (syntax) {\n      return tail(syntaxStack) === syntax;\n    });\n  };\n\n  var getValueStore = function getValueStore() {\n    return tail(objectStack);\n  };\n\n  var rst = null;\n  var i = 0;\n  var temp = '';\n\n  while (i < str.length) {\n    var nowChar = str[i];\n    var isInString = isLastPair('\"', \"'\");\n\n    if (!isInString && !nowChar.trim()) {\n      i += 1;\n      continue;\n    }\n\n    var isLastTranslate = str[i - 1] === '\\\\';\n    var isInObject = isLastPair('}');\n    var isInArray = isLastPair(']');\n    var isWaitingValue = isLastPair(',');\n    var tempArr = getValueStore();\n\n    if (isInString) {\n      if (tail(syntaxStack) === nowChar && !isLastTranslate) {\n        syntaxStack.pop();\n        var value = safeParse(temp);\n        tempArr.push(value);\n        rst = value;\n        temp = '';\n      } else {\n        temp += nowChar;\n      }\n    } else if (isInArray && nowChar === ',') {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n    } else if (isInObject && nowChar === ':') {\n      syntaxStack.push(',');\n\n      if (temp) {\n        tempArr.push(temp);\n        temp = '';\n      }\n    } else if (isWaitingValue && nowChar === ',') {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n\n      syntaxStack.pop();\n    } else if (nowChar === '}' && (isInObject || isWaitingValue)) {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n\n      if (isWaitingValue) {\n        syntaxStack.pop();\n      }\n\n      var obj = {};\n\n      for (var c = 1; c < tempArr.length; c += 2) {\n        obj[tempArr[c - 1]] = tempArr[c];\n      }\n\n      objectStack.pop();\n\n      if (objectStack.length) {\n        tail(objectStack).push(obj);\n      }\n\n      syntaxStack.pop();\n      rst = obj;\n    } else if (nowChar === ']' && isInArray) {\n      if (temp) {\n        tempArr.push(safeParse(temp));\n        temp = '';\n      }\n\n      objectStack.pop();\n\n      if (objectStack.length) {\n        tail(objectStack).push(tempArr);\n      }\n\n      syntaxStack.pop();\n      rst = tempArr;\n    } else if (nowChar === '{') {\n      objectStack.push([]);\n      syntaxStack.push('}');\n    } else if (nowChar === '[') {\n      objectStack.push([]);\n      syntaxStack.push(']');\n    } else if (nowChar === '\"') {\n      syntaxStack.push('\"');\n    } else if (nowChar === \"'\") {\n      syntaxStack.push(\"'\");\n    } else {\n      temp += nowChar;\n    }\n\n    i += 1;\n  }\n\n  return rst || temp;\n}\n\nvar keyConvert = function keyConvert(str) {\n  return str.split('-').reduce(function (a, b) {\n    return a + b.charAt(0).toUpperCase() + b.slice(1);\n  });\n};\n/**\n * 简单的一个{{}}模板渲染，不包含任何复杂语法\n * @param xml\n */\n\n\nexport var xmlDataRenderer = function xmlDataRenderer(xml) {\n  return function (data) {\n    var len = xml.length;\n    var arr = [];\n    var i = 0;\n    var tmp = '';\n\n    while (i < len) {\n      if (xml[i] === '{' && xml[i + 1] === '{') {\n        arr.push(tmp);\n        tmp = '';\n        i += 2;\n      } else if (xml[i] === '}' && xml[i + 1] === '}') {\n        if (arr.length) {\n          var last = arr.pop();\n          tmp = get(data, tmp, last.endsWith('=') ? \"\\\"{\".concat(tmp, \"}\\\"\") : tmp);\n          arr.push(last + tmp);\n        }\n\n        i += 2;\n        tmp = '';\n      } else {\n        tmp += xml[i];\n        i += 1;\n      }\n    }\n\n    arr.push(tmp);\n    return arr.map(function (e, index) {\n      return arr[index - 1] && arr[index - 1].endsWith('=') ? \"\\\"{\".concat(e, \"}\\\"\") : e;\n    }).join('');\n  };\n};\n/**\n * 解析XML，并转化为相应的JSON结构\n * @param xml xml解析后的节点\n */\n\nexport function parseXML(xml, cfg) {\n  var attrs = {};\n  var keys = xml.getAttributeNames && xml.getAttributeNames() || [];\n  var children = xml.children && Array.from(xml.children).map(function (e) {\n    return parseXML(e, cfg);\n  });\n  var rst = {};\n  var tagName = xml.tagName ? xml.tagName.toLowerCase() : 'group';\n\n  if (tagName === 'text') {\n    attrs.text = xml.innerText;\n  }\n\n  rst.type = tagName;\n\n  if (tagName === 'img') {\n    rst.type = 'image';\n  }\n\n  Array.from(keys).forEach(function (k) {\n    var key = keyConvert(k);\n    var val = xml.getAttribute(k);\n\n    try {\n      if (key === 'style' || key === 'attrs') {\n        var style = looseJSONParse(val);\n        attrs = __assign(__assign({}, attrs), style);\n      } else {\n        rst[key] = looseJSONParse(val);\n      }\n    } catch (e) {\n      if (key === 'style') {\n        throw e;\n      }\n\n      rst[key] = val;\n    }\n  });\n  rst.attrs = attrs;\n\n  if (cfg && cfg.style && rst.name && _typeof(cfg.style[rst.name]) === 'object') {\n    rst.attrs = __assign(__assign({}, rst.attrs), cfg.style[rst.name]);\n  }\n\n  if (cfg && cfg.style && rst.keyshape) {\n    rst.attrs = __assign(__assign({}, rst.attrs), cfg.style);\n  }\n\n  if (children.length) {\n    rst.children = children;\n  }\n\n  return rst;\n}\n/**\n * 根据偏移量和内部节点最终的bounding box来得出该shape最终的bbox\n */\n\nexport function getBBox(node, offset, chilrenBBox) {\n  var _a = node.attrs,\n      attrs = _a === void 0 ? {} : _a;\n  var bbox = {\n    x: offset.x || 0,\n    y: offset.y || 0,\n    width: chilrenBBox.width || 0,\n    height: chilrenBBox.height || 0\n  };\n  var shapeHeight, shapeWidth;\n\n  switch (node.type) {\n    case 'maker':\n    case 'circle':\n      if (attrs.r) {\n        shapeWidth = 2 * attrs.r;\n        shapeHeight = 2 * attrs.r;\n      }\n\n      break;\n\n    case 'text':\n      if (attrs.text) {\n        shapeWidth = getTextSize(attrs.text, attrs.fontSize || 12)[0];\n        shapeHeight = 16;\n        bbox.y += shapeHeight;\n        bbox.height = shapeHeight;\n        bbox.width = shapeWidth;\n        node.attrs = __assign({\n          fontSize: 12,\n          fill: '#000'\n        }, attrs);\n      }\n\n      break;\n\n    default:\n      if (attrs.width) {\n        shapeWidth = attrs.width;\n      }\n\n      if (attrs.height) {\n        shapeHeight = attrs.height;\n      }\n\n  }\n\n  if (shapeHeight >= 0) {\n    bbox.height = shapeHeight;\n  }\n\n  if (shapeWidth >= 0) {\n    bbox.width = shapeWidth;\n  }\n\n  if (attrs.marginTop) {\n    bbox.y += attrs.marginTop;\n  }\n\n  if (attrs.marginLeft) {\n    bbox.x += attrs.marginLeft;\n  }\n\n  return bbox;\n}\n/**\n * 把从xml计算出的结构填上位置信息，补全attrs\n * @param target\n * @param lastOffset\n */\n\nexport function generateTarget(target, lastOffset) {\n  var _a;\n\n  if (lastOffset === void 0) {\n    lastOffset = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  var defaultBbox = __assign({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0\n  }, lastOffset);\n\n  if ((_a = target.children) === null || _a === void 0 ? void 0 : _a.length) {\n    var _b = target.attrs,\n        attrs = _b === void 0 ? {} : _b;\n    var marginTop = attrs.marginTop;\n\n    var offset = __assign({}, lastOffset);\n\n    if (marginTop) {\n      offset.y += marginTop;\n    }\n\n    for (var index = 0; index < target.children.length; index++) {\n      target.children[index].attrs.key = \"\".concat(attrs.key || 'root', \" -\").concat(index, \" \");\n      var node = generateTarget(target.children[index], offset);\n\n      if (node.bbox) {\n        var bbox = node.bbox;\n\n        if (node.attrs.next === 'inline') {\n          offset.x += node.bbox.width;\n        } else {\n          offset.y += node.bbox.height;\n        }\n\n        if (bbox.width + bbox.x > defaultBbox.width) {\n          defaultBbox.width = bbox.width + bbox.x;\n        }\n\n        if (bbox.height + bbox.y > defaultBbox.height) {\n          defaultBbox.height = bbox.height + bbox.y;\n        }\n      }\n    }\n  }\n\n  target.bbox = getBBox(target, lastOffset, defaultBbox);\n  target.attrs = __assign(__assign({}, target.attrs), target.bbox);\n  return target;\n}\n/**\n * 对比前后两个最终计算出来的node，并对比出最小改动,\n * 动作： 'add' 添加节点 ｜ ’delete‘ 删除节点 ｜ ’change‘ 改变节点attrs ｜ 'restructure' 重构节点\n * @param nowTarget\n * @param formerTarget\n */\n\nexport function compareTwoTarget(nowTarget, formerTarget) {\n  var _a, _b, _c, _d;\n\n  var type = (nowTarget || {}).type;\n  var key = ((formerTarget === null || formerTarget === void 0 ? void 0 : formerTarget.attrs) || {}).key;\n\n  if (key && nowTarget) {\n    nowTarget.attrs.key = key;\n  }\n\n  if (!nowTarget && formerTarget) {\n    return {\n      action: 'delete',\n      val: formerTarget,\n      type: type,\n      key: key\n    };\n  }\n\n  if (nowTarget && !formerTarget) {\n    return {\n      action: 'add',\n      val: nowTarget,\n      type: type\n    };\n  }\n\n  if (!nowTarget && !formerTarget) {\n    return {\n      action: 'same',\n      type: type\n    };\n  }\n\n  var children = [];\n\n  if (((_a = nowTarget.children) === null || _a === void 0 ? void 0 : _a.length) > 0 || ((_b = formerTarget.children) === null || _b === void 0 ? void 0 : _b.length) > 0) {\n    var length_1 = Math.max((_c = nowTarget.children) === null || _c === void 0 ? void 0 : _c.length, (_d = formerTarget.children) === null || _d === void 0 ? void 0 : _d.length);\n    var formerChilren = formerTarget.children || [];\n    var nowChilren = nowTarget.children || [];\n\n    for (var index = 0; index < length_1; index += 1) {\n      children.push(compareTwoTarget(nowChilren[index], formerChilren[index]));\n    }\n  }\n\n  var formerKeys = Object.keys(formerTarget.attrs);\n  var nowKeys = Object.keys(nowTarget.attrs);\n\n  if (formerTarget.type !== nowTarget.type) {\n    return {\n      action: 'restructure',\n      nowTarget: nowTarget,\n      formerTarget: formerTarget,\n      key: key,\n      children: children\n    };\n  }\n\n  if (formerKeys.filter(function (e) {\n    return e !== 'children';\n  }).some(function (e) {\n    return nowTarget.attrs[e] !== formerTarget.attrs[e] || !nowKeys.includes(e);\n  })) {\n    return {\n      action: 'change',\n      val: nowTarget,\n      children: children,\n      type: type,\n      key: key\n    };\n  }\n\n  return {\n    action: 'same',\n    children: children,\n    type: type,\n    key: key\n  };\n}\n/**\n * 根据xml或者返回xml的函数构建自定义节点的结构\n * @param gen\n */\n\nexport function createNodeFromXML(gen) {\n  var structures = {};\n\n  var compileXML = function compileXML(cfg) {\n    var rawStr = typeof gen === 'function' ? gen(cfg) : gen;\n    var target = xmlDataRenderer(rawStr)(cfg);\n    var xmlParser = document.createElement('div');\n    xmlParser.innerHTML = target;\n    var xml = xmlParser.children[0];\n    var result = generateTarget(parseXML(xml, cfg));\n    xmlParser.remove();\n    return result;\n  };\n\n  return {\n    draw: function draw(cfg, group) {\n      var resultTarget = compileXML(cfg);\n      var keyshape = group;\n\n      var renderTarget = function renderTarget(target) {\n        var _a = target.attrs,\n            attrs = _a === void 0 ? {} : _a,\n            bbox = target.bbox,\n            type = target.type,\n            children = target.children,\n            rest = __rest(target, [\"attrs\", \"bbox\", \"type\", \"children\"]);\n\n        if (target.type !== 'group') {\n          var shape = group.addShape(target.type, __assign({\n            attrs: attrs,\n            origin: {\n              bbox: bbox,\n              type: type,\n              children: children\n            }\n          }, rest));\n\n          if (target.keyshape) {\n            keyshape = shape;\n          }\n        }\n\n        if (target.children) {\n          target.children.forEach(function (n) {\n            return renderTarget(n);\n          });\n        }\n      };\n\n      renderTarget(resultTarget);\n      structures[cfg.id] = [resultTarget];\n      return keyshape;\n    },\n    update: function update(cfg, node) {\n      if (!structures[cfg.id]) {\n        structures[cfg.id] = [];\n      }\n\n      var container = node.getContainer();\n      var children = container.get('children');\n      var newTarget = compileXML(cfg);\n      var lastTarget = structures[cfg.id].pop();\n      var diffResult = compareTwoTarget(newTarget, lastTarget);\n\n      var addShape = function addShape(shape) {\n        var _a;\n\n        if (shape.type !== 'group') {\n          container.addShape(shape.type, {\n            attrs: shape.attrs\n          });\n        }\n\n        if ((_a = shape.children) === null || _a === void 0 ? void 0 : _a.length) {\n          shape.children.map(function (e) {\n            return addShape(e);\n          });\n        }\n      };\n\n      var delShape = function delShape(shape) {\n        var _a;\n\n        var targetShape = children.find(function (e) {\n          return e.attrs.key === shape.attrs.key;\n        });\n\n        if (targetShape) {\n          container.removeChild(targetShape);\n        }\n\n        if ((_a = shape.children) === null || _a === void 0 ? void 0 : _a.length) {\n          shape.children.map(function (e) {\n            return delShape(e);\n          });\n        }\n      };\n\n      var updateTarget = function updateTarget(target) {\n        var key = target.key;\n\n        if (target.type !== 'group') {\n          var targetShape = children.find(function (e) {\n            return e.attrs.key === key;\n          });\n\n          switch (target.action) {\n            case 'change':\n              if (targetShape) {\n                var originAttr = target.val.keyshape ? node.getOriginStyle() : {};\n                targetShape.attr(__assign(__assign({}, originAttr), target.val.attrs));\n              }\n\n              break;\n\n            case 'add':\n              addShape(target.val);\n              break;\n\n            case 'delete':\n              delShape(target.val);\n              break;\n\n            case 'restructure':\n              delShape(target.formerTarget);\n              addShape(target.nowTarget);\n              break;\n\n            default:\n              break;\n          }\n        }\n\n        if (target.children) {\n          target.children.forEach(function (n) {\n            return updateTarget(n);\n          });\n        }\n      };\n\n      updateTarget(diffResult);\n      structures[cfg.id].push(newTarget);\n    },\n    getAnchorPoints: function getAnchorPoints() {\n      return [[0, 0.5], [1, 0.5], [0.5, 1], [0.5, 0]];\n    }\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}