{"ast":null,"code":"import { ObjectExt, Dom, Vector } from '../../util';\nimport { Util } from '../../global';\nconst defaultOptions = {\n  padding: 3,\n  rx: 0,\n  ry: 0,\n  attrs: {\n    'stroke-width': 3,\n    stroke: '#FEB663'\n  }\n};\nexport const stroke = {\n  highlight(cellView, magnet, options) {\n    const id = Private.getHighlighterId(magnet, options);\n\n    if (Private.hasCache(id)) {\n      return;\n    } // eslint-disable-next-line\n\n\n    options = ObjectExt.defaultsDeep({}, options, defaultOptions);\n    const magnetVel = Vector.create(magnet);\n    let pathData;\n    let magnetBBox;\n\n    try {\n      pathData = magnetVel.toPathData();\n    } catch (error) {\n      // Failed to get path data from magnet element.\n      // Draw a rectangle around the entire cell view instead.\n      magnetBBox = magnetVel.bbox(true\n      /* without transforms */\n      );\n      pathData = Dom.rectToPathData(Object.assign(Object.assign({}, options), magnetBBox));\n    }\n\n    const path = Dom.createSvgElement('path');\n    Dom.attr(path, Object.assign({\n      d: pathData,\n      'pointer-events': 'none',\n      'vector-effect': 'non-scaling-stroke',\n      fill: 'none'\n    }, options.attrs ? Dom.kebablizeAttrs(options.attrs) : null)); // const highlightVel = v.create('path').attr()\n\n    if (cellView.isEdgeElement(magnet)) {\n      Dom.attr(path, 'd', cellView.getConnectionPathData());\n    } else {\n      let highlightMatrix = magnetVel.getTransformToElement(cellView.container); // Add padding to the highlight element.\n\n      const padding = options.padding;\n\n      if (padding) {\n        if (magnetBBox == null) {\n          magnetBBox = magnetVel.bbox(true);\n        }\n\n        const cx = magnetBBox.x + magnetBBox.width / 2;\n        const cy = magnetBBox.y + magnetBBox.height / 2;\n        magnetBBox = Dom.transformRectangle(magnetBBox, highlightMatrix);\n        const width = Math.max(magnetBBox.width, 1);\n        const height = Math.max(magnetBBox.height, 1);\n        const sx = (width + padding) / width;\n        const sy = (height + padding) / height;\n        const paddingMatrix = Dom.createSVGMatrix({\n          a: sx,\n          b: 0,\n          c: 0,\n          d: sy,\n          e: cx - sx * cx,\n          f: cy - sy * cy\n        });\n        highlightMatrix = highlightMatrix.multiply(paddingMatrix);\n      }\n\n      Dom.transform(path, highlightMatrix);\n    }\n\n    Dom.addClass(path, Util.prefix('highlight-stroke'));\n    const cell = cellView.cell;\n\n    const removeHandler = () => Private.removeHighlighter(id);\n\n    cell.on('removed', removeHandler);\n\n    if (cell.model) {\n      cell.model.on('reseted', removeHandler);\n    }\n\n    cellView.container.appendChild(path);\n    Private.setCache(id, path);\n  },\n\n  unhighlight(cellView, magnet, opt) {\n    Private.removeHighlighter(Private.getHighlighterId(magnet, opt));\n  }\n\n};\nvar Private;\n\n(function (Private) {\n  function getHighlighterId(magnet, options) {\n    Dom.ensureId(magnet);\n    return magnet.id + JSON.stringify(options);\n  }\n\n  Private.getHighlighterId = getHighlighterId;\n  const cache = {};\n\n  function setCache(id, elem) {\n    cache[id] = elem;\n  }\n\n  Private.setCache = setCache;\n\n  function hasCache(id) {\n    return cache[id] != null;\n  }\n\n  Private.hasCache = hasCache;\n\n  function removeHighlighter(id) {\n    const elem = cache[id];\n\n    if (elem) {\n      Dom.remove(elem);\n      delete cache[id];\n    }\n  }\n\n  Private.removeHighlighter = removeHighlighter;\n})(Private || (Private = {}));","map":{"version":3,"mappings":"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","names":["ObjectExt","Dom","Vector","Util","defaultOptions","padding","rx","ry","attrs","stroke","highlight","cellView","magnet","options","id","Private","getHighlighterId","hasCache","defaultsDeep","magnetVel","create","pathData","magnetBBox","toPathData","error","bbox","rectToPathData","Object","path","createSvgElement","attr","d","fill","kebablizeAttrs","isEdgeElement","getConnectionPathData","highlightMatrix","getTransformToElement","container","cx","x","width","cy","y","height","transformRectangle","Math","max","sx","sy","paddingMatrix","createSVGMatrix","a","b","c","e","f","multiply","transform","addClass","prefix","cell","removeHandler","removeHighlighter","on","model","appendChild","setCache","unhighlight","opt","ensureId","JSON","stringify","cache","elem","remove"],"sourceRoot":"","sources":["../../../src/registry/highlighter/stroke.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}