{"ast":null,"code":"import { Base } from './base';\nimport { Dom } from '../util';\nimport { Point, Rectangle } from '../geometry';\nexport class CoordManager extends Base {\n  getClientMatrix() {\n    return Dom.createSVGMatrix(this.view.stage.getScreenCTM());\n  }\n  /**\n   * Returns coordinates of the graph viewport, relative to the window.\n   */\n\n\n  getClientOffset() {\n    // see: https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n    const rect = this.view.svg.getBoundingClientRect();\n    return new Point(rect.left, rect.top);\n  }\n  /**\n   * Returns coordinates of the graph viewport, relative to the document.\n   */\n\n\n  getPageOffset() {\n    // see: https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n    return this.getClientOffset().translate(window.scrollX, window.scrollY);\n  }\n\n  snapToGrid(x, y) {\n    const p = typeof x === 'number' ? this.clientToLocalPoint(x, y) : this.clientToLocalPoint(x.x, x.y);\n    return p.snapToGrid(this.graph.getGridSize());\n  }\n\n  localToGraphPoint(x, y) {\n    const localPoint = Point.create(x, y);\n    return Dom.transformPoint(localPoint, this.graph.matrix());\n  }\n\n  localToClientPoint(x, y) {\n    const localPoint = Point.create(x, y);\n    return Dom.transformPoint(localPoint, this.getClientMatrix());\n  }\n\n  localToPagePoint(x, y) {\n    const p = typeof x === 'number' ? this.localToGraphPoint(x, y) : this.localToGraphPoint(x);\n    return p.translate(this.getPageOffset());\n  }\n\n  localToGraphRect(x, y, width, height) {\n    const localRect = Rectangle.create(x, y, width, height);\n    return Dom.transformRectangle(localRect, this.graph.matrix());\n  }\n\n  localToClientRect(x, y, width, height) {\n    const localRect = Rectangle.create(x, y, width, height);\n    return Dom.transformRectangle(localRect, this.getClientMatrix());\n  }\n\n  localToPageRect(x, y, width, height) {\n    const rect = typeof x === 'number' ? this.localToGraphRect(x, y, width, height) : this.localToGraphRect(x);\n    return rect.translate(this.getPageOffset());\n  }\n\n  graphToLocalPoint(x, y) {\n    const graphPoint = Point.create(x, y);\n    return Dom.transformPoint(graphPoint, this.graph.matrix().inverse());\n  }\n\n  clientToLocalPoint(x, y) {\n    const clientPoint = Point.create(x, y);\n    return Dom.transformPoint(clientPoint, this.getClientMatrix().inverse());\n  }\n\n  clientToGraphPoint(x, y) {\n    const clientPoint = Point.create(x, y);\n    return Dom.transformPoint(clientPoint, this.graph.matrix().multiply(this.getClientMatrix().inverse()));\n  }\n\n  pageToLocalPoint(x, y) {\n    const pagePoint = Point.create(x, y);\n    const graphPoint = pagePoint.diff(this.getPageOffset());\n    return this.graphToLocalPoint(graphPoint);\n  }\n\n  graphToLocalRect(x, y, width, height) {\n    const graphRect = Rectangle.create(x, y, width, height);\n    return Dom.transformRectangle(graphRect, this.graph.matrix().inverse());\n  }\n\n  clientToLocalRect(x, y, width, height) {\n    const clientRect = Rectangle.create(x, y, width, height);\n    return Dom.transformRectangle(clientRect, this.getClientMatrix().inverse());\n  }\n\n  clientToGraphRect(x, y, width, height) {\n    const clientRect = Rectangle.create(x, y, width, height);\n    return Dom.transformRectangle(clientRect, this.graph.matrix().multiply(this.getClientMatrix().inverse()));\n  }\n\n  pageToLocalRect(x, y, width, height) {\n    const graphRect = Rectangle.create(x, y, width, height);\n    const pageOffset = this.getPageOffset();\n    graphRect.x -= pageOffset.x;\n    graphRect.y -= pageOffset.y;\n    return this.graphToLocalRect(graphRect);\n  }\n\n}","map":{"version":3,"mappings":"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","names":["Base","Dom","Point","Rectangle","CoordManager","getClientMatrix","createSVGMatrix","view","stage","getScreenCTM","getClientOffset","rect","svg","getBoundingClientRect","left","top","getPageOffset","translate","window","scrollX","scrollY","snapToGrid","x","y","p","clientToLocalPoint","graph","getGridSize","localToGraphPoint","localPoint","create","transformPoint","matrix","localToClientPoint","localToPagePoint","localToGraphRect","width","height","localRect","transformRectangle","localToClientRect","localToPageRect","graphToLocalPoint","graphPoint","inverse","clientPoint","clientToGraphPoint","multiply","pageToLocalPoint","pagePoint","diff","graphToLocalRect","graphRect","clientToLocalRect","clientRect","clientToGraphRect","pageToLocalRect","pageOffset"],"sourceRoot":"","sources":["../../src/graph/coord.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}