{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport { gl } from '../..';\nimport { Component } from '../../ComponentManager';\nexport var MaterialComponent = /*#__PURE__*/function (_Component) {\n  _inherits(MaterialComponent, _Component);\n\n  var _super = _createSuper(MaterialComponent); // control flow in shaders, eg. USE_UV, USE_MAP...\n\n\n  function MaterialComponent(data) {\n    var _this;\n\n    _classCallCheck(this, MaterialComponent);\n\n    _this = _super.call(this, data);\n    _this.vertexShaderGLSL = void 0;\n    _this.fragmentShaderGLSL = void 0;\n    _this.defines = {};\n    _this.dirty = true;\n    _this.uniforms = [];\n    _this.cull = {\n      enable: true,\n      face: gl.BACK\n    };\n    _this.depth = {\n      enable: true\n    };\n    _this.blend = void 0;\n    _this.entity = void 0;\n    _this.type = void 0;\n    Object.assign(_assertThisInitialized(_this), data);\n    return _this;\n  }\n\n  _createClass(MaterialComponent, [{\n    key: \"setDefines\",\n    value: function setDefines(defines) {\n      this.defines = _objectSpread(_objectSpread({}, this.defines), defines);\n      return this;\n    }\n  }, {\n    key: \"setCull\",\n    value: function setCull(cull) {\n      this.cull = cull;\n      return this;\n    }\n  }, {\n    key: \"setDepth\",\n    value: function setDepth(depth) {\n      this.depth = depth;\n      return this;\n    }\n  }, {\n    key: \"setBlend\",\n    value: function setBlend(blend) {\n      this.blend = blend;\n      return this;\n    }\n  }, {\n    key: \"setUniform\",\n    value: function setUniform(name, data) {\n      var _this2 = this;\n\n      if (typeof name !== 'string') {\n        Object.keys(name).forEach(function (key) {\n          return _this2.setUniform(key, name[key]);\n        });\n        return this;\n      }\n\n      var existedUniform = this.uniforms.find(function (u) {\n        return u.name === name;\n      });\n\n      if (!existedUniform) {\n        this.uniforms.push({\n          name: name,\n          dirty: true,\n          data: data\n        });\n      } else {\n        existedUniform.dirty = true;\n        existedUniform.data = data;\n      }\n\n      this.dirty = true;\n      return this;\n    }\n  }]);\n\n  return MaterialComponent;\n}(Component);","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAiBA,EAAjB,QAA2B,OAA3B;AACA,SAASC,SAAT,QAA0B,wBAA1B;AAMA,WAAaC,iBAAb;EAAAC;;EAAA,8CAKE;;;EAsBA,2BAAYC,IAAZ,EAAqE;IAAA;;IAAAC;;IACnEC,0BAAMF,IAAN;IADmEE,MA1B9DC,gBA0B8D;IAAAD,MAxB9DE,kBAwB8D;IAAAF,MArB9DG,OAqB8D,GArBlB,EAqBkB;IAAAH,MAnB9DI,KAmB8D,GAnBtD,IAmBsD;IAAAJ,MAjB9DK,QAiB8D,GAjBhC,EAiBgC;IAAAL,MAf9DM,IAe8D,GAflB;MACjDC,MAAM,EAAE,IADyC;MAEjDC,IAAI,EAAEd,EAAE,CAACe;IAFwC,CAekB;IAAAT,MAV9DU,KAU8D,GAVhB;MACnDH,MAAM,EAAE;IAD2C,CAUgB;IAAAP,MAN9DW,KAM8D;IAAAX,MAJ9DY,MAI8D;IAAAZ,MAF9Da,IAE8D;IAGnEC,MAAM,CAACC,MAAPD,gCAAoBhB,IAApBgB;IAHmE;EAIpE;;EA/BHE;IAAAC;IAAAC,2BAiCoBf,OAjCpB,EAiC+D;MAC3D,KAAKA,OAAL,mCAAoB,KAAKA,OAAzB,GAAqCA,OAArC;MACA,OAAO,IAAP;IACD;EApCH;IAAAc;IAAAC,wBAsCiBZ,IAtCjB,EAsC4D;MACxD,KAAKA,IAAL,GAAYA,IAAZ;MACA,OAAO,IAAP;IACD;EAzCH;IAAAW;IAAAC,yBA2CkBR,KA3ClB,EA2C+D;MAC3D,KAAKA,KAAL,GAAaA,KAAb;MACA,OAAO,IAAP;IACD;EA9CH;IAAAO;IAAAC,yBAgDkBP,KAhDlB,EAgD+D;MAC3D,KAAKA,KAAL,GAAaA,KAAb;MACA,OAAO,IAAP;IACD;EAnDH;IAAAM;IAAAC,2BAsDIC,IAtDJ,EAuDIrB,IAvDJ,EAwDI;MAAA;;MACA,IAAI,OAAOqB,IAAP,KAAgB,QAApB,EAA8B;QAC5BL,MAAM,CAACM,IAAPN,CAAYK,IAAZL,EAAkBO,OAAlBP,CAA0B,UAACG,GAAD;UAAA,OAASK,MAAI,CAACC,UAAL,CAAgBN,GAAhB,EAAqBE,IAAI,CAACF,GAAD,CAAzB,CAAT;QAA1B;QACA,OAAO,IAAP;MACD;;MAED,IAAMO,cAAc,GAAG,KAAKnB,QAAL,CAAcoB,IAAd,CAAmB,UAACC,CAAD;QAAA,OAAOA,CAAC,CAACP,IAAFO,KAAWP,IAAlB;MAAnB,EAAvB;;MACA,IAAI,CAACK,cAAL,EAAqB;QACnB,KAAKnB,QAAL,CAAcsB,IAAd,CAAmB;UACjBR,IAAI,EAAJA,IADiB;UAEjBf,KAAK,EAAE,IAFU;UAGjBN,IAAI,EAAEA;QAHW,CAAnB;MADF,OAMO;QACL0B,cAAc,CAACpB,KAAfoB,GAAuB,IAAvBA;QACAA,cAAc,CAAC1B,IAAf0B,GAAsB1B,IAAtB0B;MACD;;MAED,KAAKpB,KAAL,GAAa,IAAb;MACA,OAAO,IAAP;IACD;EA5EH;;EAAA;AAAA,EAAuCT,SAAvC","names":["gl","Component","MaterialComponent","_inherits","data","_classCallCheck","_this","vertexShaderGLSL","fragmentShaderGLSL","defines","dirty","uniforms","cull","enable","face","BACK","depth","blend","entity","type","Object","assign","_createClass","key","value","name","keys","forEach","_this2","setUniform","existedUniform","find","u","push"],"sources":["../../../src/components/material/MaterialComponent.ts"],"sourcesContent":["import { Entity, gl } from '../..';\nimport { Component } from '../../ComponentManager';\nimport { NonFunctionProperties } from '../../ComponentManager';\nimport { IModelInitializationOptions } from '../renderer/IModel';\nimport { BufferData } from '../renderer/IRendererService';\nimport { IUniformBinding } from './interface';\n\nexport class MaterialComponent extends Component<MaterialComponent> {\n  public vertexShaderGLSL: string;\n\n  public fragmentShaderGLSL: string;\n\n  // control flow in shaders, eg. USE_UV, USE_MAP...\n  public defines: Record<string, boolean | number> = {};\n\n  public dirty = true;\n\n  public uniforms: IUniformBinding[] = [];\n\n  public cull: IModelInitializationOptions['cull'] = {\n    enable: true,\n    face: gl.BACK,\n  };\n\n  public depth: IModelInitializationOptions['depth'] = {\n    enable: true,\n  };\n\n  public blend: IModelInitializationOptions['blend'];\n\n  public entity: Entity;\n\n  public type: string;\n\n  constructor(data: Partial<NonFunctionProperties<MaterialComponent>>) {\n    super(data);\n\n    Object.assign(this, data);\n  }\n\n  public setDefines(defines: Record<string, boolean | number>) {\n    this.defines = { ...this.defines, ...defines };\n    return this;\n  }\n\n  public setCull(cull: IModelInitializationOptions['cull']) {\n    this.cull = cull;\n    return this;\n  }\n\n  public setDepth(depth: IModelInitializationOptions['depth']) {\n    this.depth = depth;\n    return this;\n  }\n\n  public setBlend(blend: IModelInitializationOptions['blend']) {\n    this.blend = blend;\n    return this;\n  }\n\n  public setUniform(\n    name: string | Record<string, BufferData>,\n    data?: BufferData,\n  ) {\n    if (typeof name !== 'string') {\n      Object.keys(name).forEach((key) => this.setUniform(key, name[key]));\n      return this;\n    }\n\n    const existedUniform = this.uniforms.find((u) => u.name === name);\n    if (!existedUniform) {\n      this.uniforms.push({\n        name,\n        dirty: true,\n        data: data!,\n      });\n    } else {\n      existedUniform.dirty = true;\n      existedUniform.data = data!;\n    }\n\n    this.dirty = true;\n    return this;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}