{"ast":null,"code":"/**\n * @fileoverview Marker\n * @author dxq613@gmail.com\n */\nimport { __extends } from \"tslib\";\nimport { isNil } from '@antv/util';\nimport { path2Absolute } from '@antv/path-util';\nimport ShapeBase from './base';\nimport { isFunction } from '../util/util';\nimport { drawPath } from '../util/draw';\nvar Symbols = {\n  // 圆\n  circle: function (x, y, r) {\n    return [['M', x - r, y], ['A', r, r, 0, 1, 0, x + r, y], ['A', r, r, 0, 1, 0, x - r, y]];\n  },\n  // 正方形\n  square: function (x, y, r) {\n    return [['M', x - r, y - r], ['L', x + r, y - r], ['L', x + r, y + r], ['L', x - r, y + r], ['Z']];\n  },\n  // 菱形\n  diamond: function (x, y, r) {\n    return [['M', x - r, y], ['L', x, y - r], ['L', x + r, y], ['L', x, y + r], ['Z']];\n  },\n  // 三角形\n  triangle: function (x, y, r) {\n    var diffY = r * Math.sin(1 / 3 * Math.PI);\n    return [['M', x - r, y + diffY], ['L', x, y - diffY], ['L', x + r, y + diffY], ['Z']];\n  },\n  // 倒三角形\n  'triangle-down': function (x, y, r) {\n    var diffY = r * Math.sin(1 / 3 * Math.PI);\n    return [['M', x - r, y - diffY], ['L', x + r, y - diffY], ['L', x, y + diffY], ['Z']];\n  }\n};\n\nvar Marker =\n/** @class */\nfunction (_super) {\n  __extends(Marker, _super);\n\n  function Marker() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Marker.prototype.initAttrs = function (attrs) {\n    this._resetParamsCache();\n  }; // 重置绘制 path 存储的缓存\n\n\n  Marker.prototype._resetParamsCache = function () {\n    // 为了加速 path 的绘制、拾取和计算，这个地方可以缓存很多东西\n    // 这些缓存都是第一次需要时计算和存储，虽然增加了复杂度，但是频繁调用的方法，性能有很大提升\n    this.set('paramsCache', {}); // 清理缓存\n  }; // 更新属性时，检测是否更改了 path\n\n\n  Marker.prototype.onAttrChange = function (name, value, originValue) {\n    _super.prototype.onAttrChange.call(this, name, value, originValue);\n\n    if (['symbol', 'x', 'y', 'r', 'radius'].indexOf(name) !== -1) {\n      // path 相关属性更改时，清理缓存\n      this._resetParamsCache();\n    }\n  }; // 仅仅使用包围盒检测来进行拾取\n  // 所以不需要复写 isInStrokeOrPath 的方法\n\n\n  Marker.prototype.isOnlyHitBox = function () {\n    return true;\n  };\n\n  Marker.prototype._getR = function (attrs) {\n    // 兼容 r 和 radius 两种写法，推荐使用 r\n    return isNil(attrs.r) ? attrs.radius : attrs.r;\n  };\n\n  Marker.prototype._getPath = function () {\n    var attrs = this.attr();\n    var x = attrs.x,\n        y = attrs.y;\n    var symbol = attrs.symbol || 'circle';\n\n    var r = this._getR(attrs);\n\n    var method;\n    var path;\n\n    if (isFunction(symbol)) {\n      method = symbol;\n      path = method(x, y, r); // 将 path 转成绝对路径\n\n      path = path2Absolute(path);\n    } else {\n      // 内置 symbol 的 path 都是绝对路径，直接绘制即可，不需要对 path 进行特殊处理\n      method = Marker.Symbols[symbol];\n\n      if (!method) {\n        console.warn(symbol + \" marker is not supported.\");\n        return null;\n      }\n\n      path = method(x, y, r);\n    }\n\n    return path;\n  };\n\n  Marker.prototype.createPath = function (context) {\n    var path = this._getPath();\n\n    var paramsCache = this.get('paramsCache');\n    drawPath(this, context, {\n      path: path\n    }, paramsCache);\n  };\n\n  Marker.Symbols = Symbols;\n  return Marker;\n}(ShapeBase);\n\nexport default Marker;","map":{"version":3,"mappings":"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","names":["isNil","path2Absolute","ShapeBase","isFunction","drawPath","Symbols","circle","x","y","r","square","diamond","triangle","diffY","Math","sin","PI","__extends","Marker","attrs","_resetParamsCache","set","name","value","originValue","_super","onAttrChange","call","indexOf","radius","attr","symbol","_getR","method","path","console","warn","context","_getPath","paramsCache","get"],"sourceRoot":"","sources":["../../src/shape/marker.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}