{"ast":null,"code":"import { isString, each, isArray } from './util';\nvar regexLG = /^l\\s*\\(\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nvar regexRG = /^r\\s*\\(\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nvar regexPR = /^p\\s*\\(\\s*([axyn])\\s*\\)\\s*(.*)/i;\nvar regexColorStop = /[\\d.]+:(#[^\\s]+|[^\\)]+\\))/gi;\n\nfunction addStop(steps, gradient) {\n  var arr = steps.match(regexColorStop);\n  each(arr, function (item) {\n    var itemArr = item.split(':');\n    gradient.addColorStop(itemArr[0], itemArr[1]);\n  });\n}\n/**\n * 将边和填充设置的颜色转换成线性渐变对象\n * @param {CanvasRenderingContext2D} context canvas 上下文\n * @param {IElement}                 element  图形元素\n * @param {string}                   gradientStr   颜色\n * @returns {any} 渐变对象\n */\n\n\nexport function parseLineGradient(context, element, gradientStr) {\n  var arr = regexLG.exec(gradientStr);\n  var angle = parseFloat(arr[1]) % 360 * (Math.PI / 180);\n  var steps = arr[2];\n  var box = element.getBBox();\n  var start;\n  var end;\n\n  if (angle >= 0 && angle < 1 / 2 * Math.PI) {\n    start = {\n      x: box.minX,\n      y: box.minY\n    };\n    end = {\n      x: box.maxX,\n      y: box.maxY\n    };\n  } else if (1 / 2 * Math.PI <= angle && angle < Math.PI) {\n    start = {\n      x: box.maxX,\n      y: box.minY\n    };\n    end = {\n      x: box.minX,\n      y: box.maxY\n    };\n  } else if (Math.PI <= angle && angle < 3 / 2 * Math.PI) {\n    start = {\n      x: box.maxX,\n      y: box.maxY\n    };\n    end = {\n      x: box.minX,\n      y: box.minY\n    };\n  } else {\n    start = {\n      x: box.minX,\n      y: box.maxY\n    };\n    end = {\n      x: box.maxX,\n      y: box.minY\n    };\n  }\n\n  var tanTheta = Math.tan(angle);\n  var tanTheta2 = tanTheta * tanTheta;\n  var x = (end.x - start.x + tanTheta * (end.y - start.y)) / (tanTheta2 + 1) + start.x;\n  var y = tanTheta * (end.x - start.x + tanTheta * (end.y - start.y)) / (tanTheta2 + 1) + start.y;\n  var gradient = context.createLinearGradient(start.x, start.y, x, y);\n  addStop(steps, gradient);\n  return gradient;\n}\n/**\n * 将边和填充设置的颜色转换成圆形渐变对象\n * @param {CanvasRenderingContext2D} context canvas 上下文\n * @param {IElement}                 element  图形元素\n * @param {string}                   gradientStr   颜色\n * @returns {any} 渐变对象\n */\n\nexport function parseRadialGradient(context, element, gradientStr) {\n  var arr = regexRG.exec(gradientStr);\n  var fx = parseFloat(arr[1]);\n  var fy = parseFloat(arr[2]);\n  var fr = parseFloat(arr[3]);\n  var steps = arr[4]; // 环半径为0时，默认无渐变，取渐变序列的最后一个颜色\n\n  if (fr === 0) {\n    var colors = steps.match(regexColorStop);\n    return colors[colors.length - 1].split(':')[1];\n  }\n\n  var box = element.getBBox();\n  var width = box.maxX - box.minX;\n  var height = box.maxY - box.minY;\n  var r = Math.sqrt(width * width + height * height) / 2;\n  var gradient = context.createRadialGradient(box.minX + width * fx, box.minY + height * fy, 0, box.minX + width / 2, box.minY + height / 2, fr * r);\n  addStop(steps, gradient);\n  return gradient;\n}\n/**\n * 边和填充设置的颜色转换成 pattern\n * @param {CanvasRenderingContext2D} context canvas 上下文\n * @param {IElement}                 element  图形元素\n * @param {string}                   patternStr   生成 pattern 的字符串\n */\n\nexport function parsePattern(context, element, patternStr) {\n  // 在转换过程中进行了缓存\n  if (element.get('patternSource') && element.get('patternSource') === patternStr) {\n    return element.get('pattern');\n  }\n\n  var pattern;\n  var img;\n  var arr = regexPR.exec(patternStr);\n  var repeat = arr[1];\n  var source = arr[2]; // Function to be called when pattern loads\n\n  function onload() {\n    // Create pattern\n    pattern = context.createPattern(img, repeat);\n    element.set('pattern', pattern); // be a cache\n\n    element.set('patternSource', patternStr);\n  }\n\n  switch (repeat) {\n    case 'a':\n      repeat = 'repeat';\n      break;\n\n    case 'x':\n      repeat = 'repeat-x';\n      break;\n\n    case 'y':\n      repeat = 'repeat-y';\n      break;\n\n    case 'n':\n      repeat = 'no-repeat';\n      break;\n\n    default:\n      repeat = 'no-repeat';\n  }\n\n  img = new Image(); // If source URL is not a data URL\n\n  if (!source.match(/^data:/i)) {\n    // Set crossOrigin for this image\n    img.crossOrigin = 'Anonymous';\n  }\n\n  img.src = source;\n\n  if (img.complete) {\n    onload();\n  } else {\n    img.onload = onload; // Fix onload() bug in IE9\n\n    img.src = img.src;\n  }\n\n  return pattern;\n}\nexport function parseStyle(context, element, color) {\n  var bbox = element.getBBox();\n\n  if (isNaN(bbox.x) || isNaN(bbox.y) || isNaN(bbox.width) || isNaN(bbox.height)) {\n    return color;\n  }\n\n  if (isString(color)) {\n    if (color[1] === '(' || color[2] === '(') {\n      if (color[0] === 'l') {\n        // regexLG.test(color)\n        return parseLineGradient(context, element, color);\n      }\n\n      if (color[0] === 'r') {\n        // regexRG.test(color)\n        return parseRadialGradient(context, element, color);\n      }\n\n      if (color[0] === 'p') {\n        // regexPR.test(color)\n        return parsePattern(context, element, color);\n      }\n    }\n\n    return color;\n  }\n\n  if (color instanceof CanvasPattern) {\n    return color;\n  }\n}\nexport function parseRadius(radius) {\n  var r1 = 0;\n  var r2 = 0;\n  var r3 = 0;\n  var r4 = 0;\n\n  if (isArray(radius)) {\n    if (radius.length === 1) {\n      r1 = r2 = r3 = r4 = radius[0];\n    } else if (radius.length === 2) {\n      r1 = r3 = radius[0];\n      r2 = r4 = radius[1];\n    } else if (radius.length === 3) {\n      r1 = radius[0];\n      r2 = r4 = radius[1];\n      r3 = radius[2];\n    } else {\n      r1 = radius[0];\n      r2 = radius[1];\n      r3 = radius[2];\n      r4 = radius[3];\n    }\n  } else {\n    r1 = r2 = r3 = r4 = radius;\n  }\n\n  return [r1, r2, r3, r4];\n}","map":{"version":3,"mappings":"AACA,SAASA,QAAT,EAAmBC,IAAnB,EAAyBC,OAAzB,QAAwC,QAAxC;AAEA,IAAMC,OAAO,GAAG,iCAAhB;AACA,IAAMC,OAAO,GAAG,+DAAhB;AACA,IAAMC,OAAO,GAAG,iCAAhB;AACA,IAAMC,cAAc,GAAG,6BAAvB;;AAEA,SAASC,OAAT,CAAiBC,KAAjB,EAAwBC,QAAxB,EAAgC;EAC9B,IAAMC,GAAG,GAAaF,KAAK,CAACG,KAAN,CAAYL,cAAZ,CAAtB;EACAL,IAAI,CAACS,GAAD,EAAM,UAACE,IAAD,EAAK;IACb,IAAMC,OAAO,GAAGD,IAAI,CAACE,KAAL,CAAW,GAAX,CAAhB;IACAL,QAAQ,CAACM,YAAT,CAAsBF,OAAO,CAAC,CAAD,CAA7B,EAAkCA,OAAO,CAAC,CAAD,CAAzC;EACD,CAHG,CAAJ;AAID;AACD;;;;;;;;;AAOA,OAAM,SAAUG,iBAAV,CAA4BC,OAA5B,EAA+DC,OAA/D,EAAkFC,WAAlF,EAAqG;EACzG,IAAMT,GAAG,GAAGP,OAAO,CAACiB,IAAR,CAAaD,WAAb,CAAZ;EACA,IAAME,KAAK,GAAIC,UAAU,CAACZ,GAAG,CAAC,CAAD,CAAJ,CAAV,GAAqB,GAAtB,IAA8Ba,IAAI,CAACC,EAAL,GAAU,GAAxC,CAAd;EACA,IAAMhB,KAAK,GAAGE,GAAG,CAAC,CAAD,CAAjB;EACA,IAAMe,GAAG,GAAGP,OAAO,CAACQ,OAAR,EAAZ;EACA,IAAIC,KAAJ;EACA,IAAIC,GAAJ;;EAEA,IAAIP,KAAK,IAAI,CAAT,IAAcA,KAAK,GAAI,IAAI,CAAL,GAAUE,IAAI,CAACC,EAAzC,EAA6C;IAC3CG,KAAK,GAAG;MACNE,CAAC,EAAEJ,GAAG,CAACK,IADD;MAENC,CAAC,EAAEN,GAAG,CAACO;IAFD,CAAR;IAIAJ,GAAG,GAAG;MACJC,CAAC,EAAEJ,GAAG,CAACQ,IADH;MAEJF,CAAC,EAAEN,GAAG,CAACS;IAFH,CAAN;EAID,CATD,MASO,IAAK,IAAI,CAAL,GAAUX,IAAI,CAACC,EAAf,IAAqBH,KAArB,IAA8BA,KAAK,GAAGE,IAAI,CAACC,EAA/C,EAAmD;IACxDG,KAAK,GAAG;MACNE,CAAC,EAAEJ,GAAG,CAACQ,IADD;MAENF,CAAC,EAAEN,GAAG,CAACO;IAFD,CAAR;IAIAJ,GAAG,GAAG;MACJC,CAAC,EAAEJ,GAAG,CAACK,IADH;MAEJC,CAAC,EAAEN,GAAG,CAACS;IAFH,CAAN;EAID,CATM,MASA,IAAIX,IAAI,CAACC,EAAL,IAAWH,KAAX,IAAoBA,KAAK,GAAI,IAAI,CAAL,GAAUE,IAAI,CAACC,EAA/C,EAAmD;IACxDG,KAAK,GAAG;MACNE,CAAC,EAAEJ,GAAG,CAACQ,IADD;MAENF,CAAC,EAAEN,GAAG,CAACS;IAFD,CAAR;IAIAN,GAAG,GAAG;MACJC,CAAC,EAAEJ,GAAG,CAACK,IADH;MAEJC,CAAC,EAAEN,GAAG,CAACO;IAFH,CAAN;EAID,CATM,MASA;IACLL,KAAK,GAAG;MACNE,CAAC,EAAEJ,GAAG,CAACK,IADD;MAENC,CAAC,EAAEN,GAAG,CAACS;IAFD,CAAR;IAIAN,GAAG,GAAG;MACJC,CAAC,EAAEJ,GAAG,CAACQ,IADH;MAEJF,CAAC,EAAEN,GAAG,CAACO;IAFH,CAAN;EAID;;EAED,IAAMG,QAAQ,GAAGZ,IAAI,CAACa,GAAL,CAASf,KAAT,CAAjB;EACA,IAAMgB,SAAS,GAAGF,QAAQ,GAAGA,QAA7B;EAEA,IAAMN,CAAC,GAAG,CAACD,GAAG,CAACC,CAAJ,GAAQF,KAAK,CAACE,CAAd,GAAkBM,QAAQ,IAAIP,GAAG,CAACG,CAAJ,GAAQJ,KAAK,CAACI,CAAlB,CAA3B,KAAoDM,SAAS,GAAG,CAAhE,IAAqEV,KAAK,CAACE,CAArF;EACA,IAAME,CAAC,GAAII,QAAQ,IAAIP,GAAG,CAACC,CAAJ,GAAQF,KAAK,CAACE,CAAd,GAAkBM,QAAQ,IAAIP,GAAG,CAACG,CAAJ,GAAQJ,KAAK,CAACI,CAAlB,CAA9B,CAAT,IAAiEM,SAAS,GAAG,CAA7E,IAAkFV,KAAK,CAACI,CAAlG;EACA,IAAMtB,QAAQ,GAAGQ,OAAO,CAACqB,oBAAR,CAA6BX,KAAK,CAACE,CAAnC,EAAsCF,KAAK,CAACI,CAA5C,EAA+CF,CAA/C,EAAkDE,CAAlD,CAAjB;EACAxB,OAAO,CAACC,KAAD,EAAQC,QAAR,CAAP;EACA,OAAOA,QAAP;AACD;AAED;;;;;;;;AAOA,OAAM,SAAU8B,mBAAV,CAA8BtB,OAA9B,EAAiEC,OAAjE,EAAoFC,WAApF,EAAuG;EAC3G,IAAMT,GAAG,GAAGN,OAAO,CAACgB,IAAR,CAAaD,WAAb,CAAZ;EACA,IAAMqB,EAAE,GAAGlB,UAAU,CAACZ,GAAG,CAAC,CAAD,CAAJ,CAArB;EACA,IAAM+B,EAAE,GAAGnB,UAAU,CAACZ,GAAG,CAAC,CAAD,CAAJ,CAArB;EACA,IAAMgC,EAAE,GAAGpB,UAAU,CAACZ,GAAG,CAAC,CAAD,CAAJ,CAArB;EACA,IAAMF,KAAK,GAAGE,GAAG,CAAC,CAAD,CAAjB,CAL2G,CAM3G;;EACA,IAAIgC,EAAE,KAAK,CAAX,EAAc;IACZ,IAAMC,MAAM,GAAGnC,KAAK,CAACG,KAAN,CAAYL,cAAZ,CAAf;IACA,OAAOqC,MAAM,CAACA,MAAM,CAACC,MAAP,GAAgB,CAAjB,CAAN,CAA0B9B,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,CAAP;EACD;;EACD,IAAMW,GAAG,GAAGP,OAAO,CAACQ,OAAR,EAAZ;EACA,IAAMmB,KAAK,GAAGpB,GAAG,CAACQ,IAAJ,GAAWR,GAAG,CAACK,IAA7B;EACA,IAAMgB,MAAM,GAAGrB,GAAG,CAACS,IAAJ,GAAWT,GAAG,CAACO,IAA9B;EACA,IAAMe,CAAC,GAAGxB,IAAI,CAACyB,IAAL,CAAUH,KAAK,GAAGA,KAAR,GAAgBC,MAAM,GAAGA,MAAnC,IAA6C,CAAvD;EACA,IAAMrC,QAAQ,GAAGQ,OAAO,CAACgC,oBAAR,CACfxB,GAAG,CAACK,IAAJ,GAAWe,KAAK,GAAGL,EADJ,EAEff,GAAG,CAACO,IAAJ,GAAWc,MAAM,GAAGL,EAFL,EAGf,CAHe,EAIfhB,GAAG,CAACK,IAAJ,GAAWe,KAAK,GAAG,CAJJ,EAKfpB,GAAG,CAACO,IAAJ,GAAWc,MAAM,GAAG,CALL,EAMfJ,EAAE,GAAGK,CANU,CAAjB;EAQAxC,OAAO,CAACC,KAAD,EAAQC,QAAR,CAAP;EACA,OAAOA,QAAP;AACD;AAED;;;;;;;AAMA,OAAM,SAAUyC,YAAV,CAAuBjC,OAAvB,EAA0DC,OAA1D,EAA6EiC,UAA7E,EAA+F;EACnG;EACA,IAAIjC,OAAO,CAACkC,GAAR,CAAY,eAAZ,KAAgClC,OAAO,CAACkC,GAAR,CAAY,eAAZ,MAAiCD,UAArE,EAAiF;IAC/E,OAAOjC,OAAO,CAACkC,GAAR,CAAY,SAAZ,CAAP;EACD;;EACD,IAAIC,OAAJ;EACA,IAAIC,GAAJ;EACA,IAAM5C,GAAG,GAAGL,OAAO,CAACe,IAAR,CAAa+B,UAAb,CAAZ;EACA,IAAII,MAAM,GAAG7C,GAAG,CAAC,CAAD,CAAhB;EACA,IAAM8C,MAAM,GAAG9C,GAAG,CAAC,CAAD,CAAlB,CATmG,CAWnG;;EACA,SAAS+C,MAAT,GAAe;IACb;IACAJ,OAAO,GAAGpC,OAAO,CAACyC,aAAR,CAAsBJ,GAAtB,EAA2BC,MAA3B,CAAV;IACArC,OAAO,CAACyC,GAAR,CAAY,SAAZ,EAAuBN,OAAvB,EAHa,CAGoB;;IACjCnC,OAAO,CAACyC,GAAR,CAAY,eAAZ,EAA6BR,UAA7B;EACD;;EAED,QAAQI,MAAR;IACE,KAAK,GAAL;MACEA,MAAM,GAAG,QAAT;MACA;;IACF,KAAK,GAAL;MACEA,MAAM,GAAG,UAAT;MACA;;IACF,KAAK,GAAL;MACEA,MAAM,GAAG,UAAT;MACA;;IACF,KAAK,GAAL;MACEA,MAAM,GAAG,WAAT;MACA;;IACF;MACEA,MAAM,GAAG,WAAT;EAdJ;;EAiBAD,GAAG,GAAG,IAAIM,KAAJ,EAAN,CApCmG,CAqCnG;;EACA,IAAI,CAACJ,MAAM,CAAC7C,KAAP,CAAa,SAAb,CAAL,EAA8B;IAC5B;IACA2C,GAAG,CAACO,WAAJ,GAAkB,WAAlB;EACD;;EACDP,GAAG,CAACQ,GAAJ,GAAUN,MAAV;;EAEA,IAAIF,GAAG,CAACS,QAAR,EAAkB;IAChBN,MAAM;EACP,CAFD,MAEO;IACLH,GAAG,CAACG,MAAJ,GAAaA,MAAb,CADK,CAEL;;IACAH,GAAG,CAACQ,GAAJ,GAAUR,GAAG,CAACQ,GAAd;EACD;;EAED,OAAOT,OAAP;AACD;AAED,OAAM,SAAUW,UAAV,CAAqB/C,OAArB,EAAwDC,OAAxD,EAA2E+C,KAA3E,EAAwG;EAC5G,IAAMC,IAAI,GAAGhD,OAAO,CAACQ,OAAR,EAAb;;EACA,IAAIyC,KAAK,CAACD,IAAI,CAACrC,CAAN,CAAL,IAAiBsC,KAAK,CAACD,IAAI,CAACnC,CAAN,CAAtB,IAAkCoC,KAAK,CAACD,IAAI,CAACrB,KAAN,CAAvC,IAAuDsB,KAAK,CAACD,IAAI,CAACpB,MAAN,CAAhE,EAA+E;IAC7E,OAAOmB,KAAP;EACD;;EAED,IAAIjE,QAAQ,CAACiE,KAAD,CAAZ,EAAqB;IACnB,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa,GAAb,IAAoBA,KAAK,CAAC,CAAD,CAAL,KAAa,GAArC,EAA0C;MACxC,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa,GAAjB,EAAsB;QACpB;QACA,OAAOjD,iBAAiB,CAACC,OAAD,EAAUC,OAAV,EAAmB+C,KAAnB,CAAxB;MACD;;MACD,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa,GAAjB,EAAsB;QACpB;QACA,OAAO1B,mBAAmB,CAACtB,OAAD,EAAUC,OAAV,EAAmB+C,KAAnB,CAA1B;MACD;;MACD,IAAIA,KAAK,CAAC,CAAD,CAAL,KAAa,GAAjB,EAAsB;QACpB;QACA,OAAOf,YAAY,CAACjC,OAAD,EAAUC,OAAV,EAAmB+C,KAAnB,CAAnB;MACD;IACF;;IACD,OAAOA,KAAP;EACD;;EAED,IAAGA,KAAK,YAAYG,aAApB,EAAmC;IACjC,OAAOH,KAAP;EACD;AACF;AAED,OAAM,SAAUI,WAAV,CAAsBC,MAAtB,EAA4B;EAChC,IAAIC,EAAE,GAAG,CAAT;EACA,IAAIC,EAAE,GAAG,CAAT;EACA,IAAIC,EAAE,GAAG,CAAT;EACA,IAAIC,EAAE,GAAG,CAAT;;EACA,IAAIxE,OAAO,CAACoE,MAAD,CAAX,EAAqB;IACnB,IAAIA,MAAM,CAAC1B,MAAP,KAAkB,CAAtB,EAAyB;MACvB2B,EAAE,GAAGC,EAAE,GAAGC,EAAE,GAAGC,EAAE,GAAGJ,MAAM,CAAC,CAAD,CAA1B;IACD,CAFD,MAEO,IAAIA,MAAM,CAAC1B,MAAP,KAAkB,CAAtB,EAAyB;MAC9B2B,EAAE,GAAGE,EAAE,GAAGH,MAAM,CAAC,CAAD,CAAhB;MACAE,EAAE,GAAGE,EAAE,GAAGJ,MAAM,CAAC,CAAD,CAAhB;IACD,CAHM,MAGA,IAAIA,MAAM,CAAC1B,MAAP,KAAkB,CAAtB,EAAyB;MAC9B2B,EAAE,GAAGD,MAAM,CAAC,CAAD,CAAX;MACAE,EAAE,GAAGE,EAAE,GAAGJ,MAAM,CAAC,CAAD,CAAhB;MACAG,EAAE,GAAGH,MAAM,CAAC,CAAD,CAAX;IACD,CAJM,MAIA;MACLC,EAAE,GAAGD,MAAM,CAAC,CAAD,CAAX;MACAE,EAAE,GAAGF,MAAM,CAAC,CAAD,CAAX;MACAG,EAAE,GAAGH,MAAM,CAAC,CAAD,CAAX;MACAI,EAAE,GAAGJ,MAAM,CAAC,CAAD,CAAX;IACD;EACF,CAhBD,MAgBO;IACLC,EAAE,GAAGC,EAAE,GAAGC,EAAE,GAAGC,EAAE,GAAGJ,MAApB;EACD;;EACD,OAAO,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,EAAaC,EAAb,CAAP;AACD","names":["isString","each","isArray","regexLG","regexRG","regexPR","regexColorStop","addStop","steps","gradient","arr","match","item","itemArr","split","addColorStop","parseLineGradient","context","element","gradientStr","exec","angle","parseFloat","Math","PI","box","getBBox","start","end","x","minX","y","minY","maxX","maxY","tanTheta","tan","tanTheta2","createLinearGradient","parseRadialGradient","fx","fy","fr","colors","length","width","height","r","sqrt","createRadialGradient","parsePattern","patternStr","get","pattern","img","repeat","source","onload","createPattern","set","Image","crossOrigin","src","complete","parseStyle","color","bbox","isNaN","CanvasPattern","parseRadius","radius","r1","r2","r3","r4"],"sourceRoot":"","sources":["../../src/util/parse.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}