{"ast":null,"code":"\"use strict\";\n/**\n * @fileOverview fruchterman layout\n * @author shiwu.wyy@antfin.com\n */\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FruchtermanLayout = void 0;\n\nvar base_1 = require(\"./base\");\n\nvar util_1 = require(\"../util\");\n\nvar SPEED_DIVISOR = 800;\n/**\n * fruchterman 布局\n */\n\nvar FruchtermanLayout =\n/** @class */\nfunction (_super) {\n  __extends(FruchtermanLayout, _super);\n\n  function FruchtermanLayout(options) {\n    var _this = _super.call(this) || this;\n    /** 停止迭代的最大迭代数 */\n\n\n    _this.maxIteration = 1000;\n    /** 是否启动 worker */\n\n    _this.workerEnabled = false;\n    /** 重力大小，影响图的紧凑程度 */\n\n    _this.gravity = 10;\n    /** 速度 */\n\n    _this.speed = 5;\n    /** 是否产生聚类力 */\n\n    _this.clustering = false;\n    /** 聚类力大小 */\n\n    _this.clusterGravity = 10;\n    _this.nodes = [];\n    _this.edges = [];\n    _this.width = 300;\n    _this.height = 300;\n    _this.nodeMap = {};\n    _this.nodeIdxMap = {};\n    /** 迭代结束的回调函数 */\n\n    _this.onLayoutEnd = function () {};\n    /** 每次迭代结束的回调函数 */\n\n\n    _this.tick = function () {};\n    /** 是否使用 window.setInterval 运行迭代 */\n\n\n    _this.animate = true;\n\n    _this.updateCfg(options);\n\n    return _this;\n  }\n\n  FruchtermanLayout.prototype.getDefaultCfg = function () {\n    return {\n      maxIteration: 1000,\n      gravity: 10,\n      speed: 1,\n      clustering: false,\n      clusterGravity: 10,\n      animate: true\n    };\n  };\n  /**\n   * 执行布局\n   */\n\n\n  FruchtermanLayout.prototype.execute = function () {\n    var _this = this;\n\n    var _a, _b;\n\n    var self = this;\n    var nodes = self.nodes;\n\n    if (self.timeInterval !== undefined && typeof window !== \"undefined\") {\n      window.clearInterval(self.timeInterval);\n    }\n\n    if (!nodes || nodes.length === 0) {\n      (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n      return;\n    }\n\n    if (!self.width && typeof window !== \"undefined\") {\n      self.width = window.innerWidth;\n    }\n\n    if (!self.height && typeof window !== \"undefined\") {\n      self.height = window.innerHeight;\n    }\n\n    if (!self.center) {\n      self.center = [self.width / 2, self.height / 2];\n    }\n\n    var center = self.center;\n\n    if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      (_b = self.onLayoutEnd) === null || _b === void 0 ? void 0 : _b.call(self);\n      return;\n    }\n\n    var nodeMap = {};\n    var nodeIdxMap = {};\n    nodes.forEach(function (node, i) {\n      if (!(0, util_1.isNumber)(node.x)) node.x = Math.random() * _this.width;\n      if (!(0, util_1.isNumber)(node.y)) node.y = Math.random() * _this.height;\n      nodeMap[node.id] = node;\n      nodeIdxMap[node.id] = i;\n    });\n    self.nodeMap = nodeMap;\n    self.nodeIdxMap = nodeIdxMap; // layout\n\n    return self.run();\n  };\n\n  FruchtermanLayout.prototype.run = function () {\n    var _a;\n\n    var self = this;\n    var nodes = self.nodes;\n    if (!nodes) return;\n    var edges = self.edges,\n        maxIteration = self.maxIteration,\n        workerEnabled = self.workerEnabled,\n        clustering = self.clustering,\n        animate = self.animate;\n    var clusterMap = {};\n\n    if (clustering) {\n      nodes.forEach(function (n) {\n        if (clusterMap[n.cluster] === undefined) {\n          clusterMap[n.cluster] = {\n            name: n.cluster,\n            cx: 0,\n            cy: 0,\n            count: 0\n          };\n        }\n      });\n    }\n\n    if (workerEnabled || !animate) {\n      for (var i = 0; i < maxIteration; i++) {\n        self.runOneStep(clusterMap);\n      }\n\n      (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n    } else {\n      if (typeof window === \"undefined\") return;\n      var iter_1 = 0; // interval for render the result after each iteration\n\n      this.timeInterval = window.setInterval(function () {\n        var _a;\n\n        self.runOneStep(clusterMap);\n        iter_1++;\n\n        if (iter_1 >= maxIteration) {\n          (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n          window.clearInterval(self.timeInterval);\n        }\n      }, 0);\n    }\n\n    return {\n      nodes: nodes,\n      edges: edges\n    };\n  };\n\n  FruchtermanLayout.prototype.runOneStep = function (clusterMap) {\n    var _a;\n\n    var self = this;\n    var nodes = self.nodes;\n    if (!nodes) return;\n    var edges = self.edges,\n        center = self.center,\n        gravity = self.gravity,\n        speed = self.speed,\n        clustering = self.clustering;\n    var area = self.height * self.width;\n    var maxDisplace = Math.sqrt(area) / 10;\n    var k2 = area / (nodes.length + 1);\n    var k = Math.sqrt(k2);\n    var displacements = [];\n    nodes.forEach(function (_, j) {\n      displacements[j] = {\n        x: 0,\n        y: 0\n      };\n    });\n    self.applyCalculate(nodes, edges, displacements, k, k2); // gravity for clusters\n\n    if (clustering) {\n      // re-compute the clustering centers\n      for (var key in clusterMap) {\n        clusterMap[key].cx = 0;\n        clusterMap[key].cy = 0;\n        clusterMap[key].count = 0;\n      }\n\n      nodes.forEach(function (n) {\n        var c = clusterMap[n.cluster];\n\n        if ((0, util_1.isNumber)(n.x)) {\n          c.cx += n.x;\n        }\n\n        if ((0, util_1.isNumber)(n.y)) {\n          c.cy += n.y;\n        }\n\n        c.count++;\n      });\n\n      for (var key in clusterMap) {\n        clusterMap[key].cx /= clusterMap[key].count;\n        clusterMap[key].cy /= clusterMap[key].count;\n      } // compute the cluster gravity forces\n\n\n      var clusterGravity_1 = self.clusterGravity || gravity;\n      nodes.forEach(function (n, j) {\n        if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n        var c = clusterMap[n.cluster];\n        var distLength = Math.sqrt((n.x - c.cx) * (n.x - c.cx) + (n.y - c.cy) * (n.y - c.cy));\n        var gravityForce = k * clusterGravity_1;\n        displacements[j].x -= gravityForce * (n.x - c.cx) / distLength;\n        displacements[j].y -= gravityForce * (n.y - c.cy) / distLength;\n      });\n    } // gravity\n\n\n    nodes.forEach(function (n, j) {\n      if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n      var gravityForce = 0.01 * k * gravity;\n      displacements[j].x -= gravityForce * (n.x - center[0]);\n      displacements[j].y -= gravityForce * (n.y - center[1]);\n    }); // move\n\n    nodes.forEach(function (n, j) {\n      if ((0, util_1.isNumber)(n.fx) && (0, util_1.isNumber)(n.fy)) {\n        n.x = n.fx;\n        n.y = n.fy;\n        return;\n      }\n\n      if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n      var distLength = Math.sqrt(displacements[j].x * displacements[j].x + displacements[j].y * displacements[j].y);\n\n      if (distLength > 0) {\n        // && !n.isFixed()\n        var limitedDist = Math.min(maxDisplace * (speed / SPEED_DIVISOR), distLength);\n        n.x += displacements[j].x / distLength * limitedDist;\n        n.y += displacements[j].y / distLength * limitedDist;\n      }\n    });\n    (_a = self.tick) === null || _a === void 0 ? void 0 : _a.call(self);\n  };\n\n  FruchtermanLayout.prototype.applyCalculate = function (nodes, edges, displacements, k, k2) {\n    var self = this;\n    self.calRepulsive(nodes, displacements, k2);\n    if (edges) self.calAttractive(edges, displacements, k);\n  };\n\n  FruchtermanLayout.prototype.calRepulsive = function (nodes, displacements, k2) {\n    nodes.forEach(function (v, i) {\n      displacements[i] = {\n        x: 0,\n        y: 0\n      };\n      nodes.forEach(function (u, j) {\n        if (i === j) {\n          return;\n        }\n\n        if (!(0, util_1.isNumber)(v.x) || !(0, util_1.isNumber)(u.x) || !(0, util_1.isNumber)(v.y) || !(0, util_1.isNumber)(u.y)) {\n          return;\n        }\n\n        var vecX = v.x - u.x;\n        var vecY = v.y - u.y;\n        var vecLengthSqr = vecX * vecX + vecY * vecY;\n\n        if (vecLengthSqr === 0) {\n          vecLengthSqr = 1;\n          var sign = i > j ? 1 : -1;\n          vecX = 0.01 * sign;\n          vecY = 0.01 * sign;\n        }\n\n        var common = k2 / vecLengthSqr;\n        displacements[i].x += vecX * common;\n        displacements[i].y += vecY * common;\n      });\n    });\n  };\n\n  FruchtermanLayout.prototype.calAttractive = function (edges, displacements, k) {\n    var _this = this;\n\n    edges.forEach(function (e) {\n      var source = (0, util_1.getEdgeTerminal)(e, 'source');\n      var target = (0, util_1.getEdgeTerminal)(e, 'target');\n      if (!source || !target) return;\n      var uIndex = _this.nodeIdxMap[source];\n      var vIndex = _this.nodeIdxMap[target];\n\n      if (uIndex === vIndex) {\n        return;\n      }\n\n      var u = _this.nodeMap[source];\n      var v = _this.nodeMap[target];\n\n      if (!(0, util_1.isNumber)(v.x) || !(0, util_1.isNumber)(u.x) || !(0, util_1.isNumber)(v.y) || !(0, util_1.isNumber)(u.y)) {\n        return;\n      }\n\n      var vecX = v.x - u.x;\n      var vecY = v.y - u.y;\n      var vecLength = Math.sqrt(vecX * vecX + vecY * vecY);\n      var common = vecLength * vecLength / k;\n      displacements[vIndex].x -= vecX / vecLength * common;\n      displacements[vIndex].y -= vecY / vecLength * common;\n      displacements[uIndex].x += vecX / vecLength * common;\n      displacements[uIndex].y += vecY / vecLength * common;\n    });\n  };\n\n  FruchtermanLayout.prototype.stop = function () {\n    if (this.timeInterval && typeof window !== \"undefined\") {\n      window.clearInterval(this.timeInterval);\n    }\n  };\n\n  FruchtermanLayout.prototype.destroy = function () {\n    var self = this;\n    self.stop();\n    self.tick = null;\n    self.nodes = null;\n    self.edges = null;\n    self.destroyed = true;\n  };\n\n  FruchtermanLayout.prototype.getType = function () {\n    return \"fruchterman\";\n  };\n\n  return FruchtermanLayout;\n}(base_1.Base);\n\nexports.FruchtermanLayout = FruchtermanLayout;","map":{"version":3,"mappings":"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","names":["SPEED_DIVISOR","__extends","options","_super","_this","updateCfg","FruchtermanLayout","maxIteration","gravity","speed","clustering","clusterGravity","animate","self","nodes","timeInterval","undefined","window","clearInterval","length","onLayoutEnd","_a","width","innerWidth","height","innerHeight","center","x","y","_b","nodeMap","nodeIdxMap","forEach","node","i","Math","random","id","run","workerEnabled","clusterMap","n","cluster","name","cx","cy","count","runOneStep","iter_1","setInterval","edges","area","maxDisplace","sqrt","k2","k","displacements","_","j","applyCalculate","key","c","clusterGravity_1","distLength","gravityForce","fx","fy","limitedDist","min","tick","calRepulsive","calAttractive","v","u","vecX","vecY","vecLengthSqr","sign","common","e","source","target","uIndex","vIndex","vecLength","stop","destroyed","base_1","exports"],"sourceRoot":"","sources":["../../src/layout/fruchterman.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}